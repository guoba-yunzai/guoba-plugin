var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value:value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__spreadProps=(a,b)=>__defProps(a,__getOwnPropDescs(b));import{aa as useI18n,d as defineComponent,z as useDesign,A as computed,b as _export_sfc,c as resolveComponent,o as openBlock,e as createElementBlock,F as Fragment,ar as renderSlot,h as createBlock,i as withCtx,k as createTextVNode,m as toDisplayString,H as mergeProps,B as createCommentVNode,C as normalizeClass,Y as normalizeStyle,bq as BasicTitle,p as propTypes,E as createBaseVNode,j as createVNode,aL as ScrollContainer,r as ref,M as useAttrs,w as watch,aq as getCurrentInstance,bs as deepMerge,D as unref,ae as toRaw,bi as isNumber,n as nextTick,al as isFunction,aZ as resolveDirective,b0 as createSlots,V as withDirectives,f as renderList,a2 as normalizeProps,a3 as guardReactiveProps,a as reactive,bt as isEqual,bw as tryOnUnmounted,bu as isProdMode,bv as error,N as watchEffect,bj as withInstall}from"./index.js";import{D as Drawer}from"./index29.js";import{A as ArrowLeftOutlined}from"./ArrowLeftOutlined.js";const{t:t}=useI18n(),footerProps={confirmLoading:{type:Boolean},showCancelBtn:{type:Boolean,default:!0},cancelButtonProps:Object,cancelText:{type:String,default:t("common.cancelText")},showOkBtn:{type:Boolean,default:!0},okButtonProps:Object,okText:{type:String,default:t("common.okText")},okType:{type:String,default:"primary"},showFooter:{type:Boolean},footerHeight:{type:[String,Number],default:60}},basicProps=__spreadValues({isDetail:{type:Boolean},title:{type:String,default:""},loadingText:{type:String},showDetailBack:{type:Boolean,default:!0},visible:{type:Boolean},loading:{type:Boolean},maskClosable:{type:Boolean,default:!0},getContainer:{type:[Object,String]},closeFunc:{type:[Function,Object],default:null},destroyOnClose:{type:Boolean}},footerProps);const DrawerFooter=_export_sfc(defineComponent({name:"BasicDrawerFooter",props:__spreadProps(__spreadValues({},footerProps),{height:{type:String,default:"60px"}}),emits:["ok","close"],setup(props,{emit:emit}){const{prefixCls:prefixCls}=useDesign("basic-drawer-footer");return{handleOk:function(){emit("ok")},prefixCls:prefixCls,handleClose:function(){emit("close")},getStyle:computed((()=>{const heightStr=`${props.height}`;return{height:heightStr,lineHeight:`calc(${heightStr} - 1px)`}}))}}}),[["render",function(_ctx,_cache,$props,$setup,$data,$options){const _component_a_button=resolveComponent("a-button");return _ctx.showFooter||_ctx.$slots.footer?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(_ctx.prefixCls),style:normalizeStyle(_ctx.getStyle)},[_ctx.$slots.footer?renderSlot(_ctx.$slots,"footer",{key:1}):(openBlock(),createElementBlock(Fragment,{key:0},[renderSlot(_ctx.$slots,"insertFooter"),_ctx.showCancelBtn?(openBlock(),createBlock(_component_a_button,mergeProps({key:0},_ctx.cancelButtonProps,{onClick:_ctx.handleClose,class:"mr-2"}),{default:withCtx((()=>[createTextVNode(toDisplayString(_ctx.cancelText),1)])),_:1},16,["onClick"])):createCommentVNode("",!0),renderSlot(_ctx.$slots,"centerFooter"),_ctx.showOkBtn?(openBlock(),createBlock(_component_a_button,mergeProps({key:1,type:_ctx.okType,onClick:_ctx.handleOk},_ctx.okButtonProps,{class:"mr-2",loading:_ctx.confirmLoading}),{default:withCtx((()=>[createTextVNode(toDisplayString(_ctx.okText),1)])),_:1},16,["type","onClick","loading"])):createCommentVNode("",!0),renderSlot(_ctx.$slots,"appendFooter")],64))],6)):createCommentVNode("",!0)}]]),_sfc_main$1=defineComponent({name:"BasicDrawerHeader",components:{BasicTitle:BasicTitle,ArrowLeftOutlined:ArrowLeftOutlined},props:{isDetail:propTypes.bool,showDetailBack:propTypes.bool,title:propTypes.string},emits:["close"],setup(_,{emit:emit}){const{prefixCls:prefixCls}=useDesign("basic-drawer-header");return{prefixCls:prefixCls,handleClose:function(){emit("close")}}}}),_hoisted_1={key:1};const basicDrawer=_export_sfc(defineComponent({components:{Drawer:Drawer,ScrollContainer:ScrollContainer,DrawerFooter:DrawerFooter,DrawerHeader:_export_sfc(_sfc_main$1,[["render",function(_ctx,_cache,$props,$setup,$data,$options){const _component_BasicTitle=resolveComponent("BasicTitle"),_component_ArrowLeftOutlined=resolveComponent("ArrowLeftOutlined");return _ctx.isDetail?(openBlock(),createElementBlock("div",{key:1,class:normalizeClass([_ctx.prefixCls,`${_ctx.prefixCls}--detail`])},[createBaseVNode("span",{class:normalizeClass(`${_ctx.prefixCls}__twrap`)},[_ctx.showDetailBack?(openBlock(),createElementBlock("span",{key:0,onClick:_cache[0]||(_cache[0]=(...args)=>_ctx.handleClose&&_ctx.handleClose(...args))},[createVNode(_component_ArrowLeftOutlined,{class:normalizeClass(`${_ctx.prefixCls}__back`)},null,8,["class"])])):createCommentVNode("",!0),_ctx.title?(openBlock(),createElementBlock("span",_hoisted_1,toDisplayString(_ctx.title),1)):createCommentVNode("",!0)],2),createBaseVNode("span",{class:normalizeClass(`${_ctx.prefixCls}__toolbar`)},[renderSlot(_ctx.$slots,"titleToolbar")],2)],2)):(openBlock(),createBlock(_component_BasicTitle,{key:0,class:normalizeClass(_ctx.prefixCls)},{default:withCtx((()=>[renderSlot(_ctx.$slots,"title"),createTextVNode(" "+toDisplayString(_ctx.$slots.title?"":_ctx.title),1)])),_:3},8,["class"]))}]])},inheritAttrs:!1,props:basicProps,emits:["visible-change","ok","close","register"],setup(props,{emit:emit}){const visibleRef=ref(!1),attrs=useAttrs(),propsRef=ref(null),{t:t2}=useI18n(),{prefixVar:prefixVar,prefixCls:prefixCls}=useDesign("basic-drawer"),drawerInstance={setDrawerProps:function(props2){propsRef.value=deepMerge(unref(propsRef)||{},props2),Reflect.has(props2,"visible")&&(visibleRef.value=!!props2.visible)},emitVisible:void 0},instance=getCurrentInstance();instance&&emit("register",drawerInstance,instance.uid);const getMergeProps=computed((()=>deepMerge(toRaw(props),unref(propsRef)))),getProps=computed((()=>{const opt=__spreadProps(__spreadValues(__spreadValues({placement:"right"},unref(attrs)),unref(getMergeProps)),{visible:unref(visibleRef)});opt.title=void 0;const{isDetail:isDetail,width:width,wrapClassName:wrapClassName,getContainer:getContainer}=opt;if(isDetail){width||(opt.width="100%");const detailCls=`${prefixCls}__detail`;opt.class=wrapClassName?`${wrapClassName} ${detailCls}`:detailCls,getContainer||(opt.getContainer=`.${prefixVar}-layout-content`)}return opt})),getBindValues=computed((()=>__spreadValues(__spreadValues({},attrs),unref(getProps)))),getFooterHeight=computed((()=>{const{footerHeight:footerHeight,showFooter:showFooter}=unref(getProps);return showFooter&&footerHeight?isNumber(footerHeight)?`${footerHeight}px`:`${footerHeight.replace("px","")}px`:"0px"})),getScrollContentStyle=computed((()=>({position:"relative",height:`calc(100% - ${unref(getFooterHeight)})`}))),getLoading=computed((()=>{var _a;return!!(null==(_a=unref(getProps))?void 0:_a.loading)}));return watch((()=>props.visible),((newVal,oldVal)=>{newVal!==oldVal&&(visibleRef.value=newVal)}),{deep:!0}),watch((()=>visibleRef.value),(visible=>{nextTick((()=>{var _a;emit("visible-change",visible),instance&&(null==(_a=drawerInstance.emitVisible)||_a.call(drawerInstance,visible,instance.uid))}))})),{onClose:function(e){return __this=this,__arguments=null,generator=function*(){const{closeFunc:closeFunc}=unref(getProps);if(emit("close",e),closeFunc&&isFunction(closeFunc)){const res=yield closeFunc();visibleRef.value=!res}else visibleRef.value=!1},new Promise(((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())}));var __this,__arguments,generator},t:t2,prefixCls:prefixCls,getMergeProps:getMergeProps,getScrollContentStyle:getScrollContentStyle,getProps:getProps,getLoading:getLoading,getBindValues:getBindValues,getFooterHeight:getFooterHeight,handleOk:function(){emit("ok")}}}}),[["render",function(_ctx,_cache,$props,$setup,$data,$options){const _component_DrawerHeader=resolveComponent("DrawerHeader"),_component_ScrollContainer=resolveComponent("ScrollContainer"),_component_DrawerFooter=resolveComponent("DrawerFooter"),_component_Drawer=resolveComponent("Drawer"),_directive_loading=resolveDirective("loading");return openBlock(),createBlock(_component_Drawer,mergeProps({class:_ctx.prefixCls,onClose:_ctx.onClose},_ctx.getBindValues),createSlots({default:withCtx((()=>[withDirectives((openBlock(),createBlock(_component_ScrollContainer,{style:normalizeStyle(_ctx.getScrollContentStyle),"loading-tip":_ctx.loadingText||_ctx.t("common.loadingText")},{default:withCtx((()=>[renderSlot(_ctx.$slots,"default")])),_:3},8,["style","loading-tip"])),[[_directive_loading,_ctx.getLoading]]),createVNode(_component_DrawerFooter,mergeProps(_ctx.getProps,{onClose:_ctx.onClose,onOk:_ctx.handleOk,height:_ctx.getFooterHeight}),createSlots({_:2},[renderList(Object.keys(_ctx.$slots),(item=>({name:item,fn:withCtx((data=>[renderSlot(_ctx.$slots,item,normalizeProps(guardReactiveProps(data||{})))]))})))]),1040,["onClose","onOk","height"])])),_:2},[_ctx.$slots.title?{name:"title",fn:withCtx((()=>[renderSlot(_ctx.$slots,"title")])),key:"1"}:{name:"title",fn:withCtx((()=>[createVNode(_component_DrawerHeader,{title:_ctx.getMergeProps.title,isDetail:_ctx.isDetail,showDetailBack:_ctx.showDetailBack,onClose:_ctx.onClose},{titleToolbar:withCtx((()=>[renderSlot(_ctx.$slots,"titleToolbar")])),_:3},8,["title","isDetail","showDetailBack","onClose"])])),key:"0"}]),1040,["class","onClose"])}]]),dataTransferRef=reactive({}),visibleData=reactive({});function useDrawer(){if(!getCurrentInstance())throw new Error("useDrawer() can only be used inside setup() or functional components!");const drawer=ref(null),loaded=ref(!1),uid=ref("");const getInstance=()=>{const instance=unref(drawer);return instance||error("useDrawer instance is undefined!"),instance};return[function(drawerInstance,uuid){tryOnUnmounted((()=>{drawer.value=null,loaded.value=null,dataTransferRef[unref(uid)]=null})),unref(loaded)&&isProdMode()&&drawerInstance===unref(drawer)||(uid.value=uuid,drawer.value=drawerInstance,loaded.value=!0,drawerInstance.emitVisible=(visible,uid2)=>{visibleData[uid2]=visible})},{setDrawerProps:props=>{var _a;null==(_a=getInstance())||_a.setDrawerProps(props)},getVisible:computed((()=>visibleData[~~unref(uid)])),openDrawer:(visible=!0,data,openOnSet=!0)=>{var _a;if(null==(_a=getInstance())||_a.setDrawerProps({visible:visible}),!data)return;if(openOnSet)return dataTransferRef[unref(uid)]=null,void(dataTransferRef[unref(uid)]=toRaw(data));isEqual(toRaw(dataTransferRef[unref(uid)]),toRaw(data))||(dataTransferRef[unref(uid)]=toRaw(data))},closeDrawer:()=>{var _a;null==(_a=getInstance())||_a.setDrawerProps({visible:!1})}}]}const useDrawerInner=callbackFn=>{const drawerInstanceRef=ref(null),currentInstance=getCurrentInstance(),uidRef=ref("");if(!getCurrentInstance())throw new Error("useDrawerInner() can only be used inside setup() or functional components!");const getInstance=()=>{const instance=unref(drawerInstanceRef);if(instance)return instance;error("useDrawerInner instance is undefined!")};return watchEffect((()=>{const data=dataTransferRef[unref(uidRef)];data&&callbackFn&&isFunction(callbackFn)&&nextTick((()=>{callbackFn(data)}))})),[(modalInstance,uuid)=>{tryOnUnmounted((()=>{drawerInstanceRef.value=null})),uidRef.value=uuid,drawerInstanceRef.value=modalInstance,null==currentInstance||currentInstance.emit("register",modalInstance,uuid)},{changeLoading:(loading=!0)=>{var _a;null==(_a=getInstance())||_a.setDrawerProps({loading:loading})},changeOkLoading:(loading=!0)=>{var _a;null==(_a=getInstance())||_a.setDrawerProps({confirmLoading:loading})},getVisible:computed((()=>visibleData[~~unref(uidRef)])),closeDrawer:()=>{var _a;null==(_a=getInstance())||_a.setDrawerProps({visible:!1})},setDrawerProps:props=>{var _a;null==(_a=getInstance())||_a.setDrawerProps(props)}}]},BasicDrawer=withInstall(basicDrawer);export{BasicDrawer as B,useDrawer as a,useDrawerInner as u};
