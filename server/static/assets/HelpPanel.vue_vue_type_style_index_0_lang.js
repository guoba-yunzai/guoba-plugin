var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value:value}):obj[key]=value,__async=(__this,__arguments,generator)=>new Promise(((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())}));import EditBodyModal from"./EditBodyModal2.js";import{d as defineComponent,g4 as getAppEnvConfig,g5 as createLocalStorage,aC as usePermissionStore,z as useDesign,r as ref,w as watch,c as resolveComponent,o as openBlock,e as createElementBlock,E as createBaseVNode,j as createVNode,i as withCtx,Y as normalizeStyle,m as toDisplayString,F as Fragment,f as renderList,h as createBlock,D as unref,B as createCommentVNode,k as createTextVNode,C as normalizeClass,ay as useDebounceFn,y as useMessage}from"./index.js";import{a as useModal}from"./index19.js";import{c as cssExpand}from"./common.js";import{HelpTable}from"./HelpComps.js";import{_ as _sfc_main$1}from"./UploadIconHelpModal.vue_vue_type_script_setup_true_lang2.js";import{c as getThemeConfig,g as getHelpIconList}from"./miao.api.js";import{l as lodash}from"./lodash.default.js";const _hoisted_1={class:"container"},_hoisted_2={class:"setting-box"},_hoisted_3=createBaseVNode("input",{type:"file",id:"upload-bg",style:{display:"none"},name:"icon",accept:"image/bmp,image/jpeg,image/png"},null,-1),_hoisted_4=createBaseVNode("input",{type:"file",id:"upload-icon",style:{display:"none"},name:"icon",accept:"image/png"},null,-1),_hoisted_5={class:"info-box"},_hoisted_6={class:"head-box type"},_hoisted_7={class:"title"},_hoisted_8={class:"label"},_hoisted_9=["onClick"],_hoisted_10={class:"copyright"},_hoisted_11={class:"version"},_hoisted_12={class:"version"},_sfc_main=defineComponent({__name:"HelpPanel",props:{helpCfg:Object,helpList:Object,bgB64:String,mainB64:String,cacheVer:Number,themeName:String,themeNames:Array,iconB64List:Array,modelData:Object,themeStyle:Object,versions:Object},emits:["update:themeStyle","update:modelData","update:mainB64","update:iconB64List","open-setting"],setup(__props,{emit:__emit}){const{VITE_PUBLIC_PATH:VITE_PUBLIC_PATH}=getAppEnvConfig(),props=__props,emit=__emit,ls=createLocalStorage(),permStore=usePermissionStore(),{prefixCls:prefixCls}=useDesign("miao-plugin-help-panel"),{createMessage:$message}=useMessage(),[registerUihModal,uihModal]=useModal(),scale=ref(1),colCount=ref(3),boxWidth=ref(850),watchCfgHandler=()=>{let config=function(){let{helpCfg:helpCfg}=props;if(!helpCfg)return{style:"",colCount:3};let colCount2=Math.min(5,Math.max(parseInt(null==helpCfg?void 0:helpCfg.colCount)||3,2)),colWidth=Math.min(500,Math.max(100,parseInt(null==helpCfg?void 0:helpCfg.colWidth)||265)),width=Math.min(2500,Math.max(800,colCount2*colWidth+30)),ret=[];ret.push(`.${prefixCls} { width:${width}px; }`),ret.push(`.${prefixCls} .help-table .td,.help-table .th{width:${100/colCount2}%}`);let themePath=`${VITE_PUBLIC_PATH}/api/plugin/miao/help/theme/$s?token=${permStore.liteToken}&themeName=${props.themeName}&_v=${props.cacheVer}`,themeBg=themePath.replace("$s","bg"),themeMain=themePath.replace("$s","main");props.mainB64&&(themeMain=props.mainB64);let background=`background: url(${themeMain}) top left/100% auto no-repeat,url(${themeBg})`;ret.push(`.${prefixCls} .container { width:${width}px; ${background}; }`);let css=function(sel,css2,key,def,fn){let val=function(...args){for(let item of args)if(!lodash.isUndefined(item))return item}(props.themeStyle[key],def);fn&&(val=fn(val)),ret.push(`.${prefixCls} ${sel}{${css2}:${val}}`)};return css(".help-title,.help-group","color","fontColor","#ceb78b"),css(".help-title,.help-group","text-shadow","fontShadow","none"),css(".help-desc","color","descColor","#eee"),css(".help-desc","text-shadow","descShadow","none"),css(".cont-box","background","contBgColor","rgba(43, 52, 61, 0.8)"),css(".cont-box","backdrop-filter","contBgBlur",3,(n=>!1===(null==helpCfg?void 0:helpCfg.bgBlur)?"none":`blur(${n}px)`)),css(".help-group","background","headerBgColor","rgba(34, 41, 51, .4)"),css(".help-table .tr:nth-child(odd)","background","rowBgColor1","rgba(34, 41, 51, .2)"),css(".help-table .tr:nth-child(even)","background","rowBgColor2","rgba(34, 41, 51, .4)"),{style:`${ret.join("\n")}`,width:width,colCount:colCount2}}();config.style&&cssExpand(config.style,prefixCls),boxWidth.value=config.width||850,colCount.value=config.colCount},watchCfgHandlerDebounce=useDebounceFn(watchCfgHandler,300);watch([()=>props.helpCfg,()=>props.themeName],watchCfgHandlerDebounce,{immediate:!0,deep:!0}),watch((()=>props.themeStyle),watchCfgHandler,{immediate:!0,deep:!0}),watch(boxWidth,(width=>{document.body.clientWidth>=width?scale.value=1:scale.value=parseFloat((document.body.clientWidth/width).toFixed(4))}),{immediate:!0}),ref([{event:"changeBackground",text:"更换背景",icon:"akar-icons:image",onClick(){getUploadBase64("upload-bg",(base64=>{emit("update:mainB64",base64)}))}},{event:"uploadIcon",text:"上传图标",icon:"fontisto:nav-icon-grid",onClick(){let fn=()=>{getUploadBase64("upload-icon",(base64=>__async(this,null,(function*(){let iconList=yield getHelpIconList(base64);emit("update:iconB64List",iconList),$message.success("上传成功")}))))};!0===ls.get("hide-upload-icon-help-modal",!1)?fn():uihModal.openModal(!0,fn)}}]),watch((()=>props.themeName),(themeName=>__async(this,null,(function*(){emit("update:themeStyle",yield getThemeConfig(themeName))}))),{immediate:!0});const isBindEvent={};function getUploadBase64(inputId,callback){let input=document.getElementById(inputId);isBindEvent[inputId]||(isBindEvent[inputId]=!0,input.addEventListener("change",(ev=>{let files=ev.target.files;if(0!==files.length){let file=files[0],Reader=new FileReader;Reader.readAsDataURL(file),Reader.onload=()=>{callback(Reader.result),input.value=null}}}))),input.click()}const clickBody=(cell,cellIndex,group,groupIndex)=>{var _a,_b;let isShow=!0;(null==(_a=props.modelData)?void 0:_a.show)&&cell&&cell===(null==(_b=props.modelData)?void 0:_b.cell)&&(isShow=!1),emit("update:modelData",{show:isShow,cell:cell,cellIndex:cellIndex,group:group,groupIndex:groupIndex})};function onOpenSetting(){var a;emit("open-setting"),emit("update:modelData",(a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a})({},props.modelData),__defProps(a,__getOwnPropDescs({show:!1}))))}return(_ctx,_cache)=>{const _component_Icon=resolveComponent("Icon"),_component_a_button=resolveComponent("a-button");return openBlock(),createElementBlock("div",{class:normalizeClass([unref(prefixCls)]),style:normalizeStyle(`transform: scale(${scale.value});transform-origin: center top;`)},[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[_hoisted_3,_hoisted_4,createVNode(_component_a_button,{style:normalizeStyle(`transform: scale(${1/scale.value});transform-origin: right top;`),type:"primary",shape:"circle",size:"large",onClick:onOpenSetting},{default:withCtx((()=>[createVNode(_component_Icon,{icon:"ion:settings-outline"})])),_:1},8,["style"])]),createBaseVNode("div",_hoisted_5,[createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,toDisplayString(__props.helpCfg.title),1),createBaseVNode("div",_hoisted_8,toDisplayString(__props.helpCfg.subTitle),1)])]),(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.helpList,((group,groupIndex)=>{var _a;return openBlock(),createElementBlock("div",{class:"cont-box",key:groupIndex},[createBaseVNode("div",{class:"help-group",onClick:$event=>clickBody(null,null,group,groupIndex)},[createBaseVNode("span",null,toDisplayString(group.group),1)],8,_hoisted_9),(null==(_a=group.list)?void 0:_a.length)?(openBlock(),createBlock(unref(HelpTable),{key:0,list:group.list,colCount:colCount.value,iconB64List:__props.iconB64List,modelData:__props.modelData,onOpen:(cell,cellIndex)=>clickBody(cell,cellIndex,group,groupIndex)},null,8,["list","colCount","iconB64List","modelData","onOpen"])):createCommentVNode("",!0)])})),128)),createBaseVNode("div",_hoisted_10,[createTextVNode(" Created By Yunzai-Bot "),createBaseVNode("span",_hoisted_11,toDisplayString(__props.versions.yunzai),1),createTextVNode(" & Miao-Plugin "),createBaseVNode("span",_hoisted_12,toDisplayString(__props.versions.miao),1)])]),createVNode(EditBodyModal,{panelCls:unref(prefixCls),helpList:__props.helpList,modelData:__props.modelData,iconB64List:__props.iconB64List,"onUpdate:modelData":_cache[0]||(_cache[0]=$event=>emit("update:modelData",$event))},null,8,["panelCls","helpList","modelData","iconB64List"]),createVNode(_sfc_main$1,{onRegister:unref(registerUihModal)},null,8,["onRegister"])],6)}}});export{_sfc_main as _};
