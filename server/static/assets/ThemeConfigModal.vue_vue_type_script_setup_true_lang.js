var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value:value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__async=(__this,__arguments,generator)=>new Promise(((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())}));import BasicForm from"./BasicForm.js";import"./BasicForm.vue_vue_type_style_index_0_lang.js";import{d as defineComponent,M as useAttrs,r as ref,G as useForm,A as computed,D as unref,bf as cloneDeep,c as resolveComponent,o as openBlock,h as createBlock,i as withCtx,j as createVNode,H as mergeProps,y as useMessage}from"./index.js";import{u as useModalInner,B as BasicModal}from"./index19.js";import{s as saveThemeConfig}from"./miao.api.js";import{u as useThemeConfigSchemas}from"./miao.data.js";const _sfc_main=defineComponent({__name:"ThemeConfigModal",props:{},emits:["register","success"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,attrs=useAttrs(),{createMessage:$message}=useMessage(),loading=ref(!1),model=ref(),themeName=ref(),[registerModal,{closeModal:closeModal,setModalProps:setModalProps}]=useModalInner((function(item){return __async(this,null,(function*(){yield resetFields(),themeName.value=item.name,model.value=cloneDeep(null==item?void 0:item.style),yield setFieldsValue(__spreadValues({},model.value))}))}));let schemas=useThemeConfigSchemas();const[registerForm,{resetFields:resetFields,setFieldsValue:setFieldsValue,validate:validate}]=useForm({schemas:schemas,labelWidth:120,labelAlign:"right",labelCol:{xs:24,sm:5},wrapperCol:{xs:24,sm:19},showActionButtonGroup:!1,baseColProps:{span:24}}),getProps=computed((()=>{let modalProps={width:600,title:`编辑皮肤（${themeName.value}）`,confirmLoading:unref(loading)};var a;return a=__spreadValues(__spreadValues(__spreadValues({},unref(attrs)),modalProps),props),__defProps(a,__getOwnPropDescs({onOk:onSubmit,onCancel:close,onRegister:registerModal}))}));function close(){closeModal()}function onSubmit(){return __async(this,null,(function*(){try{let values=yield validate(),formData=Object.assign({},model.value,values);setLoading(!0),yield saveThemeConfig(themeName.value,formData),$message.success("保存成功~"),close(),emit("success")}finally{setLoading(!1)}}))}function setLoading(flag){loading.value=flag,setModalProps({confirmLoading:flag})}return(_ctx,_cache)=>{const _component_a_spin=resolveComponent("a-spin");return openBlock(),createBlock(unref(BasicModal),mergeProps(getProps.value,{destroyOnClose:""}),{default:withCtx((()=>[createVNode(_component_a_spin,{wrapperClassName:"p-2",spinning:loading.value},{default:withCtx((()=>[createVNode(unref(BasicForm),{onRegister:unref(registerForm)},null,8,["onRegister"])])),_:1},8,["spinning"])])),_:1},16)}}});export{_sfc_main as _};
