var __async=(__this,__arguments,generator)=>new Promise(((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())}));import{x as defHttp,D as unref,y as useMessage}from"./index.js";import{d as dataURLtoBlob,b as blobToDataUrl}from"./base64Conver.js";function getMiaoHelpCfg(){return defHttp.get({url:"/plugin/miao/help"},{errorMessageMode:"modal"})}function saveMiaoHelpCfg(helpCfg,helpList,iconB64List,mainB64){return __async(this,null,(function*(){let formData=new FormData;return formData.append("helpCfg",JSON.stringify(unref(helpCfg),null,2)),formData.append("helpList",JSON.stringify(unref(helpList),null,2)),formData.append("icon",yield function(iconB64List){return __async(this,null,(function*(){let{createMessage:$message}=useMessage(),cvs=document.createElement("canvas");cvs.width=1e3,cvs.height=100*Math.ceil((iconB64List.length-1)/10);let x,y,ctx=cvs.getContext("2d");for(let i=0;i<iconB64List.length;i++){let base64=iconB64List[i+1];if(!base64)continue;let img=new Image;y=Math.floor(i/10),x=i-10*y,img.src=base64;try{yield waitOnload(img)}catch(e){console.error(e),$message.error(`第 ${i+1} 个图标保存失败`);continue}ctx.drawImage(img,100*x,100*y,100,100)}return new Promise((resolve=>cvs.toBlob(resolve)))}))}(unref(iconB64List))),unref(mainB64)&&formData.append("main",yield dataURLtoBlob(unref(mainB64))),defHttp.post({url:"/plugin/miao/help",params:formData,timeout:-1},{errorMessageMode:"modal"})}))}function getHelpIconList(base64){return __async(this,null,(function*(){base64||(base64=yield function(url){return __async(this,null,(function*(){let blob=(yield defHttp.get({url:url,responseType:"blob",timeout:-1},{isTransformResponse:!1,isReturnNativeResponse:!0,errorMessageMode:"modal"})).data;return yield blobToDataUrl(blob)}))}("/plugin/miao/help/icon"));let img=new Image;return img.src=base64,yield waitOnload(img),yield function(img){return new Promise((resolve=>{img.setAttribute("crossOrigin","Anonymous");let cvs=document.createElement("canvas");cvs.width=100,cvs.height=100;let ctx=cvs.getContext("2d");if(ctx){let x,y,iconList=[],length=Math.round(img.height/10);for(let i=0;i<length;i++)y=Math.floor(i/10),x=i-10*y,ctx.drawImage(img,100*x,100*y,100,100,0,0,100,100),iconList[i+1]=cvs.toDataURL(),ctx.clearRect(0,0,100,100);resolve(iconList)}else resolve(null)}))}(img)}))}function waitOnload(img){return __async(this,null,(function*(){return new Promise(((resolve,reject)=>{img.onload=resolve,img.onerror=reject}))}))}function getBackupList(){return defHttp.get({url:"/plugin/miao/help/backup/list"},{errorMessageMode:"modal"})}function addBackup(remark){return defHttp.post({url:"/plugin/miao/help/backup",params:{remark:remark}},{errorMessageMode:"modal"})}function restoreBackup(id){return defHttp.post({url:"/plugin/miao/help/backup/restore",params:{id:id}},{errorMessageMode:"modal"})}function deleteBackup(id){return defHttp.delete({url:"/plugin/miao/help/backup/delete",params:{id:id}},{errorMessageMode:"modal"})}function getThemeList(){return defHttp.get({url:"/plugin/miao/help/theme/list"},{errorMessageMode:"modal"})}function getThemeConfig(themeName){return __async(this,null,(function*(){var _a;const cfg=yield defHttp.get({url:"/plugin/miao/help/theme/config",params:{themeName:themeName||"default"}},{errorMessageMode:"modal"});return cfg.descShadow=null!=(_a=cfg.descShadow)?_a:"none",cfg}))}function saveThemeConfig(themeName,config){return defHttp.post({url:"/plugin/miao/help/theme/config",params:{themeName:themeName,config:config}},{errorMessageMode:"modal"})}function addThemeItem(themeName,mainPic){return __async(this,null,(function*(){let formData=new FormData;return formData.append("themeName",themeName),formData.append("mainPic",mainPic),defHttp.post({url:"/plugin/miao/help/theme/action",params:formData,timeout:-1},{errorMessageMode:"modal"})}))}function putThemeItem(themeName,mainPic){return __async(this,null,(function*(){let formData=new FormData;return formData.append("themeName",themeName),formData.append("mainPic",mainPic),defHttp.post({url:"/plugin/miao/help/theme/action_put",params:formData,timeout:-1},{errorMessageMode:"modal"})}))}function deleteThemeItem(themeName){return __async(this,null,(function*(){return defHttp.delete({url:"/plugin/miao/help/theme/action",params:{themeName:themeName},timeout:-1},{errorMessageMode:"modal"})}))}export{getBackupList as a,addBackup as b,getThemeConfig as c,deleteBackup as d,getThemeList as e,addThemeItem as f,getHelpIconList as g,deleteThemeItem as h,saveMiaoHelpCfg as i,getMiaoHelpCfg as j,putThemeItem as p,restoreBackup as r,saveThemeConfig as s};
