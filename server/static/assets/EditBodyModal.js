import{d as defineComponent,r as ref,g2 as useDraggable,w as watch,N as watchEffect,A as computed,c as resolveComponent,o as openBlock,e as createElementBlock,j as createVNode,i as withCtx,E as createBaseVNode,k as createTextVNode,Y as normalizeStyle,h as createBlock,aX as resolveDynamicComponent,D as unref,B as createCommentVNode,bm as Modal,F as Fragment,R as pushScopeId,T as popScopeId,b as _export_sfc}from"./index.js";import{S as Switch}from"./index22.js";import SelectIconModal from"./SelectIconModal.js";import"./IconUploader.js";import"./esm.js";const _withScopeId=n=>(pushScopeId("data-v-df9d6de2"),n=n(),popScopeId(),n),_hoisted_1=_withScopeId((()=>createBaseVNode("span",{class:"tip"},"按住这里可拖动",-1))),_hoisted_2={class:"p-4"},_hoisted_3={class:"row"},_hoisted_4=_withScopeId((()=>createBaseVNode("div",null,"分组",-1))),_hoisted_5={class:"flex-1"},_hoisted_6={class:"row"},_hoisted_7=_withScopeId((()=>createBaseVNode("div",null,"仅主人",-1))),_hoisted_8={class:"flex justify-between align-center flex-wrap"},_hoisted_9={class:"flex justify-start"},_hoisted_10={class:"flex flex-1 justify-end"},_hoisted_11={key:0},_hoisted_12={class:"row"},_hoisted_13=_withScopeId((()=>createBaseVNode("div",null,"标题",-1))),_hoisted_14={class:"flex-1"},_hoisted_15={class:"row"},_hoisted_16=_withScopeId((()=>createBaseVNode("div",null,"描述",-1))),_hoisted_17={class:"flex-1"},_hoisted_18={class:"flex justify-between align-center"},_hoisted_19={class:"flex justify-start"},_hoisted_20={class:"flex flex-1 justify-end"},EditBodyModal=_export_sfc(defineComponent({__name:"EditBodyModal",props:{helpList:Object,modelData:Object,iconB64List:Array},setup(__props){const props=__props,showIconModal=ref(!1),createGroup=()=>{let index=props.modelData.groupIndex;props.helpList.splice(index,0,{group:"未命名组别",list:[]}),props.modelData.group=props.helpList[index],props.modelData.cellIndex=props.modelData.cell=null},createCell=()=>{var _a;let index=null!=(_a=props.modelData.cellIndex)?_a:0;props.helpList[props.modelData.groupIndex].list.splice(index,0,{icon:1,title:"未命名项目",desc:"请添加描述"}),props.modelData.cell=props.helpList[props.modelData.groupIndex].list[index],props.modelData.cellIndex=index},moveGroup=offset=>{let temp,array=props.helpList,index=props.modelData.groupIndex;temp=array[index],array[index]=array[index+offset],array[index+offset]=temp,props.modelData.groupIndex+=offset},moveCell=offset=>{let temp,array=props.helpList[props.modelData.groupIndex].list,index=props.modelData.cellIndex;temp=array[index],array[index]=array[index+offset],array[index+offset]=temp,props.modelData.cellIndex+=offset},deleteGroup=()=>{props.helpList.splice(props.modelData.groupIndex,1),props.modelData.show=!1},deleteCell=()=>{props.helpList[props.modelData.groupIndex].list.splice(props.modelData.cellIndex,1),props.modelData.show=!1},changeIcon=()=>{showIconModal.value=!0},modalTitleRef=ref(null),{x:x,y:y,isDragging:isDragging}=useDraggable(modalTitleRef),startX=ref(0),startY=ref(0),startedDrag=ref(!1),transformX=ref(0),transformY=ref(0),preTransformX=ref(0),preTransformY=ref(0),dragRect=ref({left:0,right:0,top:0,bottom:0});watch([x,y],(()=>{if(!startedDrag.value){startX.value=x.value,startY.value=y.value;const bodyRect=document.body.getBoundingClientRect(),titleRect=modalTitleRef.value.getBoundingClientRect();dragRect.value.right=bodyRect.width-titleRect.width,dragRect.value.bottom=bodyRect.height-titleRect.height,preTransformX.value=transformX.value,preTransformY.value=transformY.value}startedDrag.value=!0})),watch(isDragging,(()=>{isDragging||(startedDrag.value=!1)})),watchEffect((()=>{startedDrag.value&&(transformX.value=preTransformX.value+Math.min(Math.max(dragRect.value.left,x.value),dragRect.value.right)-startX.value,transformY.value=preTransformY.value+Math.min(Math.max(dragRect.value.top,y.value),dragRect.value.bottom)-startY.value)}));const transformStyle=computed((()=>({transform:`translate(${transformX.value}px, ${transformY.value}px)`})));return(_ctx,_cache)=>{const _component_a_input=resolveComponent("a-input"),_component_Icon=resolveComponent("Icon"),_component_a_button=resolveComponent("a-button"),_component_a_popconfirm=resolveComponent("a-popconfirm"),_component_a_divider=resolveComponent("a-divider");return openBlock(),createElementBlock(Fragment,null,[createVNode(unref(Modal),{visible:__props.modelData.show,"onUpdate:visible":_cache[8]||(_cache[8]=$event=>__props.modelData.show=$event),closable:!1,footer:null,mask:!1},{title:withCtx((()=>[createBaseVNode("div",{ref_key:"modalTitleRef",ref:modalTitleRef,style:{width:"100%",cursor:"move",margin:"0"}},[createTextVNode(" 编辑内容 "),_hoisted_1],512)])),modalRender:withCtx((({originVNode:originVNode})=>[createBaseVNode("div",{style:normalizeStyle(transformStyle.value)},[(openBlock(),createBlock(resolveDynamicComponent(originVNode)))],4)])),default:withCtx((()=>[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[_hoisted_4,createBaseVNode("div",_hoisted_5,[createVNode(_component_a_input,{value:__props.modelData.group.group,"onUpdate:value":_cache[0]||(_cache[0]=$event=>__props.modelData.group.group=$event),placeholder:"分组"},null,8,["value"])])]),createBaseVNode("div",_hoisted_6,[_hoisted_7,createVNode(unref(Switch),{checked:__props.modelData.group.auth,"onUpdate:checked":_cache[1]||(_cache[1]=$event=>__props.modelData.group.auth=$event),checkedValue:"master","checked-children":"是","un-checked-children":"否"},null,8,["checked"])]),createBaseVNode("div",_hoisted_8,[createBaseVNode("div",_hoisted_9,[createVNode(_component_a_button,{class:"ml-4",disabled:0===__props.modelData.groupIndex,type:"primary",shape:"circle",size:"medium",onClick:_cache[2]||(_cache[2]=$event=>moveGroup(-1))},{default:withCtx((()=>[createVNode(_component_Icon,{icon:"akar-icons:arrow-up"})])),_:1},8,["disabled"]),createVNode(_component_a_button,{class:"ml-4",disabled:__props.modelData.groupIndex===__props.helpList.length-1,type:"primary",shape:"circle",size:"medium",onClick:_cache[3]||(_cache[3]=$event=>moveGroup(1))},{default:withCtx((()=>[createVNode(_component_Icon,{icon:"akar-icons:arrow-down"})])),_:1},8,["disabled"])]),createBaseVNode("div",_hoisted_10,[__props.modelData.cell?createCommentVNode("",!0):(openBlock(),createBlock(_component_a_button,{key:0,class:"ml-4",onClick:createCell},{default:withCtx((()=>[createTextVNode("添加项目 ")])),_:1})),createVNode(_component_a_button,{class:"ml-4",type:"success",onClick:createGroup},{default:withCtx((()=>[createTextVNode("添加分组")])),_:1}),createVNode(_component_a_popconfirm,{title:"确定删除？",onConfirm:deleteGroup},{default:withCtx((()=>[createVNode(_component_a_button,{class:"ml-4",type:"default",danger:""},{default:withCtx((()=>[createTextVNode("删除该组")])),_:1})])),_:1})])]),__props.modelData.cell?(openBlock(),createElementBlock("div",_hoisted_11,[createVNode(_component_a_divider,{style:{margin:"16px 0"}}),createBaseVNode("div",{class:"icon",onClick:changeIcon,style:normalizeStyle(`background: url(${__props.iconB64List[__props.modelData.cell.icon]}) 0 0 no-repeat`)},null,4),createBaseVNode("div",_hoisted_12,[_hoisted_13,createBaseVNode("div",_hoisted_14,[createVNode(_component_a_input,{value:__props.modelData.cell.title,"onUpdate:value":_cache[4]||(_cache[4]=$event=>__props.modelData.cell.title=$event),placeholder:"标题"},null,8,["value"])])]),createBaseVNode("div",_hoisted_15,[_hoisted_16,createBaseVNode("div",_hoisted_17,[createVNode(_component_a_input,{value:__props.modelData.cell.desc,"onUpdate:value":_cache[5]||(_cache[5]=$event=>__props.modelData.cell.desc=$event),placeholder:"描述"},null,8,["value"])])]),createBaseVNode("div",_hoisted_18,[createBaseVNode("div",_hoisted_19,[createVNode(_component_a_button,{class:"ml-4",disabled:0===__props.modelData.cellIndex,type:"primary",shape:"circle",size:"medium",onClick:_cache[6]||(_cache[6]=$event=>moveCell(-1))},{default:withCtx((()=>[createVNode(_component_Icon,{icon:"akar-icons:arrow-left"})])),_:1},8,["disabled"]),createVNode(_component_a_button,{class:"ml-4",disabled:__props.modelData.cellIndex===__props.helpList[__props.modelData.groupIndex].list.length-1,type:"primary",shape:"circle",size:"medium",onClick:_cache[7]||(_cache[7]=$event=>moveCell(1))},{default:withCtx((()=>[createVNode(_component_Icon,{icon:"akar-icons:arrow-right"})])),_:1},8,["disabled"])]),createBaseVNode("div",_hoisted_20,[createVNode(_component_a_button,{class:"ml-4",type:"success",onClick:createCell},{default:withCtx((()=>[createTextVNode("添加项目")])),_:1}),createVNode(_component_a_popconfirm,{title:"确定删除？",onConfirm:deleteCell},{default:withCtx((()=>[createVNode(_component_a_button,{class:"ml-4",type:"default",danger:""},{default:withCtx((()=>[createTextVNode("删除该项")])),_:1})])),_:1})])])])):createCommentVNode("",!0)])])),_:1},8,["visible"]),__props.modelData.cell?(openBlock(),createBlock(SelectIconModal,{key:0,visible:showIconModal.value,"onUpdate:visible":_cache[9]||(_cache[9]=$event=>showIconModal.value=$event),cell:__props.modelData.cell,iconB64List:__props.iconB64List},null,8,["visible","cell","iconB64List"])):createCommentVNode("",!0)],64)}}}),[["__scopeId","data-v-df9d6de2"]]);export{EditBodyModal as default};
