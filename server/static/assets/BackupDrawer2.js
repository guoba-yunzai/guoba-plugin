var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,l=(e,t)=>{for(var r in t||(t={}))a.call(t,r)&&i(e,r,t[r]);if(n)for(var r of n(t))o.call(t,r)&&i(e,r,t[r]);return e},s=(e,t,r)=>new Promise(((n,a)=>{var o=e=>{try{l(r.next(e))}catch(t){a(t)}},i=e=>{try{l(r.throw(e))}catch(t){a(t)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,i);l((r=r.apply(e,t)).next())}));import{B as u,a as c}from"./index32.js";import{x as d,s as p,aL as m,a as f,b as g,B as y,r as h,I as b,e as w,o as v,i as M,j as k,k as O,v as P,l as j,m as C,a4 as _,a5 as I,u as D}from"./index.js";import"./PathSelect.js";import{d as x,b as R}from"./base64Conver.js";function S(){return d.get({url:"/plugin/miao/help"},{errorMessageMode:"modal"})}function B(e,t,r,n){return s(this,null,(function*(){let a=new FormData;return a.append("helpCfg",JSON.stringify(p(e),null,2)),a.append("helpList",JSON.stringify(p(t),null,2)),a.append("icon",yield function(e){return s(this,null,(function*(){let{createMessage:t}=m(),r=document.createElement("canvas");r.width=1e3,r.height=100*Math.ceil((e.length-1)/10);let n,a,o=r.getContext("2d");for(let l=0;l<e.length;l++){let r=e[l+1];if(!r)continue;let s=new Image;a=Math.floor(l/10),n=l-10*a,s.src=r;try{yield A(s)}catch(i){console.error(i),t.error(`第 ${l+1} 个图标保存失败`);continue}o.drawImage(s,100*n,100*a,100,100)}return new Promise((e=>r.toBlob(e)))}))}(p(r))),p(n)&&a.append("main",yield x(p(n))),d.post({url:"/plugin/miao/help",params:a,timeout:-1},{errorMessageMode:"modal"})}))}function L(e){return s(this,null,(function*(){e||(e=yield function(e){return s(this,null,(function*(){let t=(yield d.get({url:e,responseType:"blob",timeout:-1},{isTransformResponse:!1,isReturnNativeResponse:!0,errorMessageMode:"modal"})).data;return yield R(t)}))}("/plugin/miao/help/icon"));let t=new Image;return t.src=e,yield A(t),yield function(e){return new Promise((t=>{e.setAttribute("crossOrigin","Anonymous");let r=document.createElement("canvas");r.width=100,r.height=100;let n=r.getContext("2d");if(n){let a,o,i=[],l=Math.round(e.height/10);for(let t=0;t<l;t++)o=Math.floor(t/10),a=t-10*o,n.drawImage(e,100*a,100*o,100,100,0,0,100,100),i[t+1]=r.toDataURL(),n.clearRect(0,0,100,100);t(i)}else t(null)}))}(t)}))}function A(e){return s(this,null,(function*(){return new Promise(((t,r)=>{e.onload=t,e.onerror=r}))}))}const N=g({name:"BackupDrawer",components:{BasicDrawer:u},emits:["register","reload"],setup(e,{emit:n}){const a=y(),{createMessage:o}=m(),{createPrompt:i}=D(),u=h(!1),f=h([]),[g,{closeDrawer:w,setDrawerProps:v}]=c((function(){M()}));function M(){return s(this,null,(function*(){try{O(!0),f.value=(yield d.get({url:"/plugin/miao/help/backup/list"},{errorMessageMode:"modal"})).reverse()}finally{O(!1)}}))}function k(){w()}function O(e){u.value=e,v({confirmLoading:e})}return{getProps:b((()=>{let n={width:document.body.clientWidth>=768?700:"100%",title:"喵喵帮助备份",confirmLoading:p(u)};var o;return o=l(l(l({},p(a)),n),e),t(o,r({onOk:k,onCancel:k,onRegister:g}))})),loading:u,backupList:f,onAdd:function(){i({title:"新增备份",required:!0,placeholder:"请输入备注",onOk(e){return s(this,null,(function*(){var t;yield(t=e,d.post({url:"/plugin/miao/help/backup",params:{remark:t}},{errorMessageMode:"modal"})),yield M()}))}})},onRollback:function(e){return s(this,null,(function*(){try{O(!0),yield function(e){return d.post({url:"/plugin/miao/help/backup/restore",params:{id:e}},{errorMessageMode:"modal"})}(e),n("reload")}finally{O(!1)}}))},onDelete:function(e){return s(this,null,(function*(){try{if(e.isInit)return void o.warn("初始备份不可删除");O(!0),yield(t=e.id,d.delete({url:"/plugin/miao/help/backup/delete",params:{id:t}},{errorMessageMode:"modal"})),yield M()}finally{O(!1)}var t}))}}}}),E={style:{"margin-bottom":"8px"}};var T=f(N,[["render",function(e,t,r,n,a,o){const i=w("a-button"),l=w("a-popconfirm"),s=w("a-list-item-meta"),u=w("a-list-item"),c=w("a-list"),d=w("a-spin"),p=w("BasicDrawer");return v(),M(p,_(I(e.getProps)),{default:k((()=>[O(d,{wrapperClassName:"p-2",spinning:e.loading},{default:k((()=>[P("div",E,[O(i,{type:"primary",preIcon:"ant-design:plus",onClick:e.onAdd},{default:k((()=>[j("新增备份")])),_:1},8,["onClick"])]),O(c,{size:"large",bordered:"",dataSource:e.backupList},{renderItem:k((({item:t})=>[O(u,null,{actions:k((()=>[O(l,{title:"确定要还原吗？",placement:"left",onConfirm:()=>e.onRollback(t.id)},{default:k((()=>[O(i,{type:"primary",shape:"circle",preIcon:"ant-design:undo"})])),_:2},1032,["onConfirm"]),O(l,{title:"确定要删除吗？",placement:"left",onConfirm:()=>e.onDelete(t)},{default:k((()=>[O(i,{type:"primary",shape:"circle",danger:"",preIcon:"ant-design:delete"})])),_:2},1032,["onConfirm"])])),default:k((()=>[O(s,{description:t.time},{title:k((()=>[P("span",null,C(t.remark),1)])),_:2},1032,["description"])])),_:2},1024)])),_:1},8,["dataSource"])])),_:1},8,["spinning"])])),_:1},16)}]]),z=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"}));export{T as B,L as a,z as b,S as g,B as s};
