var __async=(__this,__arguments,generator)=>new Promise(((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())}));import{d as defineComponent,r as ref,x as defHttp,c as resolveComponent,o as openBlock,h as createBlock,i as withCtx,j as createVNode,k as createTextVNode,D as unref,E as createBaseVNode,u as usePrompt,e as createElementBlock,F as Fragment,b as _export_sfc,w as watch,a as reactive,aW as Transition,dk as TransitionGroup,y as useMessage}from"./index.js";import{a as useStep}from"./hooks.js";import{u as useModalInner,B as BasicModal,a as useModal}from"./index19.js";/* empty css       *//* empty css                                                          */import{g as Tree}from"./BasicForm.vue_vue_type_style_index_0_lang.js";import{_ as _sfc_main$3}from"./ModeBox.vue_vue_type_script_setup_true_lang.js";import{_ as _sfc_main$4}from"./StepBtn.vue_vue_type_script_setup_true_lang.js";const _hoisted_1$1=["innerHTML"],_sfc_main$2=defineComponent({__name:"PathSelectModal",emits:["select","register"],setup(__props,{emit:__emit}){const DirectoryTree=Tree.DirectoryTree,emit=__emit,{createPrompt:createPrompt}=usePrompt(),loading=ref(!0),treeData=ref([]),selectedKey=ref(""),currentNode=ref(),title=ref(""),[registerModal,{closeModal:closeModal}]=useModalInner((props=>__async(this,null,(function*(){title.value=props.title,0===treeData.value.length&&function(){__async(this,null,(function*(){try{loading.value=!0,treeData.value=yield defHttp.get({url:"/sys/fs/tree/root"})}finally{loading.value=!1}}))}()}))));function onSubmit(){currentNode.value&&emit("select",currentNode.value.dataRef.path),closeModal()}function onCancel(){closeModal()}function onLoadData(treeNode){return __async(this,null,(function*(){treeNode.dataRef.children||loadChildren(treeNode.dataRef.path,treeNode)}))}function onSelect(selectedKeys,{node:node}){selectedKey.value=selectedKeys[0],currentNode.value=node}function onCreate(){if(currentNode.value){let path=currentNode.value.dataRef.path;createPrompt({title:"请输入新目录名称",required:!0,onOk(value){return __async(this,null,(function*(){loading.value=!0;try{yield defHttp.put({url:"/sys/fs/create-dir",params:{path:path,name:value}}),yield loadChildren(path,currentNode.value)}finally{loading.value=!1}}))}})}}function loadChildren(path,node){return __async(this,null,(function*(){let params={path:path};node.dataRef.children=yield defHttp.get({url:"/sys/fs/tree/children",params:params}),treeData.value=[...treeData.value]}))}return(_ctx,_cache)=>{const _component_a_spin=resolveComponent("a-spin"),_component_a_button=resolveComponent("a-button"),_component_a_col=resolveComponent("a-col"),_component_a_row=resolveComponent("a-row");return openBlock(),createBlock(unref(BasicModal),{onRegister:unref(registerModal),title:title.value,width:500,onOk:onSubmit,onCancel:onCancel},{footer:withCtx((()=>[createVNode(_component_a_row,{type:"flex",justify:"space-between"},{default:withCtx((()=>[createVNode(_component_a_col,null,{default:withCtx((()=>[createVNode(_component_a_button,{type:"primary",disabled:!currentNode.value,onClick:onCreate},{default:withCtx((()=>[createTextVNode("创建新目录")])),_:1},8,["disabled"])])),_:1}),createVNode(_component_a_col,null,{default:withCtx((()=>[createVNode(_component_a_button,{onClick:onCancel},{default:withCtx((()=>[createTextVNode("取消")])),_:1}),createVNode(_component_a_button,{type:"primary",onClick:onSubmit},{default:withCtx((()=>[createTextVNode("确定")])),_:1})])),_:1})])),_:1})])),default:withCtx((()=>[createVNode(_component_a_spin,{spinning:loading.value},{default:withCtx((()=>[createVNode(unref(DirectoryTree),{treeData:treeData.value,loadData:onLoadData,expandAction:"dblclick",onSelect:onSelect},{title:withCtx((({title:title2,key:key})=>[createBaseVNode("span",{innerHTML:title2},null,8,_hoisted_1$1)])),_:1},8,["treeData"])])),_:1},8,["spinning"])])),_:1},8,["onRegister","title"])}}}),PathSelect=_export_sfc(defineComponent({__name:"PathSelect",props:{value:String,title:{type:String,default:"选择目录"},onlyDir:{type:Boolean,default:!0},beforeSelect:Function},emits:["update:value"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,[registerModal,{openModal:openModal}]=useModal();function onOpen(){openModal(!0,props)}function onSelect(path){"function"==typeof props.beforeSelect&&(path=props.beforeSelect(path)),updateValue(path)}function updateValue(value){emit("update:value",value)}return(_ctx,_cache)=>{const _component_a_input=resolveComponent("a-input");return openBlock(),createElementBlock(Fragment,null,[createVNode(_component_a_input,{class:"file-select-input",value:__props.value,placeholder:__props.title,"onUpdate:value":updateValue},{addonAfter:withCtx((()=>[createBaseVNode("span",{onClick:onOpen,style:{cursor:"pointer"}},"选择")])),_:1},8,["value","placeholder"]),createVNode(_sfc_main$2,{onRegister:unref(registerModal),onSelect:onSelect},null,8,["onRegister"])],64)}}}),[["__scopeId","data-v-27df1fd4"]]),_hoisted_1={class:"step-box"},_hoisted_2=createBaseVNode("div",{class:"step-tip"},"请选择安装V3云崽的方式",-1),_hoisted_3={key:"trans-git"},_hoisted_4={class:"lite-form"},_hoisted_5={key:"trans-input",class:"lite-form"},_hoisted_6={key:2},_sfc_main=defineComponent({__name:"Step1-1",emits:["prev","next"],setup(__props,{emit:__emit}){const emit=__emit,{createMessage:$message}=useMessage(),[onStepBtnRegister,{models:models}]=useStep({nextBtn:{},prevBtn:{disabled:!0},nextCheck:()=>!!models.value.installPath||($message.warn("请选择目录"),!1)},{emit:emit});watch((()=>models.value.installPath),(val=>{}),{immediate:!0});const modeList=reactive({install:[{key:"new",title:"全新下载",desc:"从Git上全新克隆一个项目",recommended:!0},{key:"exist",title:"选择已有",desc:"选择本地已有的项目"}],git:[{key:"gitee",title:"Gitee",desc:"使用Gitee克隆项目",recommended:!0},{key:"github",title:"Github",desc:"使用Github克隆项目"}]});function pathBeforeSelect(path){if(path&&!/Yunzai-Bot[\\/]?$/i.test(path)){let s=/\\/.test(path)?"\\":"/";return s=path.endsWith(s)?"":s,path+s+"Yunzai-Bot"}return path}return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1,[_hoisted_2,createVNode(TransitionGroup,{name:"fade-slide",mode:"out-in",appear:""},{default:withCtx((()=>[createVNode(_sfc_main$3,{active:unref(models).installMode,"onUpdate:active":_cache[0]||(_cache[0]=$event=>unref(models).installMode=$event),modeList:modeList.install,key:"trans-install"},null,8,["active","modeList"]),createVNode(Transition,{name:"fade-slide",mode:"out-in",appear:"",key:"trans-1"},{default:withCtx((()=>["new"===unref(models).installMode?(openBlock(),createElementBlock("div",_hoisted_3,[createVNode(_sfc_main$3,{active:unref(models).gitAddress,"onUpdate:active":_cache[1]||(_cache[1]=$event=>unref(models).gitAddress=$event),modeList:modeList.git},null,8,["active","modeList"]),createBaseVNode("div",_hoisted_4,[createVNode(unref(PathSelect),{value:unref(models).installPath,"onUpdate:value":_cache[2]||(_cache[2]=$event=>unref(models).installPath=$event),title:"选择安装目录",beforeSelect:pathBeforeSelect},null,8,["value"])])])):"exist"===unref(models).installMode?(openBlock(),createElementBlock("div",_hoisted_5,[createVNode(unref(PathSelect),{value:unref(models).installPath,"onUpdate:value":_cache[3]||(_cache[3]=$event=>unref(models).installPath=$event),title:"选择V3云崽地址"},null,8,["value"])])):(openBlock(),createElementBlock("span",_hoisted_6))])),_:1})])),_:1}),createVNode(_sfc_main$4,{onRegister:unref(onStepBtnRegister)},null,8,["onRegister"])]))}});export{_sfc_main as _};
