import{d as defineComponent,r as ref,A as computed,x as defHttp,o as openBlock,h as createBlock,i as withCtx,aY as KeepAlive,aX as resolveDynamicComponent,a2 as normalizeProps,a3 as guardReactiveProps,aW as Transition,y as useMessage}from"./index.js";import{a as useStep}from"./hooks.js";import{_ as _sfc_main$1}from"./Step1-1.vue_vue_type_script_setup_true_lang.js";import{_ as _sfc_main$2}from"./Step1-2.vue_vue_type_script_setup_true_lang.js";import{_ as _sfc_main$3}from"./Step1-3.vue_vue_type_script_setup_true_lang.js";import{_ as _sfc_main$4}from"./Step1-4.vue_vue_type_script_setup_true_lang.js";import{a as sleep}from"./common.js";import{l as lodash}from"./lodash.default.js";const _sfc_main=defineComponent({__name:"Step1",setup(__props){const{createMessage:$message,createConfirm:createConfirm,createWarningModal:createWarningModal}=useMessage(),[,{models:models,stepStore:stepStore}]=useStep({},{}),stepIdx=ref(0),stepsConfig=[_sfc_main$1,_sfc_main$2,_sfc_main$3,_sfc_main$4],stepProps=computed((()=>({onPrev:onPrev,onNext:onNext})));function onPrev(){let idx=stepIdx.value-1;2===idx&&"full"===models.value.mode&&idx--,idx<0?$message.warn("已是第一步"):stepIdx.value=idx}function onNext(){let idx=stepIdx.value+1;if(2===idx&&"full"===models.value.mode&&idx++,idx===stepsConfig.length){createConfirm({title:"开始迁移",iconType:"warning",content:"你已完成所有的准备工作，请确认是否全部配置正确，并开始迁移吗？",okText:"开始迁移",onOk(){return __this=this,__arguments=null,generator=function*(){yield defHttp.post({url:"/v2-transfer/start",params:{config:lodash.omit(models.value,"jsPluginInfo")}});for(let i=0;i<3;i++){if(yield stepStore.updateStatus(),0!==stepStore.status.state)return;yield sleep(300)}createWarningModal({title:"错误",content:"获取启动状态失败，请手动刷新页面重试"})},new Promise(((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())}));var __this,__arguments,generator}})}else stepIdx.value=idx}return(_ctx,_cache)=>(openBlock(),createBlock(Transition,{name:"fade-slide",appear:""},{default:withCtx((()=>[(openBlock(),createBlock(KeepAlive,null,[(openBlock(),createBlock(resolveDynamicComponent(stepsConfig[stepIdx.value]),normalizeProps(guardReactiveProps(stepProps.value)),null,16))],1024))])),_:1}))}});export{_sfc_main as _};
