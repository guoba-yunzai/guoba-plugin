var __async=(__this,__arguments,generator)=>new Promise(((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())}));import BasicForm from"./BasicForm.js";import"./BasicForm.vue_vue_type_style_index_0_lang.js";import{d as defineComponent,G as useForm,ao as onMounted,n as nextTick,c as resolveComponent,o as openBlock,h as createBlock,i as withCtx,j as createVNode,D as unref,k as createTextVNode,w as watch}from"./index.js";import{u as useDrawerInner,B as BasicDrawer}from"./index35.js";import{s as settingSchemas}from"./miao.data.js";import{_ as _sfc_main$1}from"./ThemeConfigForm.vue_vue_type_script_setup_true_lang.js";const _sfc_main=defineComponent({__name:"SettingDrawer",props:{model:{type:Object,default:()=>({})},themeName:String,themeNames:Array,themeStyle:Object,debugThemeName:String},emits:["register","update:model","update:themeStyle","update:debugThemeName"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,[registerDrawer,{setDrawerProps:setDrawerProps,closeDrawer:closeDrawer}]=useDrawerInner(),[registerFormOrigin,{getFieldsValue:getFieldsValue,setFieldsValue:setFieldsValue,updateSchema:updateSchema}]=useForm({schemas:settingSchemas,labelWidth:120,labelAlign:"right",labelCol:{xs:24,sm:5},wrapperCol:{xs:24,sm:19},showActionButtonGroup:!1,baseColProps:{span:24}}),drawerWidth=window.innerWidth>=600?"600px":"100%";function registerForm(formAction,formModel){return __async(this,null,(function*(){registerFormOrigin(formAction),yield function(){return __async(this,null,(function*(){let lastTheme=[];yield updateSchema({field:"themeSet",componentProps:{onChange(themeSet){themeSet?Array.isArray(lastTheme)&&lastTheme.length>0?setFieldsValue({theme:lastTheme}):setFieldsValue({theme:["default"]}):(lastTheme=getFieldsValue().theme,setFieldsValue({theme:"all"}))}}}),watch((()=>props.themeNames),(names=>{Array.isArray(names)||(names=[]),0===names.length&&(names=["default"]);let options=names.map((name=>({label:name,value:name})));updateSchema([{field:"theme",componentProps:{options:options}},{field:"themeExclude",componentProps:{options:options}}])}),{deep:!0,immediate:!0})}))}(),watch((()=>props.model),(()=>{var _a;return setFieldsValue(null!=(_a=props.model)?_a:{})}),{deep:!0,immediate:!0}),watch(formModel,onModelUpdate,{immediate:!0})}))}function onModelUpdate(model){model.themeSet="all"!==model.theme,emit("update:model",model)}return onMounted((()=>{setDrawerProps({visible:!0}),nextTick((()=>closeDrawer()))})),(_ctx,_cache)=>{const _component_a_col=resolveComponent("a-col"),_component_a_button=resolveComponent("a-button"),_component_a_row=resolveComponent("a-row");return openBlock(),createBlock(unref(BasicDrawer),{title:"高级设置",width:unref(drawerWidth),placement:"left",showFooter:"",maskStyle:{backgroundColor:"rgba(0,0,0,0.2)"},onRegister:unref(registerDrawer)},{footer:withCtx((()=>[createVNode(_component_a_row,{type:"flex",justify:"space-between"},{default:withCtx((()=>[createVNode(_component_a_col),createVNode(_component_a_col,null,{default:withCtx((()=>[createVNode(_component_a_button,{onClick:unref(closeDrawer)},{default:withCtx((()=>[createTextVNode("关闭")])),_:1},8,["onClick"])])),_:1})])),_:1})])),default:withCtx((()=>[createVNode(unref(BasicForm),{onRegister:registerForm}),createVNode(_sfc_main$1,{model:__props.themeStyle,themeName:__props.themeName,debugThemeName:__props.debugThemeName,themeNames:__props.themeNames,"onUpdate:model":_cache[0]||(_cache[0]=$event=>emit("update:themeStyle",$event)),"onUpdate:debugThemeName":_cache[1]||(_cache[1]=$event=>emit("update:debugThemeName",$event))},null,8,["model","themeName","debugThemeName","themeNames"])])),_:1},8,["width","maskStyle","onRegister"])}}});export{_sfc_main as _};
