var __async=(__this,__arguments,generator)=>new Promise(((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())}));import{d as defineComponent,z as useDesign,r as ref,a as reactive,w as watch,y as useMessage,b as _export_sfc,c as resolveComponent,o as openBlock,h as createBlock,i as withCtx,j as createVNode,E as createBaseVNode,aW as Transition,B as createCommentVNode,C as normalizeClass}from"./index.js";import{P as PageWrapper}from"./index30.js";import{_ as _sfc_main$2}from"./MiaoHeader.vue_vue_type_script_setup_true_lang2.js";import{_ as _sfc_main$1}from"./HelpPanel.vue_vue_type_style_index_0_lang.js";import{_ as _sfc_main$3}from"./ThemeDrawer.vue_vue_type_style_index_0_lang.js";import BackupDrawer from"./BackupDrawer2.js";import{_ as _sfc_main$4}from"./SettingDrawer.vue_vue_type_script_setup_true_lang.js";import{i as saveMiaoHelpCfg,j as getMiaoHelpCfg,g as getHelpIconList}from"./miao.api.js";import{a as useDrawer}from"./index35.js";import{l as lodash}from"./lodash.default.js";import"./index32.js";import"./onMountedOrActivated.js";import"./useWindowSizeFn.js";import"./useContentViewHeight.js";import"./ArrowLeftOutlined.js";import"./transButton.js";import"./EditBodyModal2.js";import"./index22.js";import"./SelectIconModal2.js";import"./IconUploader2.js";import"./esm.js";import"./index19.js";import"./FullscreenOutlined.js";import"./common.js";import"./HelpComps.js";import"./UploadIconHelpModal.vue_vue_type_script_setup_true_lang2.js";import"./21ae6624.js";/* empty css       *//* empty css                                                          */import"./ThemeConfigModal.vue_vue_type_script_setup_true_lang.js";import"./BasicForm.js";import"./BasicForm.vue_vue_type_style_index_0_lang.js";import"./index21.js";import"./useFormItem.js";import"./DeleteOutlined.js";import"./upperFirst.js";import"./download.js";import"./index23.js";import"./index24.js";import"./uniqBy.js";import"./miao.data.js";import"./index29.js";import"./base64Conver.js";import"./ThemeConfigForm.vue_vue_type_script_setup_true_lang.js";import"./throttle.js";import"./merge.js";const _sfc_main=defineComponent({name:"MiaoPluginExtra",components:{HelpPanel:_sfc_main$1,EditMiaoHeader:_sfc_main$2,PageWrapper:PageWrapper,ThemeDrawer:_sfc_main$3,BackupDrawer:BackupDrawer,SettingDrawer:_sfc_main$4},setup(){const{prefixCls:prefixCls}=useDesign("edit-miao-help"),{createMessage:$message,createConfirm:createConfirm}=useMessage(),pageLoading=ref(!0),loading=ref(!0),cacheVer=ref(0),helpCfg=ref(null),helpList=ref(null),bgB64=ref(null),mainB64=ref(null),iconB64List=ref(null),versions=reactive({miao:"x.x.x",yunzai:"x.x.x"}),modelData=ref({show:!1,cell:null,cellIndex:null,group:null,groupIndex:null}),themeNames=ref([]),themeStyle=ref({}),debugThemeName=ref(""),themeName=ref();let cacheThemeName=null;watch([debugThemeName,()=>{var _a;return null==(_a=helpCfg.value)?void 0:_a.theme},()=>{var _a;return null==(_a=helpCfg.value)?void 0:_a.themeExclude}],(()=>{themeName.value=(()=>{var _a,_b;if("string"==typeof cacheThemeName)return cacheThemeName;if(debugThemeName.value)return debugThemeName.value;let ret=[],theme=null==(_a=helpCfg.value)?void 0:_a.theme,exclude=null==(_b=helpCfg.value)?void 0:_b.themeExclude,names=themeNames.value;lodash.isArray(theme)?ret=lodash.intersection(theme,names):"all"===theme&&(ret=names),exclude&&lodash.isArray(exclude)&&(ret=lodash.difference(ret,exclude)),0===ret.length&&(ret=["default"]);let tempName=lodash.sample(ret);return names&&names.length>0&&null==cacheThemeName&&(cacheThemeName=tempName),tempName})()}),{deep:!0,immediate:!0});const[registerThemeDrawer,themeDrawer]=useDrawer(),[registerBackupDrawer,backupDrawer]=useDrawer(),[registerSettingDrawer,settingDrawer]=useDrawer();const loadData=()=>__async(this,null,(function*(){try{loading.value=!0;let result=yield getMiaoHelpCfg();helpCfg.value=result.helpCfg,helpList.value=result.helpList,themeNames.value=result.themeNames,versions.miao=result.miaoVersion,versions.yunzai=result.yunzaiVersion,bgB64.value=null,mainB64.value=null,iconB64List.value=yield getHelpIconList()}finally{loading.value=!1,pageLoading.value=!1,cacheVer.value++}}));return loadData(),{prefixCls:prefixCls,loading:loading,pageLoading:pageLoading,helpCfg:helpCfg,helpList:helpList,themeNames:themeNames,themeStyle:themeStyle,themeName:themeName,debugThemeName:debugThemeName,bgB64:bgB64,mainB64:mainB64,iconB64List:iconB64List,cacheVer:cacheVer,versions:versions,modelData:modelData,onBackup:function(){backupDrawer.openDrawer(!0,{})},onOpenTheme:function(){themeDrawer.openDrawer(!0,{})},onRollback:function(){createConfirm({title:"提示",iconType:"warning",content:"确定要放弃所有修改吗？",onOk:()=>{loadData()}})},onOpenSetting:function(){settingDrawer.openDrawer()},loadData:loadData,saveData:()=>__async(this,null,(function*(){try{loading.value=!0,yield saveMiaoHelpCfg(helpCfg,helpList,iconB64List,mainB64),yield loadData(),$message.success("保存成功~")}finally{loading.value=!1}})),onSettingModalChange:function(){setTimeout((()=>cacheThemeName=-1),300)},registerThemeDrawer:registerThemeDrawer,registerBackupDrawer:registerBackupDrawer,registerSettingDrawer:registerSettingDrawer}}}),_hoisted_1={class:"flex justify-center md:pt-4 my-4"};const index=_export_sfc(_sfc_main,[["render",function(_ctx,_cache,$props,$setup,$data,$options){const _component_EditMiaoHeader=resolveComponent("EditMiaoHeader"),_component_HelpPanel=resolveComponent("HelpPanel"),_component_ThemeDrawer=resolveComponent("ThemeDrawer"),_component_BackupDrawer=resolveComponent("BackupDrawer"),_component_SettingDrawer=resolveComponent("SettingDrawer"),_component_PageWrapper=resolveComponent("PageWrapper");return openBlock(),createBlock(_component_PageWrapper,{class:normalizeClass([_ctx.prefixCls]),title:"编辑喵喵帮助",dense:"",sticky:"",stickyTop:"-14px",loading:_ctx.loading},{headerContent:withCtx((()=>[createVNode(_component_EditMiaoHeader,{onSave:_ctx.saveData,onRollback:_ctx.onRollback,onBackup:_ctx.onBackup,onTheme:_ctx.onOpenTheme},null,8,["onSave","onRollback","onBackup","onTheme"])])),default:withCtx((()=>[createBaseVNode("div",_hoisted_1,[createVNode(Transition,{name:"scroll-y-reverse-transition"},{default:withCtx((()=>[_ctx.pageLoading?createCommentVNode("",!0):(openBlock(),createBlock(_component_HelpPanel,{key:0,cacheVer:_ctx.cacheVer,versions:_ctx.versions,themeNames:_ctx.themeNames,helpCfg:_ctx.helpCfg,"onUpdate:helpCfg":_cache[0]||(_cache[0]=$event=>_ctx.helpCfg=$event),helpList:_ctx.helpList,"onUpdate:helpList":_cache[1]||(_cache[1]=$event=>_ctx.helpList=$event),bgB64:_ctx.bgB64,"onUpdate:bgB64":_cache[2]||(_cache[2]=$event=>_ctx.bgB64=$event),mainB64:_ctx.mainB64,"onUpdate:mainB64":_cache[3]||(_cache[3]=$event=>_ctx.mainB64=$event),iconB64List:_ctx.iconB64List,"onUpdate:iconB64List":_cache[4]||(_cache[4]=$event=>_ctx.iconB64List=$event),modelData:_ctx.modelData,"onUpdate:modelData":_cache[5]||(_cache[5]=$event=>_ctx.modelData=$event),themeStyle:_ctx.themeStyle,"onUpdate:themeStyle":_cache[6]||(_cache[6]=$event=>_ctx.themeStyle=$event),themeName:_ctx.themeName,"onUpdate:themeName":_cache[7]||(_cache[7]=$event=>_ctx.themeName=$event),onOpenSetting:_ctx.onOpenSetting},null,8,["cacheVer","versions","themeNames","helpCfg","helpList","bgB64","mainB64","iconB64List","modelData","themeStyle","themeName","onOpenSetting"]))])),_:1})]),createVNode(_component_ThemeDrawer,{themeNames:_ctx.themeNames,"onUpdate:themeNames":_cache[8]||(_cache[8]=$event=>_ctx.themeNames=$event),onRegister:_ctx.registerThemeDrawer},null,8,["themeNames","onRegister"]),createVNode(_component_BackupDrawer,{onRegister:_ctx.registerBackupDrawer,onReload:_ctx.loadData},null,8,["onRegister","onReload"]),createVNode(_component_SettingDrawer,{model:_ctx.helpCfg,"onUpdate:model":[_cache[9]||(_cache[9]=$event=>_ctx.helpCfg=$event),_ctx.onSettingModalChange],themeName:_ctx.themeName,themeNames:_ctx.themeNames,themeStyle:_ctx.themeStyle,"onUpdate:themeStyle":_cache[10]||(_cache[10]=$event=>_ctx.themeStyle=$event),debugThemeName:_ctx.debugThemeName,"onUpdate:debugThemeName":_cache[11]||(_cache[11]=$event=>_ctx.debugThemeName=$event),onRegister:_ctx.registerSettingDrawer},null,8,["model","themeName","themeNames","themeStyle","debugThemeName","onRegister","onUpdate:model"])])),_:1},8,["class","loading"])}]]);export{index as default};
