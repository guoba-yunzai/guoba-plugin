var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value:value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__spreadProps=(a,b)=>__defProps(a,__getOwnPropDescs(b));import{d as defineComponent,a4 as Icon,p as propTypes,r as ref,ah as useRouter,z as useDesign,aJ as useRootSetting,aI as useGo,N as watchEffect,aa as useI18n,bF as isString,aj as REDIRECT_NAME,aE as getMenus,ag as getAllParentPath,gb as filter,b as _export_sfc,c as resolveComponent,o as openBlock,e as createElementBlock,j as createVNode,i as withCtx,h as createBlock,B as createCommentVNode,m as toDisplayString,k as createTextVNode,C as normalizeClass}from"./index.js";import{B as Breadcrumb$1}from"./index32.js";const _sfc_main=defineComponent({name:"LayoutBreadcrumb",components:{Icon:Icon,[Breadcrumb$1.name]:Breadcrumb$1},props:{theme:propTypes.oneOf(["dark","light"])},setup(){const routes=ref([]),{currentRoute:currentRoute}=useRouter(),{prefixCls:prefixCls}=useDesign("layout-breadcrumb"),{getShowBreadCrumbIcon:getShowBreadCrumbIcon}=useRootSetting(),go=useGo(),{t:t}=useI18n();function getMatched(menus,parent){const metched=[];return menus.forEach((item=>{var _a,_b;parent.includes(item.path)&&metched.push(__spreadProps(__spreadValues({},item),{name:(null==(_a=item.meta)?void 0:_a.title)||item.name})),(null==(_b=item.children)?void 0:_b.length)&&metched.push(...getMatched(item.children,parent))})),metched}return watchEffect((()=>{return __this=this,__arguments=null,generator=function*(){var _a,_b,_c;if(currentRoute.value.name===REDIRECT_NAME)return;const menus=yield getMenus(),routeMatched=currentRoute.value.matched,cur=null==routeMatched?void 0:routeMatched[routeMatched.length-1];let path=currentRoute.value.path;cur&&(null==(_a=null==cur?void 0:cur.meta)?void 0:_a.currentActiveMenu)&&(path=cur.meta.currentActiveMenu);const parent=getAllParentPath(menus,path),matched=getMatched(menus.filter((item=>item.path===parent[0])),parent);if(!matched||0===matched.length)return;const breadcrumbList=filter(matched,(item=>{const{meta:meta,name:name}=item;if(!meta)return!!name;const{title:title,hideBreadcrumb:hideBreadcrumb,hideMenu:hideMenu}=meta;return!(!title||hideBreadcrumb||hideMenu)})).filter((item=>{var _a;return!(null==(_a=item.meta)?void 0:_a.hideBreadcrumb)}));(null==(_b=currentRoute.value.meta)?void 0:_b.currentActiveMenu)&&breadcrumbList.push(__spreadProps(__spreadValues({},currentRoute.value),{name:(null==(_c=currentRoute.value.meta)?void 0:_c.title)||currentRoute.value.name})),routes.value=breadcrumbList},new Promise(((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())}));var __this,__arguments,generator})),{routes:routes,t:t,prefixCls:prefixCls,getIcon:function(route){var _a;return route.icon||(null==(_a=route.meta)?void 0:_a.icon)},getShowBreadCrumbIcon:getShowBreadCrumbIcon,handleClick:function(route,paths,e){null==e||e.preventDefault();const{children:children,redirect:redirect,meta:meta}=route;if(!(null==children?void 0:children.length)||redirect){if(!(null==meta?void 0:meta.carryParam))if(redirect&&isString(redirect))go(redirect);else{let goPath="";if(1===paths.length)goPath=paths[0];else{goPath=`${paths.slice(1).pop()||""}`}goPath=/^\//.test(goPath)?goPath:`/${goPath}`,go(goPath)}}else null==e||e.stopPropagation()},hasRedirect:function(routes2,route){return routes2.indexOf(route)!==routes2.length-1}}}}),_hoisted_1={key:1};const Breadcrumb=_export_sfc(_sfc_main,[["render",function(_ctx,_cache,$props,$setup,$data,$options){const _component_Icon=resolveComponent("Icon"),_component_router_link=resolveComponent("router-link"),_component_a_breadcrumb=resolveComponent("a-breadcrumb");return openBlock(),createElementBlock("div",{class:normalizeClass([_ctx.prefixCls,`${_ctx.prefixCls}--${_ctx.theme}`])},[createVNode(_component_a_breadcrumb,{routes:_ctx.routes},{itemRender:withCtx((({route:route,routes:routesMatched,paths:paths})=>[_ctx.getShowBreadCrumbIcon&&_ctx.getIcon(route)?(openBlock(),createBlock(_component_Icon,{key:0,icon:_ctx.getIcon(route)},null,8,["icon"])):createCommentVNode("",!0),_ctx.hasRedirect(routesMatched,route)?(openBlock(),createBlock(_component_router_link,{key:2,to:"",onClick:$event=>_ctx.handleClick(route,paths,$event)},{default:withCtx((()=>[createTextVNode(toDisplayString(_ctx.t(route.name||route.meta.title)),1)])),_:2},1032,["onClick"])):(openBlock(),createElementBlock("span",_hoisted_1,toDisplayString(_ctx.t(route.name||route.meta.title)),1))])),_:1},8,["routes"])],2)}]]);export{Breadcrumb as default};
