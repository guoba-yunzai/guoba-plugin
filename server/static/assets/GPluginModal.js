var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value:value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__spreadProps=(a,b)=>__defProps(a,__getOwnPropDescs(b)),__async=(__this,__arguments,generator)=>new Promise(((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())}));import{b as useModalContext,B as BasicModal,u as useModalInner}from"./index19.js";import{ca as commonjsGlobal,X as getDefaultExportFromCjs,d as defineComponent,r as ref,aS as useLocale,aJ as useRootSetting,w as watch,A as computed,D as unref,cj as onBeforeUnmount,fZ as onDeactivated,n as nextTick,b as _export_sfc,o as openBlock,e as createElementBlock,bj as withInstall,G as useForm,J as provide,x as defHttp,y as useMessage,c as resolveComponent,h as createBlock,i as withCtx,j as createVNode,f$ as Scrollbar,M as useAttrs,z as useDesign,aI as useGo,g0 as pluginApi,k as createTextVNode,d8 as Checkbox,F as Fragment,B as createCommentVNode,a2 as normalizeProps,a3 as guardReactiveProps}from"./index.js";import{D as Description,u as useDescription}from"./index31.js";import{o as onMountedOrActivated}from"./onMountedOrActivated.js";import{g as getTheme,_ as _sfc_main$3}from"./MarkdownViewer.vue_vue_type_script_setup_true_lang.js";import{p as parseAuthorLink,g as getStatusTags}from"./guoba.js";import BasicForm from"./BasicForm.js";import"./BasicForm.vue_vue_type_style_index_0_lang.js";import{l as lodash}from"./lodash.default.js";import{a as sleep}from"./common.js";var dist={exports:{}};
/*!
 * Vditor v3.10.8 - A markdown editor written in TypeScript.
 *
 * MIT License
 *
 * Copyright (c) 2018-present B3log 开源, b3log.org
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const Vditor=getDefaultExportFromCjs(dist.exports=(()=>(()=>{var __webpack_modules__={192:module2=>{var diff_match_patch=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32};diff_match_patch.Diff=function(op,text){return[op,text]},diff_match_patch.prototype.diff_main=function(text1,text2,opt_checklines,opt_deadline){void 0===opt_deadline&&(opt_deadline=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var deadline=opt_deadline;if(null==text1||null==text2)throw new Error("Null input. (diff_main)");if(text1==text2)return text1?[new diff_match_patch.Diff(0,text1)]:[];void 0===opt_checklines&&(opt_checklines=!0);var checklines=opt_checklines,commonlength=this.diff_commonPrefix(text1,text2),commonprefix=text1.substring(0,commonlength);text1=text1.substring(commonlength),text2=text2.substring(commonlength),commonlength=this.diff_commonSuffix(text1,text2);var commonsuffix=text1.substring(text1.length-commonlength);text1=text1.substring(0,text1.length-commonlength),text2=text2.substring(0,text2.length-commonlength);var diffs=this.diff_compute_(text1,text2,checklines,deadline);return commonprefix&&diffs.unshift(new diff_match_patch.Diff(0,commonprefix)),commonsuffix&&diffs.push(new diff_match_patch.Diff(0,commonsuffix)),this.diff_cleanupMerge(diffs),diffs},diff_match_patch.prototype.diff_compute_=function(text1,text2,checklines,deadline){var diffs;if(!text1)return[new diff_match_patch.Diff(1,text2)];if(!text2)return[new diff_match_patch.Diff(-1,text1)];var longtext=text1.length>text2.length?text1:text2,shorttext=text1.length>text2.length?text2:text1,i=longtext.indexOf(shorttext);if(-1!=i)return diffs=[new diff_match_patch.Diff(1,longtext.substring(0,i)),new diff_match_patch.Diff(0,shorttext),new diff_match_patch.Diff(1,longtext.substring(i+shorttext.length))],text1.length>text2.length&&(diffs[0][0]=diffs[2][0]=-1),diffs;if(1==shorttext.length)return[new diff_match_patch.Diff(-1,text1),new diff_match_patch.Diff(1,text2)];var hm=this.diff_halfMatch_(text1,text2);if(hm){var text1_a=hm[0],text1_b=hm[1],text2_a=hm[2],text2_b=hm[3],mid_common=hm[4],diffs_a=this.diff_main(text1_a,text2_a,checklines,deadline),diffs_b=this.diff_main(text1_b,text2_b,checklines,deadline);return diffs_a.concat([new diff_match_patch.Diff(0,mid_common)],diffs_b)}return checklines&&text1.length>100&&text2.length>100?this.diff_lineMode_(text1,text2,deadline):this.diff_bisect_(text1,text2,deadline)},diff_match_patch.prototype.diff_lineMode_=function(text1,text2,deadline){var a=this.diff_linesToChars_(text1,text2);text1=a.chars1,text2=a.chars2;var linearray=a.lineArray,diffs=this.diff_main(text1,text2,!1,deadline);this.diff_charsToLines_(diffs,linearray),this.diff_cleanupSemantic(diffs),diffs.push(new diff_match_patch.Diff(0,""));for(var pointer=0,count_delete=0,count_insert=0,text_delete="",text_insert="";pointer<diffs.length;){switch(diffs[pointer][0]){case 1:count_insert++,text_insert+=diffs[pointer][1];break;case-1:count_delete++,text_delete+=diffs[pointer][1];break;case 0:if(count_delete>=1&&count_insert>=1){diffs.splice(pointer-count_delete-count_insert,count_delete+count_insert),pointer=pointer-count_delete-count_insert;for(var subDiff=this.diff_main(text_delete,text_insert,!1,deadline),j=subDiff.length-1;j>=0;j--)diffs.splice(pointer,0,subDiff[j]);pointer+=subDiff.length}count_insert=0,count_delete=0,text_delete="",text_insert=""}pointer++}return diffs.pop(),diffs},diff_match_patch.prototype.diff_bisect_=function(text1,text2,deadline){for(var text1_length=text1.length,text2_length=text2.length,max_d=Math.ceil((text1_length+text2_length)/2),v_offset=max_d,v_length=2*max_d,v1=new Array(v_length),v2=new Array(v_length),x=0;x<v_length;x++)v1[x]=-1,v2[x]=-1;v1[v_offset+1]=0,v2[v_offset+1]=0;for(var delta=text1_length-text2_length,front=delta%2!=0,k1start=0,k1end=0,k2start=0,k2end=0,d=0;d<max_d&&!((new Date).getTime()>deadline);d++){for(var k1=-d+k1start;k1<=d-k1end;k1+=2){for(var k1_offset=v_offset+k1,y1=(x1=k1==-d||k1!=d&&v1[k1_offset-1]<v1[k1_offset+1]?v1[k1_offset+1]:v1[k1_offset-1]+1)-k1;x1<text1_length&&y1<text2_length&&text1.charAt(x1)==text2.charAt(y1);)x1++,y1++;if(v1[k1_offset]=x1,x1>text1_length)k1end+=2;else if(y1>text2_length)k1start+=2;else if(front&&(k2_offset=v_offset+delta-k1)>=0&&k2_offset<v_length&&-1!=v2[k2_offset]&&x1>=(x2=text1_length-v2[k2_offset]))return this.diff_bisectSplit_(text1,text2,x1,y1,deadline)}for(var k2=-d+k2start;k2<=d-k2end;k2+=2){for(var x2,k2_offset=v_offset+k2,y2=(x2=k2==-d||k2!=d&&v2[k2_offset-1]<v2[k2_offset+1]?v2[k2_offset+1]:v2[k2_offset-1]+1)-k2;x2<text1_length&&y2<text2_length&&text1.charAt(text1_length-x2-1)==text2.charAt(text2_length-y2-1);)x2++,y2++;if(v2[k2_offset]=x2,x2>text1_length)k2end+=2;else if(y2>text2_length)k2start+=2;else if(!front){var x1;if((k1_offset=v_offset+delta-k2)>=0&&k1_offset<v_length&&-1!=v1[k1_offset]&&(y1=v_offset+(x1=v1[k1_offset])-k1_offset,x1>=(x2=text1_length-x2)))return this.diff_bisectSplit_(text1,text2,x1,y1,deadline)}}}return[new diff_match_patch.Diff(-1,text1),new diff_match_patch.Diff(1,text2)]},diff_match_patch.prototype.diff_bisectSplit_=function(text1,text2,x,y,deadline){var text1a=text1.substring(0,x),text2a=text2.substring(0,y),text1b=text1.substring(x),text2b=text2.substring(y),diffs=this.diff_main(text1a,text2a,!1,deadline),diffsb=this.diff_main(text1b,text2b,!1,deadline);return diffs.concat(diffsb)},diff_match_patch.prototype.diff_linesToChars_=function(text1,text2){var lineArray=[],lineHash={};function diff_linesToCharsMunge_(text){for(var chars="",lineStart=0,lineEnd=-1,lineArrayLength=lineArray.length;lineEnd<text.length-1;){-1==(lineEnd=text.indexOf("\n",lineStart))&&(lineEnd=text.length-1);var line=text.substring(lineStart,lineEnd+1);(lineHash.hasOwnProperty?lineHash.hasOwnProperty(line):void 0!==lineHash[line])?chars+=String.fromCharCode(lineHash[line]):(lineArrayLength==maxLines&&(line=text.substring(lineStart),lineEnd=text.length),chars+=String.fromCharCode(lineArrayLength),lineHash[line]=lineArrayLength,lineArray[lineArrayLength++]=line),lineStart=lineEnd+1}return chars}lineArray[0]="";var maxLines=4e4,chars1=diff_linesToCharsMunge_(text1);return maxLines=65535,{chars1:chars1,chars2:diff_linesToCharsMunge_(text2),lineArray:lineArray}},diff_match_patch.prototype.diff_charsToLines_=function(diffs,lineArray){for(var i=0;i<diffs.length;i++){for(var chars=diffs[i][1],text=[],j=0;j<chars.length;j++)text[j]=lineArray[chars.charCodeAt(j)];diffs[i][1]=text.join("")}},diff_match_patch.prototype.diff_commonPrefix=function(text1,text2){if(!text1||!text2||text1.charAt(0)!=text2.charAt(0))return 0;for(var pointermin=0,pointermax=Math.min(text1.length,text2.length),pointermid=pointermax,pointerstart=0;pointermin<pointermid;)text1.substring(pointerstart,pointermid)==text2.substring(pointerstart,pointermid)?pointerstart=pointermin=pointermid:pointermax=pointermid,pointermid=Math.floor((pointermax-pointermin)/2+pointermin);return pointermid},diff_match_patch.prototype.diff_commonSuffix=function(text1,text2){if(!text1||!text2||text1.charAt(text1.length-1)!=text2.charAt(text2.length-1))return 0;for(var pointermin=0,pointermax=Math.min(text1.length,text2.length),pointermid=pointermax,pointerend=0;pointermin<pointermid;)text1.substring(text1.length-pointermid,text1.length-pointerend)==text2.substring(text2.length-pointermid,text2.length-pointerend)?pointerend=pointermin=pointermid:pointermax=pointermid,pointermid=Math.floor((pointermax-pointermin)/2+pointermin);return pointermid},diff_match_patch.prototype.diff_commonOverlap_=function(text1,text2){var text1_length=text1.length,text2_length=text2.length;if(0==text1_length||0==text2_length)return 0;text1_length>text2_length?text1=text1.substring(text1_length-text2_length):text1_length<text2_length&&(text2=text2.substring(0,text1_length));var text_length=Math.min(text1_length,text2_length);if(text1==text2)return text_length;for(var best=0,length=1;;){var pattern=text1.substring(text_length-length),found=text2.indexOf(pattern);if(-1==found)return best;length+=found,0!=found&&text1.substring(text_length-length)!=text2.substring(0,length)||(best=length,length++)}},diff_match_patch.prototype.diff_halfMatch_=function(text1,text2){if(this.Diff_Timeout<=0)return null;var longtext=text1.length>text2.length?text1:text2,shorttext=text1.length>text2.length?text2:text1;if(longtext.length<4||2*shorttext.length<longtext.length)return null;var dmp=this;function diff_halfMatchI_(longtext2,shorttext2,i){for(var best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b,seed=longtext2.substring(i,i+Math.floor(longtext2.length/4)),j=-1,best_common="";-1!=(j=shorttext2.indexOf(seed,j+1));){var prefixLength=dmp.diff_commonPrefix(longtext2.substring(i),shorttext2.substring(j)),suffixLength=dmp.diff_commonSuffix(longtext2.substring(0,i),shorttext2.substring(0,j));best_common.length<suffixLength+prefixLength&&(best_common=shorttext2.substring(j-suffixLength,j)+shorttext2.substring(j,j+prefixLength),best_longtext_a=longtext2.substring(0,i-suffixLength),best_longtext_b=longtext2.substring(i+prefixLength),best_shorttext_a=shorttext2.substring(0,j-suffixLength),best_shorttext_b=shorttext2.substring(j+prefixLength))}return 2*best_common.length>=longtext2.length?[best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b,best_common]:null}var hm,text1_a,text1_b,text2_a,text2_b,hm1=diff_halfMatchI_(longtext,shorttext,Math.ceil(longtext.length/4)),hm2=diff_halfMatchI_(longtext,shorttext,Math.ceil(longtext.length/2));return hm1||hm2?(hm=hm2?hm1&&hm1[4].length>hm2[4].length?hm1:hm2:hm1,text1.length>text2.length?(text1_a=hm[0],text1_b=hm[1],text2_a=hm[2],text2_b=hm[3]):(text2_a=hm[0],text2_b=hm[1],text1_a=hm[2],text1_b=hm[3]),[text1_a,text1_b,text2_a,text2_b,hm[4]]):null},diff_match_patch.prototype.diff_cleanupSemantic=function(diffs){for(var changes=!1,equalities=[],equalitiesLength=0,lastEquality=null,pointer=0,length_insertions1=0,length_deletions1=0,length_insertions2=0,length_deletions2=0;pointer<diffs.length;)0==diffs[pointer][0]?(equalities[equalitiesLength++]=pointer,length_insertions1=length_insertions2,length_deletions1=length_deletions2,length_insertions2=0,length_deletions2=0,lastEquality=diffs[pointer][1]):(1==diffs[pointer][0]?length_insertions2+=diffs[pointer][1].length:length_deletions2+=diffs[pointer][1].length,lastEquality&&lastEquality.length<=Math.max(length_insertions1,length_deletions1)&&lastEquality.length<=Math.max(length_insertions2,length_deletions2)&&(diffs.splice(equalities[equalitiesLength-1],0,new diff_match_patch.Diff(-1,lastEquality)),diffs[equalities[equalitiesLength-1]+1][0]=1,equalitiesLength--,pointer=--equalitiesLength>0?equalities[equalitiesLength-1]:-1,length_insertions1=0,length_deletions1=0,length_insertions2=0,length_deletions2=0,lastEquality=null,changes=!0)),pointer++;for(changes&&this.diff_cleanupMerge(diffs),this.diff_cleanupSemanticLossless(diffs),pointer=1;pointer<diffs.length;){if(-1==diffs[pointer-1][0]&&1==diffs[pointer][0]){var deletion=diffs[pointer-1][1],insertion=diffs[pointer][1],overlap_length1=this.diff_commonOverlap_(deletion,insertion),overlap_length2=this.diff_commonOverlap_(insertion,deletion);overlap_length1>=overlap_length2?(overlap_length1>=deletion.length/2||overlap_length1>=insertion.length/2)&&(diffs.splice(pointer,0,new diff_match_patch.Diff(0,insertion.substring(0,overlap_length1))),diffs[pointer-1][1]=deletion.substring(0,deletion.length-overlap_length1),diffs[pointer+1][1]=insertion.substring(overlap_length1),pointer++):(overlap_length2>=deletion.length/2||overlap_length2>=insertion.length/2)&&(diffs.splice(pointer,0,new diff_match_patch.Diff(0,deletion.substring(0,overlap_length2))),diffs[pointer-1][0]=1,diffs[pointer-1][1]=insertion.substring(0,insertion.length-overlap_length2),diffs[pointer+1][0]=-1,diffs[pointer+1][1]=deletion.substring(overlap_length2),pointer++),pointer++}pointer++}},diff_match_patch.prototype.diff_cleanupSemanticLossless=function(diffs){function diff_cleanupSemanticScore_(one,two){if(!one||!two)return 6;var char1=one.charAt(one.length-1),char2=two.charAt(0),nonAlphaNumeric1=char1.match(diff_match_patch.nonAlphaNumericRegex_),nonAlphaNumeric2=char2.match(diff_match_patch.nonAlphaNumericRegex_),whitespace1=nonAlphaNumeric1&&char1.match(diff_match_patch.whitespaceRegex_),whitespace2=nonAlphaNumeric2&&char2.match(diff_match_patch.whitespaceRegex_),lineBreak1=whitespace1&&char1.match(diff_match_patch.linebreakRegex_),lineBreak2=whitespace2&&char2.match(diff_match_patch.linebreakRegex_),blankLine1=lineBreak1&&one.match(diff_match_patch.blanklineEndRegex_),blankLine2=lineBreak2&&two.match(diff_match_patch.blanklineStartRegex_);return blankLine1||blankLine2?5:lineBreak1||lineBreak2?4:nonAlphaNumeric1&&!whitespace1&&whitespace2?3:whitespace1||whitespace2?2:nonAlphaNumeric1||nonAlphaNumeric2?1:0}for(var pointer=1;pointer<diffs.length-1;){if(0==diffs[pointer-1][0]&&0==diffs[pointer+1][0]){var equality1=diffs[pointer-1][1],edit=diffs[pointer][1],equality2=diffs[pointer+1][1],commonOffset=this.diff_commonSuffix(equality1,edit);if(commonOffset){var commonString=edit.substring(edit.length-commonOffset);equality1=equality1.substring(0,equality1.length-commonOffset),edit=commonString+edit.substring(0,edit.length-commonOffset),equality2=commonString+equality2}for(var bestEquality1=equality1,bestEdit=edit,bestEquality2=equality2,bestScore=diff_cleanupSemanticScore_(equality1,edit)+diff_cleanupSemanticScore_(edit,equality2);edit.charAt(0)===equality2.charAt(0);){equality1+=edit.charAt(0),edit=edit.substring(1)+equality2.charAt(0),equality2=equality2.substring(1);var score=diff_cleanupSemanticScore_(equality1,edit)+diff_cleanupSemanticScore_(edit,equality2);score>=bestScore&&(bestScore=score,bestEquality1=equality1,bestEdit=edit,bestEquality2=equality2)}diffs[pointer-1][1]!=bestEquality1&&(bestEquality1?diffs[pointer-1][1]=bestEquality1:(diffs.splice(pointer-1,1),pointer--),diffs[pointer][1]=bestEdit,bestEquality2?diffs[pointer+1][1]=bestEquality2:(diffs.splice(pointer+1,1),pointer--))}pointer++}},diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,diff_match_patch.whitespaceRegex_=/\s/,diff_match_patch.linebreakRegex_=/[\r\n]/,diff_match_patch.blanklineEndRegex_=/\n\r?\n$/,diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/,diff_match_patch.prototype.diff_cleanupEfficiency=function(diffs){for(var changes=!1,equalities=[],equalitiesLength=0,lastEquality=null,pointer=0,pre_ins=!1,pre_del=!1,post_ins=!1,post_del=!1;pointer<diffs.length;)0==diffs[pointer][0]?(diffs[pointer][1].length<this.Diff_EditCost&&(post_ins||post_del)?(equalities[equalitiesLength++]=pointer,pre_ins=post_ins,pre_del=post_del,lastEquality=diffs[pointer][1]):(equalitiesLength=0,lastEquality=null),post_ins=post_del=!1):(-1==diffs[pointer][0]?post_del=!0:post_ins=!0,lastEquality&&(pre_ins&&pre_del&&post_ins&&post_del||lastEquality.length<this.Diff_EditCost/2&&pre_ins+pre_del+post_ins+post_del==3)&&(diffs.splice(equalities[equalitiesLength-1],0,new diff_match_patch.Diff(-1,lastEquality)),diffs[equalities[equalitiesLength-1]+1][0]=1,equalitiesLength--,lastEquality=null,pre_ins&&pre_del?(post_ins=post_del=!0,equalitiesLength=0):(pointer=--equalitiesLength>0?equalities[equalitiesLength-1]:-1,post_ins=post_del=!1),changes=!0)),pointer++;changes&&this.diff_cleanupMerge(diffs)},diff_match_patch.prototype.diff_cleanupMerge=function(diffs){diffs.push(new diff_match_patch.Diff(0,""));for(var commonlength,pointer=0,count_delete=0,count_insert=0,text_delete="",text_insert="";pointer<diffs.length;)switch(diffs[pointer][0]){case 1:count_insert++,text_insert+=diffs[pointer][1],pointer++;break;case-1:count_delete++,text_delete+=diffs[pointer][1],pointer++;break;case 0:count_delete+count_insert>1?(0!==count_delete&&0!==count_insert&&(0!==(commonlength=this.diff_commonPrefix(text_insert,text_delete))&&(pointer-count_delete-count_insert>0&&0==diffs[pointer-count_delete-count_insert-1][0]?diffs[pointer-count_delete-count_insert-1][1]+=text_insert.substring(0,commonlength):(diffs.splice(0,0,new diff_match_patch.Diff(0,text_insert.substring(0,commonlength))),pointer++),text_insert=text_insert.substring(commonlength),text_delete=text_delete.substring(commonlength)),0!==(commonlength=this.diff_commonSuffix(text_insert,text_delete))&&(diffs[pointer][1]=text_insert.substring(text_insert.length-commonlength)+diffs[pointer][1],text_insert=text_insert.substring(0,text_insert.length-commonlength),text_delete=text_delete.substring(0,text_delete.length-commonlength))),pointer-=count_delete+count_insert,diffs.splice(pointer,count_delete+count_insert),text_delete.length&&(diffs.splice(pointer,0,new diff_match_patch.Diff(-1,text_delete)),pointer++),text_insert.length&&(diffs.splice(pointer,0,new diff_match_patch.Diff(1,text_insert)),pointer++),pointer++):0!==pointer&&0==diffs[pointer-1][0]?(diffs[pointer-1][1]+=diffs[pointer][1],diffs.splice(pointer,1)):pointer++,count_insert=0,count_delete=0,text_delete="",text_insert=""}""===diffs[diffs.length-1][1]&&diffs.pop();var changes=!1;for(pointer=1;pointer<diffs.length-1;)0==diffs[pointer-1][0]&&0==diffs[pointer+1][0]&&(diffs[pointer][1].substring(diffs[pointer][1].length-diffs[pointer-1][1].length)==diffs[pointer-1][1]?(diffs[pointer][1]=diffs[pointer-1][1]+diffs[pointer][1].substring(0,diffs[pointer][1].length-diffs[pointer-1][1].length),diffs[pointer+1][1]=diffs[pointer-1][1]+diffs[pointer+1][1],diffs.splice(pointer-1,1),changes=!0):diffs[pointer][1].substring(0,diffs[pointer+1][1].length)==diffs[pointer+1][1]&&(diffs[pointer-1][1]+=diffs[pointer+1][1],diffs[pointer][1]=diffs[pointer][1].substring(diffs[pointer+1][1].length)+diffs[pointer+1][1],diffs.splice(pointer+1,1),changes=!0)),pointer++;changes&&this.diff_cleanupMerge(diffs)},diff_match_patch.prototype.diff_xIndex=function(diffs,loc){var x,chars1=0,chars2=0,last_chars1=0,last_chars2=0;for(x=0;x<diffs.length&&(1!==diffs[x][0]&&(chars1+=diffs[x][1].length),-1!==diffs[x][0]&&(chars2+=diffs[x][1].length),!(chars1>loc));x++)last_chars1=chars1,last_chars2=chars2;return diffs.length!=x&&-1===diffs[x][0]?last_chars2:last_chars2+(loc-last_chars1)},diff_match_patch.prototype.diff_prettyHtml=function(diffs){for(var html=[],pattern_amp=/&/g,pattern_lt=/</g,pattern_gt=/>/g,pattern_para=/\n/g,x=0;x<diffs.length;x++){var op=diffs[x][0],text=diffs[x][1].replace(pattern_amp,"&amp;").replace(pattern_lt,"&lt;").replace(pattern_gt,"&gt;").replace(pattern_para,"&para;<br>");switch(op){case 1:html[x]='<ins style="background:#e6ffe6;">'+text+"</ins>";break;case-1:html[x]='<del style="background:#ffe6e6;">'+text+"</del>";break;case 0:html[x]="<span>"+text+"</span>"}}return html.join("")},diff_match_patch.prototype.diff_text1=function(diffs){for(var text=[],x=0;x<diffs.length;x++)1!==diffs[x][0]&&(text[x]=diffs[x][1]);return text.join("")},diff_match_patch.prototype.diff_text2=function(diffs){for(var text=[],x=0;x<diffs.length;x++)-1!==diffs[x][0]&&(text[x]=diffs[x][1]);return text.join("")},diff_match_patch.prototype.diff_levenshtein=function(diffs){for(var levenshtein=0,insertions=0,deletions=0,x=0;x<diffs.length;x++){var op=diffs[x][0],data=diffs[x][1];switch(op){case 1:insertions+=data.length;break;case-1:deletions+=data.length;break;case 0:levenshtein+=Math.max(insertions,deletions),insertions=0,deletions=0}}return levenshtein+=Math.max(insertions,deletions)},diff_match_patch.prototype.diff_toDelta=function(diffs){for(var text=[],x=0;x<diffs.length;x++)switch(diffs[x][0]){case 1:text[x]="+"+encodeURI(diffs[x][1]);break;case-1:text[x]="-"+diffs[x][1].length;break;case 0:text[x]="="+diffs[x][1].length}return text.join("\t").replace(/%20/g," ")},diff_match_patch.prototype.diff_fromDelta=function(text1,delta){for(var diffs=[],diffsLength=0,pointer=0,tokens=delta.split(/\t/g),x=0;x<tokens.length;x++){var param=tokens[x].substring(1);switch(tokens[x].charAt(0)){case"+":try{diffs[diffsLength++]=new diff_match_patch.Diff(1,decodeURI(param))}catch(ex){throw new Error("Illegal escape in diff_fromDelta: "+param)}break;case"-":case"=":var n=parseInt(param,10);if(isNaN(n)||n<0)throw new Error("Invalid number in diff_fromDelta: "+param);var text=text1.substring(pointer,pointer+=n);"="==tokens[x].charAt(0)?diffs[diffsLength++]=new diff_match_patch.Diff(0,text):diffs[diffsLength++]=new diff_match_patch.Diff(-1,text);break;default:if(tokens[x])throw new Error("Invalid diff operation in diff_fromDelta: "+tokens[x])}}if(pointer!=text1.length)throw new Error("Delta length ("+pointer+") does not equal source text length ("+text1.length+").");return diffs},diff_match_patch.prototype.match_main=function(text,pattern,loc){if(null==text||null==pattern||null==loc)throw new Error("Null input. (match_main)");return loc=Math.max(0,Math.min(loc,text.length)),text==pattern?0:text.length?text.substring(loc,loc+pattern.length)==pattern?loc:this.match_bitap_(text,pattern,loc):-1},diff_match_patch.prototype.match_bitap_=function(text,pattern,loc){if(pattern.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var s=this.match_alphabet_(pattern),dmp=this;function match_bitapScore_(e,x){var accuracy=e/pattern.length,proximity=Math.abs(loc-x);return dmp.Match_Distance?accuracy+proximity/dmp.Match_Distance:proximity?1:accuracy}var score_threshold=this.Match_Threshold,best_loc=text.indexOf(pattern,loc);-1!=best_loc&&(score_threshold=Math.min(match_bitapScore_(0,best_loc),score_threshold),-1!=(best_loc=text.lastIndexOf(pattern,loc+pattern.length))&&(score_threshold=Math.min(match_bitapScore_(0,best_loc),score_threshold)));var bin_min,bin_mid,matchmask=1<<pattern.length-1;best_loc=-1;for(var last_rd,bin_max=pattern.length+text.length,d=0;d<pattern.length;d++){for(bin_min=0,bin_mid=bin_max;bin_min<bin_mid;)match_bitapScore_(d,loc+bin_mid)<=score_threshold?bin_min=bin_mid:bin_max=bin_mid,bin_mid=Math.floor((bin_max-bin_min)/2+bin_min);bin_max=bin_mid;var start=Math.max(1,loc-bin_mid+1),finish=Math.min(loc+bin_mid,text.length)+pattern.length,rd=Array(finish+2);rd[finish+1]=(1<<d)-1;for(var j=finish;j>=start;j--){var charMatch=s[text.charAt(j-1)];if(rd[j]=0===d?(rd[j+1]<<1|1)&charMatch:(rd[j+1]<<1|1)&charMatch|(last_rd[j+1]|last_rd[j])<<1|1|last_rd[j+1],rd[j]&matchmask){var score=match_bitapScore_(d,j-1);if(score<=score_threshold){if(score_threshold=score,!((best_loc=j-1)>loc))break;start=Math.max(1,2*loc-best_loc)}}}if(match_bitapScore_(d+1,loc)>score_threshold)break;last_rd=rd}return best_loc},diff_match_patch.prototype.match_alphabet_=function(pattern){for(var s={},i=0;i<pattern.length;i++)s[pattern.charAt(i)]=0;for(i=0;i<pattern.length;i++)s[pattern.charAt(i)]|=1<<pattern.length-i-1;return s},diff_match_patch.prototype.patch_addContext_=function(patch,text){if(0!=text.length){if(null===patch.start2)throw Error("patch not initialized");for(var pattern=text.substring(patch.start2,patch.start2+patch.length1),padding=0;text.indexOf(pattern)!=text.lastIndexOf(pattern)&&pattern.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)padding+=this.Patch_Margin,pattern=text.substring(patch.start2-padding,patch.start2+patch.length1+padding);padding+=this.Patch_Margin;var prefix=text.substring(patch.start2-padding,patch.start2);prefix&&patch.diffs.unshift(new diff_match_patch.Diff(0,prefix));var suffix=text.substring(patch.start2+patch.length1,patch.start2+patch.length1+padding);suffix&&patch.diffs.push(new diff_match_patch.Diff(0,suffix)),patch.start1-=prefix.length,patch.start2-=prefix.length,patch.length1+=prefix.length+suffix.length,patch.length2+=prefix.length+suffix.length}},diff_match_patch.prototype.patch_make=function(a,opt_b,opt_c){var text1,diffs;if("string"==typeof a&&"string"==typeof opt_b&&void 0===opt_c)text1=a,(diffs=this.diff_main(text1,opt_b,!0)).length>2&&(this.diff_cleanupSemantic(diffs),this.diff_cleanupEfficiency(diffs));else if(a&&"object"==typeof a&&void 0===opt_b&&void 0===opt_c)diffs=a,text1=this.diff_text1(diffs);else if("string"==typeof a&&opt_b&&"object"==typeof opt_b&&void 0===opt_c)text1=a,diffs=opt_b;else{if("string"!=typeof a||"string"!=typeof opt_b||!opt_c||"object"!=typeof opt_c)throw new Error("Unknown call format to patch_make.");text1=a,diffs=opt_c}if(0===diffs.length)return[];for(var patches=[],patch=new diff_match_patch.patch_obj,patchDiffLength=0,char_count1=0,char_count2=0,prepatch_text=text1,postpatch_text=text1,x=0;x<diffs.length;x++){var diff_type=diffs[x][0],diff_text=diffs[x][1];switch(patchDiffLength||0===diff_type||(patch.start1=char_count1,patch.start2=char_count2),diff_type){case 1:patch.diffs[patchDiffLength++]=diffs[x],patch.length2+=diff_text.length,postpatch_text=postpatch_text.substring(0,char_count2)+diff_text+postpatch_text.substring(char_count2);break;case-1:patch.length1+=diff_text.length,patch.diffs[patchDiffLength++]=diffs[x],postpatch_text=postpatch_text.substring(0,char_count2)+postpatch_text.substring(char_count2+diff_text.length);break;case 0:diff_text.length<=2*this.Patch_Margin&&patchDiffLength&&diffs.length!=x+1?(patch.diffs[patchDiffLength++]=diffs[x],patch.length1+=diff_text.length,patch.length2+=diff_text.length):diff_text.length>=2*this.Patch_Margin&&patchDiffLength&&(this.patch_addContext_(patch,prepatch_text),patches.push(patch),patch=new diff_match_patch.patch_obj,patchDiffLength=0,prepatch_text=postpatch_text,char_count1=char_count2)}1!==diff_type&&(char_count1+=diff_text.length),-1!==diff_type&&(char_count2+=diff_text.length)}return patchDiffLength&&(this.patch_addContext_(patch,prepatch_text),patches.push(patch)),patches},diff_match_patch.prototype.patch_deepCopy=function(patches){for(var patchesCopy=[],x=0;x<patches.length;x++){var patch=patches[x],patchCopy=new diff_match_patch.patch_obj;patchCopy.diffs=[];for(var y=0;y<patch.diffs.length;y++)patchCopy.diffs[y]=new diff_match_patch.Diff(patch.diffs[y][0],patch.diffs[y][1]);patchCopy.start1=patch.start1,patchCopy.start2=patch.start2,patchCopy.length1=patch.length1,patchCopy.length2=patch.length2,patchesCopy[x]=patchCopy}return patchesCopy},diff_match_patch.prototype.patch_apply=function(patches,text){if(0==patches.length)return[text,[]];patches=this.patch_deepCopy(patches);var nullPadding=this.patch_addPadding(patches);text=nullPadding+text+nullPadding,this.patch_splitMax(patches);for(var delta=0,results=[],x=0;x<patches.length;x++){var start_loc,text2,expected_loc=patches[x].start2+delta,text1=this.diff_text1(patches[x].diffs),end_loc=-1;if(text1.length>this.Match_MaxBits?-1!=(start_loc=this.match_main(text,text1.substring(0,this.Match_MaxBits),expected_loc))&&(-1==(end_loc=this.match_main(text,text1.substring(text1.length-this.Match_MaxBits),expected_loc+text1.length-this.Match_MaxBits))||start_loc>=end_loc)&&(start_loc=-1):start_loc=this.match_main(text,text1,expected_loc),-1==start_loc)results[x]=!1,delta-=patches[x].length2-patches[x].length1;else if(results[x]=!0,delta=start_loc-expected_loc,text1==(text2=-1==end_loc?text.substring(start_loc,start_loc+text1.length):text.substring(start_loc,end_loc+this.Match_MaxBits)))text=text.substring(0,start_loc)+this.diff_text2(patches[x].diffs)+text.substring(start_loc+text1.length);else{var diffs=this.diff_main(text1,text2,!1);if(text1.length>this.Match_MaxBits&&this.diff_levenshtein(diffs)/text1.length>this.Patch_DeleteThreshold)results[x]=!1;else{this.diff_cleanupSemanticLossless(diffs);for(var index2,index1=0,y=0;y<patches[x].diffs.length;y++){var mod=patches[x].diffs[y];0!==mod[0]&&(index2=this.diff_xIndex(diffs,index1)),1===mod[0]?text=text.substring(0,start_loc+index2)+mod[1]+text.substring(start_loc+index2):-1===mod[0]&&(text=text.substring(0,start_loc+index2)+text.substring(start_loc+this.diff_xIndex(diffs,index1+mod[1].length))),-1!==mod[0]&&(index1+=mod[1].length)}}}}return[text=text.substring(nullPadding.length,text.length-nullPadding.length),results]},diff_match_patch.prototype.patch_addPadding=function(patches){for(var paddingLength=this.Patch_Margin,nullPadding="",x=1;x<=paddingLength;x++)nullPadding+=String.fromCharCode(x);for(x=0;x<patches.length;x++)patches[x].start1+=paddingLength,patches[x].start2+=paddingLength;var patch=patches[0],diffs=patch.diffs;if(0==diffs.length||0!=diffs[0][0])diffs.unshift(new diff_match_patch.Diff(0,nullPadding)),patch.start1-=paddingLength,patch.start2-=paddingLength,patch.length1+=paddingLength,patch.length2+=paddingLength;else if(paddingLength>diffs[0][1].length){var extraLength=paddingLength-diffs[0][1].length;diffs[0][1]=nullPadding.substring(diffs[0][1].length)+diffs[0][1],patch.start1-=extraLength,patch.start2-=extraLength,patch.length1+=extraLength,patch.length2+=extraLength}return 0==(diffs=(patch=patches[patches.length-1]).diffs).length||0!=diffs[diffs.length-1][0]?(diffs.push(new diff_match_patch.Diff(0,nullPadding)),patch.length1+=paddingLength,patch.length2+=paddingLength):paddingLength>diffs[diffs.length-1][1].length&&(extraLength=paddingLength-diffs[diffs.length-1][1].length,diffs[diffs.length-1][1]+=nullPadding.substring(0,extraLength),patch.length1+=extraLength,patch.length2+=extraLength),nullPadding},diff_match_patch.prototype.patch_splitMax=function(patches){for(var patch_size=this.Match_MaxBits,x=0;x<patches.length;x++)if(!(patches[x].length1<=patch_size)){var bigpatch=patches[x];patches.splice(x--,1);for(var start1=bigpatch.start1,start2=bigpatch.start2,precontext="";0!==bigpatch.diffs.length;){var patch=new diff_match_patch.patch_obj,empty=!0;for(patch.start1=start1-precontext.length,patch.start2=start2-precontext.length,""!==precontext&&(patch.length1=patch.length2=precontext.length,patch.diffs.push(new diff_match_patch.Diff(0,precontext)));0!==bigpatch.diffs.length&&patch.length1<patch_size-this.Patch_Margin;){var diff_type=bigpatch.diffs[0][0],diff_text=bigpatch.diffs[0][1];1===diff_type?(patch.length2+=diff_text.length,start2+=diff_text.length,patch.diffs.push(bigpatch.diffs.shift()),empty=!1):-1===diff_type&&1==patch.diffs.length&&0==patch.diffs[0][0]&&diff_text.length>2*patch_size?(patch.length1+=diff_text.length,start1+=diff_text.length,empty=!1,patch.diffs.push(new diff_match_patch.Diff(diff_type,diff_text)),bigpatch.diffs.shift()):(diff_text=diff_text.substring(0,patch_size-patch.length1-this.Patch_Margin),patch.length1+=diff_text.length,start1+=diff_text.length,0===diff_type?(patch.length2+=diff_text.length,start2+=diff_text.length):empty=!1,patch.diffs.push(new diff_match_patch.Diff(diff_type,diff_text)),diff_text==bigpatch.diffs[0][1]?bigpatch.diffs.shift():bigpatch.diffs[0][1]=bigpatch.diffs[0][1].substring(diff_text.length))}precontext=(precontext=this.diff_text2(patch.diffs)).substring(precontext.length-this.Patch_Margin);var postcontext=this.diff_text1(bigpatch.diffs).substring(0,this.Patch_Margin);""!==postcontext&&(patch.length1+=postcontext.length,patch.length2+=postcontext.length,0!==patch.diffs.length&&0===patch.diffs[patch.diffs.length-1][0]?patch.diffs[patch.diffs.length-1][1]+=postcontext:patch.diffs.push(new diff_match_patch.Diff(0,postcontext))),empty||patches.splice(++x,0,patch)}}},diff_match_patch.prototype.patch_toText=function(patches){for(var text=[],x=0;x<patches.length;x++)text[x]=patches[x];return text.join("")},diff_match_patch.prototype.patch_fromText=function(textline){var patches=[];if(!textline)return patches;for(var text=textline.split("\n"),textPointer=0,patchHeader=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;textPointer<text.length;){var m=text[textPointer].match(patchHeader);if(!m)throw new Error("Invalid patch string: "+text[textPointer]);var patch=new diff_match_patch.patch_obj;for(patches.push(patch),patch.start1=parseInt(m[1],10),""===m[2]?(patch.start1--,patch.length1=1):"0"==m[2]?patch.length1=0:(patch.start1--,patch.length1=parseInt(m[2],10)),patch.start2=parseInt(m[3],10),""===m[4]?(patch.start2--,patch.length2=1):"0"==m[4]?patch.length2=0:(patch.start2--,patch.length2=parseInt(m[4],10)),textPointer++;textPointer<text.length;){var sign=text[textPointer].charAt(0);try{var line=decodeURI(text[textPointer].substring(1))}catch(ex){throw new Error("Illegal escape in patch_fromText: "+line)}if("-"==sign)patch.diffs.push(new diff_match_patch.Diff(-1,line));else if("+"==sign)patch.diffs.push(new diff_match_patch.Diff(1,line));else if(" "==sign)patch.diffs.push(new diff_match_patch.Diff(0,line));else{if("@"==sign)break;if(""!==sign)throw new Error('Invalid patch mode "'+sign+'" in: '+line)}textPointer++}}return patches},(diff_match_patch.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0}).prototype.toString=function(){for(var op,text=["@@ -"+(0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1)+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],x=0;x<this.diffs.length;x++){switch(this.diffs[x][0]){case 1:op="+";break;case-1:op="-";break;case 0:op=" "}text[x+1]=op+encodeURI(this.diffs[x][1])+"\n"}return text.join("").replace(/%20/g," ")},module2.exports=diff_match_patch,module2.exports.diff_match_patch=diff_match_patch,module2.exports.DIFF_DELETE=-1,module2.exports.DIFF_INSERT=1,module2.exports.DIFF_EQUAL=0},923:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{default:()=>method});var abcRender=__webpack_require__2(288),adapterRender=__webpack_require__2(59),chartRender=__webpack_require__2(784),codeRender=__webpack_require__2(51),flowchartRender=__webpack_require__2(500),graphvizRender=__webpack_require__2(339),highlightRender=__webpack_require__2(108),lazyLoadImageRender=function(element){void 0===element&&(element=document);var loadImg=function(it){var testImage=document.createElement("img");testImage.src=it.getAttribute("data-src"),testImage.addEventListener("load",(function(){it.getAttribute("style")||it.getAttribute("class")||it.getAttribute("width")||it.getAttribute("height")||testImage.naturalHeight>testImage.naturalWidth&&testImage.naturalWidth/testImage.naturalHeight<document.querySelector(".vditor-reset").clientWidth/(window.innerHeight-40)&&testImage.naturalHeight>window.innerHeight-40&&(it.style.height=window.innerHeight-40+"px"),it.src=testImage.src})),it.removeAttribute("data-src")};if(!("IntersectionObserver"in window))return element.querySelectorAll("img").forEach((function(imgElement){imgElement.getAttribute("data-src")&&loadImg(imgElement)})),!1;window.vditorImageIntersectionObserver?(window.vditorImageIntersectionObserver.disconnect(),element.querySelectorAll("img").forEach((function(imgElement){window.vditorImageIntersectionObserver.observe(imgElement)}))):(window.vditorImageIntersectionObserver=new IntersectionObserver((function(entries){entries.forEach((function(entrie){(void 0===entrie.isIntersecting?0!==entrie.intersectionRatio:entrie.isIntersecting)&&entrie.target.getAttribute("data-src")&&loadImg(entrie.target)}))})),element.querySelectorAll("img").forEach((function(imgElement){window.vditorImageIntersectionObserver.observe(imgElement)})))},mathRender=__webpack_require__2(960),mediaRender=__webpack_require__2(0),mermaidRender=__webpack_require__2(975),SMILESRender=__webpack_require__2(931),markmapRender=__webpack_require__2(597),mindmapRender=__webpack_require__2(162),outlineRender=__webpack_require__2(70),plantumlRender=__webpack_require__2(591),constants=__webpack_require__2(913),setContentTheme=__webpack_require__2(873),addScript=__webpack_require__2(161),hasClosest=__webpack_require__2(598),merge=__webpack_require__2(905),setLute=__webpack_require__2(796),selection=__webpack_require__2(827),speechRender=function(element,lang){if(void 0===lang&&(lang="zh_CN"),"undefined"!=typeof speechSynthesis&&"undefined"!=typeof SpeechSynthesisUtterance){var getVoice=function(){var currentVoice,defaultVoice;return speechSynthesis.getVoices().forEach((function(item){item.lang===lang.replace("_","-")&&(currentVoice=item),item.default&&(defaultVoice=item)})),currentVoice||(currentVoice=defaultVoice),currentVoice},playSVG='<svg><use xlink:href="#vditor-icon-play"></use></svg>',pauseSVG='<svg><use xlink:href="#vditor-icon-pause"></use></svg>';document.getElementById("vditorIconScript")||(playSVG='<svg viewBox="0 0 32 32"><path d="M3.436 0l25.128 16-25.128 16v-32z"></path></svg>',pauseSVG='<svg viewBox="0 0 32 32"><path d="M20.617 0h9.128v32h-9.128v-32zM2.255 32v-32h9.128v32h-9.128z"></path></svg>');var speechDom=document.querySelector(".vditor-speech");speechDom||((speechDom=document.createElement("button")).className="vditor-speech",element.insertAdjacentElement("beforeend",speechDom),void 0!==speechSynthesis.onvoiceschanged&&(speechSynthesis.onvoiceschanged=getVoice));var voice=getVoice(),utterThis=new SpeechSynthesisUtterance;utterThis.voice=voice,utterThis.onend=utterThis.onerror=function(){speechDom.style.display="none",speechSynthesis.cancel(),speechDom.classList.remove("vditor-speech--current"),speechDom.innerHTML=playSVG},element.addEventListener(void 0!==window.ontouchstart?"touchend":"click",(function(event){var target=event.target;if(target.classList.contains("vditor-speech")||target.parentElement.classList.contains("vditor-speech"))return speechDom.classList.contains("vditor-speech--current")?speechSynthesis.speaking&&(speechSynthesis.paused?(speechSynthesis.resume(),speechDom.innerHTML=pauseSVG):(speechSynthesis.pause(),speechDom.innerHTML=playSVG)):(utterThis.text=speechDom.getAttribute("data-text"),speechSynthesis.speak(utterThis),speechDom.classList.add("vditor-speech--current"),speechDom.innerHTML=pauseSVG),(0,selection.jl)(window.vditorSpeechRange),void element.focus();if(speechDom.style.display="none",speechSynthesis.cancel(),speechDom.classList.remove("vditor-speech--current"),speechDom.innerHTML=playSVG,0!==getSelection().rangeCount){var range=getSelection().getRangeAt(0),text=range.toString().trim();if(text){window.vditorSpeechRange=range.cloneRange();var rect=range.getBoundingClientRect();speechDom.innerHTML=playSVG,speechDom.style.display="block",speechDom.style.top=rect.top+rect.height+document.querySelector("html").scrollTop-20+"px",void 0!==window.ontouchstart?speechDom.style.left=event.changedTouches[event.changedTouches.length-1].pageX+2+"px":speechDom.style.left=event.clientX+2+"px",speechDom.setAttribute("data-text",text)}}}))}},__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P((function(resolve){resolve(value)}))).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;g&&(g=0,op[0]&&(_=0)),_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!((t=(t=_.trys).length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},mergeOptions=function(options){var _a,defaultOption={anchor:0,cdn:constants.Y.CDN,customEmoji:{},emojiPath:"".concat(constants.Y.CDN,"/dist/images/emoji"),hljs:constants.Y.HLJS_OPTIONS,icon:"ant",lang:"zh_CN",markdown:constants.Y.MARKDOWN_OPTIONS,math:constants.Y.MATH_OPTIONS,mode:"light",speech:{enable:!1},render:{media:{enable:!0}},theme:constants.Y.THEME_OPTIONS};return options.cdn&&((null===(_a=options.theme)||void 0===_a?void 0:_a.path)||(defaultOption.theme.path="".concat(options.cdn,"/dist/css/content-theme")),options.emojiPath||(defaultOption.emojiPath="".concat(options.cdn,"/dist/images/emoji"))),(0,merge.h)(defaultOption,options)},md2html=function(mdText,options){var mergedOptions=mergeOptions(options);return(0,addScript.Z)("".concat(mergedOptions.cdn,"/dist/js/lute/lute.min.js"),"vditorLuteScript").then((function(){var lute=(0,setLute.X)({autoSpace:mergedOptions.markdown.autoSpace,gfmAutoLink:mergedOptions.markdown.gfmAutoLink,codeBlockPreview:mergedOptions.markdown.codeBlockPreview,emojiSite:mergedOptions.emojiPath,emojis:mergedOptions.customEmoji,fixTermTypo:mergedOptions.markdown.fixTermTypo,footnotes:mergedOptions.markdown.footnotes,headingAnchor:0!==mergedOptions.anchor,inlineMathDigit:mergedOptions.math.inlineDigit,lazyLoadImage:mergedOptions.lazyLoadImage,linkBase:mergedOptions.markdown.linkBase,linkPrefix:mergedOptions.markdown.linkPrefix,listStyle:mergedOptions.markdown.listStyle,mark:mergedOptions.markdown.mark,mathBlockPreview:mergedOptions.markdown.mathBlockPreview,paragraphBeginningSpace:mergedOptions.markdown.paragraphBeginningSpace,sanitize:mergedOptions.markdown.sanitize,toc:mergedOptions.markdown.toc});return(null==options?void 0:options.renderers)&&lute.SetJSRenderers({renderers:{Md2HTML:options.renderers}}),lute.SetHeadingID(!0),lute.Md2HTML(mdText)}))},previewRender=function(previewElement,markdown,options){return __awaiter(void 0,void 0,void 0,(function(){var mergedOptions,html,i18nScriptID_1;return __generator(this,(function(_a){switch(_a.label){case 0:return mergedOptions=mergeOptions(options),[4,md2html(markdown,mergedOptions)];case 1:if(html=_a.sent(),mergedOptions.transform&&(html=mergedOptions.transform(html)),previewElement.innerHTML=html,previewElement.classList.add("vditor-reset"),mergedOptions.i18n)return[3,5];if(["en_US","fr_FR","pt_BR","ja_JP","ko_KR","ru_RU","sv_SE","zh_CN","zh_TW"].includes(mergedOptions.lang))return[3,2];throw new Error("options.lang error, see https://ld246.com/article/1549638745630#options");case 2:return i18nScriptID_1="vditorI18nScript"+mergedOptions.lang,document.querySelectorAll('head script[id^="'.concat("vditorI18nScript",'"]')).forEach((function(el){el.id!==i18nScriptID_1&&document.head.removeChild(el)})),[4,(0,addScript.Z)("".concat(mergedOptions.cdn,"/dist/js/i18n/").concat(mergedOptions.lang,".js"),i18nScriptID_1)];case 3:_a.sent(),_a.label=4;case 4:return[3,6];case 5:window.VditorI18n=mergedOptions.i18n,_a.label=6;case 6:return mergedOptions.icon?[4,(0,addScript.Z)("".concat(mergedOptions.cdn,"/dist/js/icons/").concat(mergedOptions.icon,".js"),"vditorIconScript")]:[3,8];case 7:_a.sent(),_a.label=8;case 8:return(0,setContentTheme.H)(mergedOptions.theme.current,mergedOptions.theme.path),1===mergedOptions.anchor&&previewElement.classList.add("vditor-reset--anchor"),(0,codeRender.o)(previewElement,mergedOptions.hljs),(0,highlightRender.$)(mergedOptions.hljs,previewElement,mergedOptions.cdn),(0,mathRender.T)(previewElement,{cdn:mergedOptions.cdn,math:mergedOptions.math}),(0,mermaidRender.e)(previewElement,mergedOptions.cdn,mergedOptions.mode),(0,SMILESRender.Y)(previewElement,mergedOptions.cdn,mergedOptions.mode),(0,markmapRender.K)(previewElement,mergedOptions.cdn),(0,flowchartRender.D)(previewElement,mergedOptions.cdn),(0,graphvizRender.m)(previewElement,mergedOptions.cdn),(0,chartRender.v)(previewElement,mergedOptions.cdn,mergedOptions.mode),(0,mindmapRender.l)(previewElement,mergedOptions.cdn,mergedOptions.mode),(0,plantumlRender.M)(previewElement,mergedOptions.cdn),(0,abcRender.$)(previewElement,mergedOptions.cdn),mergedOptions.render.media.enable&&(0,mediaRender.l)(previewElement),mergedOptions.speech.enable&&speechRender(previewElement),0!==mergedOptions.anchor&&(type=mergedOptions.anchor,document.querySelectorAll(".vditor-anchor").forEach((function(anchor){1===type&&anchor.classList.add("vditor-anchor--left"),anchor.onclick=function(){var id=anchor.getAttribute("href").substr(1),top=document.getElementById("vditorAnchor-"+id).offsetTop;document.querySelector("html").scrollTop=top}})),window.onhashchange=function(){var element=document.getElementById("vditorAnchor-"+decodeURIComponent(window.location.hash.substr(1)));element&&(document.querySelector("html").scrollTop=element.offsetTop)}),mergedOptions.after&&mergedOptions.after(),mergedOptions.lazyLoadImage&&lazyLoadImageRender(previewElement),previewElement.addEventListener("click",(function(event){var spanElement=(0,hasClosest._Y)(event.target,"SPAN");if(spanElement&&(0,hasClosest.KJ)(spanElement,"vditor-toc")){var headingElement=previewElement.querySelector("#"+spanElement.getAttribute("data-target-id"));headingElement&&window.scrollTo(window.scrollX,headingElement.offsetTop)}})),[2]}var type}))}))},preview_image=__webpack_require__2(726),setCodeTheme=__webpack_require__2(13);const method=function(){function Vditor3(){}return Vditor3.adapterRender=adapterRender,Vditor3.previewImage=preview_image.o,Vditor3.codeRender=codeRender.o,Vditor3.graphvizRender=graphvizRender.m,Vditor3.highlightRender=highlightRender.$,Vditor3.mathRender=mathRender.T,Vditor3.mermaidRender=mermaidRender.e,Vditor3.SMILESRender=SMILESRender.Y,Vditor3.markmapRender=markmapRender.K,Vditor3.flowchartRender=flowchartRender.D,Vditor3.chartRender=chartRender.v,Vditor3.abcRender=abcRender.$,Vditor3.mindmapRender=mindmapRender.l,Vditor3.plantumlRender=plantumlRender.M,Vditor3.outlineRender=outlineRender.N,Vditor3.mediaRender=mediaRender.l,Vditor3.speechRender=speechRender,Vditor3.lazyLoadImageRender=lazyLoadImageRender,Vditor3.md2html=md2html,Vditor3.preview=previewRender,Vditor3.setCodeTheme=setCodeTheme.h,Vditor3.setContentTheme=setContentTheme.H,Vditor3}()},913:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{Y:()=>Constants,g:()=>_VDITOR_VERSION});var _VDITOR_VERSION="3.10.8",Constants=function(){function Constants2(){}return Constants2.ZWSP="​",Constants2.DROP_EDITOR="application/editor",Constants2.MOBILE_WIDTH=520,Constants2.CLASS_MENU_DISABLED="vditor-menu--disabled",Constants2.EDIT_TOOLBARS=["emoji","headings","bold","italic","strike","link","list","ordered-list","outdent","indent","check","line","quote","code","inline-code","insert-after","insert-before","upload","record","table"],Constants2.CODE_THEME=["a11y-dark","agate","an-old-hope","androidstudio","arta","atom-one-dark","atom-one-dark-reasonable","base16/3024","base16/apathy","base16/apprentice","base16/ashes","base16/atelier-cave","base16/atelier-dune","base16/atelier-estuary","base16/atelier-forest","base16/atelier-heath","base16/atelier-lakeside","base16/atelier-plateau","base16/atelier-savanna","base16/atelier-seaside","base16/atelier-sulphurpool","base16/atlas","base16/bespin","base16/black-metal","base16/black-metal-bathory","base16/black-metal-burzum","base16/black-metal-dark-funeral","base16/black-metal-gorgoroth","base16/black-metal-immortal","base16/black-metal-khold","base16/black-metal-marduk","base16/black-metal-mayhem","base16/black-metal-nile","base16/black-metal-venom","base16/brewer","base16/bright","base16/brogrammer","base16/brush-trees-dark","base16/chalk","base16/circus","base16/classic-dark","base16/codeschool","base16/colors","base16/danqing","base16/darcula","base16/dark-violet","base16/darkmoss","base16/darktooth","base16/decaf","base16/default-dark","base16/dracula","base16/edge-dark","base16/eighties","base16/embers","base16/equilibrium-dark","base16/equilibrium-gray-dark","base16/espresso","base16/eva","base16/eva-dim","base16/flat","base16/framer","base16/gigavolt","base16/google-dark","base16/grayscale-dark","base16/green-screen","base16/gruvbox-dark-hard","base16/gruvbox-dark-medium","base16/gruvbox-dark-pale","base16/gruvbox-dark-soft","base16/hardcore","base16/harmonic16-dark","base16/heetch-dark","base16/helios","base16/hopscotch","base16/horizon-dark","base16/humanoid-dark","base16/ia-dark","base16/icy-dark","base16/ir-black","base16/isotope","base16/kimber","base16/london-tube","base16/macintosh","base16/marrakesh","base16/materia","base16/material","base16/material-darker","base16/material-palenight","base16/material-vivid","base16/mellow-purple","base16/mocha","base16/monokai","base16/nebula","base16/nord","base16/nova","base16/ocean","base16/oceanicnext","base16/onedark","base16/outrun-dark","base16/papercolor-dark","base16/paraiso","base16/pasque","base16/phd","base16/pico","base16/pop","base16/porple","base16/qualia","base16/railscasts","base16/rebecca","base16/ros-pine","base16/ros-pine-moon","base16/sandcastle","base16/seti-ui","base16/silk-dark","base16/snazzy","base16/solar-flare","base16/solarized-dark","base16/spacemacs","base16/summercamp","base16/summerfruit-dark","base16/synth-midnight-terminal-dark","base16/tango","base16/tender","base16/tomorrow-night","base16/twilight","base16/unikitty-dark","base16/vulcan","base16/windows-10","base16/windows-95","base16/windows-high-contrast","base16/windows-nt","base16/woodland","base16/xcode-dusk","base16/zenburn","codepen-embed","dark","devibeans","far","felipec","github-dark","github-dark-dimmed","gml","gradient-dark","hybrid","ir-black","isbl-editor-dark","kimbie-dark","lioshi","monokai","monokai-sublime","night-owl","nnfx-dark","nord","obsidian","panda-syntax-dark","paraiso-dark","pojoaque","qtcreator-dark","rainbow","shades-of-purple","srcery","stackoverflow-dark","sunburst","tomorrow-night-blue","tomorrow-night-bright","tokyo-night-dark","vs2015","xt256","ant-design","a11y-light","arduino-light","ascetic","atom-one-light","base16/atelier-cave-light","base16/atelier-dune-light","base16/atelier-estuary-light","base16/atelier-forest-light","base16/atelier-heath-light","base16/atelier-lakeside-light","base16/atelier-plateau-light","base16/atelier-savanna-light","base16/atelier-seaside-light","base16/atelier-sulphurpool-light","base16/brush-trees","base16/classic-light","base16/cupcake","base16/cupertino","base16/default-light","base16/dirtysea","base16/edge-light","base16/equilibrium-gray-light","base16/equilibrium-light","base16/fruit-soda","base16/github","base16/google-light","base16/grayscale-light","base16/gruvbox-light-hard","base16/gruvbox-light-medium","base16/gruvbox-light-soft","base16/harmonic16-light","base16/heetch-light","base16/humanoid-light","base16/horizon-light","base16/ia-light","base16/material-lighter","base16/mexico-light","base16/one-light","base16/papercolor-light","base16/ros-pine-dawn","base16/sagelight","base16/shapeshifter","base16/silk-light","base16/solar-flare-light","base16/solarized-light","base16/summerfruit-light","base16/synth-midnight-terminal-light","base16/tomorrow","base16/unikitty-light","base16/windows-10-light","base16/windows-95-light","base16/windows-high-contrast-light","brown-paper","base16/windows-nt-light","color-brewer","docco","foundation","github","googlecode","gradient-light","grayscale","idea","intellij-light","isbl-editor-light","kimbie-light","lightfair","magula","mono-blue","nnfx-light","panda-syntax-light","paraiso-light","purebasic","qtcreator-light","routeros","school-book","stackoverflow-light","tokyo-night-light","vs","xcode","default"],Constants2.ALIAS_CODE_LANGUAGES=["abc","plantuml","mermaid","flowchart","echarts","mindmap","graphviz","math","markmap","smiles","js","ts","html","toml","c#","bat"],Constants2.CDN="https://unpkg.com/vditor@".concat("3.10.8"),Constants2.MARKDOWN_OPTIONS={autoSpace:!1,gfmAutoLink:!0,codeBlockPreview:!0,fixTermTypo:!1,footnotes:!0,linkBase:"",linkPrefix:"",listStyle:!1,mark:!1,mathBlockPreview:!0,paragraphBeginningSpace:!1,sanitize:!0,toc:!1},Constants2.HLJS_OPTIONS={enable:!0,lineNumber:!1,defaultLang:"",style:"github"},Constants2.MATH_OPTIONS={engine:"KaTeX",inlineDigit:!1,macros:{}},Constants2.THEME_OPTIONS={current:"light",list:{"ant-design":"Ant Design",dark:"Dark",light:"Light",wechat:"WeChat"},path:"".concat(Constants2.CDN,"/dist/css/content-theme")},Constants2}()},931:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{Y:()=>SMILESRender});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(913),_util_addScript__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__2(161),_adapterRender__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(59),_util_function__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__2(933),SMILESRender=function(element,cdn,theme){void 0===element&&(element=document),void 0===cdn&&(cdn=_constants__WEBPACK_IMPORTED_MODULE_0__.Y.CDN);var SMILESElements=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.SMILESRenderAdapter.getElements(element);SMILESElements.length>0&&(0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__.Z)("".concat(cdn,"/dist/js/smiles-drawer/smiles-drawer.min.js?v=2.1.7"),"vditorAbcjsScript").then((function(){var sd=new SmiDrawer({},{});SMILESElements.forEach((function(item){var code=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.SMILESRenderAdapter.getCode(item).trim();if("true"!==item.getAttribute("data-processed")&&""!==code.trim()){var id="smiles"+(0,_util_function__WEBPACK_IMPORTED_MODULE_3__.Ee)();item.innerHTML='<svg id="'.concat(id,'"></svg>'),sd.draw(code,"#"+id,"dark"===theme?"dark":void 0),item.setAttribute("data-processed","true")}}))}))}},288:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{$:()=>abcRender});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(913),_util_addScript__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__2(161),_adapterRender__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(59),abcRender=function(element,cdn){void 0===element&&(element=document),void 0===cdn&&(cdn=_constants__WEBPACK_IMPORTED_MODULE_0__.Y.CDN);var abcElements=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.abcRenderAdapter.getElements(element);abcElements.length>0&&(0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__.Z)("".concat(cdn,"/dist/js/abcjs/abcjs_basic.min.js"),"vditorAbcjsScript").then((function(){abcElements.forEach((function(item){item.parentElement.classList.contains("vditor-wysiwyg__pre")||item.parentElement.classList.contains("vditor-ir__marker--pre")||"true"!==item.getAttribute("data-processed")&&(ABCJS.renderAbc(item,_adapterRender__WEBPACK_IMPORTED_MODULE_1__.abcRenderAdapter.getCode(item).trim()),item.style.overflowX="auto",item.setAttribute("data-processed","true"))}))}))}},59:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.r(__webpack_exports__2),__webpack_require__2.d(__webpack_exports__2,{SMILESRenderAdapter:()=>SMILESRenderAdapter,abcRenderAdapter:()=>abcRenderAdapter,chartRenderAdapter:()=>chartRenderAdapter,flowchartRenderAdapter:()=>flowchartRenderAdapter,graphvizRenderAdapter:()=>graphvizRenderAdapter,markmapRenderAdapter:()=>markmapRenderAdapter,mathRenderAdapter:()=>mathRenderAdapter,mermaidRenderAdapter:()=>mermaidRenderAdapter,mindmapRenderAdapter:()=>mindmapRenderAdapter,plantumlRenderAdapter:()=>plantumlRenderAdapter});var mathRenderAdapter={getCode:function(el){return el.textContent},getElements:function(element){return element.querySelectorAll(".language-math")}},SMILESRenderAdapter={getCode:function(el){return el.textContent},getElements:function(element){return element.querySelectorAll(".language-smiles")}},mermaidRenderAdapter={getCode:function(el){return el.textContent},getElements:function(element){return element.querySelectorAll(".language-mermaid")}},markmapRenderAdapter={getCode:function(el){return el.textContent},getElements:function(element){return element.querySelectorAll(".language-markmap")}},mindmapRenderAdapter={getCode:function(el){return el.getAttribute("data-code")},getElements:function(el){return el.querySelectorAll(".language-mindmap")}},chartRenderAdapter={getCode:function(el){return el.innerText},getElements:function(el){return el.querySelectorAll(".language-echarts")}},abcRenderAdapter={getCode:function(el){return el.textContent},getElements:function(el){return el.querySelectorAll(".language-abc")}},graphvizRenderAdapter={getCode:function(el){return el.textContent},getElements:function(el){return el.querySelectorAll(".language-graphviz")}},flowchartRenderAdapter={getCode:function(el){return el.textContent},getElements:function(el){return el.querySelectorAll(".language-flowchart")}},plantumlRenderAdapter={getCode:function(el){return el.textContent},getElements:function(el){return el.querySelectorAll(".language-plantuml")}}},784:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{v:()=>chartRender});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(913),_util_addScript__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__2(161),_adapterRender__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(59),_util_function__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__2(933),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P((function(resolve){resolve(value)}))).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;g&&(g=0,op[0]&&(_=0)),_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!((t=(t=_.trys).length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},chartRender=function(element,cdn,theme){void 0===element&&(element=document),void 0===cdn&&(cdn=_constants__WEBPACK_IMPORTED_MODULE_0__.Y.CDN);var echartsElements=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.chartRenderAdapter.getElements(element);echartsElements.length>0&&(0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__.Z)("".concat(cdn,"/dist/js/echarts/echarts.min.js?v=5.5.1"),"vditorEchartsScript").then((function(){echartsElements.forEach((function(e){return __awaiter(void 0,void 0,void 0,(function(){var text,option,error_1;return __generator(this,(function(_a){switch(_a.label){case 0:if(e.parentElement.classList.contains("vditor-wysiwyg__pre")||e.parentElement.classList.contains("vditor-ir__marker--pre"))return[2];if(!(text=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.chartRenderAdapter.getCode(e).trim()))return[2];_a.label=1;case 1:return _a.trys.push([1,3,,4]),"true"===e.getAttribute("data-processed")?[2]:[4,(0,_util_function__WEBPACK_IMPORTED_MODULE_3__.kY)(text)];case 2:return option=_a.sent(),echarts.init(e,"dark"===theme?"dark":void 0).setOption(option),e.setAttribute("data-processed","true"),[3,4];case 3:return error_1=_a.sent(),e.className="vditor-reset--error",e.innerHTML="echarts render error: <br>".concat(error_1),[3,4];case 4:return[2]}}))}))}))}))}},51:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{o:()=>codeRender});var _util_code160to32__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(695),_constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(913),codeRender=function(element,option){Array.from(element.querySelectorAll("pre > code")).filter((function(e,index){return!(e.parentElement.classList.contains("vditor-wysiwyg__pre")||e.parentElement.classList.contains("vditor-ir__marker--pre")||e.classList.contains("language-mermaid")||e.classList.contains("language-flowchart")||e.classList.contains("language-echarts")||e.classList.contains("language-mindmap")||e.classList.contains("language-plantuml")||e.classList.contains("language-markmap")||e.classList.contains("language-abc")||e.classList.contains("language-graphviz")||e.classList.contains("language-math")||e.classList.contains("language-smiles")||e.style.maxHeight.indexOf("px")>-1||element.classList.contains("vditor-preview")&&index>5)})).forEach((function(e){var _a,_b,_c,codeText=e.innerText;if(e.classList.contains("highlight-chroma")){var codeElement=e.cloneNode(!0);codeElement.querySelectorAll(".highlight-ln").forEach((function(item){item.remove()})),codeText=codeElement.innerText}else codeText.endsWith("\n")&&(codeText=codeText.substr(0,codeText.length-1));var iconHTML='<svg><use xlink:href="#vditor-icon-copy"></use></svg>';document.getElementById("vditorIconScript")||(iconHTML='<svg viewBox="0 0 32 32"><path d="M22.545-0h-17.455c-1.6 0-2.909 1.309-2.909 2.909v20.364h2.909v-20.364h17.455v-2.909zM26.909 5.818h-16c-1.6 0-2.909 1.309-2.909 2.909v20.364c0 1.6 1.309 2.909 2.909 2.909h16c1.6 0 2.909-1.309 2.909-2.909v-20.364c0-1.6-1.309-2.909-2.909-2.909zM26.909 29.091h-16v-20.364h16v20.364z"></path></svg>');var divElement=document.createElement("div");divElement.className="vditor-copy",divElement.innerHTML='<span aria-label="'.concat((null===(_a=window.VditorI18n)||void 0===_a?void 0:_a.copy)||"复制","\"\nonmouseover=\"this.setAttribute('aria-label', '").concat((null===(_b=window.VditorI18n)||void 0===_b?void 0:_b.copy)||"复制","')\"\nclass=\"vditor-tooltipped vditor-tooltipped__w\"\nonclick=\"this.previousElementSibling.select();document.execCommand('copy');this.setAttribute('aria-label', '").concat((null===(_c=window.VditorI18n)||void 0===_c?void 0:_c.copied)||"已复制","');this.previousElementSibling.blur()\">").concat(iconHTML,"</span>");var textarea=document.createElement("textarea");textarea.value=(0,_util_code160to32__WEBPACK_IMPORTED_MODULE_1__.p)(codeText),divElement.insertAdjacentElement("afterbegin",textarea),option&&option.renderMenu&&option.renderMenu(e,divElement),e.before(divElement),e.style.maxHeight=window.outerHeight-40+"px",e.insertAdjacentHTML("afterend",'<span style="position: absolute">'.concat(_constants__WEBPACK_IMPORTED_MODULE_0__.Y.ZWSP,"</span>"))}))}},500:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{D:()=>flowchartRender});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(913),_util_addScript__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__2(161),_adapterRender__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(59),flowchartRender=function(element,cdn){void 0===cdn&&(cdn=_constants__WEBPACK_IMPORTED_MODULE_0__.Y.CDN);var flowchartElements=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.flowchartRenderAdapter.getElements(element);0!==flowchartElements.length&&(0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__.Z)("".concat(cdn,"/dist/js/flowchart.js/flowchart.min.js"),"vditorFlowchartScript").then((function(){flowchartElements.forEach((function(item){if("true"!==item.getAttribute("data-processed")){var flowchartObj=flowchart.parse(_adapterRender__WEBPACK_IMPORTED_MODULE_1__.flowchartRenderAdapter.getCode(item));item.innerHTML="",flowchartObj.drawSVG(item),item.setAttribute("data-processed","true")}}))}))}},339:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{m:()=>graphvizRender});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(913),_util_addScript__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__2(161),_adapterRender__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(59),graphvizRender=function(element,cdn){void 0===cdn&&(cdn=_constants__WEBPACK_IMPORTED_MODULE_0__.Y.CDN);var graphvizElements=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.graphvizRenderAdapter.getElements(element);0!==graphvizElements.length&&(0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__.Z)("".concat(cdn,"/dist/js/graphviz/viz.js"),"vditorGraphVizScript").then((function(){graphvizElements.forEach((function(e){var code=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.graphvizRenderAdapter.getCode(e);if(!e.parentElement.classList.contains("vditor-wysiwyg__pre")&&!e.parentElement.classList.contains("vditor-ir__marker--pre")&&"true"!==e.getAttribute("data-processed")&&""!==code.trim()){try{var blob=new Blob(["importScripts('".concat(document.getElementById("vditorGraphVizScript").src.replace("viz.js","full.render.js"),"');")],{type:"application/javascript"}),blobUrl=(window.URL||window.webkitURL).createObjectURL(blob),worker=new Worker(blobUrl);new Viz({worker:worker}).renderSVGElement(code).then((function(result){e.innerHTML=result.outerHTML})).catch((function(error){e.innerHTML="graphviz render error: <br>".concat(error),e.className="vditor-reset--error"}))}catch(e2){console.error("graphviz error",e2)}e.setAttribute("data-processed","true")}}))}))}},108:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{$:()=>highlightRender});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(913),_util_addScript__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__2(161),_util_addStyle__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(505),highlightRender=function(hljsOption,element,cdn){void 0===element&&(element=document),void 0===cdn&&(cdn=_constants__WEBPACK_IMPORTED_MODULE_0__.Y.CDN);var style=hljsOption.style;_constants__WEBPACK_IMPORTED_MODULE_0__.Y.CODE_THEME.includes(style)||(style="github");var vditorHljsStyle=document.getElementById("vditorHljsStyle"),href="".concat(cdn,"/dist/js/highlight.js/styles/").concat(style,".min.css");vditorHljsStyle&&vditorHljsStyle.getAttribute("href")!==href&&vditorHljsStyle.remove(),(0,_util_addStyle__WEBPACK_IMPORTED_MODULE_1__.T)("".concat(cdn,"/dist/js/highlight.js/styles/").concat(style,".min.css"),"vditorHljsStyle"),!1!==hljsOption.enable&&0!==element.querySelectorAll("pre > code").length&&(0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__.Z)("".concat(cdn,"/dist/js/highlight.js/highlight.min.js?v=11.7.0"),"vditorHljsScript").then((function(){(0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__.Z)("".concat(cdn,"/dist/js/highlight.js/third-languages.js?v=1.0.1"),"vditorHljsThirdScript").then((function(){element.querySelectorAll("pre > code").forEach((function(block){if(!block.parentElement.classList.contains("vditor-ir__marker--pre")&&!block.parentElement.classList.contains("vditor-wysiwyg__pre")&&!(block.classList.contains("language-mermaid")||block.classList.contains("language-flowchart")||block.classList.contains("language-echarts")||block.classList.contains("language-mindmap")||block.classList.contains("language-plantuml")||block.classList.contains("language-smiles")||block.classList.contains("language-abc")||block.classList.contains("language-graphviz")||block.classList.contains("language-math"))){""!==hljsOption.defaultLang&&-1===block.className.indexOf("language-")&&block.classList.add("language-"+hljsOption.defaultLang);var language=hljsOption.defaultLang||block.className.replace("language-","");if(window.hljs.getLanguage(language)||(language="plaintext"),block.innerHTML=window.hljs.highlight(block.textContent,{language:language,ignoreIllegals:!0}).value,block.classList.add("hljs"),hljsOption.lineNumber){block.classList.add("vditor-linenumber");var linenNumberTemp=block.querySelector(".vditor-linenumber__temp");linenNumberTemp||((linenNumberTemp=document.createElement("div")).className="vditor-linenumber__temp",block.insertAdjacentElement("beforeend",linenNumberTemp));var whiteSpace=getComputedStyle(block).whiteSpace,isSoftWrap=!1;"pre-wrap"!==whiteSpace&&"pre-line"!==whiteSpace||(isSoftWrap=!0);var lineNumberHTML="",lineList=block.textContent.split(/\r\n|\r|\n/g);lineList.pop(),lineList.map((function(line){var lineHeight="";isSoftWrap&&(linenNumberTemp.textContent=line||"\n",lineHeight=' style="height:'.concat(linenNumberTemp.getBoundingClientRect().height,'px"')),lineNumberHTML+="<span".concat(lineHeight,"></span>")})),linenNumberTemp.style.display="none",lineNumberHTML='<span class="vditor-linenumber__rows">'.concat(lineNumberHTML,"</span>"),block.insertAdjacentHTML("beforeend",lineNumberHTML)}}}))}))}))}},597:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{K:()=>markmapRender});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(913),_util_addScript__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__2(161),_adapterRender__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(59),enabled={},init=function(el,code){var _a=window.markmap,Transformer=_a.Transformer,Markmap=_a.Markmap,deriveOptions=_a.deriveOptions;_a.globalCSS;var transformer=new Transformer;el.innerHTML='<svg style="width:100%"></svg>';var svg=el.firstChild,mm=Markmap.create(svg,null),_b=function(transformer,content){var result=transformer.transform(content),keys=Object.keys(result.features).filter((function(key){return!enabled[key]}));keys.forEach((function(key){enabled[key]=!0}));var _a=transformer.getAssets(keys),styles=_a.styles,scripts=_a.scripts,markmap=window.markmap;return styles&&markmap.loadCSS(styles),scripts&&markmap.loadJS(scripts),result}(transformer,code),root=_b.root,frontmatter=_b.frontmatter,frontmatterOptions=deriveOptions(null==frontmatter?void 0:frontmatter.markmap);mm.setData(root,frontmatterOptions),mm.fit()},markmapRender=function(element,cdn){void 0===element&&(element=document),void 0===cdn&&(cdn=_constants__WEBPACK_IMPORTED_MODULE_0__.Y.CDN);var markmapElements=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.markmapRenderAdapter.getElements(element);0!==markmapElements.length&&(0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__.Z)("".concat(cdn,"/dist/js/markmap/markmap.min.js"),"vditorMarkerScript").then((function(){markmapElements.forEach((function(item){var code=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.markmapRenderAdapter.getCode(item);if("true"!==item.getAttribute("data-processed")&&""!==code.trim()){var render=document.createElement("div");render.className="language-markmap",item.parentNode.appendChild(render),init(render,code),"CODE"==item.parentNode.childNodes[0].nodeName&&item.parentNode.removeChild(item.parentNode.childNodes[0])}}))}))}},960:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{T:()=>mathRender});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(913),_util_addScript__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__2(161),_util_addStyle__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__2(505),_util_code160to32__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__2(695),_adapterRender__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(59),mathRender=function(element,options){void 0===element&&(element=document);var mathElements=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.mathRenderAdapter.getElements(element);if(0!==mathElements.length){var defaultOptions={cdn:_constants__WEBPACK_IMPORTED_MODULE_0__.Y.CDN,math:{engine:"KaTeX",inlineDigit:!1,macros:{}}};if(options&&options.math&&(options.math=Object.assign({},defaultOptions.math,options.math)),"KaTeX"===(options=Object.assign({},defaultOptions,options)).math.engine)(0,_util_addStyle__WEBPACK_IMPORTED_MODULE_2__.T)("".concat(options.cdn,"/dist/js/katex/katex.min.css?v=0.16.9"),"vditorKatexStyle"),(0,_util_addScript__WEBPACK_IMPORTED_MODULE_3__.Z)("".concat(options.cdn,"/dist/js/katex/katex.min.js?v=0.16.9"),"vditorKatexScript").then((function(){(0,_util_addScript__WEBPACK_IMPORTED_MODULE_3__.Z)("".concat(options.cdn,"/dist/js/katex/mhchem.min.js?v=0.16.9"),"vditorKatexChemScript").then((function(){mathElements.forEach((function(mathElement){if(!mathElement.parentElement.classList.contains("vditor-wysiwyg__pre")&&!mathElement.parentElement.classList.contains("vditor-ir__marker--pre")&&!mathElement.getAttribute("data-math")){var math=(0,_util_code160to32__WEBPACK_IMPORTED_MODULE_4__.p)(_adapterRender__WEBPACK_IMPORTED_MODULE_1__.mathRenderAdapter.getCode(mathElement));mathElement.setAttribute("data-math",math);try{mathElement.innerHTML=katex.renderToString(math,{displayMode:"DIV"===mathElement.tagName,output:"html",macros:options.math.macros})}catch(e){mathElement.innerHTML=e.message,mathElement.className="language-math vditor-reset--error"}mathElement.addEventListener("copy",(function(event){event.stopPropagation(),event.preventDefault();var vditorMathElement=event.currentTarget.closest(".language-math");event.clipboardData.setData("text/html",vditorMathElement.innerHTML),event.clipboardData.setData("text/plain",vditorMathElement.getAttribute("data-math"))}))}}))}))}));else if("MathJax"===options.math.engine){window.MathJax||(window.MathJax={loader:{paths:{mathjax:"".concat(options.cdn,"/dist/js/mathjax")}},startup:{typeset:!1},tex:{macros:options.math.macros}},Object.assign(window.MathJax,options.math.mathJaxOptions)),(0,_util_addScript__WEBPACK_IMPORTED_MODULE_3__.U)("".concat(options.cdn,"/dist/js/mathjax/tex-svg-full.js"),"protyleMathJaxScript");var renderMath_1=function(mathElement,next){var math=(0,_util_code160to32__WEBPACK_IMPORTED_MODULE_4__.p)(mathElement.textContent).trim(),mathOptions=window.MathJax.getMetricsFor(mathElement);mathOptions.display="DIV"===mathElement.tagName,window.MathJax.tex2svgPromise(math,mathOptions).then((function(node){mathElement.innerHTML="",mathElement.setAttribute("data-math",math),mathElement.append(node),window.MathJax.startup.document.clear(),window.MathJax.startup.document.updateDocument();var errorTextElement=node.querySelector('[data-mml-node="merror"]');errorTextElement&&""!==errorTextElement.textContent.trim()&&(mathElement.innerHTML=errorTextElement.textContent.trim(),mathElement.className="vditor-reset--error"),next&&next()}))};window.MathJax.startup.promise.then((function(){for(var chains=[],_loop_1=function(i2){var mathElement=mathElements[i2];mathElement.parentElement.classList.contains("vditor-wysiwyg__pre")||mathElement.parentElement.classList.contains("vditor-ir__marker--pre")||mathElement.getAttribute("data-math")||!(0,_util_code160to32__WEBPACK_IMPORTED_MODULE_4__.p)(mathElement.textContent).trim()||chains.push((function(next){i2===mathElements.length-1?renderMath_1(mathElement):renderMath_1(mathElement,next)}))},i=0;i<mathElements.length;i++)_loop_1(i);!function(fns){if(0!==fns.length){var curr=0,last=fns[fns.length-1],next=function(){var fn=fns[curr++];fn===last?fn():fn(next)};next()}}(chains)}))}}}},0:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{l:()=>mediaRender});var _util_function__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(933),mediaRender=function(element){element&&element.querySelectorAll("a").forEach((function(aElement){var url=aElement.getAttribute("href");url&&(url.match(/^.+.(mp4|m4v|ogg|ogv|webm)$/)?function(element,url){element.insertAdjacentHTML("afterend",'<video controls="controls" src="'.concat(url,'"></video>')),element.remove()}(aElement,url):url.match(/^.+.(mp3|wav|flac)$/)?function(element,url){element.insertAdjacentHTML("afterend",'<audio controls="controls" src="'.concat(url,'"></audio>')),element.remove()}(aElement,url):function(element,url){var youtubeMatch=url.match(/\/\/(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([\w|-]{11})(?:(?:[\?&]t=)(\S+))?/),youkuMatch=url.match(/\/\/v\.youku\.com\/v_show\/id_(\w+)=*\.html/),qqMatch=url.match(/\/\/v\.qq\.com\/x\/cover\/.*\/([^\/]+)\.html\??.*/),coubMatch=url.match(/(?:www\.|\/\/)coub\.com\/view\/(\w+)/),facebookMatch=url.match(/(?:www\.|\/\/)facebook\.com\/([^\/]+)\/videos\/([0-9]+)/),dailymotionMatch=url.match(/.+dailymotion.com\/(video|hub)\/(\w+)\?/),bilibiliMatch=url.match(/(?:www\.|\/\/)bilibili\.com\/video\/(\w+)/),tedMatch=url.match(/(?:www\.|\/\/)ted\.com\/talks\/(\w+)/);if(youtubeMatch&&11===youtubeMatch[1].length)element.insertAdjacentHTML("afterend",'<iframe class="iframe__video" src="//www.youtube.com/embed/'.concat(youtubeMatch[1]+(youtubeMatch[2]?"?start="+youtubeMatch[2]:""),'"></iframe>')),element.remove();else if(youkuMatch&&youkuMatch[1])element.insertAdjacentHTML("afterend",'<iframe class="iframe__video" src="//player.youku.com/embed/'.concat(youkuMatch[1],'"></iframe>')),element.remove();else if(qqMatch&&qqMatch[1])element.insertAdjacentHTML("afterend",'<iframe class="iframe__video" src="https://v.qq.com/txp/iframe/player.html?vid='.concat(qqMatch[1],'"></iframe>')),element.remove();else if(coubMatch&&coubMatch[1])element.insertAdjacentHTML("afterend",'<iframe class="iframe__video"\n src="//coub.com/embed/'.concat(coubMatch[1],'?muted=false&autostart=false&originalSize=true&startWithHD=true"></iframe>')),element.remove();else if(facebookMatch&&facebookMatch[0])element.insertAdjacentHTML("afterend",'<iframe class="iframe__video"\n src="https://www.facebook.com/plugins/video.php?href='.concat(encodeURIComponent(facebookMatch[0]),'"></iframe>')),element.remove();else if(dailymotionMatch&&dailymotionMatch[2])element.insertAdjacentHTML("afterend",'<iframe class="iframe__video"\n src="https://www.dailymotion.com/embed/video/'.concat(dailymotionMatch[2],'"></iframe>')),element.remove();else if(url.indexOf("bilibili.com")>-1&&(url.indexOf("bvid=")>-1||bilibiliMatch&&bilibiliMatch[1])){var params_1={bvid:(0,_util_function__WEBPACK_IMPORTED_MODULE_0__.TK)("bvid",url)||bilibiliMatch&&bilibiliMatch[1],page:"1",high_quality:"1",as_wide:"1",allowfullscreen:"true",autoplay:"0"};new URL(url.startsWith("http")?url:"https:"+url).search.split("&").forEach((function(item,index){if(item){0===index&&(item=item.substr(1));var keyValue=item.split("=");params_1[keyValue[0]]=keyValue[1]}}));var src_1="https://player.bilibili.com/player.html?",keys_1=Object.keys(params_1);keys_1.forEach((function(key,index){src_1+="".concat(key,"=").concat(params_1[key]),index<keys_1.length-1&&(src_1+="&")})),element.insertAdjacentHTML("afterend",'<iframe class="iframe__video" src="'.concat(src_1,'"></iframe>')),element.remove()}else tedMatch&&tedMatch[1]&&(element.insertAdjacentHTML("afterend",'<iframe class="iframe__video" src="//embed.ted.com/talks/'.concat(tedMatch[1],'"></iframe>')),element.remove())}(aElement,url))}))}},975:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{e:()=>mermaidRender});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(913),_util_addScript__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__2(161),_adapterRender__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(59),_util_function__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__2(933),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P((function(resolve){resolve(value)}))).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;g&&(g=0,op[0]&&(_=0)),_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!((t=(t=_.trys).length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},mermaidRender=function(element,cdn,theme){void 0===element&&(element=document),void 0===cdn&&(cdn=_constants__WEBPACK_IMPORTED_MODULE_0__.Y.CDN);var mermaidElements=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.mermaidRenderAdapter.getElements(element);0!==mermaidElements.length&&(0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__.Z)("".concat(cdn,"/dist/js/mermaid/mermaid.min.js"),"vditorMermaidScript").then((function(){var config={securityLevel:"loose",altFontFamily:"sans-serif",fontFamily:"sans-serif",startOnLoad:!1,flowchart:{htmlLabels:!0,useMaxWidth:!0},sequence:{useMaxWidth:!0,diagramMarginX:8,diagramMarginY:8,boxMargin:8,showSequenceNumbers:!0},gantt:{leftPadding:75,rightPadding:20}};"dark"===theme&&(config.theme="dark"),mermaid.initialize(config),mermaidElements.forEach((function(item){return __awaiter(void 0,void 0,void 0,(function(){var code,id,mermaidData,e_1,errorElement;return __generator(this,(function(_a){switch(_a.label){case 0:if(code=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.mermaidRenderAdapter.getCode(item),"true"===item.getAttribute("data-processed")||""===code.trim())return[2];id="mermaid"+(0,_util_function__WEBPACK_IMPORTED_MODULE_3__.Ee)(),_a.label=1;case 1:return _a.trys.push([1,3,,4]),[4,mermaid.render(id,item.textContent)];case 2:return mermaidData=_a.sent(),item.innerHTML=mermaidData.svg,[3,4];case 3:return e_1=_a.sent(),errorElement=document.querySelector("#"+id),item.innerHTML="".concat(errorElement.outerHTML,'<br>\n<div style="text-align: left"><small>').concat(e_1.message.replace(/\n/,"<br>"),"</small></div>"),errorElement.parentElement.remove(),[3,4];case 4:return item.setAttribute("data-processed","true"),[2]}}))}))}))}))}},162:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{l:()=>mindmapRender});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(913),_util_addScript__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__2(161),_adapterRender__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(59),mindmapRender=function(element,cdn,theme){void 0===element&&(element=document),void 0===cdn&&(cdn=_constants__WEBPACK_IMPORTED_MODULE_0__.Y.CDN);var mindmapElements=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.mindmapRenderAdapter.getElements(element);mindmapElements.length>0&&(0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__.Z)("".concat(cdn,"/dist/js/echarts/echarts.min.js?v=5.5.1"),"vditorEchartsScript").then((function(){mindmapElements.forEach((function(e){if(!e.parentElement.classList.contains("vditor-wysiwyg__pre")&&!e.parentElement.classList.contains("vditor-ir__marker--pre")){var text=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.mindmapRenderAdapter.getCode(e);if(text)try{if("true"===e.getAttribute("data-processed"))return;echarts.init(e,"dark"===theme?"dark":void 0).setOption({series:[{data:[JSON.parse(decodeURIComponent(text))],initialTreeDepth:-1,itemStyle:{borderWidth:0,color:"#4285f4"},label:{backgroundColor:"#f6f8fa",borderColor:"#d1d5da",borderRadius:5,borderWidth:.5,color:"#586069",lineHeight:20,offset:[-5,0],padding:[0,5],position:"insideRight"},lineStyle:{color:"#d1d5da",width:1},roam:!0,symbol:function(value,params){var _a;return(null===(_a=null==params?void 0:params.data)||void 0===_a?void 0:_a.children)?"circle":"path://"},type:"tree"}],tooltip:{trigger:"item",triggerOn:"mousemove"}}),e.setAttribute("data-processed","true")}catch(error){e.className="vditor-reset--error",e.innerHTML="mindmap render error: <br>".concat(error)}}}))}))}},70:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{N:()=>outlineRender});var _util_hasClosestByHeadings__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(164),_mathRender__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(960),outlineRender=function(contentElement,targetElement,vditor){var tocHTML="",ids=[];if(Array.from(contentElement.children).forEach((function(item,index){if((0,_util_hasClosestByHeadings__WEBPACK_IMPORTED_MODULE_1__.c)(item)){if(vditor){var lastIndex=item.id.lastIndexOf("_");item.id=item.id.substring(0,-1===lastIndex?void 0:lastIndex)+"_"+index}ids.push(item.id),tocHTML+=item.outerHTML.replace("<wbr>","")}})),""===tocHTML)return targetElement.innerHTML="","";var tempElement=document.createElement("div");if(vditor)vditor.lute.SetToC(!0),"wysiwyg"!==vditor.currentMode||vditor.preview.element.contains(contentElement)?"ir"!==vditor.currentMode||vditor.preview.element.contains(contentElement)?tempElement.innerHTML=vditor.lute.HTML2VditorDOM("<p>[ToC]</p>"+tocHTML):tempElement.innerHTML=vditor.lute.SpinVditorIRDOM("<p>[ToC]</p>"+tocHTML):tempElement.innerHTML=vditor.lute.SpinVditorDOM("<p>[ToC]</p>"+tocHTML),vditor.lute.SetToC(vditor.options.preview.markdown.toc);else{targetElement.classList.add("vditor-outline");var lute=Lute.New();lute.SetToC(!0),tempElement.innerHTML=lute.HTML2VditorDOM("<p>[ToC]</p>"+tocHTML)}var headingsElement=tempElement.firstElementChild.querySelectorAll("li > span[data-target-id]");return headingsElement.forEach((function(item,index){if(item.nextElementSibling&&"UL"===item.nextElementSibling.tagName){var iconHTML="<svg class='vditor-outline__action'><use xlink:href='#vditor-icon-down'></use></svg>";document.getElementById("vditorIconScript")||(iconHTML='<svg class="vditor-outline__action" viewBox="0 0 32 32"><path d="M3.76 6.12l12.24 12.213 12.24-12.213 3.76 3.76-16 16-16-16 3.76-3.76z"></path></svg>'),item.innerHTML="".concat(iconHTML,"<span>").concat(item.innerHTML,"</span>")}else item.innerHTML="<svg></svg><span>".concat(item.innerHTML,"</span>");item.setAttribute("data-target-id",ids[index])})),tocHTML=tempElement.firstElementChild.innerHTML,0===headingsElement.length?(targetElement.innerHTML="",tocHTML):(targetElement.innerHTML=tocHTML,vditor&&(0,_mathRender__WEBPACK_IMPORTED_MODULE_0__.T)(targetElement,{cdn:vditor.options.cdn,math:vditor.options.preview.math}),targetElement.firstElementChild.addEventListener("click",(function(event){for(var target=event.target;target&&!target.isEqualNode(targetElement);){if(target.classList.contains("vditor-outline__action")){target.classList.contains("vditor-outline__action--close")?(target.classList.remove("vditor-outline__action--close"),target.parentElement.nextElementSibling.setAttribute("style","display:block")):(target.classList.add("vditor-outline__action--close"),target.parentElement.nextElementSibling.setAttribute("style","display:none")),event.preventDefault(),event.stopPropagation();break}if(target.getAttribute("data-target-id")){event.preventDefault(),event.stopPropagation();var idElement=document.getElementById(target.getAttribute("data-target-id"));if(!idElement)return;if(vditor)if("auto"===vditor.options.height){var windowScrollY=idElement.offsetTop+vditor.element.offsetTop;vditor.options.toolbarConfig.pin||(windowScrollY+=vditor.toolbar.element.offsetHeight),window.scrollTo(window.scrollX,windowScrollY)}else vditor.element.offsetTop<window.scrollY&&window.scrollTo(window.scrollX,vditor.element.offsetTop),vditor.preview.element.contains(contentElement)?contentElement.parentElement.scrollTop=idElement.offsetTop:contentElement.scrollTop=idElement.offsetTop;else window.scrollTo(window.scrollX,idElement.offsetTop);break}target=target.parentElement}})),tocHTML)}},591:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{M:()=>plantumlRender});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(913),_util_addScript__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__2(161),_adapterRender__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(59),plantumlRender=function(element,cdn){void 0===element&&(element=document),void 0===cdn&&(cdn=_constants__WEBPACK_IMPORTED_MODULE_0__.Y.CDN);var plantumlElements=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.plantumlRenderAdapter.getElements(element);0!==plantumlElements.length&&(0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__.Z)("".concat(cdn,"/dist/js/plantuml/plantuml-encoder.min.js"),"vditorPlantumlScript").then((function(){plantumlElements.forEach((function(e){if(!e.parentElement.classList.contains("vditor-wysiwyg__pre")&&!e.parentElement.classList.contains("vditor-ir__marker--pre")){var text=_adapterRender__WEBPACK_IMPORTED_MODULE_1__.plantumlRenderAdapter.getCode(e).trim();if(text)try{e.innerHTML='<object type="image/svg+xml" data="https://www.plantuml.com/plantuml/svg/~1'.concat(plantumlEncoder.encode(text),'"/>')}catch(error){e.className="vditor-reset--error",e.innerHTML="plantuml render error: <br>".concat(error)}}}))}))}},796:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{X:()=>setLute});var setLute=function(options){var lute=Lute.New();return lute.PutEmojis(options.emojis),lute.SetEmojiSite(options.emojiSite),lute.SetHeadingAnchor(options.headingAnchor),lute.SetInlineMathAllowDigitAfterOpenMarker(options.inlineMathDigit),lute.SetAutoSpace(options.autoSpace),lute.SetToC(options.toc),lute.SetFootnotes(options.footnotes),lute.SetFixTermTypo(options.fixTermTypo),lute.SetVditorCodeBlockPreview(options.codeBlockPreview),lute.SetVditorMathBlockPreview(options.mathBlockPreview),lute.SetSanitize(options.sanitize),lute.SetChineseParagraphBeginningSpace(options.paragraphBeginningSpace),lute.SetRenderListStyle(options.listStyle),lute.SetLinkBase(options.linkBase),lute.SetLinkPrefix(options.linkPrefix),lute.SetMark(options.mark),lute.SetGFMAutoLink(options.gfmAutoLink),options.lazyLoadImage&&lute.SetImageLazyLoading(options.lazyLoadImage),lute}},726:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{o:()=>previewImage});var previewImage=function(oldImgElement,lang,theme){void 0===theme&&(theme="classic");var oldImgRect=oldImgElement.getBoundingClientRect();document.body.insertAdjacentHTML("beforeend",'<div class="vditor vditor-img'.concat("dark"===theme?" vditor--dark":"",'">\n    <div class="vditor-img__bar">\n      <span class="vditor-img__btn" data-deg="0">\n        <svg><use xlink:href="#vditor-icon-redo"></use></svg>\n        ').concat(window.VditorI18n.spin,"\n      </span>\n      <span class=\"vditor-img__btn\"  onclick=\"this.parentElement.parentElement.outerHTML = '';document.body.style.overflow = ''\">\n        X &nbsp;").concat(window.VditorI18n.close,'\n      </span>\n    </div>\n    <div class="vditor-img__img" onclick="this.parentElement.outerHTML = \'\';document.body.style.overflow = \'\'">\n      <img style="width: ').concat(oldImgElement.width,"px;height:").concat(oldImgElement.height,"px;transform: translate3d(").concat(oldImgRect.left,"px, ").concat(oldImgRect.top-36,'px, 0)" src="').concat(oldImgElement.getAttribute("src"),'">\n    </div>\n</div>')),document.body.style.overflow="hidden";var imgElement=document.querySelector(".vditor-img img"),translate3d="translate3d(".concat(Math.max(0,window.innerWidth-oldImgElement.naturalWidth)/2,"px, ").concat(Math.max(0,window.innerHeight-36-oldImgElement.naturalHeight)/2,"px, 0)");setTimeout((function(){imgElement.setAttribute("style","transition: transform .3s ease-in-out;transform: ".concat(translate3d)),setTimeout((function(){imgElement.parentElement.scrollTo((imgElement.parentElement.scrollWidth-imgElement.parentElement.clientWidth)/2,(imgElement.parentElement.scrollHeight-imgElement.parentElement.clientHeight)/2)}),400)}));var btnElement=document.querySelector(".vditor-img__btn");btnElement.addEventListener("click",(function(){var deg=parseInt(btnElement.getAttribute("data-deg"),10)+90;deg/90%2==1&&oldImgElement.naturalWidth>imgElement.parentElement.clientHeight?imgElement.style.transform="translate3d(".concat(Math.max(0,window.innerWidth-oldImgElement.naturalWidth)/2,"px, ").concat(oldImgElement.naturalWidth/2-oldImgElement.naturalHeight/2,"px, 0) rotateZ(").concat(deg,"deg)"):imgElement.style.transform="".concat(translate3d," rotateZ(").concat(deg,"deg)"),btnElement.setAttribute("data-deg",deg.toString()),setTimeout((function(){imgElement.parentElement.scrollTo((imgElement.parentElement.scrollWidth-imgElement.parentElement.clientWidth)/2,(imgElement.parentElement.scrollHeight-imgElement.parentElement.clientHeight)/2)}),400)}))}},13:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{h:()=>setCodeTheme});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(913),_util_addStyle__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(505),setCodeTheme=function(codeTheme,cdn){void 0===cdn&&(cdn=_constants__WEBPACK_IMPORTED_MODULE_0__.Y.CDN),_constants__WEBPACK_IMPORTED_MODULE_0__.Y.CODE_THEME.includes(codeTheme)||(codeTheme="github");var vditorHljsStyle=document.getElementById("vditorHljsStyle"),href="".concat(cdn,"/dist/js/highlight.js/styles/").concat(codeTheme,".min.css");vditorHljsStyle?vditorHljsStyle.getAttribute("href")!==href&&(vditorHljsStyle.remove(),(0,_util_addStyle__WEBPACK_IMPORTED_MODULE_1__.T)(href,"vditorHljsStyle")):(0,_util_addStyle__WEBPACK_IMPORTED_MODULE_1__.T)(href,"vditorHljsStyle")}},873:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{H:()=>setContentTheme});var _util_addStyle__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(505),setContentTheme=function(contentTheme,path){if(contentTheme&&path){var vditorContentTheme=document.getElementById("vditorContentTheme"),cssPath="".concat(path,"/").concat(contentTheme,".css");vditorContentTheme?vditorContentTheme.getAttribute("href")!==cssPath&&(vditorContentTheme.remove(),(0,_util_addStyle__WEBPACK_IMPORTED_MODULE_0__.T)(cssPath,"vditorContentTheme")):(0,_util_addStyle__WEBPACK_IMPORTED_MODULE_0__.T)(cssPath,"vditorContentTheme")}}},161:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{U:()=>addScriptSync,Z:()=>addScript});var addScriptSync=function(path,id){if(document.getElementById(id))return!1;var xhrObj=new XMLHttpRequest;xhrObj.open("GET",path,!1),xhrObj.setRequestHeader("Accept","text/javascript, application/javascript, application/ecmascript, application/x-ecmascript, */*; q=0.01"),xhrObj.send("");var scriptElement=document.createElement("script");scriptElement.type="text/javascript",scriptElement.text=xhrObj.responseText,scriptElement.id=id,document.head.appendChild(scriptElement)},addScript=function(path,id){return new Promise((function(resolve,reject){if(document.getElementById(id))return resolve(!0),!1;var scriptElement=document.createElement("script");scriptElement.src=path,scriptElement.async=!0,document.head.appendChild(scriptElement),scriptElement.onerror=function(event){reject(event)},scriptElement.onload=function(){if(document.getElementById(id))return scriptElement.remove(),resolve(!0),!1;scriptElement.id=id,resolve(!0)}}))}},505:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{T:()=>addStyle});var addStyle=function(url,id){if(!document.getElementById(id)){var styleElement=document.createElement("link");styleElement.id=id,styleElement.rel="stylesheet",styleElement.type="text/css",styleElement.href=url,document.getElementsByTagName("head")[0].appendChild(styleElement)}}},695:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{p:()=>code160to32});var code160to32=function(text){return text.replace(/\u00a0/g," ")}},629:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{D:()=>accessLocalStorage,H8:()=>isChrome,_0:()=>isCtrl,fG:()=>updateHotkeyTip,gm:()=>isFirefox,nr:()=>isSafari,y3:()=>getEventName});var isSafari=function(){return navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome")},isFirefox=function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},accessLocalStorage=function(){try{return"undefined"!=typeof localStorage}catch(e){return!1}},getEventName=function(){return navigator.userAgent.indexOf("iPhone")>-1?"touchstart":"click"},isCtrl=function(event){return navigator.platform.toUpperCase().indexOf("MAC")>=0?!(!event.metaKey||event.ctrlKey):!(event.metaKey||!event.ctrlKey)},updateHotkeyTip=function(hotkey){return/Mac/.test(navigator.platform)||"iPhone"===navigator.platform?hotkey.indexOf("⇧")>-1&&isFirefox()&&(hotkey=hotkey.replace(";",":").replace("=","+").replace("-","_")):(hotkey=(hotkey=hotkey.startsWith("⌘")?hotkey.replace("⌘","⌘+"):hotkey.startsWith("⌥")&&"⌘"!==hotkey.substr(1,1)?hotkey.replace("⌥","⌥+"):hotkey.replace("⇧⌘","⌘+⇧+").replace("⌥⌘","⌥+⌘+")).replace("⌘","Ctrl").replace("⇧","Shift").replace("⌥","Alt")).indexOf("Shift")>-1&&(hotkey=hotkey.replace(";",":").replace("=","+").replace("-","_")),hotkey},isChrome=function(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}},933:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{Ee:()=>genUUID,TK:()=>getSearch,kY:()=>looseJsonParse});var genUUID=function(){return([1e7].toString()+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(c){return(parseInt(c,10)^window.crypto.getRandomValues(new Uint32Array(1))[0]&15>>parseInt(c,10)/4).toString(16)}))},getSearch=function(key,link){void 0===link&&(link=window.location.search);var params=link.substring(link.indexOf("?")),hashIndex=params.indexOf("#");return new URLSearchParams(params.substring(0,hashIndex>=0?hashIndex:void 0)).get(key)},looseJsonParse=function(text){return Function('"use strict";return ('.concat(text,")"))()}},598:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{Ab:()=>hasTopClosestByTag,KJ:()=>hasClosestByClassName,KR:()=>getTopList,Rp:()=>getLastNode,Th:()=>hasClosestByAttribute,XW:()=>hasTopClosestByClassName,_Y:()=>hasClosestByMatchTag,pt:()=>hasClosestBlock});var _hasClosestByHeadings__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(164),hasTopClosestByClassName=function(element,className){for(var closest=hasClosestByClassName(element,className),parentClosest=!1,findTop=!1;closest&&!closest.classList.contains("vditor-reset")&&!findTop;)(parentClosest=hasClosestByClassName(closest.parentElement,className))?closest=parentClosest:findTop=!0;return closest||!1},hasTopClosestByTag=function(element,nodeName){for(var closest=(0,_hasClosestByHeadings__WEBPACK_IMPORTED_MODULE_0__.f)(element,nodeName),parentClosest=!1,findTop=!1;closest&&!closest.classList.contains("vditor-reset")&&!findTop;)(parentClosest=(0,_hasClosestByHeadings__WEBPACK_IMPORTED_MODULE_0__.f)(closest.parentElement,nodeName))?closest=parentClosest:findTop=!0;return closest||!1},getTopList=function(element){var topUlElement=hasTopClosestByTag(element,"UL"),topOlElement=hasTopClosestByTag(element,"OL"),topListElement=topUlElement;return topOlElement&&(!topUlElement||topUlElement&&topOlElement.contains(topUlElement))&&(topListElement=topOlElement),topListElement},hasClosestByAttribute=function(element,attr,value){if(!element)return!1;3===element.nodeType&&(element=element.parentElement);for(var e=element,isClosest=!1;e&&!isClosest&&!e.classList.contains("vditor-reset");)e.getAttribute(attr)===value?isClosest=!0:e=e.parentElement;return isClosest&&e},hasClosestBlock=function(element){if(!element)return!1;3===element.nodeType&&(element=element.parentElement);var e=element,isClosest=!1,blockElement=hasClosestByAttribute(element,"data-block","0");if(blockElement)return blockElement;for(;e&&!isClosest&&!e.classList.contains("vditor-reset");)"H1"===e.tagName||"H2"===e.tagName||"H3"===e.tagName||"H4"===e.tagName||"H5"===e.tagName||"H6"===e.tagName||"P"===e.tagName||"BLOCKQUOTE"===e.tagName||"OL"===e.tagName||"UL"===e.tagName?isClosest=!0:e=e.parentElement;return isClosest&&e},hasClosestByMatchTag=function(element,nodeName){if(!element)return!1;3===element.nodeType&&(element=element.parentElement);for(var e=element,isClosest=!1;e&&!isClosest&&!e.classList.contains("vditor-reset");)e.nodeName===nodeName?isClosest=!0:e=e.parentElement;return isClosest&&e},hasClosestByClassName=function(element,className){if(!element)return!1;3===element.nodeType&&(element=element.parentElement);for(var e=element,isClosest=!1;e&&!isClosest&&!e.classList.contains("vditor-reset");)e.classList.contains(className)?isClosest=!0:e=e.parentElement;return isClosest&&e},getLastNode=function(node){for(;node&&node.lastChild;)node=node.lastChild;return node}},164:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{c:()=>hasClosestByHeadings,f:()=>hasClosestByTag});var hasClosestByTag=function(element,nodeName){if(!element)return!1;3===element.nodeType&&(element=element.parentElement);for(var e=element,isClosest=!1;e&&!isClosest&&!e.classList.contains("vditor-reset");)0===e.nodeName.indexOf(nodeName)?isClosest=!0:e=e.parentElement;return isClosest&&e},hasClosestByHeadings=function(element){var headingElement=hasClosestByTag(element,"H");return!(!headingElement||2!==headingElement.tagName.length||"HR"===headingElement.tagName)&&headingElement}},905:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{h:()=>merge});var merge=function(){for(var options=[],_i=0;_i<arguments.length;_i++)options[_i]=arguments[_i];for(var target={},merger=function(obj){for(var prop in obj)obj.hasOwnProperty(prop)&&("[object Object]"===Object.prototype.toString.call(obj[prop])?target[prop]=merge(target[prop],obj[prop]):target[prop]=obj[prop])},i=0;i<options.length;i++)merger(options[i]);return target}},827:(__unused_webpack_module,__webpack_exports__2,__webpack_require__2)=>{__webpack_require__2.d(__webpack_exports__2,{Co:()=>selectIsEditor,ED:()=>getSelectPosition,Ey:()=>getCursorPosition,Fm:()=>setSelectionByPosition,RN:()=>getEditorRange,Z2:()=>insertHTML,ir:()=>setRangeByWbr,jl:()=>setSelectionFocus});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__2(913),_compatibility__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__2(629),_hasClosest__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__2(598),getEditorRange=function(vditor){var range,element=vditor[vditor.currentMode].element;return getSelection().rangeCount>0&&(range=getSelection().getRangeAt(0),element.isEqualNode(range.startContainer)||element.contains(range.startContainer))?range:vditor[vditor.currentMode].range?vditor[vditor.currentMode].range:(element.focus(),(range=element.ownerDocument.createRange()).setStart(element,0),range.collapse(!0),range)},getCursorPosition=function(editor){var range=window.getSelection().getRangeAt(0);if(!editor.contains(range.startContainer)&&!(0,_hasClosest__WEBPACK_IMPORTED_MODULE_1__.KJ)(range.startContainer,"vditor-panel--none"))return{left:0,top:0};var cursorRect,parentRect=editor.parentElement.getBoundingClientRect();if(0===range.getClientRects().length)if(3===range.startContainer.nodeType){var parent_1=range.startContainer.parentElement;if(!(parent_1&&parent_1.getClientRects().length>0))return{left:0,top:0};cursorRect=parent_1.getClientRects()[0]}else{var children=range.startContainer.children;if(children[range.startOffset]&&children[range.startOffset].getClientRects().length>0)cursorRect=children[range.startOffset].getClientRects()[0];else if(range.startContainer.childNodes.length>0){var cloneRange=range.cloneRange();range.selectNode(range.startContainer.childNodes[Math.max(0,range.startOffset-1)]),cursorRect=range.getClientRects()[0],range.setEnd(cloneRange.endContainer,cloneRange.endOffset),range.setStart(cloneRange.startContainer,cloneRange.startOffset)}else cursorRect=range.startContainer.getClientRects()[0];if(!cursorRect){for(var parentElement=range.startContainer.childNodes[range.startOffset];!parentElement.getClientRects||parentElement.getClientRects&&0===parentElement.getClientRects().length;)parentElement=parentElement.parentElement;cursorRect=parentElement.getClientRects()[0]}}else cursorRect=range.getClientRects()[0];return{left:cursorRect.left-parentRect.left,top:cursorRect.top-parentRect.top}},selectIsEditor=function(editor,range){if(!range){if(0===getSelection().rangeCount)return!1;range=getSelection().getRangeAt(0)}var container=range.commonAncestorContainer;return editor.isEqualNode(container)||editor.contains(container)},setSelectionFocus=function(range){var selection=window.getSelection();selection.removeAllRanges(),selection.addRange(range)},getSelectPosition=function(selectElement,editorElement,range){var position={end:0,start:0};if(!range){if(0===getSelection().rangeCount)return position;range=window.getSelection().getRangeAt(0)}if(selectIsEditor(editorElement,range)){var preSelectionRange=range.cloneRange();selectElement.childNodes[0]&&selectElement.childNodes[0].childNodes[0]?preSelectionRange.setStart(selectElement.childNodes[0].childNodes[0],0):preSelectionRange.selectNodeContents(selectElement),preSelectionRange.setEnd(range.startContainer,range.startOffset),position.start=preSelectionRange.toString().length,position.end=position.start+range.toString().length}return position},setSelectionByPosition=function(start,end,editor){var charIndex=0,line=0,pNode=editor.childNodes[line],foundStart=!1,stop=!1;start=Math.max(0,start),end=Math.max(0,end);var range=editor.ownerDocument.createRange();for(range.setStart(pNode||editor,0),range.collapse(!0);!stop&&pNode;){var nextCharIndex=charIndex+pNode.textContent.length;if(!foundStart&&start>=charIndex&&start<=nextCharIndex&&(0===start?range.setStart(pNode,0):3===pNode.childNodes[0].nodeType?range.setStart(pNode.childNodes[0],start-charIndex):pNode.nextSibling?range.setStartBefore(pNode.nextSibling):range.setStartAfter(pNode),foundStart=!0,start===end)){stop=!0;break}foundStart&&end>=charIndex&&end<=nextCharIndex&&(0===end?range.setEnd(pNode,0):3===pNode.childNodes[0].nodeType?range.setEnd(pNode.childNodes[0],end-charIndex):pNode.nextSibling?range.setEndBefore(pNode.nextSibling):range.setEndAfter(pNode),stop=!0),charIndex=nextCharIndex,pNode=editor.childNodes[++line]}return!stop&&editor.childNodes[line-1]&&range.setStartBefore(editor.childNodes[line-1]),setSelectionFocus(range),range},setRangeByWbr=function(element,range){var wbrElement=element.querySelector("wbr");if(wbrElement){if(wbrElement.previousElementSibling)if(wbrElement.previousElementSibling.isSameNode(wbrElement.previousSibling)){if(wbrElement.previousElementSibling.lastChild)return range.setStartBefore(wbrElement),range.collapse(!0),setSelectionFocus(range),!(0,_compatibility__WEBPACK_IMPORTED_MODULE_2__.H8)()||"EM"!==wbrElement.previousElementSibling.tagName&&"STRONG"!==wbrElement.previousElementSibling.tagName&&"S"!==wbrElement.previousElementSibling.tagName||(range.insertNode(document.createTextNode(_constants__WEBPACK_IMPORTED_MODULE_0__.Y.ZWSP)),range.collapse(!1)),void wbrElement.remove();range.setStartAfter(wbrElement.previousElementSibling)}else range.setStart(wbrElement.previousSibling,wbrElement.previousSibling.textContent.length);else wbrElement.previousSibling?range.setStart(wbrElement.previousSibling,wbrElement.previousSibling.textContent.length):wbrElement.nextSibling?3===wbrElement.nextSibling.nodeType?range.setStart(wbrElement.nextSibling,0):range.setStartBefore(wbrElement.nextSibling):range.setStart(wbrElement.parentElement,0);range.collapse(!0),wbrElement.remove(),setSelectionFocus(range)}},insertHTML=function(html,vditor){var tempElement=document.createElement("div");tempElement.innerHTML=html;var tempBlockElement=tempElement.querySelectorAll("p");1===tempBlockElement.length&&!tempBlockElement[0].previousSibling&&!tempBlockElement[0].nextSibling&&vditor[vditor.currentMode].element.children.length>0&&"P"===tempElement.firstElementChild.tagName&&(html=tempBlockElement[0].innerHTML.trim());var pasteElement=document.createElement("div");pasteElement.innerHTML=html;var range=getEditorRange(vditor);if(""!==range.toString()&&(vditor[vditor.currentMode].preventInput=!0,document.execCommand("delete",!1,"")),pasteElement.firstElementChild&&"0"===pasteElement.firstElementChild.getAttribute("data-block")){pasteElement.lastElementChild.insertAdjacentHTML("beforeend","<wbr>");var blockElement=(0,_hasClosest__WEBPACK_IMPORTED_MODULE_1__.pt)(range.startContainer);blockElement?blockElement.insertAdjacentHTML("afterend",pasteElement.innerHTML):vditor[vditor.currentMode].element.insertAdjacentHTML("beforeend",pasteElement.innerHTML),setRangeByWbr(vditor[vditor.currentMode].element,range)}else{var pasteTemplate=document.createElement("template");pasteTemplate.innerHTML=html,range.insertNode(pasteTemplate.content.cloneNode(!0)),range.collapse(!1),setSelectionFocus(range)}}}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module2=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module2,module2.exports,__webpack_require__),module2.exports}__webpack_require__.d=(exports2,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports2,key)&&Object.defineProperty(exports2,key,{enumerable:!0,get:definition[key]})},__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop),__webpack_require__.r=exports2=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports2,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports2,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.d(__webpack_exports__,{default:()=>src});var resizeCb,method=__webpack_require__(923),constants=__webpack_require__(913),code160to32=__webpack_require__(695),getMarkdown=function(vditor){return"sv"===vditor.currentMode?(0,code160to32.p)("".concat(vditor.sv.element.textContent,"\n").replace(/\n\n$/,"\n")):"wysiwyg"===vditor.currentMode?vditor.lute.VditorDOM2Md(vditor.wysiwyg.element.innerHTML):"ir"===vditor.currentMode?vditor.lute.VditorIRDOM2Md(vditor.ir.element.innerHTML):""},addScript=__webpack_require__(161),DevTools=function(){function DevTools2(){this.element=document.createElement("div"),this.element.className="vditor-devtools",this.element.innerHTML='<div class="vditor-reset--error"></div><div style="height: 100%;"></div>'}return DevTools2.prototype.renderEchart=function(vditor){var _this=this;"block"===vditor.devtools.element.style.display&&(0,addScript.Z)("".concat(vditor.options.cdn,"/dist/js/echarts/echarts.min.js?v=5.5.1"),"vditorEchartsScript").then((function(){_this.ASTChart||(_this.ASTChart=echarts.init(vditor.devtools.element.lastElementChild));try{_this.element.lastElementChild.style.display="block",_this.element.firstElementChild.innerHTML="",_this.ASTChart.setOption({series:[{data:JSON.parse(vditor.lute.RenderEChartsJSON(getMarkdown(vditor))),initialTreeDepth:-1,label:{align:"left",backgroundColor:"rgba(68, 77, 86, .68)",borderRadius:3,color:"#d1d5da",fontSize:12,lineHeight:12,offset:[9,12],padding:[2,4,2,4],position:"top",verticalAlign:"middle"},lineStyle:{color:"#4285f4",type:"curve",width:1},orient:"vertical",roam:!0,type:"tree"}],toolbox:{bottom:25,emphasis:{iconStyle:{color:"#4285f4"}},feature:{restore:{show:!0},saveAsImage:{show:!0}},right:15,show:!0}}),_this.ASTChart.resize()}catch(e){_this.element.lastElementChild.style.display="none",_this.element.firstElementChild.innerHTML=e}}))},DevTools2}(),compatibility=__webpack_require__(629),removeCurrentToolbar=function(toolbar,names){names.forEach((function(name){if(toolbar[name]){var itemElement=toolbar[name].children[0];itemElement&&itemElement.classList.contains("vditor-menu--current")&&itemElement.classList.remove("vditor-menu--current")}}))},setCurrentToolbar=function(toolbar,names){names.forEach((function(name){if(toolbar[name]){var itemElement=toolbar[name].children[0];itemElement&&!itemElement.classList.contains("vditor-menu--current")&&itemElement.classList.add("vditor-menu--current")}}))},enableToolbar=function(toolbar,names){names.forEach((function(name){if(toolbar[name]){var itemElement=toolbar[name].children[0];itemElement&&itemElement.classList.contains(constants.Y.CLASS_MENU_DISABLED)&&itemElement.classList.remove(constants.Y.CLASS_MENU_DISABLED)}}))},disableToolbar=function(toolbar,names){names.forEach((function(name){if(toolbar[name]){var itemElement=toolbar[name].children[0];itemElement&&!itemElement.classList.contains(constants.Y.CLASS_MENU_DISABLED)&&itemElement.classList.add(constants.Y.CLASS_MENU_DISABLED)}}))},hideToolbar=function(toolbar,names){names.forEach((function(name){toolbar[name]&&toolbar[name]&&(toolbar[name].style.display="none")}))},showToolbar=function(toolbar,names){names.forEach((function(name){toolbar[name]&&toolbar[name]&&(toolbar[name].style.display="block")}))},hidePanel=function(vditor,panels,exceptElement){panels.includes("subToolbar")&&(vditor.toolbar.element.querySelectorAll(".vditor-hint").forEach((function(item){exceptElement&&item.isEqualNode(exceptElement)||(item.style.display="none")})),vditor.toolbar.elements.emoji&&(vditor.toolbar.elements.emoji.lastElementChild.style.display="none")),panels.includes("hint")&&(vditor.hint.element.style.display="none"),vditor.wysiwyg.popover&&panels.includes("popover")&&(vditor.wysiwyg.popover.style.display="none")},toggleSubMenu=function(vditor,panelElement,actionBtn,level){actionBtn.addEventListener((0,compatibility.y3)(),(function(event){event.preventDefault(),event.stopPropagation(),actionBtn.classList.contains(constants.Y.CLASS_MENU_DISABLED)||(vditor.toolbar.element.querySelectorAll(".vditor-hint--current").forEach((function(item){item.classList.remove("vditor-hint--current")})),"block"===panelElement.style.display?panelElement.style.display="none":(hidePanel(vditor,["subToolbar","hint","popover"],actionBtn.parentElement.parentElement),actionBtn.classList.contains("vditor-tooltipped")||actionBtn.classList.add("vditor-hint--current"),panelElement.style.display="block",vditor.toolbar.element.getBoundingClientRect().right-actionBtn.getBoundingClientRect().right<250?panelElement.classList.add("vditor-panel--left"):panelElement.classList.remove("vditor-panel--left")))}))},hasClosest=__webpack_require__(598),hasClosestByHeadings=__webpack_require__(164),log=function(method2,content,type,print){print&&console.log("".concat(method2," - ").concat(type,": ").concat(content))},abcRender=__webpack_require__(288),chartRender=__webpack_require__(784),codeRender=__webpack_require__(51),flowchartRender=__webpack_require__(500),graphvizRender=__webpack_require__(339),highlightRender=__webpack_require__(108),mathRender=__webpack_require__(960),mermaidRender=__webpack_require__(975),markmapRender=__webpack_require__(597),mindmapRender=__webpack_require__(162),plantumlRender=__webpack_require__(591),SMILESRender=__webpack_require__(931),processCodeRender=function(previewPanel,vditor){if(previewPanel)if("html-block"!==previewPanel.parentElement.getAttribute("data-type")){var language=previewPanel.firstElementChild.className.replace("language-","");"abc"===language?(0,abcRender.$)(previewPanel,vditor.options.cdn):"mermaid"===language?(0,mermaidRender.e)(previewPanel,vditor.options.cdn,vditor.options.theme):"smiles"===language?(0,SMILESRender.Y)(previewPanel,vditor.options.cdn,vditor.options.theme):"markmap"===language?(0,markmapRender.K)(previewPanel,vditor.options.cdn):"flowchart"===language?(0,flowchartRender.D)(previewPanel,vditor.options.cdn):"echarts"===language?(0,chartRender.v)(previewPanel,vditor.options.cdn,vditor.options.theme):"mindmap"===language?(0,mindmapRender.l)(previewPanel,vditor.options.cdn,vditor.options.theme):"plantuml"===language?(0,plantumlRender.M)(previewPanel,vditor.options.cdn):"graphviz"===language?(0,graphvizRender.m)(previewPanel,vditor.options.cdn):"math"===language?(0,mathRender.T)(previewPanel,{cdn:vditor.options.cdn,math:vditor.options.preview.math}):vditor.options.customRenders.find((function(item){if(item.language===language)return item.render(previewPanel,vditor),!0}))||((0,highlightRender.$)(Object.assign({},vditor.options.preview.hljs),previewPanel,vditor.options.cdn),(0,codeRender.o)(previewPanel,vditor.options.preview.hljs)),previewPanel.setAttribute("data-render","1")}else previewPanel.setAttribute("data-render","1")},selection=__webpack_require__(827),renderToc=function(vditor){if("sv"!==vditor.currentMode){var editorElement=vditor[vditor.currentMode].element,tocHTML=vditor.outline.render(vditor);""===tocHTML&&(tocHTML="[ToC]"),editorElement.querySelectorAll('[data-type="toc-block"]').forEach((function(item){item.innerHTML=tocHTML,(0,mathRender.T)(item,{cdn:vditor.options.cdn,math:vditor.options.preview.math})}))}},clickToc=function(event,vditor){var spanElement=(0,hasClosest._Y)(event.target,"SPAN");if(spanElement&&(0,hasClosest.KJ)(spanElement,"vditor-toc")){var headingElement=vditor[vditor.currentMode].element.querySelector("#"+spanElement.getAttribute("data-target-id"));if(headingElement)if("auto"===vditor.options.height){var windowScrollY=headingElement.offsetTop+vditor.element.offsetTop;vditor.options.toolbarConfig.pin||(windowScrollY+=vditor.toolbar.element.offsetHeight),window.scrollTo(window.scrollX,windowScrollY)}else vditor.element.offsetTop<window.scrollY&&window.scrollTo(window.scrollX,vditor.element.offsetTop),vditor[vditor.currentMode].element.scrollTop=headingElement.offsetTop}},keydownToc=function(blockElement,vditor,event,range){if(blockElement.previousElementSibling&&blockElement.previousElementSibling.classList.contains("vditor-toc")){if("Backspace"===event.key&&0===(0,selection.ED)(blockElement,vditor[vditor.currentMode].element,range).start)return blockElement.previousElementSibling.remove(),execAfterRender(vditor),!0;if(insertBeforeBlock(vditor,event,range,blockElement,blockElement.previousElementSibling))return!0}if(blockElement.nextElementSibling&&blockElement.nextElementSibling.classList.contains("vditor-toc")){if("Delete"===event.key&&(0,selection.ED)(blockElement,vditor[vditor.currentMode].element,range).start>=blockElement.textContent.trimRight().length)return blockElement.nextElementSibling.remove(),execAfterRender(vditor),!0;if(insertAfterBlock(vditor,event,range,blockElement,blockElement.nextElementSibling))return!0}if("Backspace"===event.key||"Delete"===event.key){var tocElement=(0,hasClosest.KJ)(range.startContainer,"vditor-toc");if(tocElement)return tocElement.remove(),execAfterRender(vditor),!0}},input=function(vditor,range,ignoreSpace,event){void 0===ignoreSpace&&(ignoreSpace=!1);var blockElement=(0,hasClosest.pt)(range.startContainer);if(blockElement&&!ignoreSpace&&"code-block"!==blockElement.getAttribute("data-type")){if(isHrMD(blockElement.innerHTML)&&blockElement.previousElementSibling||isHeadingMD(blockElement.innerHTML))return;for(var startOffset=(0,selection.ED)(blockElement,vditor.ir.element,range).start,startSpace=!0,i=startOffset-1;i>blockElement.textContent.substr(0,startOffset).lastIndexOf("\n");i--)if(" "!==blockElement.textContent.charAt(i)&&"\t"!==blockElement.textContent.charAt(i)){startSpace=!1;break}0===startOffset&&(startSpace=!1);var endSpace=!0;for(i=startOffset-1;i<blockElement.textContent.length;i++)if(" "!==blockElement.textContent.charAt(i)&&"\n"!==blockElement.textContent.charAt(i)){endSpace=!1;break}if(startSpace)return void("function"==typeof vditor.options.input&&vditor.options.input(getMarkdown(vditor)));if(endSpace&&/^#{1,6} $/.test(blockElement.textContent)&&(endSpace=!1),endSpace&&!(0,hasClosest.KJ)(range.startContainer,"vditor-ir__marker")){var previousNode=range.startContainer.previousSibling;return previousNode&&3!==previousNode.nodeType&&previousNode.classList.contains("vditor-ir__node--expand")&&previousNode.classList.remove("vditor-ir__node--expand"),void("function"==typeof vditor.options.input&&vditor.options.input(getMarkdown(vditor)))}}if(vditor.ir.element.querySelectorAll(".vditor-ir__node--expand").forEach((function(item){item.classList.remove("vditor-ir__node--expand")})),blockElement||(blockElement=vditor.ir.element),!blockElement.querySelector("wbr")){var previewRenderElement=(0,hasClosest.KJ)(range.startContainer,"vditor-ir__preview");previewRenderElement?previewRenderElement.previousElementSibling.insertAdjacentHTML("beforeend","<wbr>"):range.insertNode(document.createElement("wbr"))}blockElement.querySelectorAll("[style]").forEach((function(item){item.removeAttribute("style")})),"link-ref-defs-block"===blockElement.getAttribute("data-type")&&(blockElement=vditor.ir.element);var firstLinkRefDefElement,isIRElement=blockElement.isEqualNode(vditor.ir.element),footnoteElement=(0,hasClosest.Th)(blockElement,"data-type","footnotes-block"),html="";if(isIRElement)html=blockElement.innerHTML;else{var blockquoteElement=(0,hasClosestByHeadings.f)(range.startContainer,"BLOCKQUOTE"),topListElement=(0,hasClosest.KR)(range.startContainer);if(topListElement&&(blockElement=topListElement),blockquoteElement&&(!topListElement||topListElement&&!blockquoteElement.contains(topListElement))&&(blockElement=blockquoteElement),footnoteElement&&(blockElement=footnoteElement),html=blockElement.outerHTML,"UL"===blockElement.tagName||"OL"===blockElement.tagName){var listPrevElement=blockElement.previousElementSibling,listNextElement=blockElement.nextElementSibling;!listPrevElement||"UL"!==listPrevElement.tagName&&"OL"!==listPrevElement.tagName||(html=listPrevElement.outerHTML+html,listPrevElement.remove()),!listNextElement||"UL"!==listNextElement.tagName&&"OL"!==listNextElement.tagName||(html+=listNextElement.outerHTML,listNextElement.remove()),html=html.replace("<div><wbr><br></div>","<li><p><wbr><br></p></li>")}else blockElement.previousElementSibling&&""!==blockElement.previousElementSibling.textContent.replace(constants.Y.ZWSP,"")&&event&&"insertParagraph"===event.inputType&&(html=blockElement.previousElementSibling.outerHTML+html,blockElement.previousElementSibling.remove());blockElement.innerText.startsWith("```")||(vditor.ir.element.querySelectorAll("[data-type='link-ref-defs-block']").forEach((function(item){item&&!blockElement.isEqualNode(item)&&(html+=item.outerHTML,item.remove())})),vditor.ir.element.querySelectorAll("[data-type='footnotes-block']").forEach((function(item){item&&!blockElement.isEqualNode(item)&&(html+=item.outerHTML,item.remove())})))}if(log("SpinVditorIRDOM",html,"argument",vditor.options.debugger),html=vditor.lute.SpinVditorIRDOM(html),log("SpinVditorIRDOM",html,"result",vditor.options.debugger),isIRElement)blockElement.innerHTML=html;else if(blockElement.outerHTML=html,footnoteElement){var footnoteItemElement=(0,hasClosest.Th)(vditor.ir.element.querySelector("wbr"),"data-type","footnotes-def");if(footnoteItemElement){var footnoteItemText=footnoteItemElement.textContent,marker=footnoteItemText.substring(1,footnoteItemText.indexOf("]:")),footnoteRefElement=vditor.ir.element.querySelector('sup[data-type="footnotes-ref"][data-footnotes-label="'.concat(marker,'"]'));footnoteRefElement&&footnoteRefElement.setAttribute("aria-label",footnoteItemText.substr(marker.length+3).trim().substr(0,24))}}var firstFootnoteElement,allLinkRefDefsElement=vditor.ir.element.querySelectorAll("[data-type='link-ref-defs-block']");allLinkRefDefsElement.forEach((function(item,index){0===index?firstLinkRefDefElement=item:(firstLinkRefDefElement.insertAdjacentHTML("beforeend",item.innerHTML),item.remove())})),allLinkRefDefsElement.length>0&&vditor.ir.element.insertAdjacentElement("beforeend",allLinkRefDefsElement[0]);var allFootnoteElement=vditor.ir.element.querySelectorAll("[data-type='footnotes-block']");allFootnoteElement.forEach((function(item,index){0===index?firstFootnoteElement=item:(firstFootnoteElement.insertAdjacentHTML("beforeend",item.innerHTML),item.remove())})),allFootnoteElement.length>0&&vditor.ir.element.insertAdjacentElement("beforeend",allFootnoteElement[0]),(0,selection.ir)(vditor.ir.element,range),vditor.ir.element.querySelectorAll(".vditor-ir__preview[data-render='2']").forEach((function(item){processCodeRender(item,vditor)})),renderToc(vditor),process_processAfterRender(vditor,{enableAddUndoStack:!0,enableHint:!0,enableInput:!0})},matchHotKey=function(hotKey,event){if(""===hotKey)return!1;if(-1===hotKey.indexOf("⇧")&&-1===hotKey.indexOf("⌘")&&-1===hotKey.indexOf("⌥"))return!((0,compatibility._0)(event)||event.altKey||event.shiftKey||event.code!==hotKey);if("⇧Tab"===hotKey)return!((0,compatibility._0)(event)||event.altKey||!event.shiftKey||"Tab"!==event.code);var hotKeys=hotKey.split("");if(hotKey.startsWith("⌥")){var keyCode=3===hotKeys.length?hotKeys[2]:hotKeys[1];return!((3===hotKeys.length?!(0,compatibility._0)(event):(0,compatibility._0)(event))||!event.altKey||event.shiftKey||event.code!==(/^[0-9]$/.test(keyCode)?"Digit":"Key")+keyCode)}"⌘Enter"===hotKey&&(hotKeys=["⌘","Enter"]);var hasShift=hotKeys.length>2&&"⇧"===hotKeys[0],key=hasShift?hotKeys[2]:hotKeys[1];return!hasShift||!(0,compatibility.gm)()&&/Mac/.test(navigator.platform)||("-"===key?key="_":"="===key&&(key="+")),!(!(0,compatibility._0)(event)||event.key.toLowerCase()!==key.toLowerCase()||event.altKey||!(!hasShift&&!event.shiftKey||hasShift&&event.shiftKey))},expandMarker=function(range,vditor){vditor.ir.element.querySelectorAll(".vditor-ir__node--expand").forEach((function(item){item.classList.remove("vditor-ir__node--expand")}));var nodeElement=(0,hasClosest.XW)(range.startContainer,"vditor-ir__node"),nodeElementEnd=!range.collapsed&&(0,hasClosest.XW)(range.endContainer,"vditor-ir__node");if(range.collapsed||nodeElement&&nodeElement===nodeElementEnd){nodeElement&&(nodeElement.classList.add("vditor-ir__node--expand"),nodeElement.classList.remove("vditor-ir__node--hidden"),(0,selection.jl)(range));var nextNode=function(range){var startContainer=range.startContainer;if(3===startContainer.nodeType&&startContainer.nodeValue.length!==range.startOffset)return!1;for(var nextNode=startContainer.nextSibling;nextNode&&""===nextNode.textContent;)nextNode=nextNode.nextSibling;if(!nextNode){var markerElement=(0,hasClosest.KJ)(startContainer,"vditor-ir__marker");if(markerElement&&!markerElement.nextSibling){var parentNextNode=startContainer.parentElement.parentElement.nextSibling;if(parentNextNode&&3!==parentNextNode.nodeType&&parentNextNode.classList.contains("vditor-ir__node"))return parentNextNode}return!1}return!(!nextNode||3===nextNode.nodeType||!nextNode.classList.contains("vditor-ir__node")||nextNode.getAttribute("data-block"))&&nextNode}(range);if(nextNode)return nextNode.classList.add("vditor-ir__node--expand"),void nextNode.classList.remove("vditor-ir__node--hidden");var previousNode=function(range){var startContainer=range.startContainer,previousNode=startContainer.previousSibling;return!(3!==startContainer.nodeType||0!==range.startOffset||!previousNode||3===previousNode.nodeType||!previousNode.classList.contains("vditor-ir__node")||previousNode.getAttribute("data-block"))&&previousNode}(range);return previousNode?(previousNode.classList.add("vditor-ir__node--expand"),void previousNode.classList.remove("vditor-ir__node--hidden")):void 0}},preview_image=__webpack_require__(726),combineFootnote=function(elements,afterCombine){elements.querySelectorAll("[data-type=footnotes-link]").forEach((function(el){for(var root=el.parentElement,footnote=root.nextSibling;footnote&&footnote.textContent.startsWith("    ");){var thisNode=footnote;thisNode.childNodes.forEach((function(node){root.append(node.cloneNode(!0))})),footnote=footnote.nextSibling,thisNode.remove()}afterCombine&&afterCombine(root)}))},inputEvent=function(vditor,event){var _a,range=getSelection().getRangeAt(0).cloneRange(),startContainer=range.startContainer;3!==range.startContainer.nodeType&&"DIV"===range.startContainer.tagName&&(startContainer=range.startContainer.childNodes[range.startOffset-1]);var blockElement=(0,hasClosest.Th)(startContainer,"data-block","0");if(blockElement&&event&&("deleteContentBackward"===event.inputType||" "===event.data)){for(var startOffset=(0,selection.ED)(blockElement,vditor.sv.element,range).start,startSpace=!0,i=startOffset-1;i>blockElement.textContent.substr(0,startOffset).lastIndexOf("\n");i--)if(" "!==blockElement.textContent.charAt(i)&&"\t"!==blockElement.textContent.charAt(i)){startSpace=!1;break}if(0===startOffset&&(startSpace=!1),startSpace)return void processAfterRender(vditor);if("deleteContentBackward"===event.inputType){var codeBlockMarkerElement=(0,hasClosest.Th)(startContainer,"data-type","code-block-open-marker")||(0,hasClosest.Th)(startContainer,"data-type","code-block-close-marker");if(codeBlockMarkerElement){var openMarkerElement;if("code-block-close-marker"===codeBlockMarkerElement.getAttribute("data-type")&&(openMarkerElement=getSideByType(startContainer,"code-block-open-marker")))return openMarkerElement.textContent=codeBlockMarkerElement.textContent,void processAfterRender(vditor);if("code-block-open-marker"===codeBlockMarkerElement.getAttribute("data-type")&&(openMarkerElement=getSideByType(startContainer,"code-block-close-marker",!1)))return openMarkerElement.textContent=codeBlockMarkerElement.textContent,void processAfterRender(vditor)}var mathBlockMarkerElement=(0,hasClosest.Th)(startContainer,"data-type","math-block-open-marker");if(mathBlockMarkerElement){var mathBlockCloseElement=mathBlockMarkerElement.nextElementSibling.nextElementSibling;return void(mathBlockCloseElement&&"math-block-close-marker"===mathBlockCloseElement.getAttribute("data-type")&&(mathBlockCloseElement.remove(),processAfterRender(vditor)))}blockElement.querySelectorAll('[data-type="code-block-open-marker"]').forEach((function(item){1===item.textContent.length&&item.remove()})),blockElement.querySelectorAll('[data-type="code-block-close-marker"]').forEach((function(item){1===item.textContent.length&&item.remove()}));var headingElement=(0,hasClosest.Th)(startContainer,"data-type","heading-marker");if(headingElement&&-1===headingElement.textContent.indexOf("#"))return void processAfterRender(vditor)}if((" "===event.data||"deleteContentBackward"===event.inputType)&&((0,hasClosest.Th)(startContainer,"data-type","padding")||(0,hasClosest.Th)(startContainer,"data-type","li-marker")||(0,hasClosest.Th)(startContainer,"data-type","task-marker")||(0,hasClosest.Th)(startContainer,"data-type","blockquote-marker")))return void processAfterRender(vditor)}if(blockElement&&"$$"===blockElement.textContent.trimRight())processAfterRender(vditor);else{blockElement||(blockElement=vditor.sv.element),"link-ref-defs-block"===(null===(_a=blockElement.firstElementChild)||void 0===_a?void 0:_a.getAttribute("data-type"))&&(blockElement=vditor.sv.element),(0,hasClosest.Th)(startContainer,"data-type","footnotes-link")&&(blockElement=vditor.sv.element),-1===blockElement.textContent.indexOf(Lute.Caret)&&range.insertNode(document.createTextNode(Lute.Caret)),blockElement.querySelectorAll("[style]").forEach((function(item){item.removeAttribute("style")})),blockElement.querySelectorAll("font").forEach((function(item){item.outerHTML=item.innerHTML}));var html=blockElement.textContent,isSVElement=blockElement.isEqualNode(vditor.sv.element);if(isSVElement)html=blockElement.textContent;else{blockElement.previousElementSibling&&(html=blockElement.previousElementSibling.textContent+html,blockElement.previousElementSibling.remove()),blockElement.previousElementSibling&&0===html.indexOf("---\n")&&(html=blockElement.previousElementSibling.textContent+html,blockElement.previousElementSibling.remove());var footnotes_1="";vditor.sv.element.querySelectorAll("[data-type='link-ref-defs-block']").forEach((function(item,index){item&&!blockElement.isEqualNode(item.parentElement)&&(footnotes_1+=item.parentElement.textContent+"\n",item.parentElement.remove())})),vditor.sv.element.querySelectorAll("[data-type='footnotes-link']").forEach((function(item,index){item&&!blockElement.isEqualNode(item.parentElement)&&(footnotes_1+=item.parentElement.textContent+"\n",item.parentElement.remove())})),html=footnotes_1+html}html=processSpinVditorSVDOM(html,vditor),isSVElement?blockElement.innerHTML=html:blockElement.outerHTML=html,vditor.sv.element.querySelectorAll("[data-type='link-ref-defs-block']").forEach((function(item){vditor.sv.element.insertAdjacentElement("beforeend",item.parentElement)})),combineFootnote(vditor.sv.element,(function(root){vditor.sv.element.insertAdjacentElement("beforeend",root)})),(0,selection.ir)(vditor.sv.element,range),scrollCenter(vditor),processAfterRender(vditor,{enableAddUndoStack:!0,enableHint:!0,enableInput:!0})}},setContentTheme=__webpack_require__(873),setTheme=function(vditor){"dark"===vditor.options.theme?vditor.element.classList.add("vditor--dark"):vditor.element.classList.remove("vditor--dark")},setPadding=function(vditor){var minPadding=window.innerWidth<=constants.Y.MOBILE_WIDTH?10:35;if("none"!==vditor.wysiwyg.element.parentElement.style.display){var padding=(vditor.wysiwyg.element.parentElement.clientWidth-vditor.options.preview.maxWidth)/2;vditor.wysiwyg.element.style.padding="10px ".concat(Math.max(minPadding,padding),"px")}"none"!==vditor.ir.element.parentElement.style.display&&(padding=(vditor.ir.element.parentElement.clientWidth-vditor.options.preview.maxWidth)/2,vditor.ir.element.style.padding="10px ".concat(Math.max(minPadding,padding),"px")),"block"!==vditor.preview.element.style.display?vditor.toolbar.element.style.paddingLeft=Math.max(5,parseInt(vditor[vditor.currentMode].element.style.paddingLeft||"0",10)+("left"===vditor.options.outline.position?vditor.outline.element.offsetWidth:0))+"px":vditor.toolbar.element.style.paddingLeft=5+("left"===vditor.options.outline.position?vditor.outline.element.offsetWidth:0)+"px"},setTypewriterPosition=function(vditor){if(vditor.options.typewriterMode){var height=window.innerHeight;"number"==typeof vditor.options.height?(height=vditor.options.height,"number"==typeof vditor.options.minHeight&&(height=Math.max(height,vditor.options.minHeight)),height=Math.min(window.innerHeight,height)):height=vditor.element.clientHeight,vditor.element.classList.contains("vditor--fullscreen")&&(height=window.innerHeight),vditor[vditor.currentMode].element.style.setProperty("--editor-bottom",(height-vditor.toolbar.element.offsetHeight)/2+"px")}};function UIUnbindListener(){window.removeEventListener("resize",resizeCb)}var templateObject_1,afterRender=function(vditor){setTypewriterPosition(vditor),UIUnbindListener(),window.addEventListener("resize",resizeCb=function(){setPadding(vditor),setTypewriterPosition(vditor)});var initValue=(0,compatibility.D)()&&localStorage.getItem(vditor.options.cache.id);return vditor.options.cache.enable&&initValue||(vditor.options.value?initValue=vditor.options.value:vditor.originalInnerHTML?initValue=vditor.lute.HTML2Md(vditor.originalInnerHTML):vditor.options.cache.enable||(initValue="")),initValue||""},highlightToolbarIR=function(vditor){clearTimeout(vditor[vditor.currentMode].hlToolbarTimeoutId),vditor[vditor.currentMode].hlToolbarTimeoutId=window.setTimeout((function(){if("false"!==vditor[vditor.currentMode].element.getAttribute("contenteditable")&&(0,selection.Co)(vditor[vditor.currentMode].element)){removeCurrentToolbar(vditor.toolbar.elements,constants.Y.EDIT_TOOLBARS),enableToolbar(vditor.toolbar.elements,constants.Y.EDIT_TOOLBARS);var range=(0,selection.RN)(vditor),typeElement=range.startContainer;3===range.startContainer.nodeType&&(typeElement=range.startContainer.parentElement),typeElement.classList.contains("vditor-reset")&&(typeElement=typeElement.childNodes[range.startOffset]),("sv"===vditor.currentMode?(0,hasClosest.Th)(typeElement,"data-type","heading"):(0,hasClosestByHeadings.c)(typeElement))&&setCurrentToolbar(vditor.toolbar.elements,["headings"]),("sv"===vditor.currentMode?(0,hasClosest.Th)(typeElement,"data-type","blockquote"):(0,hasClosest._Y)(typeElement,"BLOCKQUOTE"))&&setCurrentToolbar(vditor.toolbar.elements,["quote"]),(0,hasClosest.Th)(typeElement,"data-type","strong")&&setCurrentToolbar(vditor.toolbar.elements,["bold"]),(0,hasClosest.Th)(typeElement,"data-type","em")&&setCurrentToolbar(vditor.toolbar.elements,["italic"]),(0,hasClosest.Th)(typeElement,"data-type","s")&&setCurrentToolbar(vditor.toolbar.elements,["strike"]),(0,hasClosest.Th)(typeElement,"data-type","a")&&setCurrentToolbar(vditor.toolbar.elements,["link"]);var liElement=(0,hasClosest._Y)(typeElement,"LI");liElement?(liElement.classList.contains("vditor-task")?setCurrentToolbar(vditor.toolbar.elements,["check"]):"OL"===liElement.parentElement.tagName?setCurrentToolbar(vditor.toolbar.elements,["ordered-list"]):"UL"===liElement.parentElement.tagName&&setCurrentToolbar(vditor.toolbar.elements,["list"]),enableToolbar(vditor.toolbar.elements,["outdent","indent"])):disableToolbar(vditor.toolbar.elements,["outdent","indent"]),(0,hasClosest.Th)(typeElement,"data-type","code-block")&&(disableToolbar(vditor.toolbar.elements,["headings","bold","italic","strike","line","quote","list","ordered-list","check","code","inline-code","upload","link","table","record"]),setCurrentToolbar(vditor.toolbar.elements,["code"])),(0,hasClosest.Th)(typeElement,"data-type","code")&&(disableToolbar(vditor.toolbar.elements,["headings","bold","italic","strike","line","quote","list","ordered-list","check","code","upload","link","table","record"]),setCurrentToolbar(vditor.toolbar.elements,["inline-code"])),(0,hasClosest.Th)(typeElement,"data-type","table")&&disableToolbar(vditor.toolbar.elements,["headings","list","ordered-list","check","line","quote","code","table"])}}),200)},afterRenderEvent=function(vditor,options){void 0===options&&(options={enableAddUndoStack:!0,enableHint:!1,enableInput:!0}),options.enableHint&&vditor.hint.render(vditor),clearTimeout(vditor.wysiwyg.afterRenderTimeoutId),vditor.wysiwyg.afterRenderTimeoutId=window.setTimeout((function(){if(!vditor.wysiwyg.composingLock){var text=getMarkdown(vditor);"function"==typeof vditor.options.input&&options.enableInput&&vditor.options.input(text),vditor.options.counter.enable&&vditor.counter.render(vditor,text),vditor.options.cache.enable&&(0,compatibility.D)()&&(localStorage.setItem(vditor.options.cache.id,text),vditor.options.cache.after&&vditor.options.cache.after(text)),vditor.devtools&&vditor.devtools.renderEchart(vditor),options.enableAddUndoStack&&vditor.undo.addToUndoStack(vditor)}}),vditor.options.undoDelay)},getNextHTML=function(node){for(var html="",nextNode=node.nextSibling;nextNode;)3===nextNode.nodeType?html+=nextNode.textContent:html+=nextNode.outerHTML,nextNode=nextNode.nextSibling;return html},getPreviousHTML=function(node){for(var html="",previousNode=node.previousSibling;previousNode;)html=3===previousNode.nodeType?previousNode.textContent+html:previousNode.outerHTML+html,previousNode=previousNode.previousSibling;return html},modifyPre=function(vditor,range){Array.from(vditor.wysiwyg.element.childNodes).find((function(node){if(3===node.nodeType){var pElement=document.createElement("p");pElement.setAttribute("data-block","0"),pElement.textContent=node.textContent;var cloneRangeOffset=3===range.startContainer.nodeType?range.startOffset:node.textContent.length;return node.parentNode.insertBefore(pElement,node),node.remove(),range.setStart(pElement.firstChild,Math.min(pElement.firstChild.textContent.length,cloneRangeOffset)),range.collapse(!0),(0,selection.jl)(range),!0}if(!node.getAttribute("data-block"))return"P"===node.tagName?node.remove():("DIV"===node.tagName?(range.insertNode(document.createElement("wbr")),node.outerHTML='<p data-block="0">'.concat(node.innerHTML,"</p>")):"BR"===node.tagName?node.outerHTML='<p data-block="0">'.concat(node.outerHTML,"<wbr></p>"):(range.insertNode(document.createElement("wbr")),node.outerHTML='<p data-block="0">'.concat(node.outerHTML,"</p>")),(0,selection.ir)(vditor.wysiwyg.element,range),range=getSelection().getRangeAt(0)),!0}))},setHeading=function(vditor,tagName){var range=(0,selection.RN)(vditor),blockElement=(0,hasClosest.pt)(range.startContainer);blockElement||(blockElement=range.startContainer.childNodes[range.startOffset]),blockElement||0!==vditor.wysiwyg.element.children.length||(blockElement=vditor.wysiwyg.element),blockElement&&!blockElement.classList.contains("vditor-wysiwyg__block")&&(range.insertNode(document.createElement("wbr")),"<wbr>"===blockElement.innerHTML.trim()&&(blockElement.innerHTML="<wbr><br>"),"BLOCKQUOTE"===blockElement.tagName||blockElement.classList.contains("vditor-reset")?blockElement.innerHTML="<".concat(tagName,' data-block="0">').concat(blockElement.innerHTML.trim(),"</").concat(tagName,">"):blockElement.outerHTML="<".concat(tagName,' data-block="0">').concat(blockElement.innerHTML.trim(),"</").concat(tagName,">"),(0,selection.ir)(vditor.wysiwyg.element,range),renderToc(vditor))},removeHeading=function(vditor){var range=getSelection().getRangeAt(0),blockElement=(0,hasClosest.pt)(range.startContainer);blockElement||(blockElement=range.startContainer.childNodes[range.startOffset]),blockElement&&(range.insertNode(document.createElement("wbr")),blockElement.outerHTML='<p data-block="0">'.concat(blockElement.innerHTML,"</p>"),(0,selection.ir)(vditor.wysiwyg.element,range)),vditor.wysiwyg.popover.style.display="none"},showCode=function(previewElement,vditor,first){void 0===first&&(first=!0);var previousElement=previewElement.previousElementSibling,range=previousElement.ownerDocument.createRange();"CODE"===previousElement.tagName?(previousElement.style.display="inline-block",first?range.setStart(previousElement.firstChild,1):range.selectNodeContents(previousElement)):(previousElement.style.display="block",previousElement.firstChild.firstChild||previousElement.firstChild.appendChild(document.createTextNode("")),range.selectNodeContents(previousElement.firstChild)),first?range.collapse(!0):range.collapse(!1),(0,selection.jl)(range),previewElement.firstElementChild.classList.contains("language-mindmap")||scrollCenter(vditor)},removeBlockElement=function(vditor,event){if(matchHotKey("⇧⌘X",event)){var itemElement=vditor.wysiwyg.popover.querySelector('[data-type="remove"]');return itemElement&&itemElement.click(),event.preventDefault(),!0}},highlightToolbarWYSIWYG=function(vditor){clearTimeout(vditor.wysiwyg.hlToolbarTimeoutId),vditor.wysiwyg.hlToolbarTimeoutId=window.setTimeout((function(){if("false"!==vditor.wysiwyg.element.getAttribute("contenteditable")&&(0,selection.Co)(vditor.wysiwyg.element)){removeCurrentToolbar(vditor.toolbar.elements,constants.Y.EDIT_TOOLBARS),enableToolbar(vditor.toolbar.elements,constants.Y.EDIT_TOOLBARS);var range=getSelection().getRangeAt(0),typeElement=range.startContainer;typeElement=3===range.startContainer.nodeType?range.startContainer.parentElement:typeElement.childNodes[range.startOffset>=typeElement.childNodes.length?typeElement.childNodes.length-1:range.startOffset];var footnotesElement=(0,hasClosest.Th)(typeElement,"data-type","footnotes-block");if(footnotesElement)return vditor.wysiwyg.popover.innerHTML="",genClose(footnotesElement,vditor),void setPopoverPosition(vditor,footnotesElement);var liElement=(0,hasClosest._Y)(typeElement,"LI");liElement?(liElement.classList.contains("vditor-task")?setCurrentToolbar(vditor.toolbar.elements,["check"]):"OL"===liElement.parentElement.tagName?setCurrentToolbar(vditor.toolbar.elements,["ordered-list"]):"UL"===liElement.parentElement.tagName&&setCurrentToolbar(vditor.toolbar.elements,["list"]),enableToolbar(vditor.toolbar.elements,["outdent","indent"])):disableToolbar(vditor.toolbar.elements,["outdent","indent"]),(0,hasClosest._Y)(typeElement,"BLOCKQUOTE")&&setCurrentToolbar(vditor.toolbar.elements,["quote"]),((0,hasClosest._Y)(typeElement,"B")||(0,hasClosest._Y)(typeElement,"STRONG"))&&setCurrentToolbar(vditor.toolbar.elements,["bold"]),((0,hasClosest._Y)(typeElement,"I")||(0,hasClosest._Y)(typeElement,"EM"))&&setCurrentToolbar(vditor.toolbar.elements,["italic"]),((0,hasClosest._Y)(typeElement,"STRIKE")||(0,hasClosest._Y)(typeElement,"S"))&&setCurrentToolbar(vditor.toolbar.elements,["strike"]),vditor.wysiwyg.element.querySelectorAll(".vditor-comment--focus").forEach((function(item){item.classList.remove("vditor-comment--focus")}));var commentElement=(0,hasClosest.KJ)(typeElement,"vditor-comment");if(commentElement){var ids_1=commentElement.getAttribute("data-cmtids").split(" ");if(ids_1.length>1&&commentElement.nextSibling.isSameNode(commentElement.nextElementSibling)){var nextIds_1=commentElement.nextElementSibling.getAttribute("data-cmtids").split(" ");ids_1.find((function(id){if(nextIds_1.includes(id))return ids_1=[id],!0}))}vditor.wysiwyg.element.querySelectorAll(".vditor-comment").forEach((function(item){item.getAttribute("data-cmtids").indexOf(ids_1[0])>-1&&item.classList.add("vditor-comment--focus")}))}var aElement=(0,hasClosest._Y)(typeElement,"A");aElement&&setCurrentToolbar(vditor.toolbar.elements,["link"]);var tableElement=(0,hasClosest._Y)(typeElement,"TABLE"),headingElement=(0,hasClosestByHeadings.c)(typeElement);(0,hasClosest._Y)(typeElement,"CODE")?(0,hasClosest._Y)(typeElement,"PRE")?(disableToolbar(vditor.toolbar.elements,["headings","bold","italic","strike","line","quote","list","ordered-list","check","code","inline-code","upload","link","table","record"]),setCurrentToolbar(vditor.toolbar.elements,["code"])):(disableToolbar(vditor.toolbar.elements,["headings","bold","italic","strike","line","quote","list","ordered-list","check","code","upload","link","table","record"]),setCurrentToolbar(vditor.toolbar.elements,["inline-code"])):headingElement?(disableToolbar(vditor.toolbar.elements,["bold"]),setCurrentToolbar(vditor.toolbar.elements,["headings"])):tableElement&&disableToolbar(vditor.toolbar.elements,["table"]);var tocElement=(0,hasClosest.KJ)(typeElement,"vditor-toc");if(tocElement)return vditor.wysiwyg.popover.innerHTML="",genClose(tocElement,vditor),void setPopoverPosition(vditor,tocElement);var blockquoteElement=(0,hasClosestByHeadings.f)(typeElement,"BLOCKQUOTE");if(blockquoteElement&&(vditor.wysiwyg.popover.innerHTML="",genUp(range,blockquoteElement,vditor),genDown(range,blockquoteElement,vditor),genClose(blockquoteElement,vditor),setPopoverPosition(vditor,blockquoteElement)),liElement&&(vditor.wysiwyg.popover.innerHTML="",genUp(range,liElement,vditor),genDown(range,liElement,vditor),genClose(liElement,vditor),setPopoverPosition(vditor,liElement)),tableElement){vditor.options.lang,vditor.options,vditor.wysiwyg.popover.innerHTML="";var updateTable_1=function(){var oldRow=tableElement.rows.length,oldColumn=tableElement.rows[0].cells.length,row=parseInt(input_1.value,10)||oldRow,column=parseInt(input2_1.value,10)||oldColumn;if(row!==oldRow||oldColumn!==column){if(oldColumn!==column)for(var columnDiff=column-oldColumn,i=0;i<tableElement.rows.length;i++)if(columnDiff>0)for(var j=0;j<columnDiff;j++)0===i?tableElement.rows[i].lastElementChild.insertAdjacentHTML("afterend","<th> </th>"):tableElement.rows[i].lastElementChild.insertAdjacentHTML("afterend","<td> </td>");else for(var k=oldColumn-1;k>=column;k--)tableElement.rows[i].cells[k].remove();if(oldRow!==row){var rowDiff=row-oldRow;if(rowDiff>0){for(var rowHTML="<tr>",m=0;m<column;m++)rowHTML+="<td> </td>";for(var l=0;l<rowDiff;l++)tableElement.querySelector("tbody")?tableElement.querySelector("tbody").insertAdjacentHTML("beforeend",rowHTML):tableElement.querySelector("thead").insertAdjacentHTML("afterend",rowHTML+"</tr>")}else for(m=oldRow-1;m>=row;m--)tableElement.rows[m].remove(),1===tableElement.rows.length&&tableElement.querySelector("tbody").remove()}"function"==typeof vditor.options.input&&vditor.options.input(getMarkdown(vditor))}},setAlign_1=function(type){setTableAlign(tableElement,type),"right"===type?(left_1.classList.remove("vditor-icon--current"),center_1.classList.remove("vditor-icon--current"),right_1.classList.add("vditor-icon--current")):"center"===type?(left_1.classList.remove("vditor-icon--current"),right_1.classList.remove("vditor-icon--current"),center_1.classList.add("vditor-icon--current")):(center_1.classList.remove("vditor-icon--current"),right_1.classList.remove("vditor-icon--current"),left_1.classList.add("vditor-icon--current")),(0,selection.jl)(range),afterRenderEvent(vditor)},td=(0,hasClosest._Y)(typeElement,"TD"),th=(0,hasClosest._Y)(typeElement,"TH"),alignType="left";td?alignType=td.getAttribute("align")||"left":th&&(alignType=th.getAttribute("align")||"center");var left_1=document.createElement("button");left_1.setAttribute("type","button"),left_1.setAttribute("aria-label",window.VditorI18n.alignLeft+"<"+(0,compatibility.fG)("⇧⌘L")+">"),left_1.setAttribute("data-type","left"),left_1.innerHTML='<svg><use xlink:href="#vditor-icon-align-left"></use></svg>',left_1.className="vditor-icon vditor-tooltipped vditor-tooltipped__n"+("left"===alignType?" vditor-icon--current":""),left_1.onclick=function(){setAlign_1("left")};var center_1=document.createElement("button");center_1.setAttribute("type","button"),center_1.setAttribute("aria-label",window.VditorI18n.alignCenter+"<"+(0,compatibility.fG)("⇧⌘C")+">"),center_1.setAttribute("data-type","center"),center_1.innerHTML='<svg><use xlink:href="#vditor-icon-align-center"></use></svg>',center_1.className="vditor-icon vditor-tooltipped vditor-tooltipped__n"+("center"===alignType?" vditor-icon--current":""),center_1.onclick=function(){setAlign_1("center")};var right_1=document.createElement("button");right_1.setAttribute("type","button"),right_1.setAttribute("aria-label",window.VditorI18n.alignRight+"<"+(0,compatibility.fG)("⇧⌘R")+">"),right_1.setAttribute("data-type","right"),right_1.innerHTML='<svg><use xlink:href="#vditor-icon-align-right"></use></svg>',right_1.className="vditor-icon vditor-tooltipped vditor-tooltipped__n"+("right"===alignType?" vditor-icon--current":""),right_1.onclick=function(){setAlign_1("right")};var insertRowElement=document.createElement("button");insertRowElement.setAttribute("type","button"),insertRowElement.setAttribute("aria-label",window.VditorI18n.insertRowBelow+"<"+(0,compatibility.fG)("⌘=")+">"),insertRowElement.setAttribute("data-type","insertRow"),insertRowElement.innerHTML='<svg><use xlink:href="#vditor-icon-insert-row"></use></svg>',insertRowElement.className="vditor-icon vditor-tooltipped vditor-tooltipped__n",insertRowElement.onclick=function(){var startContainer=getSelection().getRangeAt(0).startContainer,cellElement=(0,hasClosest._Y)(startContainer,"TD")||(0,hasClosest._Y)(startContainer,"TH");cellElement&&insertRow(vditor,range,cellElement)};var insertRowBElement=document.createElement("button");insertRowBElement.setAttribute("type","button"),insertRowBElement.setAttribute("aria-label",window.VditorI18n.insertRowAbove+"<"+(0,compatibility.fG)("⇧⌘F")+">"),insertRowBElement.setAttribute("data-type","insertRow"),insertRowBElement.innerHTML='<svg><use xlink:href="#vditor-icon-insert-rowb"></use></svg>',insertRowBElement.className="vditor-icon vditor-tooltipped vditor-tooltipped__n",insertRowBElement.onclick=function(){var startContainer=getSelection().getRangeAt(0).startContainer,cellElement=(0,hasClosest._Y)(startContainer,"TD")||(0,hasClosest._Y)(startContainer,"TH");cellElement&&insertRowAbove(vditor,range,cellElement)};var insertColumnElement=document.createElement("button");insertColumnElement.setAttribute("type","button"),insertColumnElement.setAttribute("aria-label",window.VditorI18n.insertColumnRight+"<"+(0,compatibility.fG)("⇧⌘=")+">"),insertColumnElement.setAttribute("data-type","insertColumn"),insertColumnElement.innerHTML='<svg><use xlink:href="#vditor-icon-insert-column"></use></svg>',insertColumnElement.className="vditor-icon vditor-tooltipped vditor-tooltipped__n",insertColumnElement.onclick=function(){var startContainer=getSelection().getRangeAt(0).startContainer,cellElement=(0,hasClosest._Y)(startContainer,"TD")||(0,hasClosest._Y)(startContainer,"TH");cellElement&&insertColumn(vditor,tableElement,cellElement)};var insertColumnBElement=document.createElement("button");insertColumnBElement.setAttribute("type","button"),insertColumnBElement.setAttribute("aria-label",window.VditorI18n.insertColumnLeft+"<"+(0,compatibility.fG)("⇧⌘G")+">"),insertColumnBElement.setAttribute("data-type","insertColumn"),insertColumnBElement.innerHTML='<svg><use xlink:href="#vditor-icon-insert-columnb"></use></svg>',insertColumnBElement.className="vditor-icon vditor-tooltipped vditor-tooltipped__n",insertColumnBElement.onclick=function(){var startContainer=getSelection().getRangeAt(0).startContainer,cellElement=(0,hasClosest._Y)(startContainer,"TD")||(0,hasClosest._Y)(startContainer,"TH");cellElement&&insertColumn(vditor,tableElement,cellElement,"beforebegin")};var deleteRowElement=document.createElement("button");deleteRowElement.setAttribute("type","button"),deleteRowElement.setAttribute("aria-label",window.VditorI18n["delete-row"]+"<"+(0,compatibility.fG)("⌘-")+">"),deleteRowElement.setAttribute("data-type","deleteRow"),deleteRowElement.innerHTML='<svg><use xlink:href="#vditor-icon-delete-row"></use></svg>',deleteRowElement.className="vditor-icon vditor-tooltipped vditor-tooltipped__n",deleteRowElement.onclick=function(){var startContainer=getSelection().getRangeAt(0).startContainer,cellElement=(0,hasClosest._Y)(startContainer,"TD")||(0,hasClosest._Y)(startContainer,"TH");cellElement&&deleteRow(vditor,range,cellElement)};var deleteColumnElement=document.createElement("button");deleteColumnElement.setAttribute("type","button"),deleteColumnElement.setAttribute("aria-label",window.VditorI18n["delete-column"]+"<"+(0,compatibility.fG)("⇧⌘-")+">"),deleteColumnElement.setAttribute("data-type","deleteColumn"),deleteColumnElement.innerHTML='<svg><use xlink:href="#vditor-icon-delete-column"></use></svg>',deleteColumnElement.className="vditor-icon vditor-tooltipped vditor-tooltipped__n",deleteColumnElement.onclick=function(){var startContainer=getSelection().getRangeAt(0).startContainer,cellElement=(0,hasClosest._Y)(startContainer,"TD")||(0,hasClosest._Y)(startContainer,"TH");cellElement&&deleteColumn(vditor,range,tableElement,cellElement)},(inputWrap=document.createElement("span")).setAttribute("aria-label",window.VditorI18n.row),inputWrap.className="vditor-tooltipped vditor-tooltipped__n";var input_1=document.createElement("input");inputWrap.appendChild(input_1),input_1.type="number",input_1.min="1",input_1.className="vditor-input",input_1.style.width="42px",input_1.style.textAlign="center",input_1.setAttribute("placeholder",window.VditorI18n.row),input_1.value=tableElement.rows.length.toString(),input_1.oninput=function(){updateTable_1()},input_1.onkeydown=function(event){if(!event.isComposing)return"Tab"===event.key?(input2_1.focus(),input2_1.select(),void event.preventDefault()):void(removeBlockElement(vditor,event)||focusToElement(event,range))};var input2Wrap=document.createElement("span");input2Wrap.setAttribute("aria-label",window.VditorI18n.column),input2Wrap.className="vditor-tooltipped vditor-tooltipped__n";var input2_1=document.createElement("input");input2Wrap.appendChild(input2_1),input2_1.type="number",input2_1.min="1",input2_1.className="vditor-input",input2_1.style.width="42px",input2_1.style.textAlign="center",input2_1.setAttribute("placeholder",window.VditorI18n.column),input2_1.value=tableElement.rows[0].cells.length.toString(),input2_1.oninput=function(){updateTable_1()},input2_1.onkeydown=function(event){if(!event.isComposing)return"Tab"===event.key?(input_1.focus(),input_1.select(),void event.preventDefault()):void(removeBlockElement(vditor,event)||focusToElement(event,range))},genUp(range,tableElement,vditor),genDown(range,tableElement,vditor),genClose(tableElement,vditor),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",left_1),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",center_1),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",right_1),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",insertRowBElement),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",insertRowElement),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",insertColumnBElement),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",insertColumnElement),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",deleteRowElement),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",deleteColumnElement),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",inputWrap),vditor.wysiwyg.popover.insertAdjacentHTML("beforeend"," x "),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",input2Wrap),setPopoverPosition(vditor,tableElement)}var linkRefElement=(0,hasClosest.Th)(typeElement,"data-type","link-ref");linkRefElement&&genLinkRefPopover(vditor,linkRefElement,range);var footnotesRefElement=(0,hasClosest.Th)(typeElement,"data-type","footnotes-ref");if(footnotesRefElement){vditor.options.lang,vditor.options,vditor.wysiwyg.popover.innerHTML="",(inputWrap=document.createElement("span")).setAttribute("aria-label",window.VditorI18n.footnoteRef+"<"+(0,compatibility.fG)("⌥Enter")+">"),inputWrap.className="vditor-tooltipped vditor-tooltipped__n";var input_2=document.createElement("input");inputWrap.appendChild(input_2),input_2.className="vditor-input",input_2.setAttribute("placeholder",window.VditorI18n.footnoteRef+"<"+(0,compatibility.fG)("⌥Enter")+">"),input_2.style.width="120px",input_2.value=footnotesRefElement.getAttribute("data-footnotes-label"),input_2.oninput=function(){""!==input_2.value.trim()&&footnotesRefElement.setAttribute("data-footnotes-label",input_2.value),"function"==typeof vditor.options.input&&vditor.options.input(getMarkdown(vditor))},input_2.onkeydown=function(event){event.isComposing||removeBlockElement(vditor,event)||focusToElement(event,range)},genClose(footnotesRefElement,vditor),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",inputWrap),setPopoverPosition(vditor,footnotesRefElement)}var blockRenderElement=(0,hasClosest.KJ)(typeElement,"vditor-wysiwyg__block"),isBlock=!!blockRenderElement&&blockRenderElement.getAttribute("data-type").indexOf("block")>-1;if(vditor.wysiwyg.element.querySelectorAll(".vditor-wysiwyg__preview").forEach((function(itemElement){(!blockRenderElement||blockRenderElement&&isBlock&&!blockRenderElement.contains(itemElement))&&(itemElement.previousElementSibling.style.display="none")})),blockRenderElement&&isBlock){if(vditor.wysiwyg.popover.innerHTML="",genUp(range,blockRenderElement,vditor),genDown(range,blockRenderElement,vditor),genClose(blockRenderElement,vditor),"code-block"===blockRenderElement.getAttribute("data-type")){var languageWrap=document.createElement("span");languageWrap.setAttribute("aria-label",window.VditorI18n.language+"<"+(0,compatibility.fG)("⌥Enter")+">"),languageWrap.className="vditor-tooltipped vditor-tooltipped__n";var language_1=document.createElement("input");languageWrap.appendChild(language_1);var codeElement_1=blockRenderElement.firstElementChild.firstElementChild;language_1.className="vditor-input",language_1.setAttribute("placeholder",window.VditorI18n.language+"<"+(0,compatibility.fG)("⌥Enter")+">"),language_1.value=codeElement_1.className.indexOf("language-")>-1?codeElement_1.className.split("-")[1].split(" ")[0]:"",language_1.oninput=function(e){""!==language_1.value.trim()?codeElement_1.className="language-".concat(language_1.value):(codeElement_1.className="",vditor.hint.recentLanguage=""),blockRenderElement.lastElementChild.classList.contains("vditor-wysiwyg__preview")&&(blockRenderElement.lastElementChild.innerHTML=blockRenderElement.firstElementChild.innerHTML,processCodeRender(blockRenderElement.lastElementChild,vditor)),afterRenderEvent(vditor),1===e.detail&&(range.setStart(codeElement_1.firstChild,0),range.collapse(!0),(0,selection.jl)(range))},language_1.onkeydown=function(event){if(!event.isComposing&&!removeBlockElement(vditor,event)){if("Escape"===event.key&&"block"===vditor.hint.element.style.display)return vditor.hint.element.style.display="none",void event.preventDefault();vditor.hint.select(event,vditor),focusToElement(event,range)}},language_1.onkeyup=function(event){var _a,_b;if(!event.isComposing&&"Enter"!==event.key&&"ArrowUp"!==event.key&&"Escape"!==event.key&&"ArrowDown"!==event.key){var matchLangData=[],key=language_1.value.substring(0,language_1.selectionStart);(vditor.options.preview.hljs.langs||constants.Y.ALIAS_CODE_LANGUAGES.concat((null!==(_b=null===(_a=window.hljs)||void 0===_a?void 0:_a.listLanguages())&&void 0!==_b?_b:[]).sort())).forEach((function(keyName){keyName.indexOf(key.toLowerCase())>-1&&matchLangData.push({html:keyName,value:keyName})})),vditor.hint.genHTML(matchLangData,key,vditor),event.preventDefault()}},vditor.wysiwyg.popover.insertAdjacentElement("beforeend",languageWrap)}setPopoverPosition(vditor,blockRenderElement)}else blockRenderElement=void 0;if(headingElement){var inputWrap;vditor.wysiwyg.popover.innerHTML="",(inputWrap=document.createElement("span")).setAttribute("aria-label","ID<"+(0,compatibility.fG)("⌥Enter")+">"),inputWrap.className="vditor-tooltipped vditor-tooltipped__n";var input_3=document.createElement("input");inputWrap.appendChild(input_3),input_3.className="vditor-input",input_3.setAttribute("placeholder","ID<"+(0,compatibility.fG)("⌥Enter")+">"),input_3.style.width="120px",input_3.value=headingElement.getAttribute("data-id")||"",input_3.oninput=function(){headingElement.setAttribute("data-id",input_3.value),"function"==typeof vditor.options.input&&vditor.options.input(getMarkdown(vditor))},input_3.onkeydown=function(event){event.isComposing||removeBlockElement(vditor,event)||focusToElement(event,range)},genUp(range,headingElement,vditor),genDown(range,headingElement,vditor),genClose(headingElement,vditor),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",inputWrap),setPopoverPosition(vditor,headingElement)}if(aElement&&genAPopover(vditor,aElement,range),!(blockquoteElement||liElement||tableElement||blockRenderElement||aElement||linkRefElement||footnotesRefElement||headingElement||tocElement)){var blockElement=(0,hasClosest.Th)(typeElement,"data-block","0");blockElement&&blockElement.parentElement.isEqualNode(vditor.wysiwyg.element)?(vditor.wysiwyg.popover.innerHTML="",genUp(range,blockElement,vditor),genDown(range,blockElement,vditor),genClose(blockElement,vditor),setPopoverPosition(vditor,blockElement)):vditor.wysiwyg.popover.style.display="none"}vditor.wysiwyg.element.querySelectorAll('span[data-type="backslash"] > span').forEach((function(item){item.style.display="none"}));var backslashElement=(0,hasClosest.Th)(range.startContainer,"data-type","backslash");backslashElement&&(backslashElement.querySelector("span").style.display="inline")}}),200)},setPopoverPosition=function(vditor,element){var targetElement=element,tableElement=(0,hasClosest._Y)(element,"TABLE");tableElement&&(targetElement=tableElement),vditor.wysiwyg.popover.style.left="0",vditor.wysiwyg.popover.style.display="block",vditor.wysiwyg.popover.style.top=Math.max(-8,targetElement.offsetTop-21-vditor.wysiwyg.element.scrollTop)+"px",vditor.wysiwyg.popover.style.left=Math.min(targetElement.offsetLeft,vditor.wysiwyg.element.clientWidth-vditor.wysiwyg.popover.clientWidth)+"px",vditor.wysiwyg.popover.setAttribute("data-top",(targetElement.offsetTop-21).toString())},genLinkRefPopover=function(vditor,linkRefElement,range){void 0===range&&(range=getSelection().getRangeAt(0)),vditor.wysiwyg.popover.innerHTML="";var updateLinkRef=function(){""!==input2.value.trim()&&("IMG"===linkRefElement.tagName?linkRefElement.setAttribute("alt",input2.value):linkRefElement.textContent=input2.value),""!==input1.value.trim()&&linkRefElement.setAttribute("data-link-label",input1.value),"function"==typeof vditor.options.input&&vditor.options.input(getMarkdown(vditor))},inputWrap=document.createElement("span");inputWrap.setAttribute("aria-label",window.VditorI18n.textIsNotEmpty),inputWrap.className="vditor-tooltipped vditor-tooltipped__n";var input2=document.createElement("input");inputWrap.appendChild(input2),input2.className="vditor-input",input2.setAttribute("placeholder",window.VditorI18n.textIsNotEmpty),input2.style.width="120px",input2.value=linkRefElement.getAttribute("alt")||linkRefElement.textContent,input2.oninput=function(){updateLinkRef()},input2.onkeydown=function(event){removeBlockElement(vditor,event)||focusToElement(event,range)||linkHotkey(vditor,linkRefElement,event,input1)};var input1Wrap=document.createElement("span");input1Wrap.setAttribute("aria-label",window.VditorI18n.linkRef),input1Wrap.className="vditor-tooltipped vditor-tooltipped__n";var input1=document.createElement("input");input1Wrap.appendChild(input1),input1.className="vditor-input",input1.setAttribute("placeholder",window.VditorI18n.linkRef),input1.value=linkRefElement.getAttribute("data-link-label"),input1.oninput=function(){updateLinkRef()},input1.onkeydown=function(event){removeBlockElement(vditor,event)||focusToElement(event,range)||linkHotkey(vditor,linkRefElement,event,input2)},genClose(linkRefElement,vditor),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",inputWrap),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",input1Wrap),setPopoverPosition(vditor,linkRefElement)},genUp=function(range,element,vditor){var previousElement=element.previousElementSibling;if(previousElement&&(element.parentElement.isEqualNode(vditor.wysiwyg.element)||"LI"===element.tagName)){var upElement=document.createElement("button");upElement.setAttribute("type","button"),upElement.setAttribute("data-type","up"),upElement.setAttribute("aria-label",window.VditorI18n.up+"<"+(0,compatibility.fG)("⇧⌘U")+">"),upElement.innerHTML='<svg><use xlink:href="#vditor-icon-up"></use></svg>',upElement.className="vditor-icon vditor-tooltipped vditor-tooltipped__n",upElement.onclick=function(){range.insertNode(document.createElement("wbr")),previousElement.insertAdjacentElement("beforebegin",element),(0,selection.ir)(vditor.wysiwyg.element,range),afterRenderEvent(vditor),highlightToolbarWYSIWYG(vditor),scrollCenter(vditor)},vditor.wysiwyg.popover.insertAdjacentElement("beforeend",upElement)}},genDown=function(range,element,vditor){var nextElement=element.nextElementSibling;if(nextElement&&(element.parentElement.isEqualNode(vditor.wysiwyg.element)||"LI"===element.tagName)){var downElement=document.createElement("button");downElement.setAttribute("type","button"),downElement.setAttribute("data-type","down"),downElement.setAttribute("aria-label",window.VditorI18n.down+"<"+(0,compatibility.fG)("⇧⌘D")+">"),downElement.innerHTML='<svg><use xlink:href="#vditor-icon-down"></use></svg>',downElement.className="vditor-icon vditor-tooltipped vditor-tooltipped__n",downElement.onclick=function(){range.insertNode(document.createElement("wbr")),nextElement.insertAdjacentElement("afterend",element),(0,selection.ir)(vditor.wysiwyg.element,range),afterRenderEvent(vditor),highlightToolbarWYSIWYG(vditor),scrollCenter(vditor)},vditor.wysiwyg.popover.insertAdjacentElement("beforeend",downElement)}},genClose=function(element,vditor){var close=document.createElement("button");close.setAttribute("type","button"),close.setAttribute("data-type","remove"),close.setAttribute("aria-label",window.VditorI18n.remove+"<"+(0,compatibility.fG)("⇧⌘X")+">"),close.innerHTML='<svg><use xlink:href="#vditor-icon-trashcan"></use></svg>',close.className="vditor-icon vditor-tooltipped vditor-tooltipped__n",close.onclick=function(){var range=(0,selection.RN)(vditor);range.setStartAfter(element),(0,selection.jl)(range),element.remove(),afterRenderEvent(vditor),highlightToolbarWYSIWYG(vditor),["H1","H2","H3","H4","H5","H6"].includes(element.tagName)&&renderToc(vditor)},vditor.wysiwyg.popover.insertAdjacentElement("beforeend",close)},linkHotkey=function(vditor,element,event,nextInputElement){if(!event.isComposing){if("Tab"===event.key)return nextInputElement.focus(),nextInputElement.select(),void event.preventDefault();if(!(0,compatibility._0)(event)&&!event.shiftKey&&event.altKey&&"Enter"===event.key){var range=(0,selection.RN)(vditor);element.insertAdjacentHTML("afterend",constants.Y.ZWSP),range.setStartAfter(element.nextSibling),range.collapse(!0),(0,selection.jl)(range),event.preventDefault()}}},genAPopover=function(vditor,aElement,range){vditor.wysiwyg.popover.innerHTML="";var updateA=function(){""!==input2.value.trim()&&(aElement.innerHTML=input2.value),aElement.setAttribute("href",input1.value),aElement.setAttribute("title",input22.value),afterRenderEvent(vditor)};aElement.querySelectorAll("[data-marker]").forEach((function(item){item.removeAttribute("data-marker")}));var inputWrap=document.createElement("span");inputWrap.setAttribute("aria-label",window.VditorI18n.textIsNotEmpty),inputWrap.className="vditor-tooltipped vditor-tooltipped__n";var input2=document.createElement("input");inputWrap.appendChild(input2),input2.className="vditor-input",input2.setAttribute("placeholder",window.VditorI18n.textIsNotEmpty),input2.style.width="120px",input2.value=aElement.innerHTML||"",input2.oninput=function(){updateA()},input2.onkeydown=function(event){removeBlockElement(vditor,event)||focusToElement(event,range)||linkHotkey(vditor,aElement,event,input1)};var input1Wrap=document.createElement("span");input1Wrap.setAttribute("aria-label",window.VditorI18n.link),input1Wrap.className="vditor-tooltipped vditor-tooltipped__n";var input1=document.createElement("input");input1Wrap.appendChild(input1),input1.className="vditor-input",input1.setAttribute("placeholder",window.VditorI18n.link),input1.value=aElement.getAttribute("href")||"",input1.oninput=function(){updateA()},input1.onkeydown=function(event){removeBlockElement(vditor,event)||focusToElement(event,range)||linkHotkey(vditor,aElement,event,input22)};var input2Wrap=document.createElement("span");input2Wrap.setAttribute("aria-label",window.VditorI18n.tooltipText),input2Wrap.className="vditor-tooltipped vditor-tooltipped__n";var input22=document.createElement("input");input2Wrap.appendChild(input22),input22.className="vditor-input",input22.setAttribute("placeholder",window.VditorI18n.tooltipText),input22.style.width="60px",input22.value=aElement.getAttribute("title")||"",input22.oninput=function(){updateA()},input22.onkeydown=function(event){removeBlockElement(vditor,event)||focusToElement(event,range)||linkHotkey(vditor,aElement,event,input2)},genClose(aElement,vditor),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",inputWrap),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",input1Wrap),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",input2Wrap),setPopoverPosition(vditor,aElement)},focusToElement=function(event,range){if(!(0,compatibility._0)(event)&&!event.shiftKey&&"Enter"===event.key||"Escape"===event.key)return range&&(0,selection.jl)(range),event.preventDefault(),event.stopPropagation(),!0},highlightToolbar=function(vditor){"wysiwyg"===vditor.currentMode?highlightToolbarWYSIWYG(vditor):"ir"===vditor.currentMode&&highlightToolbarIR(vditor)},renderDomByMd=function(vditor,md,options){void 0===options&&(options={enableAddUndoStack:!0,enableHint:!1,enableInput:!0});var editorElement=vditor.wysiwyg.element;editorElement.innerHTML=vditor.lute.Md2VditorDOM(md),editorElement.querySelectorAll(".vditor-wysiwyg__preview[data-render='2']").forEach((function(item){processCodeRender(item,vditor),item.previousElementSibling.setAttribute("style","display:none")})),afterRenderEvent(vditor,options)},cancelBES=function(range,vditor,commandName){for(var element=range.startContainer.parentElement,jump=!1,lastTagName="",lastEndTagName="",splitHTML=function(range){var previousHTML=getPreviousHTML(range.startContainer),nextHTML=getNextHTML(range.startContainer),text=range.startContainer.textContent,offset=range.startOffset,beforeHTML="",afterHTML="";return(""!==text.substr(0,offset)&&text.substr(0,offset)!==constants.Y.ZWSP||previousHTML)&&(beforeHTML="".concat(previousHTML).concat(text.substr(0,offset))),(""!==text.substr(offset)&&text.substr(offset)!==constants.Y.ZWSP||nextHTML)&&(afterHTML="".concat(text.substr(offset)).concat(nextHTML)),{afterHTML:afterHTML,beforeHTML:beforeHTML}}(range),lastBeforeHTML=splitHTML.beforeHTML,lastAfterHTML=splitHTML.afterHTML;element&&!jump;){var tagName=element.tagName;if("STRIKE"===tagName&&(tagName="S"),"I"===tagName&&(tagName="EM"),"B"===tagName&&(tagName="STRONG"),"S"===tagName||"STRONG"===tagName||"EM"===tagName){var insertHTML="",previousHTML="",nextHTML="";"0"!==element.parentElement.getAttribute("data-block")&&(previousHTML=getPreviousHTML(element),nextHTML=getNextHTML(element)),(lastBeforeHTML||previousHTML)&&(lastBeforeHTML=insertHTML="".concat(previousHTML,"<").concat(tagName,">").concat(lastBeforeHTML,"</").concat(tagName,">")),("bold"===commandName&&"STRONG"===tagName||"italic"===commandName&&"EM"===tagName||"strikeThrough"===commandName&&"S"===tagName)&&(insertHTML+="".concat(lastTagName).concat(constants.Y.ZWSP,"<wbr>").concat(lastEndTagName),jump=!0),(lastAfterHTML||nextHTML)&&(insertHTML+=lastAfterHTML="<".concat(tagName,">").concat(lastAfterHTML,"</").concat(tagName,">").concat(nextHTML)),"0"!==element.parentElement.getAttribute("data-block")?(element=element.parentElement).innerHTML=insertHTML:(element.outerHTML=insertHTML,element=element.parentElement),lastTagName="<".concat(tagName,">")+lastTagName,lastEndTagName="</".concat(tagName,">")+lastEndTagName}else jump=!0}(0,selection.ir)(vditor.wysiwyg.element,range)},MenuItem=function(){return function(vditor,menuItem){var _a,_this=this;this.element=document.createElement("div"),menuItem.className&&(_a=this.element.classList).add.apply(_a,menuItem.className.split(" "));var hotkey=menuItem.hotkey?" <".concat((0,compatibility.fG)(menuItem.hotkey),">"):"";2===menuItem.level&&(hotkey=menuItem.hotkey?" &lt;".concat((0,compatibility.fG)(menuItem.hotkey),"&gt;"):"");var tip=menuItem.tip?menuItem.tip+hotkey:"".concat(window.VditorI18n[menuItem.name]).concat(hotkey),tagName="upload"===menuItem.name?"div":"button";if(2===menuItem.level)this.element.innerHTML="<".concat(tagName,' data-type="').concat(menuItem.name,'">').concat(tip,"</").concat(tagName,">");else{this.element.classList.add("vditor-toolbar__item");var iconElement=document.createElement(tagName);iconElement.setAttribute("data-type",menuItem.name),iconElement.className="vditor-tooltipped vditor-tooltipped__".concat(menuItem.tipPosition),iconElement.setAttribute("aria-label",tip),iconElement.innerHTML=menuItem.icon,this.element.appendChild(iconElement)}menuItem.prefix&&this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){event.preventDefault(),_this.element.firstElementChild.classList.contains(constants.Y.CLASS_MENU_DISABLED)||("wysiwyg"===vditor.currentMode?function(vditor,actionBtn,event){if(!(vditor.wysiwyg.composingLock&&event instanceof CustomEvent)){var useHighlight=!0,useRender=!0;vditor.wysiwyg.element.querySelector("wbr")&&vditor.wysiwyg.element.querySelector("wbr").remove();var range=(0,selection.RN)(vditor),commandName=actionBtn.getAttribute("data-type");if(actionBtn.classList.contains("vditor-menu--current"))if("strike"===commandName&&(commandName="strikeThrough"),"quote"===commandName){var quoteElement=(0,hasClosest._Y)(range.startContainer,"BLOCKQUOTE");quoteElement||(quoteElement=range.startContainer.childNodes[range.startOffset]),quoteElement&&(useHighlight=!1,actionBtn.classList.remove("vditor-menu--current"),range.insertNode(document.createElement("wbr")),quoteElement.outerHTML=""===quoteElement.innerHTML.trim()?'<p data-block="0">'.concat(quoteElement.innerHTML,"</p>"):quoteElement.innerHTML,(0,selection.ir)(vditor.wysiwyg.element,range))}else if("inline-code"===commandName){var inlineCodeElement=(0,hasClosest._Y)(range.startContainer,"CODE");inlineCodeElement||(inlineCodeElement=range.startContainer.childNodes[range.startOffset]),inlineCodeElement&&(inlineCodeElement.outerHTML=inlineCodeElement.innerHTML.replace(constants.Y.ZWSP,"")+"<wbr>",(0,selection.ir)(vditor.wysiwyg.element,range))}else"link"===commandName?range.collapsed?(range.selectNode(range.startContainer.parentElement),document.execCommand("unlink",!1,"")):document.execCommand("unlink",!1,""):"check"===commandName||"list"===commandName||"ordered-list"===commandName?(listToggle(vditor,range,commandName),(0,selection.ir)(vditor.wysiwyg.element,range),useHighlight=!1,actionBtn.classList.remove("vditor-menu--current")):(useHighlight=!1,actionBtn.classList.remove("vditor-menu--current"),""===range.toString()?cancelBES(range,vditor,commandName):document.execCommand(commandName,!1,""));else{0===vditor.wysiwyg.element.childNodes.length&&(vditor.wysiwyg.element.innerHTML='<p data-block="0"><wbr></p>',(0,selection.ir)(vditor.wysiwyg.element,range));var blockElement=(0,hasClosest.pt)(range.startContainer);if("quote"===commandName){if(blockElement||(blockElement=range.startContainer.childNodes[range.startOffset]),blockElement){useHighlight=!1,actionBtn.classList.add("vditor-menu--current"),range.insertNode(document.createElement("wbr"));var liElement=(0,hasClosest._Y)(range.startContainer,"LI");liElement&&blockElement.contains(liElement)?liElement.innerHTML='<blockquote data-block="0">'.concat(liElement.innerHTML,"</blockquote>"):blockElement.outerHTML='<blockquote data-block="0">'.concat(blockElement.outerHTML,"</blockquote>"),(0,selection.ir)(vditor.wysiwyg.element,range)}}else if("check"===commandName||"list"===commandName||"ordered-list"===commandName)listToggle(vditor,range,commandName,!1),(0,selection.ir)(vditor.wysiwyg.element,range),useHighlight=!1,removeCurrentToolbar(vditor.toolbar.elements,["check","list","ordered-list"]),actionBtn.classList.add("vditor-menu--current");else if("inline-code"===commandName){if(""===range.toString())(node=document.createElement("code")).textContent=constants.Y.ZWSP,range.insertNode(node),range.setStart(node.firstChild,1),range.collapse(!0),(0,selection.jl)(range);else if(3===range.startContainer.nodeType){var node=document.createElement("code");range.surroundContents(node),range.insertNode(node),(0,selection.jl)(range)}actionBtn.classList.add("vditor-menu--current")}else if("code"===commandName)(node=document.createElement("div")).className="vditor-wysiwyg__block",node.setAttribute("data-type","code-block"),node.setAttribute("data-block","0"),node.setAttribute("data-marker","```"),""===range.toString()?node.innerHTML="<pre><code><wbr>\n</code></pre>":(node.innerHTML="<pre><code>".concat(range.toString(),"<wbr></code></pre>"),range.deleteContents()),range.insertNode(node),blockElement&&(blockElement.outerHTML=vditor.lute.SpinVditorDOM(blockElement.outerHTML)),(0,selection.ir)(vditor.wysiwyg.element,range),vditor.wysiwyg.element.querySelectorAll(".vditor-wysiwyg__preview[data-render='2']").forEach((function(item){processCodeRender(item,vditor)})),actionBtn.classList.add("vditor-menu--disabled");else if("link"===commandName){if(""===range.toString()){var aElement=document.createElement("a");aElement.innerText=constants.Y.ZWSP,range.insertNode(aElement),range.setStart(aElement.firstChild,1),range.collapse(!0),genAPopover(vditor,aElement,range);var textInputElement=vditor.wysiwyg.popover.querySelector("input");textInputElement.value="",textInputElement.focus(),useRender=!1}else{(node=document.createElement("a")).setAttribute("href",""),node.innerHTML=range.toString(),range.surroundContents(node),range.insertNode(node),(0,selection.jl)(range),genAPopover(vditor,node,range);var textInputElements=vditor.wysiwyg.popover.querySelectorAll("input");textInputElements[0].value=node.innerText,textInputElements[1].focus()}useHighlight=!1,actionBtn.classList.add("vditor-menu--current")}else if("table"===commandName){var tableHTML_1='<table data-block="0"><thead><tr><th>col1<wbr></th><th>col2</th><th>col3</th></tr></thead><tbody><tr><td> </td><td> </td><td> </td></tr><tr><td> </td><td> </td><td> </td></tr></tbody></table>';if(""===range.toString().trim())blockElement&&""===blockElement.innerHTML.trim().replace(constants.Y.ZWSP,"")?blockElement.outerHTML=tableHTML_1:document.execCommand("insertHTML",!1,tableHTML_1),range.selectNode(vditor.wysiwyg.element.querySelector("wbr").previousSibling),vditor.wysiwyg.element.querySelector("wbr").remove(),(0,selection.jl)(range);else{tableHTML_1='<table data-block="0"><thead><tr>';var tableText=range.toString().split("\n"),delimiter_1=tableText[0].split(",").length>tableText[0].split("\t").length?",":"\t";tableText.forEach((function(rows,index){0===index?(rows.split(delimiter_1).forEach((function(header,subIndex){tableHTML_1+="<th>".concat(header,0===subIndex?"<wbr></th>":"</th>")})),tableHTML_1+="</tr></thead>"):(tableHTML_1+=1===index?"<tbody><tr>":"<tr>",rows.split(delimiter_1).forEach((function(cell){tableHTML_1+="<td>".concat(cell,"</td>")})),tableHTML_1+="</tr>")})),tableHTML_1+="</tbody></table>",document.execCommand("insertHTML",!1,tableHTML_1),(0,selection.ir)(vditor.wysiwyg.element,range)}useHighlight=!1,actionBtn.classList.add("vditor-menu--disabled")}else if("line"===commandName){if(blockElement){var hrHTML='<hr data-block="0"><p data-block="0"><wbr>\n</p>';""===blockElement.innerHTML.trim()?blockElement.outerHTML=hrHTML:blockElement.insertAdjacentHTML("afterend",hrHTML),(0,selection.ir)(vditor.wysiwyg.element,range)}}else if(useHighlight=!1,actionBtn.classList.add("vditor-menu--current"),"strike"===commandName&&(commandName="strikeThrough"),""!==range.toString()||"bold"!==commandName&&"italic"!==commandName&&"strikeThrough"!==commandName)document.execCommand(commandName,!1,"");else{var tagName="strong";"italic"===commandName?tagName="em":"strikeThrough"===commandName&&(tagName="s"),(node=document.createElement(tagName)).textContent=constants.Y.ZWSP,range.insertNode(node),node.previousSibling&&node.previousSibling.textContent===constants.Y.ZWSP&&(node.previousSibling.textContent=""),range.setStart(node.firstChild,1),range.collapse(!0),(0,selection.jl)(range)}}useHighlight&&highlightToolbarWYSIWYG(vditor),useRender&&afterRenderEvent(vditor)}}(vditor,_this.element.children[0],event):"ir"===vditor.currentMode?process_processToolbar(vditor,_this.element.children[0],menuItem.prefix||"",menuItem.suffix||""):processToolbar(vditor,_this.element.children[0],menuItem.prefix||"",menuItem.suffix||""))}))}}(),__extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),setEditMode=function(vditor,type,event){var markdownText;if("string"!=typeof event?(hidePanel(vditor,["subToolbar","hint"]),event.preventDefault(),markdownText=getMarkdown(vditor)):markdownText=event,vditor.currentMode!==type||"string"==typeof event){if(vditor.devtools&&vditor.devtools.renderEchart(vditor),"both"===vditor.options.preview.mode&&"sv"===type?vditor.preview.element.style.display="block":vditor.preview.element.style.display="none",enableToolbar(vditor.toolbar.elements,constants.Y.EDIT_TOOLBARS),removeCurrentToolbar(vditor.toolbar.elements,constants.Y.EDIT_TOOLBARS),disableToolbar(vditor.toolbar.elements,["outdent","indent"]),"ir"===type)hideToolbar(vditor.toolbar.elements,["both"]),showToolbar(vditor.toolbar.elements,["outdent","indent","outline","insert-before","insert-after"]),vditor.sv.element.style.display="none",vditor.wysiwyg.element.parentElement.style.display="none",vditor.ir.element.parentElement.style.display="block",vditor.lute.SetVditorIR(!0),vditor.lute.SetVditorWYSIWYG(!1),vditor.lute.SetVditorSV(!1),vditor.currentMode="ir",vditor.ir.element.innerHTML=vditor.lute.Md2VditorIRDOM(markdownText),process_processAfterRender(vditor,{enableAddUndoStack:!0,enableHint:!1,enableInput:!1}),setPadding(vditor),vditor.ir.element.querySelectorAll(".vditor-ir__preview[data-render='2']").forEach((function(item){processCodeRender(item,vditor)})),vditor.ir.element.querySelectorAll(".vditor-toc").forEach((function(item){(0,mathRender.T)(item,{cdn:vditor.options.cdn,math:vditor.options.preview.math})}));else if("wysiwyg"===type)hideToolbar(vditor.toolbar.elements,["both"]),showToolbar(vditor.toolbar.elements,["outdent","indent","outline","insert-before","insert-after"]),vditor.sv.element.style.display="none",vditor.wysiwyg.element.parentElement.style.display="block",vditor.ir.element.parentElement.style.display="none",vditor.lute.SetVditorIR(!1),vditor.lute.SetVditorWYSIWYG(!0),vditor.lute.SetVditorSV(!1),vditor.currentMode="wysiwyg",setPadding(vditor),renderDomByMd(vditor,markdownText,{enableAddUndoStack:!0,enableHint:!1,enableInput:!1}),vditor.wysiwyg.element.querySelectorAll(".vditor-toc").forEach((function(item){(0,mathRender.T)(item,{cdn:vditor.options.cdn,math:vditor.options.preview.math})})),vditor.wysiwyg.popover.style.display="none";else if("sv"===type){showToolbar(vditor.toolbar.elements,["both"]),hideToolbar(vditor.toolbar.elements,["outdent","indent","outline","insert-before","insert-after"]),vditor.wysiwyg.element.parentElement.style.display="none",vditor.ir.element.parentElement.style.display="none",("both"===vditor.options.preview.mode||"editor"===vditor.options.preview.mode)&&(vditor.sv.element.style.display="block"),vditor.lute.SetVditorIR(!1),vditor.lute.SetVditorWYSIWYG(!1),vditor.lute.SetVditorSV(!0),vditor.currentMode="sv";var svHTML=processSpinVditorSVDOM(markdownText,vditor);"<div data-block='0'></div>"===svHTML&&(svHTML=""),vditor.sv.element.innerHTML=svHTML,combineFootnote(vditor.sv.element),processAfterRender(vditor,{enableAddUndoStack:!0,enableHint:!1,enableInput:!1}),setPadding(vditor)}vditor.undo.resetIcon(vditor),"string"!=typeof event&&(vditor[vditor.currentMode].element.focus(),highlightToolbar(vditor)),renderToc(vditor),setTypewriterPosition(vditor),vditor.toolbar.elements["edit-mode"]&&(vditor.toolbar.elements["edit-mode"].querySelectorAll("button").forEach((function(item){item.classList.remove("vditor-menu--current")})),vditor.toolbar.elements["edit-mode"].querySelector('button[data-mode="'.concat(vditor.currentMode,'"]')).classList.add("vditor-menu--current")),vditor.outline.toggle(vditor,"sv"!==vditor.currentMode&&vditor.options.outline.enable,"string"!=typeof event)}},EditMode=function(_super){function EditMode2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this,panelElement=document.createElement("div");return panelElement.className="vditor-hint".concat(2===menuItem.level?"":" vditor-panel--arrow"),panelElement.innerHTML='<button data-mode="wysiwyg">'.concat(window.VditorI18n.wysiwyg," &lt;").concat((0,compatibility.fG)("⌥⌘7"),'></button>\n<button data-mode="ir">').concat(window.VditorI18n.instantRendering," &lt;").concat((0,compatibility.fG)("⌥⌘8"),'></button>\n<button data-mode="sv">').concat(window.VditorI18n.splitView," &lt;").concat((0,compatibility.fG)("⌥⌘9"),"></button>"),_this.element.appendChild(panelElement),_this._bindEvent(vditor,panelElement,menuItem),_this}return __extends(EditMode2,_super),EditMode2.prototype._bindEvent=function(vditor,panelElement,menuItem){var actionBtn=this.element.children[0];toggleSubMenu(vditor,panelElement,actionBtn,menuItem.level),panelElement.children.item(0).addEventListener((0,compatibility.y3)(),(function(event){setEditMode(vditor,"wysiwyg",event),event.preventDefault(),event.stopPropagation()})),panelElement.children.item(1).addEventListener((0,compatibility.y3)(),(function(event){setEditMode(vditor,"ir",event),event.preventDefault(),event.stopPropagation()})),panelElement.children.item(2).addEventListener((0,compatibility.y3)(),(function(event){setEditMode(vditor,"sv",event),event.preventDefault(),event.stopPropagation()}))},EditMode2}(MenuItem),getSelectText=function(editor,range){return(0,selection.Co)(editor,range)?getSelection().toString():""},focusEvent=function(vditor,editorElement){editorElement.addEventListener("focus",(function(){vditor.options.focus&&vditor.options.focus(getMarkdown(vditor)),hidePanel(vditor,["subToolbar","hint"])}))},dblclickEvent=function(vditor,editorElement){editorElement.addEventListener("dblclick",(function(event){"IMG"===event.target.tagName&&(vditor.options.image.preview?vditor.options.image.preview(event.target):vditor.options.image.isPreview&&(0,preview_image.o)(event.target,vditor.options.lang,vditor.options.theme))}))},blurEvent=function(vditor,editorElement){editorElement.addEventListener("blur",(function(event){if("ir"===vditor.currentMode){var expandElement=vditor.ir.element.querySelector(".vditor-ir__node--expand");expandElement&&expandElement.classList.remove("vditor-ir__node--expand")}else"wysiwyg"!==vditor.currentMode||vditor.wysiwyg.selectPopover.contains(event.relatedTarget)||vditor.wysiwyg.hideComment();vditor[vditor.currentMode].range=(0,selection.RN)(vditor),vditor.options.blur&&vditor.options.blur(getMarkdown(vditor))}))},dropEvent=function(vditor,editorElement){editorElement.addEventListener("dragstart",(function(event){event.dataTransfer.setData(constants.Y.DROP_EDITOR,constants.Y.DROP_EDITOR)})),editorElement.addEventListener("drop",(function(event){event.dataTransfer.getData(constants.Y.DROP_EDITOR)?execAfterRender(vditor):(event.dataTransfer.types.includes("Files")||event.dataTransfer.types.includes("text/html"))&&paste(vditor,event,{pasteCode:function(code){document.execCommand("insertHTML",!1,code)}})}))},copyEvent=function(vditor,editorElement,copy){editorElement.addEventListener("copy",(function(event){return copy(event,vditor)}))},cutEvent=function(vditor,editorElement,copy){editorElement.addEventListener("cut",(function(event){copy(event,vditor),vditor.options.comment.enable&&"wysiwyg"===vditor.currentMode&&vditor.wysiwyg.getComments(vditor),document.execCommand("delete")}))},scrollCenter=function(vditor){if("wysiwyg"===vditor.currentMode&&vditor.options.comment.enable&&vditor.options.comment.adjustTop(vditor.wysiwyg.getComments(vditor,!0)),vditor.options.typewriterMode){var editorElement=vditor[vditor.currentMode].element,cursorTop=(0,selection.Ey)(editorElement).top;"auto"!==vditor.options.height||vditor.element.classList.contains("vditor--fullscreen")||window.scrollTo(window.scrollX,cursorTop+vditor.element.offsetTop+vditor.toolbar.element.offsetHeight-window.innerHeight/2+10),("auto"!==vditor.options.height||vditor.element.classList.contains("vditor--fullscreen"))&&(editorElement.scrollTop=cursorTop+editorElement.scrollTop-editorElement.clientHeight/2+10)}},hotkeyEvent=function(vditor,editorElement){editorElement.addEventListener("keydown",(function(event){if(!event.isComposing&&vditor.options.keydown&&vditor.options.keydown(event),!(vditor.options.hint.extend.length>1||vditor.toolbar.elements.emoji)||!vditor.hint.select(event,vditor)){if(vditor.options.comment.enable&&"wysiwyg"===vditor.currentMode&&("Backspace"===event.key||matchHotKey("⌘X",event))&&vditor.wysiwyg.getComments(vditor),"sv"===vditor.currentMode){if(function(vditor,event){var _a,_b,_c,_d,_e;if(vditor.sv.composingLock=event.isComposing,event.isComposing)return!1;if(-1!==event.key.indexOf("Arrow")||"Meta"===event.key||"Control"===event.key||"Alt"===event.key||"Shift"===event.key||"CapsLock"===event.key||"Escape"===event.key||/^F\d{1,2}$/.test(event.key)||vditor.undo.recordFirstPosition(vditor,event),"Enter"!==event.key&&"Tab"!==event.key&&"Backspace"!==event.key&&-1===event.key.indexOf("Arrow")&&!(0,compatibility._0)(event)&&"Escape"!==event.key)return!1;var range=(0,selection.RN)(vditor),startContainer=range.startContainer;3!==range.startContainer.nodeType&&"DIV"===range.startContainer.tagName&&(startContainer=range.startContainer.childNodes[range.startOffset-1]);var textElement=(0,hasClosest.Th)(startContainer,"data-type","text"),blockquoteMarkerElement=(0,hasClosest.Th)(startContainer,"data-type","blockquote-marker");if(!blockquoteMarkerElement&&0===range.startOffset&&textElement&&textElement.previousElementSibling&&"blockquote-marker"===textElement.previousElementSibling.getAttribute("data-type")&&(blockquoteMarkerElement=textElement.previousElementSibling),blockquoteMarkerElement&&"Enter"===event.key&&!(0,compatibility._0)(event)&&!event.altKey&&""===blockquoteMarkerElement.nextElementSibling.textContent.trim()&&(0,selection.ED)(blockquoteMarkerElement,vditor.sv.element,range).start===blockquoteMarkerElement.textContent.length)return"padding"===(null===(_a=blockquoteMarkerElement.previousElementSibling)||void 0===_a?void 0:_a.getAttribute("data-type"))&&blockquoteMarkerElement.previousElementSibling.setAttribute("data-action","enter-remove"),blockquoteMarkerElement.remove(),processAfterRender(vditor),event.preventDefault(),!0;var listMarkerElement=(0,hasClosest.Th)(startContainer,"data-type","li-marker"),taskMarkerElement=(0,hasClosest.Th)(startContainer,"data-type","task-marker"),listLastMarkerElement=listMarkerElement;if(listLastMarkerElement||taskMarkerElement&&"task-marker"!==taskMarkerElement.nextElementSibling.getAttribute("data-type")&&(listLastMarkerElement=taskMarkerElement),listLastMarkerElement||0!==range.startOffset||!textElement||!textElement.previousElementSibling||"li-marker"!==textElement.previousElementSibling.getAttribute("data-type")&&"task-marker"!==textElement.previousElementSibling.getAttribute("data-type")||(listLastMarkerElement=textElement.previousElementSibling),listLastMarkerElement){var startIndex=(0,selection.ED)(listLastMarkerElement,vditor.sv.element,range).start,isTask="task-marker"===listLastMarkerElement.getAttribute("data-type"),listFirstMarkerElement=listLastMarkerElement;if(isTask&&(listFirstMarkerElement=listLastMarkerElement.previousElementSibling.previousElementSibling.previousElementSibling),startIndex===listLastMarkerElement.textContent.length){if("Enter"===event.key&&!(0,compatibility._0)(event)&&!event.altKey&&!event.shiftKey&&""===listLastMarkerElement.nextElementSibling.textContent.trim())return"padding"===(null===(_b=listFirstMarkerElement.previousElementSibling)||void 0===_b?void 0:_b.getAttribute("data-type"))?(listFirstMarkerElement.previousElementSibling.remove(),inputEvent(vditor)):(isTask&&(listFirstMarkerElement.remove(),listLastMarkerElement.previousElementSibling.previousElementSibling.remove(),listLastMarkerElement.previousElementSibling.remove()),listLastMarkerElement.nextElementSibling.remove(),listLastMarkerElement.remove(),processAfterRender(vditor)),event.preventDefault(),!0;if("Tab"===event.key)return event.shiftKey?"padding"===listFirstMarkerElement.previousElementSibling.getAttribute("data-type")&&listFirstMarkerElement.previousElementSibling.remove():listFirstMarkerElement.insertAdjacentHTML("beforebegin",'<span data-type="padding">'.concat(listFirstMarkerElement.textContent.replace(/\S/g," "),"</span>")),/^\d/.test(listFirstMarkerElement.textContent)&&(listFirstMarkerElement.textContent=listFirstMarkerElement.textContent.replace(/^\d{1,}/,"1"),range.selectNodeContents(listLastMarkerElement.firstChild),range.collapse(!1)),inputEvent(vditor),event.preventDefault(),!0}}if(fixTab(vditor,range,event))return!0;var blockElement=(0,hasClosest.Th)(startContainer,"data-block","0"),spanElement=(0,hasClosestByHeadings.f)(startContainer,"SPAN");if("Enter"===event.key&&!(0,compatibility._0)(event)&&!event.altKey&&!event.shiftKey&&blockElement){var isFirst=!1,newLineMatch=blockElement.textContent.match(/^\n+/);(0,selection.ED)(blockElement,vditor.sv.element).start<=(newLineMatch?newLineMatch[0].length:0)&&(isFirst=!0);var newLineText="\n";if(spanElement){if("enter-remove"===(null===(_c=spanElement.previousElementSibling)||void 0===_c?void 0:_c.getAttribute("data-action")))return spanElement.previousElementSibling.remove(),processAfterRender(vditor),event.preventDefault(),!0;newLineText+=processPreviousMarkers(spanElement)}return range.insertNode(document.createTextNode(newLineText)),range.collapse(!1),blockElement&&""!==blockElement.textContent.trim()&&!isFirst?inputEvent(vditor):processAfterRender(vditor),event.preventDefault(),!0}if("Backspace"===event.key&&!(0,compatibility._0)(event)&&!event.altKey&&!event.shiftKey){if(spanElement&&"newline"===(null===(_d=spanElement.previousElementSibling)||void 0===_d?void 0:_d.getAttribute("data-type"))&&1===(0,selection.ED)(spanElement,vditor.sv.element,range).start&&-1===spanElement.getAttribute("data-type").indexOf("code-block-"))return range.setStart(spanElement,0),range.extractContents(),""!==spanElement.textContent.trim()?inputEvent(vditor):processAfterRender(vditor),event.preventDefault(),!0;if(blockElement&&0===(0,selection.ED)(blockElement,vditor.sv.element,range).start&&blockElement.previousElementSibling){range.extractContents();var previousLastElement=blockElement.previousElementSibling.lastElementChild;return"newline"===previousLastElement.getAttribute("data-type")&&(previousLastElement.remove(),previousLastElement=blockElement.previousElementSibling.lastElementChild),"newline"!==previousLastElement.getAttribute("data-type")&&(previousLastElement.insertAdjacentHTML("afterend",blockElement.innerHTML),blockElement.remove()),""===blockElement.textContent.trim()||(null===(_e=blockElement.previousElementSibling)||void 0===_e?void 0:_e.querySelector('[data-type="code-block-open-marker"]'))?("newline"!==previousLastElement.getAttribute("data-type")&&(range.selectNodeContents(previousLastElement.lastChild),range.collapse(!1)),processAfterRender(vditor)):inputEvent(vditor),event.preventDefault(),!0}}return!1}(vditor,event))return}else if("wysiwyg"===vditor.currentMode){if(function(vditor,event){if(vditor.wysiwyg.composingLock=event.isComposing,event.isComposing)return!1;-1!==event.key.indexOf("Arrow")||"Meta"===event.key||"Control"===event.key||"Alt"===event.key||"Shift"===event.key||"CapsLock"===event.key||"Escape"===event.key||/^F\d{1,2}$/.test(event.key)||vditor.undo.recordFirstPosition(vditor,event);var range=(0,selection.RN)(vditor),startContainer=range.startContainer;if(!fixGSKeyBackspace(event,vditor,startContainer))return!1;if(fixCJKPosition(range,vditor,event),fixHR(range),"Enter"!==event.key&&"Tab"!==event.key&&"Backspace"!==event.key&&-1===event.key.indexOf("Arrow")&&!(0,compatibility._0)(event)&&"Escape"!==event.key&&"Delete"!==event.key)return!1;var blockElement=(0,hasClosest.pt)(startContainer),pElement=(0,hasClosest._Y)(startContainer,"P");if(fixMarkdown(event,vditor,pElement,range))return!0;if(fixList(range,vditor,pElement,event))return!0;if(fixTable(vditor,event,range))return!0;var codeRenderElement=(0,hasClosest.KJ)(startContainer,"vditor-wysiwyg__block");if(codeRenderElement){if("Escape"===event.key&&2===codeRenderElement.children.length)return vditor.wysiwyg.popover.style.display="none",codeRenderElement.firstElementChild.style.display="none",vditor.wysiwyg.element.blur(),event.preventDefault(),!0;if(!(0,compatibility._0)(event)&&!event.shiftKey&&event.altKey&&"Enter"===event.key&&"code-block"===codeRenderElement.getAttribute("data-type")){var inputElemment=vditor.wysiwyg.popover.querySelector(".vditor-input");return inputElemment.focus(),inputElemment.select(),event.preventDefault(),!0}if("0"===codeRenderElement.getAttribute("data-block")){if(fixCodeBlock(vditor,event,codeRenderElement.firstElementChild,range))return!0;if(insertAfterBlock(vditor,event,range,codeRenderElement.firstElementChild,codeRenderElement))return!0;if("yaml-front-matter"!==codeRenderElement.getAttribute("data-type")&&insertBeforeBlock(vditor,event,range,codeRenderElement.firstElementChild,codeRenderElement))return!0}}if(fixBlockquote(vditor,range,event,pElement))return!0;var topBQElement=(0,hasClosest.Ab)(startContainer,"BLOCKQUOTE");if(topBQElement&&!event.shiftKey&&event.altKey&&"Enter"===event.key){(0,compatibility._0)(event)?range.setStartBefore(topBQElement):range.setStartAfter(topBQElement),(0,selection.jl)(range);var node=document.createElement("p");return node.setAttribute("data-block","0"),node.innerHTML="\n",range.insertNode(node),range.collapse(!0),(0,selection.jl)(range),afterRenderEvent(vditor),scrollCenter(vditor),event.preventDefault(),!0}var itemElement,headingElement=(0,hasClosestByHeadings.c)(startContainer);if(headingElement){if("H6"===headingElement.tagName&&startContainer.textContent.length===range.startOffset&&!(0,compatibility._0)(event)&&!event.shiftKey&&!event.altKey&&"Enter"===event.key){var pTempElement=document.createElement("p");return pTempElement.textContent="\n",pTempElement.setAttribute("data-block","0"),startContainer.parentElement.insertAdjacentElement("afterend",pTempElement),range.setStart(pTempElement,0),(0,selection.jl)(range),afterRenderEvent(vditor),scrollCenter(vditor),event.preventDefault(),!0}var index;if(matchHotKey("⌘=",event))return(index=parseInt(headingElement.tagName.substr(1),10)-1)>0&&(setHeading(vditor,"h".concat(index)),afterRenderEvent(vditor)),event.preventDefault(),!0;if(matchHotKey("⌘-",event))return(index=parseInt(headingElement.tagName.substr(1),10)+1)<7&&(setHeading(vditor,"h".concat(index)),afterRenderEvent(vditor)),event.preventDefault(),!0;"Backspace"!==event.key||(0,compatibility._0)(event)||event.shiftKey||event.altKey||1!==headingElement.textContent.length||removeHeading(vditor)}if(fixTask(vditor,range,event))return!0;if(event.altKey&&"Enter"===event.key&&!(0,compatibility._0)(event)&&!event.shiftKey){var aElement=(0,hasClosest._Y)(startContainer,"A"),linRefElement=(0,hasClosest.Th)(startContainer,"data-type","link-ref"),footnoteRefElement=(0,hasClosest.Th)(startContainer,"data-type","footnotes-ref");if(aElement||linRefElement||footnoteRefElement||headingElement&&2===headingElement.tagName.length){var inputElement=vditor.wysiwyg.popover.querySelector("input");inputElement.focus(),inputElement.select()}}if(removeBlockElement(vditor,event))return!0;if(matchHotKey("⇧⌘U",event)&&(itemElement=vditor.wysiwyg.popover.querySelector('[data-type="up"]')))return itemElement.click(),event.preventDefault(),!0;if(matchHotKey("⇧⌘D",event)&&(itemElement=vditor.wysiwyg.popover.querySelector('[data-type="down"]')))return itemElement.click(),event.preventDefault(),!0;if(fixTab(vditor,range,event))return!0;if(!(0,compatibility._0)(event)&&event.shiftKey&&!event.altKey&&"Enter"===event.key&&"LI"!==startContainer.parentElement.tagName&&"P"!==startContainer.parentElement.tagName)return["STRONG","STRIKE","S","I","EM","B"].includes(startContainer.parentElement.tagName)?range.insertNode(document.createTextNode("\n"+constants.Y.ZWSP)):range.insertNode(document.createTextNode("\n")),range.collapse(!1),(0,selection.jl)(range),afterRenderEvent(vditor),scrollCenter(vditor),event.preventDefault(),!0;if("Backspace"===event.key&&!(0,compatibility._0)(event)&&!event.shiftKey&&!event.altKey&&""===range.toString()){if(fixDelete(vditor,range,event,pElement))return!0;if(blockElement){if(blockElement.previousElementSibling&&blockElement.previousElementSibling.classList.contains("vditor-wysiwyg__block")&&"0"===blockElement.previousElementSibling.getAttribute("data-block")&&"UL"!==blockElement.tagName&&"OL"!==blockElement.tagName){var rangeStart=(0,selection.ED)(blockElement,vditor.wysiwyg.element,range).start;if(0===rangeStart&&0===range.startOffset||1===rangeStart&&blockElement.innerText.startsWith(constants.Y.ZWSP))return showCode(blockElement.previousElementSibling.lastElementChild,vditor,!1),""===blockElement.innerHTML.trim().replace(constants.Y.ZWSP,"")&&(blockElement.remove(),afterRenderEvent(vditor)),event.preventDefault(),!0}var rangeStartOffset=range.startOffset;if(""===range.toString()&&3===startContainer.nodeType&&"\n"===startContainer.textContent.charAt(rangeStartOffset-2)&&startContainer.textContent.charAt(rangeStartOffset-1)!==constants.Y.ZWSP&&["STRONG","STRIKE","S","I","EM","B"].includes(startContainer.parentElement.tagName))return startContainer.textContent=startContainer.textContent.substring(0,rangeStartOffset-1)+constants.Y.ZWSP,range.setStart(startContainer,rangeStartOffset),range.collapse(!0),afterRenderEvent(vditor),event.preventDefault(),!0;startContainer.textContent===constants.Y.ZWSP&&1===range.startOffset&&!startContainer.previousSibling&&function(range){for(var nextNode=range.startContainer.nextSibling;nextNode&&""===nextNode.textContent;)nextNode=nextNode.nextSibling;return!(!nextNode||3===nextNode.nodeType||"CODE"!==nextNode.tagName&&"math-inline"!==nextNode.getAttribute("data-type")&&"html-entity"!==nextNode.getAttribute("data-type")&&"html-inline"!==nextNode.getAttribute("data-type"))}(range)&&(startContainer.textContent=""),blockElement.querySelectorAll("span.vditor-wysiwyg__block[data-type='math-inline']").forEach((function(item){item.firstElementChild.style.display="inline",item.lastElementChild.style.display="none"})),blockElement.querySelectorAll("span.vditor-wysiwyg__block[data-type='html-entity']").forEach((function(item){item.firstElementChild.style.display="inline",item.lastElementChild.style.display="none"}))}}if((0,compatibility.gm)()&&1===range.startOffset&&startContainer.textContent.indexOf(constants.Y.ZWSP)>-1&&startContainer.previousSibling&&3!==startContainer.previousSibling.nodeType&&"CODE"===startContainer.previousSibling.tagName&&("Backspace"===event.key||"ArrowLeft"===event.key))return range.selectNodeContents(startContainer.previousSibling),range.collapse(!1),event.preventDefault(),!0;if(fixFirefoxArrowUpTable(event,blockElement,range))return event.preventDefault(),!0;if(fixCursorDownInlineMath(range,event.key),"ArrowDown"===event.key){var nextElement=startContainer.nextSibling;nextElement&&3!==nextElement.nodeType&&"math-inline"===nextElement.getAttribute("data-type")&&range.setStartAfter(nextElement)}return!(!blockElement||!keydownToc(blockElement,vditor,event,range)||(event.preventDefault(),0))}(vditor,event))return}else if("ir"===vditor.currentMode&&function(vditor,event){if(vditor.ir.composingLock=event.isComposing,event.isComposing)return!1;-1!==event.key.indexOf("Arrow")||"Meta"===event.key||"Control"===event.key||"Alt"===event.key||"Shift"===event.key||"CapsLock"===event.key||"Escape"===event.key||/^F\d{1,2}$/.test(event.key)||vditor.undo.recordFirstPosition(vditor,event);var range=(0,selection.RN)(vditor),startContainer=range.startContainer;if(!fixGSKeyBackspace(event,vditor,startContainer))return!1;if(fixCJKPosition(range,vditor,event),fixHR(range),"Enter"!==event.key&&"Tab"!==event.key&&"Backspace"!==event.key&&-1===event.key.indexOf("Arrow")&&!(0,compatibility._0)(event)&&"Escape"!==event.key&&"Delete"!==event.key)return!1;var newlineElement=(0,hasClosest.Th)(startContainer,"data-newline","1");if(!(0,compatibility._0)(event)&&!event.altKey&&!event.shiftKey&&"Enter"===event.key&&newlineElement&&range.startOffset<newlineElement.textContent.length){var beforeMarkerElement=newlineElement.previousElementSibling;beforeMarkerElement&&(range.insertNode(document.createTextNode(beforeMarkerElement.textContent)),range.collapse(!1));var afterMarkerElement=newlineElement.nextSibling;afterMarkerElement&&(range.insertNode(document.createTextNode(afterMarkerElement.textContent)),range.collapse(!0))}var pElement=(0,hasClosest._Y)(startContainer,"P");if(fixMarkdown(event,vditor,pElement,range))return!0;if(fixList(range,vditor,pElement,event))return!0;if(fixBlockquote(vditor,range,event,pElement))return!0;var preRenderElement=(0,hasClosest.KJ)(startContainer,"vditor-ir__marker--pre");if(preRenderElement&&"PRE"===preRenderElement.tagName){var codeRenderElement=preRenderElement.firstChild;if(fixCodeBlock(vditor,event,preRenderElement,range))return!0;if(("math-block"===codeRenderElement.getAttribute("data-type")||"html-block"===codeRenderElement.getAttribute("data-type"))&&insertBeforeBlock(vditor,event,range,codeRenderElement,preRenderElement.parentElement))return!0;if(insertAfterBlock(vditor,event,range,codeRenderElement,preRenderElement.parentElement))return!0}var preBeforeElement=(0,hasClosest.Th)(startContainer,"data-type","code-block-info");if(preBeforeElement){if("Enter"===event.key||"Tab"===event.key)return range.selectNodeContents(preBeforeElement.nextElementSibling.firstChild),range.collapse(!0),event.preventDefault(),hidePanel(vditor,["hint"]),!0;if("Backspace"===event.key){var start=(0,selection.ED)(preBeforeElement,vditor.ir.element).start;1===start&&range.setStart(startContainer,0),2===start&&(vditor.hint.recentLanguage="")}if(insertBeforeBlock(vditor,event,range,preBeforeElement,preBeforeElement.parentElement))return hidePanel(vditor,["hint"]),!0}var cellElement=(0,hasClosest._Y)(startContainer,"TD")||(0,hasClosest._Y)(startContainer,"TH");if(event.key.indexOf("Arrow")>-1&&cellElement){var tableElement=isFirstCell(cellElement);if(tableElement&&insertBeforeBlock(vditor,event,range,cellElement,tableElement))return!0;var table2Element=isLastCell(cellElement);if(table2Element&&insertAfterBlock(vditor,event,range,cellElement,table2Element))return!0}if(fixTable(vditor,event,range))return!0;if(fixTask(vditor,range,event))return!0;if(fixTab(vditor,range,event))return!0;var headingElement=(0,hasClosestByHeadings.c)(startContainer);if(headingElement){var headingMarkerElement;if(matchHotKey("⌘=",event))return(headingMarkerElement=headingElement.querySelector(".vditor-ir__marker--heading"))&&headingMarkerElement.textContent.trim().length>1&&process_processHeading(vditor,headingMarkerElement.textContent.substr(1)),event.preventDefault(),!0;if(matchHotKey("⌘-",event))return(headingMarkerElement=headingElement.querySelector(".vditor-ir__marker--heading"))&&headingMarkerElement.textContent.trim().length<6&&process_processHeading(vditor,headingMarkerElement.textContent.trim()+"# "),event.preventDefault(),!0}var blockElement=(0,hasClosest.pt)(startContainer);if("Backspace"===event.key&&!(0,compatibility._0)(event)&&!event.shiftKey&&!event.altKey&&""===range.toString()){if(fixDelete(vditor,range,event,pElement))return!0;if(blockElement&&blockElement.previousElementSibling&&"UL"!==blockElement.tagName&&"OL"!==blockElement.tagName&&("code-block"===blockElement.previousElementSibling.getAttribute("data-type")||"math-block"===blockElement.previousElementSibling.getAttribute("data-type"))){var rangeStart=(0,selection.ED)(blockElement,vditor.ir.element,range).start;if(0===rangeStart||1===rangeStart&&blockElement.innerText.startsWith(constants.Y.ZWSP))return range.selectNodeContents(blockElement.previousElementSibling.querySelector(".vditor-ir__marker--pre code")),range.collapse(!1),expandMarker(range,vditor),""===blockElement.textContent.trim().replace(constants.Y.ZWSP,"")&&(blockElement.remove(),process_processAfterRender(vditor)),event.preventDefault(),!0}if(headingElement){var headingLength=headingElement.firstElementChild.textContent.length;(0,selection.ED)(headingElement,vditor.ir.element).start===headingLength&&0!==headingLength&&(range.setStart(headingElement.firstElementChild.firstChild,headingLength-1),range.collapse(!0),(0,selection.jl)(range))}}return!(("ArrowUp"!==event.key&&"ArrowDown"!==event.key||!blockElement||(blockElement.querySelectorAll(".vditor-ir__node").forEach((function(item){item.contains(startContainer)||item.classList.add("vditor-ir__node--hidden")})),!fixFirefoxArrowUpTable(event,blockElement,range)))&&(fixCursorDownInlineMath(range,event.key),!blockElement||!keydownToc(blockElement,vditor,event,range)||(event.preventDefault(),0)))}(vditor,event))return;if(vditor.options.ctrlEnter&&matchHotKey("⌘Enter",event))return vditor.options.ctrlEnter(getMarkdown(vditor)),void event.preventDefault();if(matchHotKey("⌘Z",event)&&!vditor.toolbar.elements.undo)return vditor.undo.undo(vditor),void event.preventDefault();if(matchHotKey("⌘Y",event)&&!vditor.toolbar.elements.redo)return vditor.undo.redo(vditor),void event.preventDefault();if("Escape"===event.key)return"block"===vditor.hint.element.style.display?vditor.hint.element.style.display="none":vditor.options.esc&&!event.isComposing&&vditor.options.esc(getMarkdown(vditor)),void event.preventDefault();if((0,compatibility._0)(event)&&event.altKey&&!event.shiftKey&&/^Digit[1-6]$/.test(event.code)){if("wysiwyg"===vditor.currentMode){var tagName=event.code.replace("Digit","H");(0,hasClosest._Y)(getSelection().getRangeAt(0).startContainer,tagName)?removeHeading(vditor):setHeading(vditor,tagName),afterRenderEvent(vditor)}else"sv"===vditor.currentMode?processHeading(vditor,"#".repeat(parseInt(event.code.replace("Digit",""),10))+" "):"ir"===vditor.currentMode&&process_processHeading(vditor,"#".repeat(parseInt(event.code.replace("Digit",""),10))+" ");return event.preventDefault(),!0}if((0,compatibility._0)(event)&&event.altKey&&!event.shiftKey&&/^Digit[7-9]$/.test(event.code))return"Digit7"===event.code?setEditMode(vditor,"wysiwyg",event):"Digit8"===event.code?setEditMode(vditor,"ir",event):"Digit9"===event.code&&setEditMode(vditor,"sv",event),!0;vditor.options.toolbar.find((function(menuItem){return!menuItem.hotkey||menuItem.toolbar?!!menuItem.toolbar&&!!menuItem.toolbar.find((function(subMenuItem){return!!subMenuItem.hotkey&&(matchHotKey(subMenuItem.hotkey,event)?(vditor.toolbar.elements[subMenuItem.name].children[0].dispatchEvent(new CustomEvent((0,compatibility.y3)())),event.preventDefault(),!0):void 0)})):matchHotKey(menuItem.hotkey,event)?(vditor.toolbar.elements[menuItem.name].children[0].dispatchEvent(new CustomEvent((0,compatibility.y3)())),event.preventDefault(),!0):void 0}))}}))},selectEvent=function(vditor,editorElement){editorElement.addEventListener("selectstart",(function(event){editorElement.onmouseup=function(){setTimeout((function(){var selectText=getSelectText(vditor[vditor.currentMode].element);selectText.trim()?("wysiwyg"===vditor.currentMode&&vditor.options.comment.enable&&((0,hasClosest.Th)(event.target,"data-type","footnotes-block")||(0,hasClosest.Th)(event.target,"data-type","link-ref-defs-block")?vditor.wysiwyg.hideComment():vditor.wysiwyg.showComment()),vditor.options.select&&vditor.options.select(selectText)):"wysiwyg"===vditor.currentMode&&vditor.options.comment.enable&&vditor.wysiwyg.hideComment()}))}}))},processPaste=function(vditor,text){var range=(0,selection.RN)(vditor);range.extractContents(),range.insertNode(document.createTextNode(Lute.Caret)),range.insertNode(document.createTextNode(text));var blockElement=(0,hasClosest.Th)(range.startContainer,"data-block","0");blockElement||(blockElement=vditor.sv.element);var spinHTML=vditor.lute.SpinVditorSVDOM(blockElement.textContent);spinHTML="<div data-block='0'>"+spinHTML.replace(/<span data-type="newline"><br \/><span style="display: none">\n<\/span><\/span><span data-type="newline"><br \/><span style="display: none">\n<\/span><\/span></g,'<span data-type="newline"><br /><span style="display: none">\n</span></span><span data-type="newline"><br /><span style="display: none">\n</span></span></div><div data-block="0"><')+"</div>",blockElement.isEqualNode(vditor.sv.element)?blockElement.innerHTML=spinHTML:blockElement.outerHTML=spinHTML,combineFootnote(vditor.sv.element),(0,selection.ir)(vditor.sv.element,range),scrollCenter(vditor)},getSideByType=function(spanNode,type,isPrevious){void 0===isPrevious&&(isPrevious=!0);var sideElement=spanNode;for(3===sideElement.nodeType&&(sideElement=sideElement.parentElement);sideElement;){if(sideElement.getAttribute("data-type")===type)return sideElement;sideElement=isPrevious?sideElement.previousElementSibling:sideElement.nextElementSibling}return!1},processSpinVditorSVDOM=function(html,vditor){return log("SpinVditorSVDOM",html,"argument",vditor.options.debugger),html="<div data-block='0'>"+vditor.lute.SpinVditorSVDOM(html).replace(/<span data-type="newline"><br \/><span style="display: none">\n<\/span><\/span><span data-type="newline"><br \/><span style="display: none">\n<\/span><\/span></g,'<span data-type="newline"><br /><span style="display: none">\n</span></span><span data-type="newline"><br /><span style="display: none">\n</span></span></div><div data-block="0"><')+"</div>",log("SpinVditorSVDOM",html,"result",vditor.options.debugger),html},processPreviousMarkers=function(spanElement){var spanType=spanElement.getAttribute("data-type"),previousElement=spanElement.previousElementSibling,markerText=spanType&&"text"!==spanType&&"table"!==spanType&&"heading-marker"!==spanType&&"newline"!==spanType&&"yaml-front-matter-open-marker"!==spanType&&"yaml-front-matter-close-marker"!==spanType&&"code-block-info"!==spanType&&"code-block-close-marker"!==spanType&&"code-block-open-marker"!==spanType?spanElement.textContent:"",hasNL=!1;for("newline"===spanType&&(hasNL=!0);previousElement&&!hasNL;){var previousType=previousElement.getAttribute("data-type");if("li-marker"===previousType||"blockquote-marker"===previousType||"task-marker"===previousType||"padding"===previousType){var previousText=previousElement.textContent;if("li-marker"!==previousType||"code-block-open-marker"!==spanType&&"code-block-info"!==spanType)if("code-block-close-marker"===spanType&&previousElement.nextElementSibling.isSameNode(spanElement)){var openMarker=getSideByType(spanElement,"code-block-open-marker");openMarker&&openMarker.previousElementSibling&&(previousElement=openMarker.previousElementSibling,markerText=previousText+markerText)}else markerText=previousText+markerText;else markerText=previousText.replace(/\S/g," ")+markerText}else"newline"===previousType&&(hasNL=!0);previousElement=previousElement.previousElementSibling}return markerText},processAfterRender=function(vditor,options){void 0===options&&(options={enableAddUndoStack:!0,enableHint:!1,enableInput:!0}),options.enableHint&&vditor.hint.render(vditor),vditor.preview.render(vditor);var text=getMarkdown(vditor);"function"==typeof vditor.options.input&&options.enableInput&&vditor.options.input(text),vditor.options.counter.enable&&vditor.counter.render(vditor,text),vditor.options.cache.enable&&(0,compatibility.D)()&&(localStorage.setItem(vditor.options.cache.id,text),vditor.options.cache.after&&vditor.options.cache.after(text)),vditor.devtools&&vditor.devtools.renderEchart(vditor),clearTimeout(vditor.sv.processTimeoutId),vditor.sv.processTimeoutId=window.setTimeout((function(){options.enableAddUndoStack&&!vditor.sv.composingLock&&vditor.undo.addToUndoStack(vditor)}),vditor.options.undoDelay)},processHeading=function(vditor,value){var range=(0,selection.RN)(vditor),headingElement=(0,hasClosestByHeadings.f)(range.startContainer,"SPAN");headingElement&&""!==headingElement.textContent.trim()&&(value="\n"+value),range.collapse(!0),document.execCommand("insertHTML",!1,value)},processToolbar=function(vditor,actionBtn,prefix,suffix){var range=(0,selection.RN)(vditor),commandName=actionBtn.getAttribute("data-type");0===vditor.sv.element.childNodes.length&&(vditor.sv.element.innerHTML='<span data-type="p" data-block="0"><span data-type="text"><wbr></span></span><span data-type="newline"><br><span style="display: none">\n</span></span>',(0,selection.ir)(vditor.sv.element,range));var blockElement=(0,hasClosest.pt)(range.startContainer),spanElement=(0,hasClosestByHeadings.f)(range.startContainer,"SPAN");if(blockElement){if("link"===commandName){var html=void 0;return html=""===range.toString()?"".concat(prefix).concat(Lute.Caret).concat(suffix):"".concat(prefix).concat(range.toString()).concat(suffix.replace(")",Lute.Caret+")")),void document.execCommand("insertHTML",!1,html)}if("italic"===commandName||"bold"===commandName||"strike"===commandName||"inline-code"===commandName||"code"===commandName||"table"===commandName||"line"===commandName)return html=void 0,html=""===range.toString()?"".concat(prefix).concat(Lute.Caret).concat("code"===commandName?"":suffix):"".concat(prefix).concat(range.toString()).concat(Lute.Caret).concat("code"===commandName?"":suffix),"table"===commandName||"code"===commandName&&spanElement&&""!==spanElement.textContent?html="\n\n"+html:"line"===commandName&&(html="\n\n".concat(prefix,"\n").concat(Lute.Caret)),void document.execCommand("insertHTML",!1,html);if(("check"===commandName||"list"===commandName||"ordered-list"===commandName||"quote"===commandName)&&spanElement){var marker="* ";"check"===commandName?marker="* [ ] ":"ordered-list"===commandName?marker="1. ":"quote"===commandName&&(marker="> ");var newLine=getSideByType(spanElement,"newline");return newLine?newLine.insertAdjacentText("afterend",marker):blockElement.insertAdjacentText("afterbegin",marker),void inputEvent(vditor)}(0,selection.ir)(vditor.sv.element,range),processAfterRender(vditor)}},getElement=function(vditor){switch(vditor.currentMode){case"ir":return vditor.ir.element;case"wysiwyg":return vditor.wysiwyg.element;case"sv":return vditor.sv.element}},setHeaders=function(vditor,xhr){vditor.options.upload.setHeaders&&(vditor.options.upload.headers=vditor.options.upload.setHeaders()),vditor.options.upload.headers&&Object.keys(vditor.options.upload.headers).forEach((function(key){xhr.setRequestHeader(key,vditor.options.upload.headers[key])}))},__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P((function(resolve){resolve(value)}))).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;g&&(g=0,op[0]&&(_=0)),_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!((t=(t=_.trys).length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},Upload=function(){return function(){this.isUploading=!1,this.element=document.createElement("div"),this.element.className="vditor-upload"}}(),uploadFiles=function(vditor,files,element){return __awaiter(void 0,void 0,void 0,(function(){var fileList,filesMax,fileItem,isValidate,editorElement,validateResult,formData,extraData,_i,_a,key,i,iMax,xhr;return __generator(this,(function(_b){switch(_b.label){case 0:for(fileList=[],filesMax=!0===vditor.options.upload.multiple?files.length:1,i=0;i<filesMax;i++)(fileItem=files[i])instanceof DataTransferItem&&(fileItem=fileItem.getAsFile()),fileList.push(fileItem);return vditor.options.upload.handler?[4,vditor.options.upload.handler(fileList)]:[3,2];case 1:return isValidate=_b.sent(),element&&(element.value=""),"string"==typeof isValidate?(vditor.tip.show(isValidate),[2]):[2];case 2:return vditor.options.upload.url&&vditor.upload?vditor.options.upload.file?[4,vditor.options.upload.file(fileList)]:[3,4]:(element&&(element.value=""),vditor.tip.show("please config: options.upload.url"),[2]);case 3:fileList=_b.sent(),_b.label=4;case 4:if(vditor.options.upload.validate&&"string"==typeof(isValidate=vditor.options.upload.validate(fileList)))return vditor.tip.show(isValidate),[2];if(editorElement=getElement(vditor),vditor.upload.range=(0,selection.RN)(vditor),validateResult=function(vditor,files){vditor.tip.hide();var uploadFileList=[],errorTip="",uploadingStr="";vditor.options.lang,vditor.options;for(var _loop_1=function(iMax2,i2){var file=files[i2],validate=!0;file.name||(errorTip+="<li>".concat(window.VditorI18n.nameEmpty,"</li>"),validate=!1),file.size>vditor.options.upload.max&&(errorTip+="<li>".concat(file.name," ").concat(window.VditorI18n.over," ").concat(vditor.options.upload.max/1024/1024,"M</li>"),validate=!1);var lastIndex=file.name.lastIndexOf("."),fileExt=file.name.substr(lastIndex),filename=vditor.options.upload.filename(file.name.substr(0,lastIndex))+fileExt;vditor.options.upload.accept&&(vditor.options.upload.accept.split(",").some((function(item){var type=item.trim();if(0===type.indexOf(".")){if(fileExt.toLowerCase()===type.toLowerCase())return!0}else if(file.type.split("/")[0]===type.split("/")[0])return!0;return!1}))||(errorTip+="<li>".concat(file.name," ").concat(window.VditorI18n.fileTypeError,"</li>"),validate=!1)),validate&&(uploadFileList.push(file),uploadingStr+="<li>".concat(filename," ").concat(window.VditorI18n.uploading,"</li>"))},iMax=files.length,i=0;i<iMax;i++)_loop_1(0,i);return vditor.tip.show("<ul>".concat(errorTip).concat(uploadingStr,"</ul>")),uploadFileList}(vditor,fileList),0===validateResult.length)return element&&(element.value=""),[2];for(formData=new FormData,extraData=vditor.options.upload.extraData,_i=0,_a=Object.keys(extraData);_i<_a.length;_i++)key=_a[_i],formData.append(key,extraData[key]);for(i=0,iMax=validateResult.length;i<iMax;i++)formData.append(vditor.options.upload.fieldName,validateResult[i]);return(xhr=new XMLHttpRequest).open("POST",vditor.options.upload.url),vditor.options.upload.token&&xhr.setRequestHeader("X-Upload-Token",vditor.options.upload.token),vditor.options.upload.withCredentials&&(xhr.withCredentials=!0),setHeaders(vditor,xhr),vditor.upload.isUploading=!0,editorElement.setAttribute("contenteditable","false"),xhr.onreadystatechange=function(){if(xhr.readyState===XMLHttpRequest.DONE){if(vditor.upload.isUploading=!1,editorElement.setAttribute("contenteditable","true"),xhr.status>=200&&xhr.status<300)if(vditor.options.upload.success)vditor.options.upload.success(editorElement,xhr.responseText);else{var responseText=xhr.responseText;vditor.options.upload.format&&(responseText=vditor.options.upload.format(files,xhr.responseText)),function(responseText,vditor){getElement(vditor).focus();var response=JSON.parse(responseText),errorTip="";1===response.code&&(errorTip="".concat(response.msg)),response.data.errFiles&&response.data.errFiles.length>0&&(errorTip="<ul><li>".concat(errorTip,"</li>"),response.data.errFiles.forEach((function(data){var lastIndex=data.lastIndexOf("."),filename=vditor.options.upload.filename(data.substr(0,lastIndex))+data.substr(lastIndex);errorTip+="<li>".concat(filename," ").concat(window.VditorI18n.uploadError,"</li>")})),errorTip+="</ul>"),errorTip?vditor.tip.show(errorTip):vditor.tip.hide();var succFileText="";Object.keys(response.data.succMap).forEach((function(key){var path=response.data.succMap[key],lastIndex=key.lastIndexOf("."),type=key.substr(lastIndex),filename=vditor.options.upload.filename(key.substr(0,lastIndex))+type;0===(type=type.toLowerCase()).indexOf(".wav")||0===type.indexOf(".mp3")||0===type.indexOf(".ogg")?"wysiwyg"===vditor.currentMode?succFileText+='<div class="vditor-wysiwyg__block" data-type="html-block"\n data-block="0"><pre><code>&lt;audio controls="controls" src="'.concat(path,'"&gt;&lt;/audio&gt;</code></pre><pre class="vditor-wysiwyg__preview" data-render="1"><audio controls="controls" src="').concat(path,'"></audio></pre></div>\n'):"ir"===vditor.currentMode?succFileText+='<audio controls="controls" src="'.concat(path,'"></audio>\n'):succFileText+="[".concat(filename,"](").concat(path,")\n"):0===type.indexOf(".apng")||0===type.indexOf(".bmp")||0===type.indexOf(".gif")||0===type.indexOf(".ico")||0===type.indexOf(".cur")||0===type.indexOf(".jpg")||0===type.indexOf(".jpeg")||0===type.indexOf(".jfif")||0===type.indexOf(".pjp")||0===type.indexOf(".pjpeg")||0===type.indexOf(".png")||0===type.indexOf(".svg")||0===type.indexOf(".webp")?"wysiwyg"===vditor.currentMode?succFileText+='<img alt="'.concat(filename,'" src="').concat(path,'">\n'):succFileText+="![".concat(filename,"](").concat(path,")\n"):"wysiwyg"===vditor.currentMode?succFileText+='<a href="'.concat(path,'">').concat(filename,"</a>\n"):succFileText+="[".concat(filename,"](").concat(path,")\n")})),(0,selection.jl)(vditor.upload.range),document.execCommand("insertHTML",!1,succFileText),vditor.upload.range=getSelection().getRangeAt(0).cloneRange()}(responseText,vditor)}else vditor.options.upload.error?vditor.options.upload.error(xhr.responseText):vditor.tip.show(xhr.responseText);element&&(element.value=""),vditor.upload.element.style.display="none"}},xhr.upload.onprogress=function(event){if(event.lengthComputable){var progress=event.loaded/event.total*100;vditor.upload.element.style.display="block",vditor.upload.element.style.width=progress+"%"}},xhr.send(formData),[2]}}))}))},input_input=function(vditor,range,event){var _a,blockElement=(0,hasClosest.pt)(range.startContainer);if(blockElement||(blockElement=vditor.wysiwyg.element),event&&"formatItalic"!==event.inputType&&"deleteByDrag"!==event.inputType&&"insertFromDrop"!==event.inputType&&"formatBold"!==event.inputType&&"formatRemove"!==event.inputType&&"formatStrikeThrough"!==event.inputType&&"insertUnorderedList"!==event.inputType&&"insertOrderedList"!==event.inputType&&"formatOutdent"!==event.inputType&&"formatIndent"!==event.inputType&&""!==event.inputType||!event){var previousAEmptyElement=function(node){for(var previousNode=node.previousSibling;previousNode;){if(3!==previousNode.nodeType&&"A"===previousNode.tagName&&!previousNode.previousSibling&&""===previousNode.innerHTML.replace(constants.Y.ZWSP,"")&&previousNode.nextSibling)return previousNode;previousNode=previousNode.previousSibling}return!1}(range.startContainer);previousAEmptyElement&&previousAEmptyElement.remove(),vditor.wysiwyg.element.querySelectorAll("wbr").forEach((function(wbr){wbr.remove()})),range.insertNode(document.createElement("wbr")),blockElement.querySelectorAll("[style]").forEach((function(item){item.removeAttribute("style")})),blockElement.querySelectorAll(".vditor-comment").forEach((function(item){""===item.textContent.trim()&&(item.classList.remove("vditor-comment","vditor-comment--focus"),item.removeAttribute("data-cmtids"))})),null===(_a=blockElement.previousElementSibling)||void 0===_a||_a.querySelectorAll(".vditor-comment").forEach((function(item){""===item.textContent.trim()&&(item.classList.remove("vditor-comment","vditor-comment--focus"),item.removeAttribute("data-cmtids"))}));var html_1="";"link-ref-defs-block"===blockElement.getAttribute("data-type")&&(blockElement=vditor.wysiwyg.element);var firstLinkRefDefElement_1,isWYSIWYGElement=blockElement.isEqualNode(vditor.wysiwyg.element),footnoteElement=(0,hasClosest.Th)(blockElement,"data-type","footnotes-block");if(isWYSIWYGElement)html_1=blockElement.innerHTML;else{var topListElement=(0,hasClosest.KR)(range.startContainer);if(topListElement&&!footnoteElement){var blockquoteElement=(0,hasClosestByHeadings.f)(range.startContainer,"BLOCKQUOTE");blockElement=blockquoteElement?(0,hasClosest.pt)(range.startContainer)||blockElement:topListElement}if(footnoteElement&&(blockElement=footnoteElement),html_1=blockElement.outerHTML,"UL"===blockElement.tagName||"OL"===blockElement.tagName){var listPrevElement=blockElement.previousElementSibling,listNextElement=blockElement.nextElementSibling;!listPrevElement||"UL"!==listPrevElement.tagName&&"OL"!==listPrevElement.tagName||(html_1=listPrevElement.outerHTML+html_1,listPrevElement.remove()),!listNextElement||"UL"!==listNextElement.tagName&&"OL"!==listNextElement.tagName||(html_1+=listNextElement.outerHTML,listNextElement.remove()),html_1=html_1.replace("<div><wbr><br></div>","<li><p><wbr><br></p></li>")}blockElement.innerText.startsWith("```")||(vditor.wysiwyg.element.querySelectorAll("[data-type='link-ref-defs-block']").forEach((function(item){item&&!blockElement.isEqualNode(item)&&(html_1+=item.outerHTML,item.remove())})),vditor.wysiwyg.element.querySelectorAll("[data-type='footnotes-block']").forEach((function(item){item&&!blockElement.isEqualNode(item)&&(html_1+=item.outerHTML,item.remove())})))}if('<p data-block="0">```<wbr></p>'===(html_1=html_1.replace(/<\/(strong|b)><strong data-marker="\W{2}">/g,"").replace(/<\/(em|i)><em data-marker="\W{1}">/g,"").replace(/<\/(s|strike)><s data-marker="~{1,2}">/g,""))&&vditor.hint.recentLanguage&&(html_1='<p data-block="0">```<wbr></p>'.replace("```","```"+vditor.hint.recentLanguage)),log("SpinVditorDOM",html_1,"argument",vditor.options.debugger),html_1=vditor.lute.SpinVditorDOM(html_1),log("SpinVditorDOM",html_1,"result",vditor.options.debugger),isWYSIWYGElement)blockElement.innerHTML=html_1;else if(blockElement.outerHTML=html_1,footnoteElement){var footnoteItemElement=(0,hasClosest.Ab)(vditor.wysiwyg.element.querySelector("wbr"),"LI");if(footnoteItemElement){var footnoteRefElement=vditor.wysiwyg.element.querySelector('sup[data-type="footnotes-ref"][data-footnotes-label="'.concat(footnoteItemElement.getAttribute("data-marker"),'"]'));footnoteRefElement&&footnoteRefElement.setAttribute("aria-label",footnoteItemElement.textContent.trim().substr(0,24))}}var firstFootnoteElement_1,allLinkRefDefsElement=vditor.wysiwyg.element.querySelectorAll("[data-type='link-ref-defs-block']");allLinkRefDefsElement.forEach((function(item,index){0===index?firstLinkRefDefElement_1=item:(firstLinkRefDefElement_1.insertAdjacentHTML("beforeend",item.innerHTML),item.remove())})),allLinkRefDefsElement.length>0&&vditor.wysiwyg.element.insertAdjacentElement("beforeend",allLinkRefDefsElement[0]);var allFootnoteElement=vditor.wysiwyg.element.querySelectorAll("[data-type='footnotes-block']");allFootnoteElement.forEach((function(item,index){0===index?firstFootnoteElement_1=item:(firstFootnoteElement_1.insertAdjacentHTML("beforeend",item.innerHTML),item.remove())})),allFootnoteElement.length>0&&vditor.wysiwyg.element.insertAdjacentElement("beforeend",allFootnoteElement[0]),(0,selection.ir)(vditor.wysiwyg.element,range),vditor.wysiwyg.element.querySelectorAll(".vditor-wysiwyg__preview[data-render='2']").forEach((function(item){processCodeRender(item,vditor)})),event&&("deleteContentBackward"===event.inputType||"deleteContentForward"===event.inputType)&&vditor.options.comment.enable&&(vditor.wysiwyg.triggerRemoveComment(vditor),vditor.options.comment.adjustTop(vditor.wysiwyg.getComments(vditor,!0)))}renderToc(vditor),afterRenderEvent(vditor,{enableAddUndoStack:!0,enableHint:!0,enableInput:!0})},fixBrowserBehavior_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P((function(resolve){resolve(value)}))).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},fixBrowserBehavior_generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;g&&(g=0,op[0]&&(_=0)),_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!((t=(t=_.trys).length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},fixGSKeyBackspace=function(event,vditor,startContainer){if(229===event.keyCode&&""===event.code&&"Unidentified"===event.key&&"sv"!==vditor.currentMode){var blockElement=(0,hasClosest.pt)(startContainer);if(blockElement&&""===blockElement.textContent.trim())return vditor[vditor.currentMode].composingLock=!0,!1}return!0},fixCJKPosition=function(range,vditor,event){if(!("Enter"===event.key||"Tab"===event.key||"Backspace"===event.key||event.key.indexOf("Arrow")>-1||(0,compatibility._0)(event)||"Escape"===event.key||event.shiftKey||event.altKey)){var pLiElement=(0,hasClosest._Y)(range.startContainer,"P")||(0,hasClosest._Y)(range.startContainer,"LI");if(pLiElement&&0===(0,selection.ED)(pLiElement,vditor[vditor.currentMode].element,range).start){pLiElement.nodeValue&&(pLiElement.nodeValue=pLiElement.nodeValue.replace(/\u2006/g,""));var zwspNode=document.createTextNode(constants.Y.ZWSP);range.insertNode(zwspNode),range.setStartAfter(zwspNode)}}},fixCursorDownInlineMath=function(range,key){if("ArrowDown"===key||"ArrowUp"===key){var inlineElement=(0,hasClosest.Th)(range.startContainer,"data-type","math-inline")||(0,hasClosest.Th)(range.startContainer,"data-type","html-entity")||(0,hasClosest.Th)(range.startContainer,"data-type","html-inline");inlineElement&&("ArrowDown"===key&&range.setStartAfter(inlineElement.parentElement),"ArrowUp"===key&&range.setStartBefore(inlineElement.parentElement))}},insertEmptyBlock=function(vditor,position){var range=(0,selection.RN)(vditor),blockElement=(0,hasClosest.pt)(range.startContainer);blockElement&&(blockElement.insertAdjacentHTML(position,'<p data-block="0">'.concat(constants.Y.ZWSP,"<wbr>\n</p>")),(0,selection.ir)(vditor[vditor.currentMode].element,range),highlightToolbar(vditor),execAfterRender(vditor))},isFirstCell=function(cellElement){var tableElement=(0,hasClosest._Y)(cellElement,"TABLE");return!(!tableElement||!tableElement.rows[0].cells[0].isSameNode(cellElement))&&tableElement},isLastCell=function(cellElement){var tableElement=(0,hasClosest._Y)(cellElement,"TABLE");return!(!tableElement||!tableElement.lastElementChild.lastElementChild.lastElementChild.isSameNode(cellElement))&&tableElement},goPreviousCell=function(cellElement,range,isSelected){void 0===isSelected&&(isSelected=!0);var previousElement=cellElement.previousElementSibling;return previousElement||(previousElement=cellElement.parentElement.previousElementSibling?cellElement.parentElement.previousElementSibling.lastElementChild:"TBODY"===cellElement.parentElement.parentElement.tagName&&cellElement.parentElement.parentElement.previousElementSibling?cellElement.parentElement.parentElement.previousElementSibling.lastElementChild.lastElementChild:null),previousElement&&(range.selectNodeContents(previousElement),isSelected||range.collapse(!1),(0,selection.jl)(range)),previousElement},insertAfterBlock=function(vditor,event,range,element,blockElement){var position=(0,selection.ED)(element,vditor[vditor.currentMode].element,range);if("ArrowDown"===event.key&&-1===element.textContent.trimRight().substr(position.start).indexOf("\n")||"ArrowRight"===event.key&&position.start>=element.textContent.trimRight().length){var nextElement=blockElement.nextElementSibling;return!nextElement||nextElement&&("TABLE"===nextElement.tagName||nextElement.getAttribute("data-type"))?(blockElement.insertAdjacentHTML("afterend",'<p data-block="0">'.concat(constants.Y.ZWSP,"<wbr></p>")),(0,selection.ir)(vditor[vditor.currentMode].element,range)):(range.selectNodeContents(nextElement),range.collapse(!0),(0,selection.jl)(range)),event.preventDefault(),!0}return!1},insertBeforeBlock=function(vditor,event,range,element,blockElement){var position=(0,selection.ED)(element,vditor[vditor.currentMode].element,range);if("ArrowUp"===event.key&&-1===element.textContent.substr(0,position.start).indexOf("\n")||("ArrowLeft"===event.key||"Backspace"===event.key&&""===range.toString())&&0===position.start){var previousElement=blockElement.previousElementSibling;return!previousElement||previousElement&&("TABLE"===previousElement.tagName||previousElement.getAttribute("data-type"))?(blockElement.insertAdjacentHTML("beforebegin",'<p data-block="0">'.concat(constants.Y.ZWSP,"<wbr></p>")),(0,selection.ir)(vditor[vditor.currentMode].element,range)):(range.selectNodeContents(previousElement),range.collapse(!1),(0,selection.jl)(range)),event.preventDefault(),!0}return!1},listToggle=function(vditor,range,type,cancel){void 0===cancel&&(cancel=!0);var itemElement=(0,hasClosest._Y)(range.startContainer,"LI");if(vditor[vditor.currentMode].element.querySelectorAll("wbr").forEach((function(wbr){wbr.remove()})),range.insertNode(document.createElement("wbr")),cancel&&itemElement){for(var pHTML="",i=0;i<itemElement.parentElement.childElementCount;i++){var inputElement=itemElement.parentElement.children[i].querySelector("input");inputElement&&inputElement.remove(),pHTML+='<p data-block="0">'.concat(itemElement.parentElement.children[i].innerHTML.trimLeft(),"</p>")}itemElement.parentElement.insertAdjacentHTML("beforebegin",pHTML),itemElement.parentElement.remove()}else if(itemElement)if("check"===type)itemElement.parentElement.querySelectorAll("li").forEach((function(item){item.insertAdjacentHTML("afterbegin",'<input type="checkbox" />'.concat(0===item.textContent.indexOf(" ")?"":" ")),item.classList.add("vditor-task")}));else{itemElement.querySelector("input")&&itemElement.parentElement.querySelectorAll("li").forEach((function(item){item.querySelector("input").remove(),item.classList.remove("vditor-task")}));var element=void 0;"list"===type?(element=document.createElement("ul")).setAttribute("data-marker","*"):(element=document.createElement("ol")).setAttribute("data-marker","1."),element.setAttribute("data-block","0"),element.setAttribute("data-tight",itemElement.parentElement.getAttribute("data-tight")),element.innerHTML=itemElement.parentElement.innerHTML,itemElement.parentElement.parentNode.replaceChild(element,itemElement.parentElement)}else{var blockElement=(0,hasClosest.Th)(range.startContainer,"data-block","0");blockElement||(vditor[vditor.currentMode].element.querySelector("wbr").remove(),(blockElement=vditor[vditor.currentMode].element.querySelector("p")).innerHTML="<wbr>"),"check"===type?(blockElement.insertAdjacentHTML("beforebegin",'<ul data-block="0"><li class="vditor-task"><input type="checkbox" /> '.concat(blockElement.innerHTML,"</li></ul>")),blockElement.remove()):"list"===type?(blockElement.insertAdjacentHTML("beforebegin",'<ul data-block="0"><li>'.concat(blockElement.innerHTML,"</li></ul>")),blockElement.remove()):"ordered-list"===type&&(blockElement.insertAdjacentHTML("beforebegin",'<ol data-block="0"><li>'.concat(blockElement.innerHTML,"</li></ol>")),blockElement.remove())}},listIndent=function(vditor,liElement,range){var previousElement=liElement.previousElementSibling;if(liElement&&previousElement){var liElements_1=[liElement];Array.from(range.cloneContents().children).forEach((function(item,index){3!==item.nodeType&&liElement&&""!==item.textContent.trim()&&liElement.getAttribute("data-node-id")===item.getAttribute("data-node-id")&&(0!==index&&liElements_1.push(liElement),liElement=liElement.nextElementSibling)})),vditor[vditor.currentMode].element.querySelectorAll("wbr").forEach((function(wbr){wbr.remove()})),range.insertNode(document.createElement("wbr"));var liParentElement=previousElement.parentElement,liHTML_1="";liElements_1.forEach((function(item){var marker=item.getAttribute("data-marker");1!==marker.length&&(marker="1".concat(marker.slice(-1))),liHTML_1+='<li data-node-id="'.concat(item.getAttribute("data-node-id"),'" data-marker="').concat(marker,'">').concat(item.innerHTML,"</li>"),item.remove()})),previousElement.insertAdjacentHTML("beforeend","<".concat(liParentElement.tagName,' data-block="0">').concat(liHTML_1,"</").concat(liParentElement.tagName,">")),"wysiwyg"===vditor.currentMode?liParentElement.outerHTML=vditor.lute.SpinVditorDOM(liParentElement.outerHTML):liParentElement.outerHTML=vditor.lute.SpinVditorIRDOM(liParentElement.outerHTML),(0,selection.ir)(vditor[vditor.currentMode].element,range);var tempTopListElement=(0,hasClosest.KR)(range.startContainer);tempTopListElement&&tempTopListElement.querySelectorAll(".vditor-".concat(vditor.currentMode,"__preview[data-render='2']")).forEach((function(item){processCodeRender(item,vditor),"wysiwyg"===vditor.currentMode&&item.previousElementSibling.setAttribute("style","display:none")})),execAfterRender(vditor),highlightToolbar(vditor)}else vditor[vditor.currentMode].element.focus()},listOutdent=function(vditor,liElement,range,topListElement){var liParentLiElement=(0,hasClosest._Y)(liElement.parentElement,"LI");if(liParentLiElement){vditor[vditor.currentMode].element.querySelectorAll("wbr").forEach((function(wbr){wbr.remove()})),range.insertNode(document.createElement("wbr"));var liParentElement=liElement.parentElement,liParentAfterElement=liParentElement.cloneNode(),liElements_2=[liElement];Array.from(range.cloneContents().children).forEach((function(item,index){3!==item.nodeType&&liElement&&""!==item.textContent.trim()&&liElement.getAttribute("data-node-id")===item.getAttribute("data-node-id")&&(0!==index&&liElements_2.push(liElement),liElement=liElement.nextElementSibling)}));var isMatch_1=!1,afterHTML_1="";liParentElement.querySelectorAll("li").forEach((function(item){isMatch_1&&(afterHTML_1+=item.outerHTML,item.nextElementSibling||item.previousElementSibling?item.remove():item.parentElement.remove()),item.isSameNode(liElements_2[liElements_2.length-1])&&(isMatch_1=!0)})),liElements_2.reverse().forEach((function(item){liParentLiElement.insertAdjacentElement("afterend",item)})),afterHTML_1&&(liParentAfterElement.innerHTML=afterHTML_1,liElements_2[0].insertAdjacentElement("beforeend",liParentAfterElement)),"wysiwyg"===vditor.currentMode?topListElement.outerHTML=vditor.lute.SpinVditorDOM(topListElement.outerHTML):topListElement.outerHTML=vditor.lute.SpinVditorIRDOM(topListElement.outerHTML),(0,selection.ir)(vditor[vditor.currentMode].element,range);var tempTopListElement=(0,hasClosest.KR)(range.startContainer);tempTopListElement&&tempTopListElement.querySelectorAll(".vditor-".concat(vditor.currentMode,"__preview[data-render='2']")).forEach((function(item){processCodeRender(item,vditor),"wysiwyg"===vditor.currentMode&&item.previousElementSibling.setAttribute("style","display:none")})),execAfterRender(vditor),highlightToolbar(vditor)}else vditor[vditor.currentMode].element.focus()},setTableAlign=function(tableElement,type){for(var cell=getSelection().getRangeAt(0).startContainer.parentElement,columnCnt=tableElement.rows[0].cells.length,rowCnt=tableElement.rows.length,currentColumn=0,i=0;i<rowCnt;i++)for(var j=0;j<columnCnt;j++)if(tableElement.rows[i].cells[j].isSameNode(cell)){currentColumn=j;break}for(var k=0;k<rowCnt;k++)tableElement.rows[k].cells[currentColumn].setAttribute("align",type)},isHrMD=function(text){var marker=text.trimRight().split("\n").pop();return""!==marker&&(""===marker.replace(/ |-/g,"")||""===marker.replace(/ |_/g,"")||""===marker.replace(/ |\*/g,""))&&marker.replace(/ /g,"").length>2&&!(marker.indexOf("-")>-1&&-1===marker.trimLeft().indexOf(" ")&&text.trimRight().split("\n").length>1)&&0!==marker.indexOf("    ")&&0!==marker.indexOf("\t")},isHeadingMD=function(text){var textArray=text.trimRight().split("\n");return 0!==(text=textArray.pop()).indexOf("    ")&&0!==text.indexOf("\t")&&""!==(text=text.trimLeft())&&0!==textArray.length&&(""===text.replace(/-/g,"")||""===text.replace(/=/g,""))},execAfterRender=function(vditor,options){void 0===options&&(options={enableAddUndoStack:!0,enableHint:!1,enableInput:!0}),"wysiwyg"===vditor.currentMode?afterRenderEvent(vditor,options):"ir"===vditor.currentMode?process_processAfterRender(vditor,options):"sv"===vditor.currentMode&&processAfterRender(vditor,options)},fixList=function(range,vditor,pElement,event){var _a,startContainer=range.startContainer,liElement=(0,hasClosest._Y)(startContainer,"LI");if(liElement){if(!(0,compatibility._0)(event)&&!event.altKey&&"Enter"===event.key&&!event.shiftKey&&pElement&&liElement.contains(pElement)&&pElement.nextElementSibling)return liElement&&!liElement.textContent.endsWith("\n")&&liElement.insertAdjacentText("beforeend","\n"),range.insertNode(document.createTextNode("\n\n")),range.collapse(!1),execAfterRender(vditor),event.preventDefault(),!0;if(!((0,compatibility._0)(event)||event.shiftKey||event.altKey||"Backspace"!==event.key||liElement.previousElementSibling||""!==range.toString()||0!==(0,selection.ED)(liElement,vditor[vditor.currentMode].element,range).start))return liElement.nextElementSibling?(liElement.parentElement.insertAdjacentHTML("beforebegin",'<p data-block="0"><wbr>'.concat(liElement.innerHTML,"</p>")),liElement.remove()):liElement.parentElement.outerHTML='<p data-block="0"><wbr>'.concat(liElement.innerHTML,"</p>"),(0,selection.ir)(vditor[vditor.currentMode].element,range),execAfterRender(vditor),event.preventDefault(),!0;if(!(0,compatibility._0)(event)&&!event.shiftKey&&!event.altKey&&"Backspace"===event.key&&""===liElement.textContent.trim().replace(constants.Y.ZWSP,"")&&""===range.toString()&&"LI"===(null===(_a=liElement.previousElementSibling)||void 0===_a?void 0:_a.tagName))return liElement.previousElementSibling.insertAdjacentText("beforeend","\n\n"),range.selectNodeContents(liElement.previousElementSibling),range.collapse(!1),liElement.remove(),(0,selection.ir)(vditor[vditor.currentMode].element,range),execAfterRender(vditor),event.preventDefault(),!0;if(!(0,compatibility._0)(event)&&!event.altKey&&"Tab"===event.key){var isFirst=!1;if((0===range.startOffset&&(3===startContainer.nodeType&&!startContainer.previousSibling||3!==startContainer.nodeType&&"LI"===startContainer.nodeName)||liElement.classList.contains("vditor-task")&&1===range.startOffset&&3!==startContainer.previousSibling.nodeType&&"INPUT"===startContainer.previousSibling.tagName)&&(isFirst=!0),isFirst||""!==range.toString())return event.shiftKey?listOutdent(vditor,liElement,range,liElement.parentElement):listIndent(vditor,liElement,range),event.preventDefault(),!0}}return!1},fixTab=function(vditor,range,event){if(vditor.options.tab&&"Tab"===event.key)return event.shiftKey||(""===range.toString()?(range.insertNode(document.createTextNode(vditor.options.tab)),range.collapse(!1)):(range.extractContents(),range.insertNode(document.createTextNode(vditor.options.tab)),range.collapse(!1))),(0,selection.jl)(range),execAfterRender(vditor),event.preventDefault(),!0},fixMarkdown=function(event,vditor,pElement,range){if(pElement){if(!(0,compatibility._0)(event)&&!event.altKey&&"Enter"===event.key){var pText=String.raw(templateObject_1||(cooked=["",""],raw=["",""],Object.defineProperty?Object.defineProperty(cooked,"raw",{value:raw}):cooked.raw=raw,templateObject_1=cooked),pElement.textContent).replace(/\\\|/g,"").trim(),pTextList=pText.split("|");if(pText.startsWith("|")&&pText.endsWith("|")&&pTextList.length>3){var tableHeaderMD=pTextList.map((function(){return"---"})).join("|");return tableHeaderMD=pElement.textContent+"\n"+tableHeaderMD.substring(3,tableHeaderMD.length-3)+"\n|<wbr>",pElement.outerHTML=vditor.lute.SpinVditorDOM(tableHeaderMD),(0,selection.ir)(vditor[vditor.currentMode].element,range),execAfterRender(vditor),scrollCenter(vditor),event.preventDefault(),!0}if(isHrMD(pElement.innerHTML)&&pElement.previousElementSibling){var pInnerHTML="",innerHTMLList=pElement.innerHTML.trimRight().split("\n");return innerHTMLList.length>1&&(innerHTMLList.pop(),pInnerHTML='<p data-block="0">'.concat(innerHTMLList.join("\n"),"</p>")),pElement.insertAdjacentHTML("afterend","".concat(pInnerHTML,'<hr data-block="0"><p data-block="0"><wbr>\n</p>')),pElement.remove(),(0,selection.ir)(vditor[vditor.currentMode].element,range),execAfterRender(vditor),scrollCenter(vditor),event.preventDefault(),!0}if(isHeadingMD(pElement.innerHTML))return"wysiwyg"===vditor.currentMode?pElement.outerHTML=vditor.lute.SpinVditorDOM(pElement.innerHTML+'<p data-block="0"><wbr>\n</p>'):pElement.outerHTML=vditor.lute.SpinVditorIRDOM(pElement.innerHTML+'<p data-block="0"><wbr>\n</p>'),(0,selection.ir)(vditor[vditor.currentMode].element,range),execAfterRender(vditor),scrollCenter(vditor),event.preventDefault(),!0}var cooked,raw;if(range.collapsed&&pElement.previousElementSibling&&"Backspace"===event.key&&!(0,compatibility._0)(event)&&!event.altKey&&!event.shiftKey&&pElement.textContent.trimRight().split("\n").length>1&&0===(0,selection.ED)(pElement,vditor[vditor.currentMode].element,range).start){var lastElement=(0,hasClosest.Rp)(pElement.previousElementSibling);return lastElement.textContent.endsWith("\n")||(lastElement.textContent=lastElement.textContent+"\n"),lastElement.parentElement.insertAdjacentHTML("beforeend","<wbr>".concat(pElement.innerHTML)),pElement.remove(),(0,selection.ir)(vditor[vditor.currentMode].element,range),!1}return!1}},insertRow=function(vditor,range,cellElement){for(var rowHTML="",m=0;m<cellElement.parentElement.childElementCount;m++)rowHTML+='<td align="'.concat(cellElement.parentElement.children[m].getAttribute("align"),'"> </td>');"TH"===cellElement.tagName?cellElement.parentElement.parentElement.insertAdjacentHTML("afterend","<tbody><tr>".concat(rowHTML,"</tr></tbody>")):cellElement.parentElement.insertAdjacentHTML("afterend","<tr>".concat(rowHTML,"</tr>")),execAfterRender(vditor)},insertRowAbove=function(vditor,range,cellElement){for(var rowHTML="",m=0;m<cellElement.parentElement.childElementCount;m++)"TH"===cellElement.tagName?rowHTML+='<th align="'.concat(cellElement.parentElement.children[m].getAttribute("align"),'"> </th>'):rowHTML+='<td align="'.concat(cellElement.parentElement.children[m].getAttribute("align"),'"> </td>');if("TH"===cellElement.tagName){cellElement.parentElement.parentElement.insertAdjacentHTML("beforebegin","<thead><tr>".concat(rowHTML,"</tr></thead>")),range.insertNode(document.createElement("wbr"));var theadHTML=cellElement.parentElement.innerHTML.replace(/<th>/g,"<td>").replace(/<\/th>/g,"</td>");cellElement.parentElement.parentElement.nextElementSibling.insertAdjacentHTML("afterbegin",theadHTML),cellElement.parentElement.parentElement.remove(),(0,selection.ir)(vditor.ir.element,range)}else cellElement.parentElement.insertAdjacentHTML("beforebegin","<tr>".concat(rowHTML,"</tr>"));execAfterRender(vditor)},insertColumn=function(vditor,tableElement,cellElement,type){void 0===type&&(type="afterend");for(var index=0,previousElement=cellElement.previousElementSibling;previousElement;)index++,previousElement=previousElement.previousElementSibling;for(var i=0;i<tableElement.rows.length;i++)0===i?tableElement.rows[i].cells[index].insertAdjacentHTML(type,"<th> </th>"):tableElement.rows[i].cells[index].insertAdjacentHTML(type,"<td> </td>");execAfterRender(vditor)},deleteRow=function(vditor,range,cellElement){if("TD"===cellElement.tagName){var tbodyElement=cellElement.parentElement.parentElement;cellElement.parentElement.previousElementSibling?range.selectNodeContents(cellElement.parentElement.previousElementSibling.lastElementChild):range.selectNodeContents(tbodyElement.previousElementSibling.lastElementChild.lastElementChild),1===tbodyElement.childElementCount?tbodyElement.remove():cellElement.parentElement.remove(),range.collapse(!1),(0,selection.jl)(range),execAfterRender(vditor)}},deleteColumn=function(vditor,range,tableElement,cellElement){for(var index=0,previousElement=cellElement.previousElementSibling;previousElement;)index++,previousElement=previousElement.previousElementSibling;(cellElement.previousElementSibling||cellElement.nextElementSibling)&&(range.selectNodeContents(cellElement.previousElementSibling||cellElement.nextElementSibling),range.collapse(!0));for(var i=0;i<tableElement.rows.length;i++){var cells=tableElement.rows[i].cells;if(1===cells.length){tableElement.remove(),highlightToolbar(vditor);break}cells[index].remove()}(0,selection.jl)(range),execAfterRender(vditor)},fixTable=function(vditor,event,range){var startContainer=range.startContainer,cellElement=(0,hasClosest._Y)(startContainer,"TD")||(0,hasClosest._Y)(startContainer,"TH");if(cellElement){if(!(0,compatibility._0)(event)&&!event.altKey&&"Enter"===event.key){cellElement.lastElementChild&&(!cellElement.lastElementChild||cellElement.lastElementChild.isSameNode(cellElement.lastChild)&&"BR"===cellElement.lastElementChild.tagName)||cellElement.insertAdjacentHTML("beforeend","<br>");var brElement=document.createElement("br");return range.insertNode(brElement),range.setStartAfter(brElement),execAfterRender(vditor),scrollCenter(vditor),event.preventDefault(),!0}if("Tab"===event.key)return event.shiftKey?(goPreviousCell(cellElement,range),event.preventDefault(),!0):((nextElement=cellElement.nextElementSibling)||(nextElement=cellElement.parentElement.nextElementSibling?cellElement.parentElement.nextElementSibling.firstElementChild:"THEAD"===cellElement.parentElement.parentElement.tagName&&cellElement.parentElement.parentElement.nextElementSibling?cellElement.parentElement.parentElement.nextElementSibling.firstElementChild.firstElementChild:null),nextElement&&(range.selectNodeContents(nextElement),(0,selection.jl)(range)),event.preventDefault(),!0);var tableElement=cellElement.parentElement.parentElement.parentElement;if("ArrowUp"===event.key){if(event.preventDefault(),"TH"===cellElement.tagName)return tableElement.previousElementSibling?(range.selectNodeContents(tableElement.previousElementSibling),range.collapse(!1),(0,selection.jl)(range)):insertEmptyBlock(vditor,"beforebegin"),!0;for(var m=0,trElement=cellElement.parentElement;m<trElement.cells.length&&!trElement.cells[m].isSameNode(cellElement);m++);var previousElement=trElement.previousElementSibling;return previousElement||(previousElement=trElement.parentElement.previousElementSibling.firstChild),range.selectNodeContents(previousElement.cells[m]),range.collapse(!1),(0,selection.jl)(range),!0}if("ArrowDown"===event.key){var nextElement;if(event.preventDefault(),!(trElement=cellElement.parentElement).nextElementSibling&&"TD"===cellElement.tagName)return tableElement.nextElementSibling?(range.selectNodeContents(tableElement.nextElementSibling),range.collapse(!0),(0,selection.jl)(range)):insertEmptyBlock(vditor,"afterend"),!0;for(m=0;m<trElement.cells.length&&!trElement.cells[m].isSameNode(cellElement);m++);return(nextElement=trElement.nextElementSibling)||(nextElement=trElement.parentElement.nextElementSibling.firstChild),range.selectNodeContents(nextElement.cells[m]),range.collapse(!0),(0,selection.jl)(range),!0}if("wysiwyg"===vditor.currentMode&&!(0,compatibility._0)(event)&&"Enter"===event.key&&!event.shiftKey&&event.altKey){var inputElement=vditor.wysiwyg.popover.querySelector(".vditor-input");return inputElement.focus(),inputElement.select(),event.preventDefault(),!0}if(!(0,compatibility._0)(event)&&!event.shiftKey&&!event.altKey&&"Backspace"===event.key&&0===range.startOffset&&""===range.toString())return!goPreviousCell(cellElement,range,!1)&&tableElement&&(""===tableElement.textContent.trim()?(tableElement.outerHTML='<p data-block="0"><wbr>\n</p>',(0,selection.ir)(vditor[vditor.currentMode].element,range)):(range.setStartBefore(tableElement),range.collapse(!0)),execAfterRender(vditor)),event.preventDefault(),!0;if(matchHotKey("⇧⌘F",event))return insertRowAbove(vditor,range,cellElement),event.preventDefault(),!0;if(matchHotKey("⌘=",event))return insertRow(vditor,range,cellElement),event.preventDefault(),!0;if(matchHotKey("⇧⌘G",event))return insertColumn(vditor,tableElement,cellElement,"beforebegin"),event.preventDefault(),!0;if(matchHotKey("⇧⌘=",event))return insertColumn(vditor,tableElement,cellElement),event.preventDefault(),!0;if(matchHotKey("⌘-",event))return deleteRow(vditor,range,cellElement),event.preventDefault(),!0;if(matchHotKey("⇧⌘-",event))return deleteColumn(vditor,range,tableElement,cellElement),event.preventDefault(),!0;if(matchHotKey("⇧⌘L",event)){if("ir"===vditor.currentMode)return setTableAlign(tableElement,"left"),execAfterRender(vditor),event.preventDefault(),!0;if(itemElement=vditor.wysiwyg.popover.querySelector('[data-type="left"]'))return itemElement.click(),event.preventDefault(),!0}if(matchHotKey("⇧⌘C",event)){if("ir"===vditor.currentMode)return setTableAlign(tableElement,"center"),execAfterRender(vditor),event.preventDefault(),!0;if(itemElement=vditor.wysiwyg.popover.querySelector('[data-type="center"]'))return itemElement.click(),event.preventDefault(),!0}if(matchHotKey("⇧⌘R",event)){if("ir"===vditor.currentMode)return setTableAlign(tableElement,"right"),execAfterRender(vditor),event.preventDefault(),!0;var itemElement;if(itemElement=vditor.wysiwyg.popover.querySelector('[data-type="right"]'))return itemElement.click(),event.preventDefault(),!0}}return!1},fixCodeBlock=function(vditor,event,codeRenderElement,range){if("PRE"===codeRenderElement.tagName&&matchHotKey("⌘A",event))return range.selectNodeContents(codeRenderElement.firstElementChild),event.preventDefault(),!0;if(vditor.options.tab&&"Tab"===event.key&&!event.shiftKey&&""===range.toString())return range.insertNode(document.createTextNode(vditor.options.tab)),range.collapse(!1),execAfterRender(vditor),event.preventDefault(),!0;if("Backspace"===event.key&&!(0,compatibility._0)(event)&&!event.shiftKey&&!event.altKey){var codePosition=(0,selection.ED)(codeRenderElement,vditor[vditor.currentMode].element,range);if((0===codePosition.start||1===codePosition.start&&"\n"===codeRenderElement.innerText)&&""===range.toString())return codeRenderElement.parentElement.outerHTML='<p data-block="0"><wbr>'.concat(codeRenderElement.firstElementChild.innerHTML,"</p>"),(0,selection.ir)(vditor[vditor.currentMode].element,range),execAfterRender(vditor),event.preventDefault(),!0}return!(0,compatibility._0)(event)&&!event.altKey&&"Enter"===event.key&&(codeRenderElement.firstElementChild.textContent.endsWith("\n")||codeRenderElement.firstElementChild.insertAdjacentText("beforeend","\n"),range.extractContents(),range.insertNode(document.createTextNode("\n")),range.collapse(!1),(0,selection.jl)(range),(0,compatibility.gm)()||("wysiwyg"===vditor.currentMode?input_input(vditor,range):input(vditor,range)),scrollCenter(vditor),event.preventDefault(),!0)},fixBlockquote=function(vditor,range,event,pElement){var startContainer=range.startContainer,blockquoteElement=(0,hasClosest._Y)(startContainer,"BLOCKQUOTE");if(blockquoteElement&&""===range.toString()){if("Backspace"===event.key&&!(0,compatibility._0)(event)&&!event.shiftKey&&!event.altKey&&0===(0,selection.ED)(blockquoteElement,vditor[vditor.currentMode].element,range).start)return range.insertNode(document.createElement("wbr")),blockquoteElement.outerHTML=blockquoteElement.innerHTML,(0,selection.ir)(vditor[vditor.currentMode].element,range),execAfterRender(vditor),event.preventDefault(),!0;if(pElement&&"Enter"===event.key&&!(0,compatibility._0)(event)&&!event.shiftKey&&!event.altKey&&"BLOCKQUOTE"===pElement.parentElement.tagName){var isEmpty=!1;if("\n"===pElement.innerHTML.replace(constants.Y.ZWSP,"")||""===pElement.innerHTML.replace(constants.Y.ZWSP,"")?(isEmpty=!0,pElement.remove()):pElement.innerHTML.endsWith("\n\n")&&(0,selection.ED)(pElement,vditor[vditor.currentMode].element,range).start===pElement.textContent.length-1&&(pElement.innerHTML=pElement.innerHTML.substr(0,pElement.innerHTML.length-2),isEmpty=!0),isEmpty)return blockquoteElement.insertAdjacentHTML("afterend",'<p data-block="0">'.concat(constants.Y.ZWSP,"<wbr>\n</p>")),(0,selection.ir)(vditor[vditor.currentMode].element,range),execAfterRender(vditor),event.preventDefault(),!0}var blockElement=(0,hasClosest.pt)(startContainer);if("wysiwyg"===vditor.currentMode&&blockElement&&matchHotKey("⇧⌘;",event))return range.insertNode(document.createElement("wbr")),blockElement.outerHTML='<blockquote data-block="0">'.concat(blockElement.outerHTML,"</blockquote>"),(0,selection.ir)(vditor.wysiwyg.element,range),afterRenderEvent(vditor),event.preventDefault(),!0;if(insertAfterBlock(vditor,event,range,blockquoteElement,blockquoteElement))return!0;if(insertBeforeBlock(vditor,event,range,blockquoteElement,blockquoteElement))return!0}return!1},fixTask=function(vditor,range,event){var startContainer=range.startContainer,taskItemElement=(0,hasClosest.KJ)(startContainer,"vditor-task");if(taskItemElement){if(matchHotKey("⇧⌘J",event)){var inputElement=taskItemElement.firstElementChild;return inputElement.checked?inputElement.removeAttribute("checked"):inputElement.setAttribute("checked","checked"),execAfterRender(vditor),event.preventDefault(),!0}if("Backspace"===event.key&&!(0,compatibility._0)(event)&&!event.shiftKey&&!event.altKey&&""===range.toString()&&1===range.startOffset&&(3===startContainer.nodeType&&startContainer.previousSibling&&"INPUT"===startContainer.previousSibling.tagName||3!==startContainer.nodeType)){var previousElement=taskItemElement.previousElementSibling;return taskItemElement.querySelector("input").remove(),previousElement?((0,hasClosest.Rp)(previousElement).parentElement.insertAdjacentHTML("beforeend","<wbr>"+taskItemElement.innerHTML.trim()),taskItemElement.remove()):(taskItemElement.parentElement.insertAdjacentHTML("beforebegin",'<p data-block="0"><wbr>'.concat(taskItemElement.innerHTML.trim()||"\n","</p>")),taskItemElement.nextElementSibling?taskItemElement.remove():taskItemElement.parentElement.remove()),(0,selection.ir)(vditor[vditor.currentMode].element,range),execAfterRender(vditor),event.preventDefault(),!0}if("Enter"===event.key&&!(0,compatibility._0)(event)&&!event.shiftKey&&!event.altKey){if(""===taskItemElement.textContent.trim())if((0,hasClosest.KJ)(taskItemElement.parentElement,"vditor-task")){var topListElement=(0,hasClosest.KR)(startContainer);topListElement&&listOutdent(vditor,taskItemElement,range,topListElement)}else if(taskItemElement.nextElementSibling){var afterHTML_2="",beforeHTML_1="",isAfter_1=!1;Array.from(taskItemElement.parentElement.children).forEach((function(taskItem){taskItemElement.isSameNode(taskItem)?isAfter_1=!0:isAfter_1?afterHTML_2+=taskItem.outerHTML:beforeHTML_1+=taskItem.outerHTML}));var parentTagName=taskItemElement.parentElement.tagName,dataMarker="OL"===taskItemElement.parentElement.tagName?"":' data-marker="'.concat(taskItemElement.parentElement.getAttribute("data-marker"),'"'),startAttribute="";beforeHTML_1&&(startAttribute="UL"===taskItemElement.parentElement.tagName?"":' start="1"',beforeHTML_1="<".concat(parentTagName,' data-tight="true"').concat(dataMarker,' data-block="0">').concat(beforeHTML_1,"</").concat(parentTagName,">")),taskItemElement.parentElement.outerHTML="".concat(beforeHTML_1,'<p data-block="0"><wbr>\n</p><').concat(parentTagName,'\n data-tight="true"').concat(dataMarker,' data-block="0"').concat(startAttribute,">").concat(afterHTML_2,"</").concat(parentTagName,">")}else taskItemElement.parentElement.insertAdjacentHTML("afterend",'<p data-block="0"><wbr>\n</p>'),1===taskItemElement.parentElement.querySelectorAll("li").length?taskItemElement.parentElement.remove():taskItemElement.remove();else 3!==startContainer.nodeType&&0===range.startOffset&&"INPUT"===startContainer.firstChild.tagName?range.setStart(startContainer.childNodes[1],1):(range.setEndAfter(taskItemElement.lastChild),taskItemElement.insertAdjacentHTML("afterend",'<li class="vditor-task" data-marker="'.concat(taskItemElement.getAttribute("data-marker"),'"><input type="checkbox"> <wbr></li>')),document.querySelector("wbr").after(range.extractContents()));return(0,selection.ir)(vditor[vditor.currentMode].element,range),execAfterRender(vditor),scrollCenter(vditor),event.preventDefault(),!0}}return!1},fixDelete=function(vditor,range,event,pElement){if(3!==range.startContainer.nodeType){var rangeElement=range.startContainer.children[range.startOffset];if(rangeElement&&"HR"===rangeElement.tagName)return range.selectNodeContents(rangeElement.previousElementSibling),range.collapse(!1),event.preventDefault(),!0}if(pElement){var previousElement=pElement.previousElementSibling;if(previousElement&&0===(0,selection.ED)(pElement,vditor[vditor.currentMode].element,range).start&&((0,compatibility.gm)()&&"HR"===previousElement.tagName||"TABLE"===previousElement.tagName)){if("TABLE"===previousElement.tagName){var lastCellElement=previousElement.lastElementChild.lastElementChild.lastElementChild;lastCellElement.innerHTML=lastCellElement.innerHTML.trimLeft()+"<wbr>"+pElement.textContent.trim(),pElement.remove()}else previousElement.remove();return(0,selection.ir)(vditor[vditor.currentMode].element,range),execAfterRender(vditor),event.preventDefault(),!0}}return!1},fixHR=function(range){(0,compatibility.gm)()&&3!==range.startContainer.nodeType&&"HR"===range.startContainer.tagName&&range.setStartBefore(range.startContainer)},fixFirefoxArrowUpTable=function(event,blockElement,range){var _a,_b;if(!(0,compatibility.gm)())return!1;if("ArrowUp"===event.key&&blockElement&&"TABLE"===(null===(_a=blockElement.previousElementSibling)||void 0===_a?void 0:_a.tagName)){var tableElement=blockElement.previousElementSibling;return range.selectNodeContents(tableElement.rows[tableElement.rows.length-1].lastElementChild),range.collapse(!1),event.preventDefault(),!0}return!("ArrowDown"!==event.key||!blockElement||"TABLE"!==(null===(_b=blockElement.nextElementSibling)||void 0===_b?void 0:_b.tagName)||(range.selectNodeContents(blockElement.nextElementSibling.rows[0].cells[0]),range.collapse(!0),event.preventDefault(),0))},paste=function(vditor,event,callback){return fixBrowserBehavior_awaiter(void 0,void 0,void 0,(function(){var textHTML,textPlain,files,renderers,renderLinkDest,doc,height,code,codeElement,position,tempElement,fileReader_1,file_1,blockElement,range,_a;return fixBrowserBehavior_generator(this,(function(_b){switch(_b.label){case 0:return"true"!==vditor[vditor.currentMode].element.getAttribute("contenteditable")?[2]:(event.stopPropagation(),event.preventDefault(),"clipboardData"in event?(textHTML=event.clipboardData.getData("text/html"),textPlain=event.clipboardData.getData("text/plain"),files=event.clipboardData.files):(textHTML=event.dataTransfer.getData("text/html"),textPlain=event.dataTransfer.getData("text/plain"),event.dataTransfer.types.includes("Files")&&(files=event.dataTransfer.items)),renderers={},renderLinkDest=function(node,entering){if(!entering)return["",Lute.WalkContinue];if(vditor.options.upload.renderLinkDest)return vditor.options.upload.renderLinkDest(vditor,node,entering);var src2=node.TokensStr();if(34===node.__internal_object__.Parent.Type&&src2&&-1===src2.indexOf("file://")&&vditor.options.upload.linkToImgUrl){var xhr_1=new XMLHttpRequest;xhr_1.open("POST",vditor.options.upload.linkToImgUrl),vditor.options.upload.token&&xhr_1.setRequestHeader("X-Upload-Token",vditor.options.upload.token),vditor.options.upload.withCredentials&&(xhr_1.withCredentials=!0),setHeaders(vditor,xhr_1),xhr_1.setRequestHeader("Content-Type","application/json; charset=utf-8"),xhr_1.onreadystatechange=function(){if(xhr_1.readyState===XMLHttpRequest.DONE){if(200===xhr_1.status){var responseText=xhr_1.responseText;vditor.options.upload.linkToImgFormat&&(responseText=vditor.options.upload.linkToImgFormat(xhr_1.responseText));var responseJSON_1=JSON.parse(responseText);if(0!==responseJSON_1.code)return void vditor.tip.show(responseJSON_1.msg);var original_1=responseJSON_1.data.originalURL;if("sv"===vditor.currentMode)vditor.sv.element.querySelectorAll(".vditor-sv__marker--link").forEach((function(item){item.textContent===original_1&&(item.textContent=responseJSON_1.data.url)}));else{var imgElement=vditor[vditor.currentMode].element.querySelector('img[src="'.concat(original_1,'"]'));imgElement.src=responseJSON_1.data.url,"ir"===vditor.currentMode&&(imgElement.previousElementSibling.previousElementSibling.innerHTML=responseJSON_1.data.url)}execAfterRender(vditor)}else vditor.tip.show(xhr_1.responseText);vditor.options.upload.linkToImgCallback&&vditor.options.upload.linkToImgCallback(xhr_1.responseText)}},xhr_1.send(JSON.stringify({url:src2}))}return"ir"===vditor.currentMode?['<span class="vditor-ir__marker vditor-ir__marker--link">'.concat(Lute.EscapeHTMLStr(src2),"</span>"),Lute.WalkContinue]:"wysiwyg"===vditor.currentMode?["",Lute.WalkContinue]:['<span class="vditor-sv__marker--link">'.concat(Lute.EscapeHTMLStr(src2),"</span>"),Lute.WalkContinue]},textHTML.replace(/&amp;/g,"&").replace(/<(|\/)(html|body|meta)[^>]*?>/gi,"").trim()!=='<a href="'.concat(textPlain,'">').concat(textPlain,"</a>")&&textHTML.replace(/&amp;/g,"&").replace(/<(|\/)(html|body|meta)[^>]*?>/gi,"").trim()!=='\x3c!--StartFragment--\x3e<a href="'.concat(textPlain,'">').concat(textPlain,"</a>\x3c!--EndFragment--\x3e")||(textHTML=""),(doc=(new DOMParser).parseFromString(textHTML,"text/html")).body&&(textHTML=doc.body.innerHTML),textHTML=Lute.Sanitize(textHTML),vditor.wysiwyg.getComments(vditor),height=vditor[vditor.currentMode].element.scrollHeight,code=function(html,text,type){void 0===type&&(type="sv");var tempElement=document.createElement("div");tempElement.innerHTML=html;var isCode=!1;1===tempElement.childElementCount&&tempElement.lastElementChild.style.fontFamily.indexOf("monospace")>-1&&(isCode=!0);var pres=tempElement.querySelectorAll("pre");if(1===tempElement.childElementCount&&1===pres.length&&"vditor-wysiwyg"!==pres[0].className&&"vditor-sv"!==pres[0].className&&(isCode=!0),0===html.indexOf('\n<p class="p1">')&&(isCode=!0),1===tempElement.childElementCount&&"TABLE"===tempElement.firstElementChild.tagName&&tempElement.querySelector(".line-number")&&tempElement.querySelector(".line-content")&&(isCode=!0),isCode){var code=text||html;return/\n/.test(code)||1===pres.length?"wysiwyg"===type?'<div class="vditor-wysiwyg__block" data-block="0" data-type="code-block"><pre><code>'.concat(code.replace(/&/g,"&amp;").replace(/</g,"&lt;"),"<wbr></code></pre></div>"):"\n```\n"+code.replace(/&/g,"&amp;").replace(/</g,"&lt;")+"\n```":"wysiwyg"===type?"<code>".concat(code.replace(/&/g,"&amp;").replace(/</g,"&lt;"),"</code><wbr>"):"`".concat(code,"`")}return!1}(textHTML,textPlain,vditor.currentMode),(codeElement="sv"===vditor.currentMode?(0,hasClosest.Th)(event.target,"data-type","code-block"):(0,hasClosest._Y)(event.target,"CODE"))?("sv"===vditor.currentMode?document.execCommand("insertHTML",!1,textPlain.replace(/&/g,"&amp;").replace(/</g,"&lt;")):(position=(0,selection.ED)(event.target,vditor[vditor.currentMode].element),"PRE"!==codeElement.parentElement.tagName&&(textPlain+=constants.Y.ZWSP),codeElement.textContent=codeElement.textContent.substring(0,position.start)+textPlain+codeElement.textContent.substring(position.end),(0,selection.Fm)(position.start+textPlain.length,position.start+textPlain.length,codeElement.parentElement),(null===(_a=codeElement.parentElement)||void 0===_a?void 0:_a.nextElementSibling.classList.contains("vditor-".concat(vditor.currentMode,"__preview")))&&(codeElement.parentElement.nextElementSibling.innerHTML=codeElement.outerHTML,processCodeRender(codeElement.parentElement.nextElementSibling,vditor))),[3,8]):[3,1]);case 1:return code?(callback.pasteCode(code),[3,8]):[3,2];case 2:return""===textHTML.trim()?[3,3]:((tempElement=document.createElement("div")).innerHTML=textHTML,tempElement.querySelectorAll("[style]").forEach((function(e){e.removeAttribute("style")})),tempElement.querySelectorAll(".vditor-copy").forEach((function(e){e.remove()})),"ir"===vditor.currentMode?(renderers.HTML2VditorIRDOM={renderLinkDest:renderLinkDest},vditor.lute.SetJSRenderers({renderers:renderers}),(0,selection.Z2)(vditor.lute.HTML2VditorIRDOM(tempElement.innerHTML),vditor)):"wysiwyg"===vditor.currentMode?(renderers.HTML2VditorDOM={renderLinkDest:renderLinkDest},vditor.lute.SetJSRenderers({renderers:renderers}),(0,selection.Z2)(vditor.lute.HTML2VditorDOM(tempElement.innerHTML),vditor)):(renderers.Md2VditorSVDOM={renderLinkDest:renderLinkDest},vditor.lute.SetJSRenderers({renderers:renderers}),processPaste(vditor,vditor.lute.HTML2Md(tempElement.innerHTML).trimRight())),vditor.outline.render(vditor),[3,8]);case 3:return files.length>0?vditor.options.upload.url||vditor.options.upload.handler?[4,uploadFiles(vditor,files)]:[3,5]:[3,7];case 4:return _b.sent(),[3,6];case 5:fileReader_1=new FileReader,"clipboardData"in event?(files=event.clipboardData.files,file_1=files[0]):event.dataTransfer.types.includes("Files")&&(files=event.dataTransfer.items,file_1=files[0].getAsFile()),file_1&&file_1.type.startsWith("image")&&(fileReader_1.readAsDataURL(file_1),fileReader_1.onload=function(){var imgHTML="";"wysiwyg"===vditor.currentMode?imgHTML+='<img alt="'.concat(file_1.name,'" src="').concat(fileReader_1.result.toString(),'">\n'):imgHTML+="![".concat(file_1.name,"](").concat(fileReader_1.result.toString(),")\n"),document.execCommand("insertHTML",!1,imgHTML)}),_b.label=6;case 6:return[3,8];case 7:""!==textPlain.trim()&&0===files.length&&(""!==(range=(0,selection.RN)(vditor)).toString()&&vditor.lute.IsValidLinkDest(textPlain)&&(textPlain="[".concat(range.toString(),"](").concat(textPlain,")")),"ir"===vditor.currentMode?(renderers.Md2VditorIRDOM={renderLinkDest:renderLinkDest},vditor.lute.SetJSRenderers({renderers:renderers}),(0,selection.Z2)(vditor.lute.Md2VditorIRDOM(textPlain),vditor)):"wysiwyg"===vditor.currentMode?(renderers.Md2VditorDOM={renderLinkDest:renderLinkDest},vditor.lute.SetJSRenderers({renderers:renderers}),(0,selection.Z2)(vditor.lute.Md2VditorDOM(textPlain),vditor)):(renderers.Md2VditorSVDOM={renderLinkDest:renderLinkDest},vditor.lute.SetJSRenderers({renderers:renderers}),processPaste(vditor,textPlain)),vditor.outline.render(vditor)),_b.label=8;case 8:return"sv"!==vditor.currentMode&&((blockElement=(0,hasClosest.pt)((0,selection.RN)(vditor).startContainer))&&(range=(0,selection.RN)(vditor),vditor[vditor.currentMode].element.querySelectorAll("wbr").forEach((function(wbr){wbr.remove()})),range.insertNode(document.createElement("wbr")),"wysiwyg"===vditor.currentMode?blockElement.outerHTML=vditor.lute.SpinVditorDOM(blockElement.outerHTML):blockElement.outerHTML=vditor.lute.SpinVditorIRDOM(blockElement.outerHTML),(0,selection.ir)(vditor[vditor.currentMode].element,range)),vditor[vditor.currentMode].element.querySelectorAll(".vditor-".concat(vditor.currentMode,"__preview[data-render='2']")).forEach((function(item){processCodeRender(item,vditor)}))),vditor.wysiwyg.triggerRemoveComment(vditor),execAfterRender(vditor),vditor[vditor.currentMode].element.scrollHeight-height>Math.min(vditor[vditor.currentMode].element.clientHeight,window.innerHeight)/2&&scrollCenter(vditor),[2]}}))}))},processHint=function(vditor){var _a,_b;vditor.hint.render(vditor);var startContainer=(0,selection.RN)(vditor).startContainer,preBeforeElement=(0,hasClosest.Th)(startContainer,"data-type","code-block-info");if(preBeforeElement)if(""===preBeforeElement.textContent.replace(constants.Y.ZWSP,"")&&vditor.hint.recentLanguage)preBeforeElement.textContent=constants.Y.ZWSP+vditor.hint.recentLanguage,(0,selection.RN)(vditor).selectNodeContents(preBeforeElement);else{var matchLangData_1=[],key_1=preBeforeElement.textContent.substring(0,(0,selection.ED)(preBeforeElement,vditor.ir.element).start).replace(constants.Y.ZWSP,"");(vditor.options.preview.hljs.langs||constants.Y.ALIAS_CODE_LANGUAGES.concat((null!==(_b=null===(_a=window.hljs)||void 0===_a?void 0:_a.listLanguages())&&void 0!==_b?_b:[]).sort())).forEach((function(keyName){keyName.indexOf(key_1.toLowerCase())>-1&&matchLangData_1.push({html:keyName,value:keyName})})),vditor.hint.genHTML(matchLangData_1,key_1,vditor)}},process_processAfterRender=function(vditor,options){void 0===options&&(options={enableAddUndoStack:!0,enableHint:!1,enableInput:!0}),options.enableHint&&processHint(vditor),clearTimeout(vditor.ir.processTimeoutId),vditor.ir.processTimeoutId=window.setTimeout((function(){if(!vditor.ir.composingLock){var text=getMarkdown(vditor);"function"==typeof vditor.options.input&&options.enableInput&&vditor.options.input(text),vditor.options.counter.enable&&vditor.counter.render(vditor,text),vditor.options.cache.enable&&(0,compatibility.D)()&&(localStorage.setItem(vditor.options.cache.id,text),vditor.options.cache.after&&vditor.options.cache.after(text)),vditor.devtools&&vditor.devtools.renderEchart(vditor),options.enableAddUndoStack&&vditor.undo.addToUndoStack(vditor)}}),vditor.options.undoDelay)},process_processHeading=function(vditor,value){var range=(0,selection.RN)(vditor),headingElement=(0,hasClosest.pt)(range.startContainer)||range.startContainer;if(headingElement){var headingMarkerElement=headingElement.querySelector(".vditor-ir__marker--heading");headingMarkerElement?headingMarkerElement.innerHTML=value:(headingElement.insertAdjacentText("afterbegin",value),range.selectNodeContents(headingElement),range.collapse(!1)),input(vditor,range.cloneRange()),highlightToolbarIR(vditor)}},removeInline=function(range,vditor,type){var inlineElement=(0,hasClosest.Th)(range.startContainer,"data-type",type);if(inlineElement){inlineElement.firstElementChild.remove(),inlineElement.lastElementChild.remove(),range.insertNode(document.createElement("wbr"));var tempElement=document.createElement("div");tempElement.innerHTML=vditor.lute.SpinVditorIRDOM(inlineElement.outerHTML),inlineElement.outerHTML=tempElement.firstElementChild.innerHTML.trim()}},process_processToolbar=function(vditor,actionBtn,prefix,suffix){var range=(0,selection.RN)(vditor),commandName=actionBtn.getAttribute("data-type"),typeElement=range.startContainer;3===typeElement.nodeType&&(typeElement=typeElement.parentElement);var useHighlight=!0;if(actionBtn.classList.contains("vditor-menu--current"))if("quote"===commandName){var quoteElement=(0,hasClosest._Y)(typeElement,"BLOCKQUOTE");quoteElement&&(range.insertNode(document.createElement("wbr")),quoteElement.outerHTML=""===quoteElement.innerHTML.trim()?'<p data-block="0">'.concat(quoteElement.innerHTML,"</p>"):quoteElement.innerHTML)}else if("link"===commandName){var aElement=(0,hasClosest.Th)(range.startContainer,"data-type","a");if(aElement){var aTextElement=(0,hasClosest.KJ)(range.startContainer,"vditor-ir__link");aTextElement?(range.insertNode(document.createElement("wbr")),aElement.outerHTML=aTextElement.innerHTML):aElement.outerHTML=aElement.querySelector(".vditor-ir__link").innerHTML+"<wbr>"}}else"italic"===commandName?removeInline(range,vditor,"em"):"bold"===commandName?removeInline(range,vditor,"strong"):"strike"===commandName?removeInline(range,vditor,"s"):"inline-code"===commandName?removeInline(range,vditor,"code"):"check"!==commandName&&"list"!==commandName&&"ordered-list"!==commandName||(listToggle(vditor,range,commandName),useHighlight=!1,actionBtn.classList.remove("vditor-menu--current"));else{0===vditor.ir.element.childNodes.length&&(vditor.ir.element.innerHTML='<p data-block="0"><wbr></p>',(0,selection.ir)(vditor.ir.element,range));var blockElement=(0,hasClosest.pt)(range.startContainer);if("line"===commandName){if(blockElement){var hrHTML='<hr data-block="0"><p data-block="0"><wbr>\n</p>';""===blockElement.innerHTML.trim()?blockElement.outerHTML=hrHTML:blockElement.insertAdjacentHTML("afterend",hrHTML)}}else if("quote"===commandName)blockElement&&(range.insertNode(document.createElement("wbr")),blockElement.outerHTML='<blockquote data-block="0">'.concat(blockElement.outerHTML,"</blockquote>"),useHighlight=!1,actionBtn.classList.add("vditor-menu--current"));else if("link"===commandName){var html=void 0;html=""===range.toString()?"".concat(prefix,"<wbr>").concat(suffix):"".concat(prefix).concat(range.toString()).concat(suffix.replace(")","<wbr>)")),document.execCommand("insertHTML",!1,html),useHighlight=!1,actionBtn.classList.add("vditor-menu--current")}else if("italic"===commandName||"bold"===commandName||"strike"===commandName||"inline-code"===commandName||"code"===commandName||"table"===commandName){html=void 0,""===range.toString()?html="".concat(prefix,"<wbr>").concat(suffix):(html="code"===commandName?"".concat(prefix,"\n").concat(range.toString(),"<wbr>").concat(suffix):"table"===commandName?"".concat(prefix).concat(range.toString(),"<wbr>").concat(suffix):"".concat(prefix).concat(range.toString()).concat(suffix,"<wbr>"),range.deleteContents()),"table"!==commandName&&"code"!==commandName||(html="\n"+html+"\n\n");var spanElement=document.createElement("span");spanElement.innerHTML=html,range.insertNode(spanElement),input(vditor,range),"table"===commandName&&(range.selectNodeContents(getSelection().getRangeAt(0).startContainer.parentElement),(0,selection.jl)(range))}else"check"!==commandName&&"list"!==commandName&&"ordered-list"!==commandName||(listToggle(vditor,range,commandName,!1),useHighlight=!1,removeCurrentToolbar(vditor.toolbar.elements,["check","list","ordered-list"]),actionBtn.classList.add("vditor-menu--current"))}(0,selection.ir)(vditor.ir.element,range),process_processAfterRender(vditor),useHighlight&&highlightToolbarIR(vditor)},hint_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P((function(resolve){resolve(value)}))).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},hint_generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;g&&(g=0,op[0]&&(_=0)),_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!((t=(t=_.trys).length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},Hint=function(){function Hint2(hintExtends){var _this=this;this.splitChar="",this.lastIndex=-1,this.fillEmoji=function(element,vditor){_this.element.style.display="none";var value=decodeURIComponent(element.getAttribute("data-value")),range=window.getSelection().getRangeAt(0);if("ir"===vditor.currentMode){var preBeforeElement=(0,hasClosest.Th)(range.startContainer,"data-type","code-block-info");if(preBeforeElement)return preBeforeElement.textContent=constants.Y.ZWSP+value.trimRight(),range.selectNodeContents(preBeforeElement),range.collapse(!1),process_processAfterRender(vditor),preBeforeElement.parentElement.querySelectorAll("code").forEach((function(item){item.className="language-"+value.trimRight()})),processCodeRender(preBeforeElement.parentElement.querySelector(".vditor-ir__preview"),vditor),void(_this.recentLanguage=value.trimRight())}if("wysiwyg"===vditor.currentMode&&3!==range.startContainer.nodeType){var startContainer=range.startContainer,inputElement=void 0;if((inputElement=startContainer.classList.contains("vditor-input")?startContainer:startContainer.firstElementChild)&&inputElement.classList.contains("vditor-input"))return inputElement.value=value.trimRight(),range.selectNodeContents(inputElement),range.collapse(!1),inputElement.dispatchEvent(new CustomEvent("input",{detail:1})),void(_this.recentLanguage=value.trimRight())}if(range.setStart(range.startContainer,_this.lastIndex),range.deleteContents(),vditor.options.hint.parse?"sv"===vditor.currentMode?(0,selection.Z2)(vditor.lute.SpinVditorSVDOM(value),vditor):"wysiwyg"===vditor.currentMode?(0,selection.Z2)(vditor.lute.SpinVditorDOM(value),vditor):(0,selection.Z2)(vditor.lute.SpinVditorIRDOM(value),vditor):(0,selection.Z2)(value,vditor),":"===_this.splitChar&&value.indexOf(":")>-1&&"sv"!==vditor.currentMode&&range.insertNode(document.createTextNode(" ")),range.collapse(!1),(0,selection.jl)(range),"wysiwyg"===vditor.currentMode)(preElement=(0,hasClosest.KJ)(range.startContainer,"vditor-wysiwyg__block"))&&preElement.lastElementChild.classList.contains("vditor-wysiwyg__preview")&&(preElement.lastElementChild.innerHTML=preElement.firstElementChild.innerHTML,processCodeRender(preElement.lastElementChild,vditor));else if("ir"===vditor.currentMode){var preElement;(preElement=(0,hasClosest.KJ)(range.startContainer,"vditor-ir__marker--pre"))&&preElement.nextElementSibling.classList.contains("vditor-ir__preview")&&(preElement.nextElementSibling.innerHTML=preElement.innerHTML,processCodeRender(preElement.nextElementSibling,vditor))}execAfterRender(vditor)},this.timeId=-1,this.element=document.createElement("div"),this.element.className="vditor-hint",this.recentLanguage="",hintExtends.push({key:":"})}return Hint2.prototype.render=function(vditor){var _this=this;if(window.getSelection().focusNode){var currentLineValue,range=getSelection().getRangeAt(0);currentLineValue=range.startContainer.textContent.substring(0,range.startOffset)||"";var key=this.getKey(currentLineValue,vditor.options.hint.extend);if(void 0===key)this.element.style.display="none",clearTimeout(this.timeId);else if(":"===this.splitChar){var emojiHint_1=""===key?vditor.options.hint.emoji:vditor.lute.GetEmojis(),matchEmojiData_1=[];Object.keys(emojiHint_1).forEach((function(keyName){0===keyName.indexOf(key.toLowerCase())&&(emojiHint_1[keyName].indexOf(".")>-1?matchEmojiData_1.push({html:'<img src="'.concat(emojiHint_1[keyName],'" title=":').concat(keyName,':"/> :').concat(keyName,":"),value:":".concat(keyName,":")}):matchEmojiData_1.push({html:'<span class="vditor-hint__emoji">'.concat(emojiHint_1[keyName],"</span>").concat(keyName),value:emojiHint_1[keyName]}))})),this.genHTML(matchEmojiData_1,key,vditor)}else vditor.options.hint.extend.forEach((function(item){item.key===_this.splitChar&&(clearTimeout(_this.timeId),_this.timeId=window.setTimeout((function(){return hint_awaiter(_this,void 0,void 0,(function(){var _a;return hint_generator(this,(function(_b){switch(_b.label){case 0:return _a=this.genHTML,[4,item.hint(key)];case 1:return _a.apply(this,[_b.sent(),key,vditor]),[2]}}))}))}),vditor.options.hint.delay))}))}},Hint2.prototype.genHTML=function(data,key,vditor){var _this=this;if(0!==data.length){var editorElement=vditor[vditor.currentMode].element,textareaPosition=(0,selection.Ey)(editorElement),x=textareaPosition.left+("left"===vditor.options.outline.position?vditor.outline.element.offsetWidth:0),y=textareaPosition.top,hintsHTML="";data.forEach((function(hintData,i){if(!(i>7)){var html=hintData.html;if(""!==key){var lastIndex=html.lastIndexOf(">")+1,replaceHtml=html.substr(lastIndex),replaceIndex=replaceHtml.toLowerCase().indexOf(key.toLowerCase());replaceIndex>-1&&(replaceHtml=replaceHtml.substring(0,replaceIndex)+"<b>"+replaceHtml.substring(replaceIndex,replaceIndex+key.length)+"</b>"+replaceHtml.substring(replaceIndex+key.length),html=html.substr(0,lastIndex)+replaceHtml)}hintsHTML+='<button type="button" data-value="'.concat(encodeURIComponent(hintData.value),' "\n').concat(0===i?"class='vditor-hint--current'":"","> ").concat(html,"</button>")}})),this.element.innerHTML=hintsHTML;var lineHeight=parseInt(document.defaultView.getComputedStyle(editorElement,null).getPropertyValue("line-height"),10);this.element.style.top="".concat(y+(lineHeight||22),"px"),this.element.style.left="".concat(x,"px"),this.element.style.display="block",this.element.style.right="auto",this.element.querySelectorAll("button").forEach((function(element){element.addEventListener("click",(function(event){_this.fillEmoji(element,vditor),event.preventDefault()}))})),this.element.getBoundingClientRect().bottom>window.innerHeight&&(this.element.style.top="".concat(y-this.element.offsetHeight,"px")),this.element.getBoundingClientRect().right>window.innerWidth&&(this.element.style.left="auto",this.element.style.right="0")}else this.element.style.display="none"},Hint2.prototype.select=function(event,vditor){if(0===this.element.querySelectorAll("button").length||"none"===this.element.style.display)return!1;var currentHintElement=this.element.querySelector(".vditor-hint--current");if("ArrowDown"===event.key)return event.preventDefault(),event.stopPropagation(),currentHintElement.removeAttribute("class"),currentHintElement.nextElementSibling?currentHintElement.nextElementSibling.className="vditor-hint--current":this.element.children[0].className="vditor-hint--current",!0;if("ArrowUp"===event.key){if(event.preventDefault(),event.stopPropagation(),currentHintElement.removeAttribute("class"),currentHintElement.previousElementSibling)currentHintElement.previousElementSibling.className="vditor-hint--current";else{var length_1=this.element.children.length;this.element.children[length_1-1].className="vditor-hint--current"}return!0}return!((0,compatibility._0)(event)||event.shiftKey||event.altKey||"Enter"!==event.key||event.isComposing||(event.preventDefault(),event.stopPropagation(),this.fillEmoji(currentHintElement,vditor),0))},Hint2.prototype.getKey=function(currentLineValue,extend){var key,_this=this;if(this.lastIndex=-1,this.splitChar="",extend.forEach((function(item){var currentLastIndex=currentLineValue.lastIndexOf(item.key);_this.lastIndex<currentLastIndex&&(_this.splitChar=item.key,_this.lastIndex=currentLastIndex)})),-1===this.lastIndex)return key;var lineArray=currentLineValue.split(this.splitChar),lastItem=lineArray[lineArray.length-1];if(lineArray.length>1&&lastItem.trim()===lastItem)if(2===lineArray.length&&""===lineArray[0]&&lineArray[1].length<32)key=lineArray[1];else{var preChar=lineArray[lineArray.length-2].slice(-1);" "===(0,code160to32.p)(preChar)&&lastItem.length<32&&(key=lastItem)}return key},Hint2}(),IR=function(){function IR2(vditor){this.composingLock=!1;var divElement=document.createElement("div");divElement.className="vditor-ir",divElement.innerHTML='<pre class="vditor-reset" placeholder="'.concat(vditor.options.placeholder,'"\n contenteditable="true" spellcheck="false"></pre>'),this.element=divElement.firstElementChild,this.bindEvent(vditor),focusEvent(vditor,this.element),dblclickEvent(vditor,this.element),blurEvent(vditor,this.element),hotkeyEvent(vditor,this.element),selectEvent(vditor,this.element),dropEvent(vditor,this.element),copyEvent(vditor,this.element,this.copy),cutEvent(vditor,this.element,this.copy)}return IR2.prototype.copy=function(event,vditor){var range=getSelection().getRangeAt(0);if(""!==range.toString()){event.stopPropagation(),event.preventDefault();var tempElement=document.createElement("div");tempElement.appendChild(range.cloneContents()),event.clipboardData.setData("text/plain",vditor.lute.VditorIRDOM2Md(tempElement.innerHTML).trim()),event.clipboardData.setData("text/html","")}},IR2.prototype.bindEvent=function(vditor){var _this=this;this.element.addEventListener("paste",(function(event){paste(vditor,event,{pasteCode:function(code){document.execCommand("insertHTML",!1,code)}})})),this.element.addEventListener("scroll",(function(){hidePanel(vditor,["hint"])})),this.element.addEventListener("compositionstart",(function(event){_this.composingLock=!0})),this.element.addEventListener("compositionend",(function(event){(0,compatibility.gm)()||input(vditor,getSelection().getRangeAt(0).cloneRange()),_this.composingLock=!1})),this.element.addEventListener("input",(function(event){if("deleteByDrag"!==event.inputType&&"insertFromDrop"!==event.inputType)return _this.preventInput?(_this.preventInput=!1,void process_processAfterRender(vditor,{enableAddUndoStack:!0,enableHint:!0,enableInput:!0})):void(_this.composingLock||"‘"===event.data||"“"===event.data||"《"===event.data||input(vditor,getSelection().getRangeAt(0).cloneRange(),!1,event))})),this.element.addEventListener("click",(function(event){if("INPUT"===event.target.tagName)return event.target.checked?event.target.setAttribute("checked","checked"):event.target.removeAttribute("checked"),_this.preventInput=!0,void process_processAfterRender(vditor);var range=(0,selection.RN)(vditor),previewElement=(0,hasClosest.KJ)(event.target,"vditor-ir__preview");if(previewElement||(previewElement=(0,hasClosest.KJ)(range.startContainer,"vditor-ir__preview")),previewElement&&(previewElement.previousElementSibling.firstElementChild?range.selectNodeContents(previewElement.previousElementSibling.firstElementChild):range.selectNodeContents(previewElement.previousElementSibling),range.collapse(!0),(0,selection.jl)(range),scrollCenter(vditor)),"IMG"===event.target.tagName){var linkElement=event.target.parentElement.querySelector(".vditor-ir__marker--link");linkElement&&(range.selectNode(linkElement),(0,selection.jl)(range))}var aElement=(0,hasClosest.Th)(event.target,"data-type","a");if(!aElement||aElement.classList.contains("vditor-ir__node--expand")){if(event.target.isEqualNode(_this.element)&&_this.element.lastElementChild&&range.collapsed){var lastRect=_this.element.lastElementChild.getBoundingClientRect();event.y>lastRect.top+lastRect.height&&("P"===_this.element.lastElementChild.tagName&&""===_this.element.lastElementChild.textContent.trim().replace(constants.Y.ZWSP,"")?(range.selectNodeContents(_this.element.lastElementChild),range.collapse(!1)):(_this.element.insertAdjacentHTML("beforeend",'<p data-block="0">'.concat(constants.Y.ZWSP,"<wbr></p>")),(0,selection.ir)(_this.element,range)))}""===range.toString()?expandMarker(range,vditor):setTimeout((function(){expandMarker((0,selection.RN)(vditor),vditor)})),clickToc(event,vditor),highlightToolbarIR(vditor)}else vditor.options.link.click?vditor.options.link.click(aElement.querySelector(":scope > .vditor-ir__marker--link")):vditor.options.link.isOpen&&window.open(aElement.querySelector(":scope > .vditor-ir__marker--link").textContent)})),this.element.addEventListener("keyup",(function(event){if(!event.isComposing&&!(0,compatibility._0)(event))if("Enter"===event.key&&scrollCenter(vditor),highlightToolbarIR(vditor),"Backspace"!==event.key&&"Delete"!==event.key||""===vditor.ir.element.innerHTML||1!==vditor.ir.element.childNodes.length||!vditor.ir.element.firstElementChild||"P"!==vditor.ir.element.firstElementChild.tagName||0!==vditor.ir.element.firstElementChild.childElementCount||""!==vditor.ir.element.textContent&&"\n"!==vditor.ir.element.textContent){var range=(0,selection.RN)(vditor);"Backspace"===event.key?((0,compatibility.gm)()&&"\n"===range.startContainer.textContent&&1===range.startOffset&&(range.startContainer.textContent="",expandMarker(range,vditor)),_this.element.querySelectorAll(".language-math").forEach((function(item){var brElement=item.querySelector("br");brElement&&brElement.remove()}))):event.key.indexOf("Arrow")>-1?("ArrowLeft"!==event.key&&"ArrowRight"!==event.key||processHint(vditor),expandMarker(range,vditor)):229===event.keyCode&&""===event.code&&"Unidentified"===event.key&&expandMarker(range,vditor);var previewRenderElement=(0,hasClosest.KJ)(range.startContainer,"vditor-ir__preview");if(previewRenderElement){if("ArrowUp"===event.key||"ArrowLeft"===event.key)return previewRenderElement.previousElementSibling.firstElementChild?range.selectNodeContents(previewRenderElement.previousElementSibling.firstElementChild):range.selectNodeContents(previewRenderElement.previousElementSibling),range.collapse(!1),event.preventDefault(),!0;if("SPAN"===previewRenderElement.tagName&&("ArrowDown"===event.key||"ArrowRight"===event.key))return"html-entity"===previewRenderElement.parentElement.getAttribute("data-type")?(previewRenderElement.parentElement.insertAdjacentText("afterend",constants.Y.ZWSP),range.setStart(previewRenderElement.parentElement.nextSibling,1)):range.selectNodeContents(previewRenderElement.parentElement.lastElementChild),range.collapse(!1),event.preventDefault(),!0}}else vditor.ir.element.innerHTML=""}))},IR2}(),getHTML=function(vditor){return"sv"===vditor.currentMode?vditor.lute.Md2HTML(getMarkdown(vditor)):"wysiwyg"===vditor.currentMode?vditor.lute.VditorDOM2HTML(vditor.wysiwyg.element.innerHTML):"ir"===vditor.currentMode?vditor.lute.VditorIRDOM2HTML(vditor.ir.element.innerHTML):void 0},setLute=__webpack_require__(796),outlineRender=__webpack_require__(70),Outline=function(){function Outline2(outlineLabel){this.element=document.createElement("div"),this.element.className="vditor-outline",this.element.innerHTML='<div class="vditor-outline__title">'.concat(outlineLabel,'</div>\n<div class="vditor-outline__content"></div>')}return Outline2.prototype.render=function(vditor){return"block"===vditor.preview.element.style.display?(0,outlineRender.N)(vditor.preview.previewElement,this.element.lastElementChild,vditor):(0,outlineRender.N)(vditor[vditor.currentMode].element,this.element.lastElementChild,vditor)},Outline2.prototype.toggle=function(vditor,show,focus){var _a;void 0===show&&(show=!0),void 0===focus&&(focus=!0);var btnElement=null===(_a=vditor.toolbar.elements.outline)||void 0===_a?void 0:_a.firstElementChild;if(show&&window.innerWidth>=constants.Y.MOBILE_WIDTH?(this.element.style.display="block",this.render(vditor),null==btnElement||btnElement.classList.add("vditor-menu--current")):(this.element.style.display="none",null==btnElement||btnElement.classList.remove("vditor-menu--current")),focus&&getSelection().rangeCount>0){var range=getSelection().getRangeAt(0);vditor[vditor.currentMode].element.contains(range.startContainer)&&(0,selection.jl)(range)}setPadding(vditor)},Outline2}(),mediaRender=__webpack_require__(0),Preview=function(){function Preview2(vditor){var _this=this;this.element=document.createElement("div"),this.element.className="vditor-preview",this.previewElement=document.createElement("div"),this.previewElement.className="vditor-reset",vditor.options.classes.preview&&this.previewElement.classList.add(vditor.options.classes.preview),this.previewElement.style.maxWidth=vditor.options.preview.maxWidth+"px",this.previewElement.addEventListener("copy",(function(event){if("TEXTAREA"!==event.target.tagName){var tempElement=document.createElement("div");tempElement.className="vditor-reset",tempElement.appendChild(getSelection().getRangeAt(0).cloneContents()),_this.copyToX(vditor,tempElement,"default"),event.preventDefault()}})),this.previewElement.addEventListener("click",(function(event){var spanElement=(0,hasClosest._Y)(event.target,"SPAN");if(spanElement&&(0,hasClosest.KJ)(spanElement,"vditor-toc")){var headingElement=_this.previewElement.querySelector("#"+spanElement.getAttribute("data-target-id"));headingElement&&(_this.element.scrollTop=headingElement.offsetTop)}else{if("A"===event.target.tagName)return vditor.options.link.click?vditor.options.link.click(event.target):vditor.options.link.isOpen&&window.open(event.target.getAttribute("href")),void event.preventDefault();"IMG"===event.target.tagName&&(vditor.options.image.preview?vditor.options.image.preview(event.target):vditor.options.image.isPreview&&(0,preview_image.o)(event.target,vditor.options.lang,vditor.options.theme))}})),this.element.appendChild(this.previewElement);var actions=vditor.options.preview.actions;if(0!==actions.length){var actionElement=document.createElement("div");actionElement.className="vditor-preview__action";for(var actionHtml=[],i=0;i<actions.length;i++){var action=actions[i];if("object"!=typeof action)switch(action){case"desktop":actionHtml.push('<button type="button" class="vditor-preview__action--current" data-type="desktop">Desktop</button>');break;case"tablet":actionHtml.push('<button type="button" data-type="tablet">Tablet</button>');break;case"mobile":actionHtml.push('<button type="button" data-type="mobile">Mobile/Wechat</button>');break;case"mp-wechat":actionHtml.push('<button type="button" data-type="mp-wechat" class="vditor-tooltipped vditor-tooltipped__w" aria-label="复制到公众号"><svg><use xlink:href="#vditor-icon-mp-wechat"></use></svg></button>');break;case"zhihu":actionHtml.push('<button type="button" data-type="zhihu" class="vditor-tooltipped vditor-tooltipped__w" aria-label="复制到知乎"><svg><use xlink:href="#vditor-icon-zhihu"></use></svg></button>')}else actionHtml.push('<button type="button" data-type="'.concat(action.key,'" class="').concat(action.className,'"').concat(action.tooltip?' aria-label="'.concat(action.tooltip,'"'):"",'">').concat(action.text,"</button>"))}actionElement.innerHTML=actionHtml.join(""),actionElement.addEventListener((0,compatibility.y3)(),(function(event){var btn=(0,hasClosestByHeadings.f)(event.target,"BUTTON");if(btn){var type=btn.getAttribute("data-type"),actionCustom=actions.find((function(w){return(null==w?void 0:w.key)===type}));actionCustom?actionCustom.click(type):"mp-wechat"!==type&&"zhihu"!==type?(_this.previewElement.style.width="desktop"===type?"auto":"tablet"===type?"780px":"360px",_this.previewElement.scrollWidth>_this.previewElement.parentElement.clientWidth&&(_this.previewElement.style.width="auto"),_this.render(vditor),actionElement.querySelectorAll("button").forEach((function(item){item.classList.remove("vditor-preview__action--current")})),btn.classList.add("vditor-preview__action--current")):_this.copyToX(vditor,_this.previewElement.cloneNode(!0),type)}})),this.element.insertBefore(actionElement,this.previewElement)}}return Preview2.prototype.render=function(vditor,value){var _this=this;if(clearTimeout(this.mdTimeoutId),"none"!==this.element.style.display)if(value)this.previewElement.innerHTML=value;else if(""!==getMarkdown(vditor).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")){var renderStartTime=(new Date).getTime(),markdownText=getMarkdown(vditor);this.mdTimeoutId=window.setTimeout((function(){if(vditor.options.preview.url){var xhr_1=new XMLHttpRequest;xhr_1.open("POST",vditor.options.preview.url),xhr_1.setRequestHeader("Content-Type","application/json;charset=UTF-8"),xhr_1.onreadystatechange=function(){if(xhr_1.readyState===XMLHttpRequest.DONE)if(200===xhr_1.status){var responseJSON=JSON.parse(xhr_1.responseText);if(0!==responseJSON.code)return void vditor.tip.show(responseJSON.msg);vditor.options.preview.transform&&(responseJSON.data=vditor.options.preview.transform(responseJSON.data)),_this.previewElement.innerHTML=responseJSON.data,_this.afterRender(vditor,renderStartTime)}else{var html2=vditor.lute.Md2HTML(markdownText);vditor.options.preview.transform&&(html2=vditor.options.preview.transform(html2)),_this.previewElement.innerHTML=html2,_this.afterRender(vditor,renderStartTime)}},xhr_1.send(JSON.stringify({markdownText:markdownText}))}else{var html=vditor.lute.Md2HTML(markdownText);vditor.options.preview.transform&&(html=vditor.options.preview.transform(html)),_this.previewElement.innerHTML=html,_this.afterRender(vditor,renderStartTime)}}),vditor.options.preview.delay)}else this.previewElement.innerHTML="";else"renderPerformance"===this.element.getAttribute("data-type")&&vditor.tip.hide()},Preview2.prototype.afterRender=function(vditor,startTime){vditor.options.preview.parse&&vditor.options.preview.parse(this.element);var time=(new Date).getTime()-startTime;(new Date).getTime()-startTime>2600?(vditor.tip.show(window.VditorI18n.performanceTip.replace("${x}",time.toString())),vditor.preview.element.setAttribute("data-type","renderPerformance")):"renderPerformance"===vditor.preview.element.getAttribute("data-type")&&(vditor.tip.hide(),vditor.preview.element.removeAttribute("data-type"));var cmtFocusElement=vditor.preview.element.querySelector(".vditor-comment--focus");cmtFocusElement&&cmtFocusElement.classList.remove("vditor-comment--focus"),(0,codeRender.o)(vditor.preview.previewElement,vditor.options.preview.hljs),(0,highlightRender.$)(vditor.options.preview.hljs,vditor.preview.previewElement,vditor.options.cdn),(0,mermaidRender.e)(vditor.preview.previewElement,vditor.options.cdn,vditor.options.theme),(0,markmapRender.K)(vditor.preview.previewElement,vditor.options.cdn),(0,SMILESRender.Y)(vditor.preview.previewElement,vditor.options.cdn,vditor.options.theme),(0,flowchartRender.D)(vditor.preview.previewElement,vditor.options.cdn),(0,graphvizRender.m)(vditor.preview.previewElement,vditor.options.cdn),(0,chartRender.v)(vditor.preview.previewElement,vditor.options.cdn,vditor.options.theme),(0,mindmapRender.l)(vditor.preview.previewElement,vditor.options.cdn,vditor.options.theme),(0,plantumlRender.M)(vditor.preview.previewElement,vditor.options.cdn),(0,abcRender.$)(vditor.preview.previewElement,vditor.options.cdn),vditor.options.preview.render.media.enable&&(0,mediaRender.l)(vditor.preview.previewElement),vditor.options.customRenders.forEach((function(item){item.render(vditor.preview.previewElement,vditor)}));var editorElement=vditor.preview.element,tocHTML=vditor.outline.render(vditor);""===tocHTML&&(tocHTML="[ToC]"),editorElement.querySelectorAll('[data-type="toc-block"]').forEach((function(item){item.innerHTML=tocHTML,(0,mathRender.T)(item,{cdn:vditor.options.cdn,math:vditor.options.preview.math})})),(0,mathRender.T)(vditor.preview.previewElement,{cdn:vditor.options.cdn,math:vditor.options.preview.math})},Preview2.prototype.copyToX=function(vditor,copyElement,type){void 0===type&&(type="mp-wechat"),"zhihu"!==type?copyElement.querySelectorAll(".katex-html .base").forEach((function(item){item.style.display="initial"})):copyElement.querySelectorAll(".language-math").forEach((function(item){item.outerHTML='<img class="Formula-image" data-eeimg="true" src="//www.zhihu.com/equation?tex=" alt="'.concat(item.getAttribute("data-math"),'\\" style="display: block; margin: 0 auto; max-width: 100%;">')})),copyElement.style.backgroundColor="#fff",copyElement.querySelectorAll("code").forEach((function(item){item.style.backgroundImage="none"})),this.element.append(copyElement);var range=copyElement.ownerDocument.createRange();range.selectNode(copyElement),(0,selection.jl)(range),document.execCommand("copy"),copyElement.remove(),vditor.tip.show(["zhihu","mp-wechat"].includes(type)?"已复制，可到".concat("zhihu"===type?"知乎":"微信公众号平台","进行粘贴"):"已复制到剪切板")},Preview2}(),Resize=function(){function Resize2(vditor){this.element=document.createElement("div"),this.element.className="vditor-resize vditor-resize--".concat(vditor.options.resize.position),this.element.innerHTML='<div><svg><use xlink:href="#vditor-icon-resize"></use></svg></div>',this.bindEvent(vditor)}return Resize2.prototype.bindEvent=function(vditor){var _this=this;this.element.addEventListener("mousedown",(function(event){var documentSelf=document,y=event.clientY,height=vditor.element.offsetHeight,minHeight=63+vditor.element.querySelector(".vditor-toolbar").clientHeight;documentSelf.ondragstart=function(){return!1},window.captureEvents&&window.captureEvents(),_this.element.classList.add("vditor-resize--selected"),documentSelf.onmousemove=function(moveEvent){"top"===vditor.options.resize.position?vditor.element.style.height=Math.max(minHeight,height+(y-moveEvent.clientY))+"px":vditor.element.style.height=Math.max(minHeight,height+(moveEvent.clientY-y))+"px",vditor.options.typewriterMode&&(vditor.sv.element.style.paddingBottom=vditor.sv.element.parentElement.offsetHeight/2+"px")},documentSelf.onmouseup=function(){vditor.options.resize.after&&vditor.options.resize.after(vditor.element.offsetHeight-height),window.captureEvents&&window.captureEvents(),documentSelf.onmousemove=null,documentSelf.onmouseup=null,documentSelf.ondragstart=null,documentSelf.onselectstart=null,documentSelf.onselect=null,_this.element.classList.remove("vditor-resize--selected")}}))},Resize2}(),Editor=function(){function Editor2(vditor){this.composingLock=!1,this.element=document.createElement("pre"),this.element.className="vditor-sv vditor-reset",this.element.setAttribute("placeholder",vditor.options.placeholder),this.element.setAttribute("contenteditable","true"),this.element.setAttribute("spellcheck","false"),this.bindEvent(vditor),focusEvent(vditor,this.element),blurEvent(vditor,this.element),hotkeyEvent(vditor,this.element),selectEvent(vditor,this.element),dropEvent(vditor,this.element),copyEvent(vditor,this.element,this.copy),cutEvent(vditor,this.element,this.copy)}return Editor2.prototype.copy=function(event,vditor){event.stopPropagation(),event.preventDefault(),event.clipboardData.setData("text/plain",getSelectText(vditor[vditor.currentMode].element))},Editor2.prototype.bindEvent=function(vditor){var _this=this;this.element.addEventListener("paste",(function(event){paste(vditor,event,{pasteCode:function(code){document.execCommand("insertHTML",!1,code)}})})),this.element.addEventListener("scroll",(function(){if("block"===vditor.preview.element.style.display){var textScrollTop=_this.element.scrollTop,textHeight=_this.element.clientHeight,textScrollHeight=_this.element.scrollHeight-parseFloat(_this.element.style.paddingBottom||"0"),preview=vditor.preview.element;preview.scrollTop=textScrollTop/textHeight>.5?(textScrollTop+textHeight)*preview.scrollHeight/textScrollHeight-textHeight:textScrollTop*preview.scrollHeight/textScrollHeight}})),this.element.addEventListener("compositionstart",(function(event){_this.composingLock=!0})),this.element.addEventListener("compositionend",(function(event){(0,compatibility.gm)()||inputEvent(vditor,event),_this.composingLock=!1})),this.element.addEventListener("input",(function(event){if("deleteByDrag"!==event.inputType&&"insertFromDrop"!==event.inputType&&!_this.composingLock&&"‘"!==event.data&&"“"!==event.data&&"《"!==event.data)return _this.preventInput?(_this.preventInput=!1,void processAfterRender(vditor,{enableAddUndoStack:!0,enableHint:!0,enableInput:!0})):void inputEvent(vditor,event)})),this.element.addEventListener("keyup",(function(event){event.isComposing||(0,compatibility._0)(event)||("Backspace"!==event.key&&"Delete"!==event.key||""===vditor.sv.element.innerHTML||1!==vditor.sv.element.childNodes.length||!vditor.sv.element.firstElementChild||"DIV"!==vditor.sv.element.firstElementChild.tagName||2!==vditor.sv.element.firstElementChild.childElementCount||""!==vditor.sv.element.firstElementChild.textContent&&"\n"!==vditor.sv.element.textContent?"Enter"===event.key&&scrollCenter(vditor):vditor.sv.element.innerHTML="")}))},Editor2}(),Tip=function(){function Tip2(){this.element=document.createElement("div"),this.element.className="vditor-tip"}return Tip2.prototype.show=function(text,time){var _this=this;void 0===time&&(time=6e3),this.element.className="vditor-tip vditor-tip--show",0===time?(this.element.innerHTML='<div class="vditor-tip__content">'.concat(text,'\n<div class="vditor-tip__close">X</div></div>'),this.element.querySelector(".vditor-tip__close").addEventListener("click",(function(){_this.hide()}))):(this.element.innerHTML='<div class="vditor-tip__content">'.concat(text,"</div>"),setTimeout((function(){_this.hide()}),time)),this.element.removeAttribute("style"),setTimeout((function(){_this.element.getBoundingClientRect().top<46&&(_this.element.style.position="fixed",_this.element.style.top="46px")}),150)},Tip2.prototype.hide=function(){this.element.className="vditor-messageElementtip",this.element.innerHTML=""},Tip2}(),setPreviewMode=function(mode,vditor){if(vditor.options.preview.mode!==mode){switch(vditor.options.preview.mode=mode,mode){case"both":vditor.sv.element.style.display="block",vditor.preview.element.style.display="block",vditor.preview.render(vditor),setCurrentToolbar(vditor.toolbar.elements,["both"]);break;case"editor":vditor.sv.element.style.display="block",vditor.preview.element.style.display="none",removeCurrentToolbar(vditor.toolbar.elements,["both"])}vditor.devtools&&vditor.devtools.renderEchart(vditor)}},Both_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Both=function(_super){function Both2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return"both"===vditor.options.preview.mode&&_this.element.children[0].classList.add("vditor-menu--current"),_this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){_this.element.firstElementChild.classList.contains(constants.Y.CLASS_MENU_DISABLED)||(event.preventDefault(),"sv"===vditor.currentMode&&("both"===vditor.options.preview.mode?setPreviewMode("editor",vditor):setPreviewMode("both",vditor)))})),_this}return Both_extends(Both2,_super),Both2}(MenuItem),Br=function(){return function(){this.element=document.createElement("div"),this.element.className="vditor-toolbar__br"}}(),setCodeTheme=__webpack_require__(13),CodeTheme_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),CodeTheme=function(_super){function CodeTheme2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this,actionBtn=_this.element.children[0],panelElement=document.createElement("div");panelElement.className="vditor-hint".concat(2===menuItem.level?"":" vditor-panel--arrow");var innerHTML="";return constants.Y.CODE_THEME.forEach((function(theme){innerHTML+="<button>".concat(theme,"</button>")})),panelElement.innerHTML='<div style="overflow: auto;max-height:'.concat(window.innerHeight/2,'px">').concat(innerHTML,"</div>"),panelElement.addEventListener((0,compatibility.y3)(),(function(event){"BUTTON"===event.target.tagName&&(hidePanel(vditor,["subToolbar"]),vditor.options.preview.hljs.style=event.target.textContent,(0,setCodeTheme.h)(event.target.textContent,vditor.options.cdn),event.preventDefault(),event.stopPropagation())})),_this.element.appendChild(panelElement),toggleSubMenu(vditor,panelElement,actionBtn,menuItem.level),_this}return CodeTheme_extends(CodeTheme2,_super),CodeTheme2}(MenuItem),ContentTheme_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),ContentTheme=function(_super){function ContentTheme2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this,actionBtn=_this.element.children[0],panelElement=document.createElement("div");panelElement.className="vditor-hint".concat(2===menuItem.level?"":" vditor-panel--arrow");var innerHTML="";return Object.keys(vditor.options.preview.theme.list).forEach((function(key){innerHTML+='<button data-type="'.concat(key,'">').concat(vditor.options.preview.theme.list[key],"</button>")})),panelElement.innerHTML='<div style="overflow: auto;max-height:'.concat(window.innerHeight/2,'px">').concat(innerHTML,"</div>"),panelElement.addEventListener((0,compatibility.y3)(),(function(event){"BUTTON"===event.target.tagName&&(hidePanel(vditor,["subToolbar"]),vditor.options.preview.theme.current=event.target.getAttribute("data-type"),(0,setContentTheme.H)(vditor.options.preview.theme.current,vditor.options.preview.theme.path),event.preventDefault(),event.stopPropagation())})),_this.element.appendChild(panelElement),toggleSubMenu(vditor,panelElement,actionBtn,menuItem.level),_this}return ContentTheme_extends(ContentTheme2,_super),ContentTheme2}(MenuItem),Counter=function(){function Counter2(vditor){this.element=document.createElement("span"),this.element.className="vditor-counter vditor-tooltipped vditor-tooltipped__nw",this.render(vditor,"")}return Counter2.prototype.render=function(vditor,mdText){var length=mdText.endsWith("\n")?mdText.length-1:mdText.length;if("text"===vditor.options.counter.type&&vditor[vditor.currentMode]){var tempElement=vditor[vditor.currentMode].element.cloneNode(!0);tempElement.querySelectorAll(".vditor-wysiwyg__preview").forEach((function(item){item.remove()})),length=tempElement.textContent.length}"number"==typeof vditor.options.counter.max?(length>vditor.options.counter.max?this.element.className="vditor-counter vditor-counter--error":this.element.className="vditor-counter",this.element.innerHTML="".concat(length,"/").concat(vditor.options.counter.max)):this.element.innerHTML="".concat(length),this.element.setAttribute("aria-label",vditor.options.counter.type),vditor.options.counter.after&&vditor.options.counter.after(length,{enable:vditor.options.counter.enable,max:vditor.options.counter.max,type:vditor.options.counter.type})},Counter2}(),Custom_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Custom=function(_super){function Custom2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return _this.element.children[0].innerHTML=menuItem.icon,_this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){event.preventDefault(),event.currentTarget.classList.contains(constants.Y.CLASS_MENU_DISABLED)||menuItem.click(event,vditor)})),_this}return Custom_extends(Custom2,_super),Custom2}(MenuItem),Devtools_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Devtools=function(_super){function Devtools2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return _this.element.firstElementChild.addEventListener((0,compatibility.y3)(),(function(event){var btnElement=_this.element.firstElementChild;btnElement.classList.contains(constants.Y.CLASS_MENU_DISABLED)||(event.preventDefault(),btnElement.classList.contains("vditor-menu--current")?(btnElement.classList.remove("vditor-menu--current"),vditor.devtools.element.style.display="none",setPadding(vditor)):(btnElement.classList.add("vditor-menu--current"),vditor.devtools.element.style.display="block",setPadding(vditor),vditor.devtools.renderEchart(vditor)))})),_this}return Devtools_extends(Devtools2,_super),Devtools2}(MenuItem),Divider=function(){return function(){this.element=document.createElement("div"),this.element.className="vditor-toolbar__divider"}}(),Emoji_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Emoji=function(_super){function Emoji2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this,panelElement=document.createElement("div");panelElement.className="vditor-panel vditor-panel--arrow";var commonEmojiHTML="";return Object.keys(vditor.options.hint.emoji).forEach((function(key){var emojiValue=vditor.options.hint.emoji[key];emojiValue.indexOf(".")>-1?commonEmojiHTML+='<button data-value=":'.concat(key,': " data-key=":').concat(key,':"><img\ndata-value=":').concat(key,': " data-key=":').concat(key,':" class="vditor-emojis__icon" src="').concat(emojiValue,'"/></button>'):commonEmojiHTML+='<button data-value="'.concat(emojiValue,' "\n data-key="').concat(key,'"><span class="vditor-emojis__icon">').concat(emojiValue,"</span></button>")})),panelElement.innerHTML='<div class="vditor-emojis" style="max-height: '.concat("auto"===vditor.options.height?"auto":vditor.options.height-80,'px">').concat(commonEmojiHTML,'</div><div class="vditor-emojis__tail">\n    <span class="vditor-emojis__tip"></span><span>').concat(vditor.options.hint.emojiTail||"","</span>\n</div>"),_this.element.appendChild(panelElement),toggleSubMenu(vditor,panelElement,_this.element.firstElementChild,menuItem.level),_this.bindEvent(vditor),_this}return Emoji_extends(Emoji2,_super),Emoji2.prototype.bindEvent=function(vditor){var _this=this;this.element.lastElementChild.addEventListener((0,compatibility.y3)(),(function(event){var btnElement=(0,hasClosestByHeadings.f)(event.target,"BUTTON");if(btnElement){event.preventDefault();var value=btnElement.getAttribute("data-value"),range=(0,selection.RN)(vditor),html=value;if("wysiwyg"===vditor.currentMode?html=vditor.lute.SpinVditorDOM(value):"ir"===vditor.currentMode&&(html=vditor.lute.SpinVditorIRDOM(value)),value.indexOf(":")>-1&&"sv"!==vditor.currentMode){var tempElement=document.createElement("div");tempElement.innerHTML=html,html=tempElement.firstElementChild.firstElementChild.outerHTML+" ",(0,selection.Z2)(html,vditor)}else range.extractContents(),range.insertNode(document.createTextNode(value)),(0,hasClosest.pt)(range.startContainer)||modifyPre(vditor,range);range.collapse(!1),(0,selection.jl)(range),_this.element.lastElementChild.style.display="none",execAfterRender(vditor)}})),this.element.lastElementChild.addEventListener("mouseover",(function(event){var btnElement=(0,hasClosestByHeadings.f)(event.target,"BUTTON");btnElement&&(_this.element.querySelector(".vditor-emojis__tip").innerHTML=btnElement.getAttribute("data-key"))}))},Emoji2}(MenuItem),download=function(vditor,content,filename){var aElement=document.createElement("a");"download"in aElement?(aElement.download=filename,aElement.style.display="none",aElement.href=URL.createObjectURL(new Blob([content])),document.body.appendChild(aElement),aElement.click(),aElement.remove()):vditor.tip.show(window.VditorI18n.downloadTip,0)},Export_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Export=function(_super){function Export2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this,actionBtn=_this.element.children[0],panelElement=document.createElement("div");return panelElement.className="vditor-hint".concat(2===menuItem.level?"":" vditor-panel--arrow"),panelElement.innerHTML='<button data-type="markdown">Markdown</button>\n<button data-type="pdf">PDF</button>\n<button data-type="html">HTML</button>',panelElement.addEventListener((0,compatibility.y3)(),(function(event){var btnElement=event.target;if("BUTTON"===btnElement.tagName){switch(btnElement.getAttribute("data-type")){case"markdown":!function(vditor){var content=getMarkdown(vditor);download(vditor,content,content.substr(0,10)+".md")}(vditor);break;case"pdf":!function(vditor){vditor.tip.show(window.VditorI18n.generate,3800);var iframe=document.querySelector("#vditorExportIframe");iframe.contentDocument.open(),iframe.contentDocument.write('<link rel="stylesheet" href="'.concat(vditor.options.cdn,'/dist/index.css"/>\n<script src="').concat(vditor.options.cdn,'/dist/method.min.js"><\/script>\n<div id="preview" style="width: 800px"></div>\n<script>\nwindow.addEventListener("message", (e) => {\n  if(!e.data) {\n    return;\n  }\n  Vditor.preview(document.getElementById(\'preview\'), e.data, {\n    cdn: "').concat(vditor.options.cdn,'",\n    markdown: {\n      theme: ').concat(JSON.stringify(vditor.options.preview.theme),'\n    },\n    hljs: {\n      style: "').concat(vditor.options.preview.hljs.style,'"\n    }\n  });\n  setTimeout(() => {\n        window.print();\n    }, 3600);\n}, false);\n<\/script>')),iframe.contentDocument.close(),setTimeout((function(){iframe.contentWindow.postMessage(getMarkdown(vditor),"*")}),200)}(vditor);break;case"html":!function(vditor){var content=getHTML(vditor),html='<html><head><link rel="stylesheet" type="text/css" href="'.concat(vditor.options.cdn,'/dist/index.css"/>\n<script src="').concat(vditor.options.cdn,"/dist/js/i18n/").concat(vditor.options.lang,'.js"><\/script>\n<script src="').concat(vditor.options.cdn,'/dist/method.min.js"><\/script></head>\n<body><div class="vditor-reset" id="preview">').concat(content,"</div>\n<script>\n    const previewElement = document.getElementById('preview')\n    Vditor.setContentTheme('").concat(vditor.options.preview.theme.current,"', '").concat(vditor.options.preview.theme.path,"');\n    Vditor.codeRender(previewElement);\n    Vditor.highlightRender(").concat(JSON.stringify(vditor.options.preview.hljs),", previewElement, '").concat(vditor.options.cdn,"');\n    Vditor.mathRender(previewElement, {\n        cdn: '").concat(vditor.options.cdn,"',\n        math: ").concat(JSON.stringify(vditor.options.preview.math),",\n    });\n    Vditor.mermaidRender(previewElement, '").concat(vditor.options.cdn,"', '").concat(vditor.options.theme,"');\n    Vditor.SMILESRender(previewElement, '").concat(vditor.options.cdn,"', '").concat(vditor.options.theme,"');\n    Vditor.markmapRender(previewElement, '").concat(vditor.options.cdn,"');\n    Vditor.flowchartRender(previewElement, '").concat(vditor.options.cdn,"');\n    Vditor.graphvizRender(previewElement, '").concat(vditor.options.cdn,"');\n    Vditor.chartRender(previewElement, '").concat(vditor.options.cdn,"', '").concat(vditor.options.theme,"');\n    Vditor.mindmapRender(previewElement, '").concat(vditor.options.cdn,"', '").concat(vditor.options.theme,"');\n    Vditor.abcRender(previewElement, '").concat(vditor.options.cdn,"');\n    ").concat(vditor.options.preview.render.media.enable?"Vditor.mediaRender(previewElement);":"",'\n    Vditor.speechRender(previewElement);\n<\/script>\n<script src="').concat(vditor.options.cdn,"/dist/js/icons/").concat(vditor.options.icon,'.js"><\/script></body></html>');download(vditor,html,content.substr(0,10)+".html")}(vditor)}hidePanel(vditor,["subToolbar"]),event.preventDefault(),event.stopPropagation()}})),_this.element.appendChild(panelElement),toggleSubMenu(vditor,panelElement,actionBtn,menuItem.level),_this}return Export_extends(Export2,_super),Export2}(MenuItem),Fullscreen_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Fullscreen=function(_super){function Fullscreen2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return _this._bindEvent(vditor,menuItem),_this}return Fullscreen_extends(Fullscreen2,_super),Fullscreen2.prototype._bindEvent=function(vditor,menuItem){this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){event.preventDefault(),vditor.element.className.includes("vditor--fullscreen")?(menuItem.level||(this.innerHTML=menuItem.icon),vditor.element.style.zIndex="",document.body.style.overflow="",vditor.element.classList.remove("vditor--fullscreen"),Object.keys(vditor.toolbar.elements).forEach((function(key){var svgElement=vditor.toolbar.elements[key].firstChild;svgElement&&(svgElement.className=svgElement.className.replace("__s","__n"),vditor.options.toolbar.forEach((function(item){"string"!=typeof item&&item.tipPosition&&item.name===svgElement.dataset.type&&(svgElement.className="vditor-tooltipped vditor-tooltipped__".concat(item.tipPosition))})))})),vditor.counter&&(vditor.counter.element.className=vditor.counter.element.className.replace("__s","__n"))):(menuItem.level||(this.innerHTML='<svg><use xlink:href="#vditor-icon-contract"></use></svg>'),vditor.element.style.zIndex=vditor.options.fullscreen.index.toString(),document.body.style.overflow="hidden",vditor.element.classList.add("vditor--fullscreen"),Object.keys(vditor.toolbar.elements).forEach((function(key){var svgElement=vditor.toolbar.elements[key].firstChild;svgElement&&(svgElement.className=svgElement.className.replace("__n","__s"))})),vditor.counter&&(vditor.counter.element.className=vditor.counter.element.className.replace("__n","__s"))),vditor.devtools&&vditor.devtools.renderEchart(vditor),menuItem.click&&menuItem.click(event,vditor),setPadding(vditor),setTypewriterPosition(vditor)}))},Fullscreen2}(MenuItem),Headings_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Headings=function(_super){function Headings2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this,panelElement=document.createElement("div");return panelElement.className="vditor-hint vditor-panel--arrow",panelElement.innerHTML='<button data-tag="h1" data-value="# ">'.concat(window.VditorI18n.heading1," ").concat((0,compatibility.fG)("&lt;⌥⌘1>"),'</button>\n<button data-tag="h2" data-value="## ">').concat(window.VditorI18n.heading2," &lt;").concat((0,compatibility.fG)("⌥⌘2"),'></button>\n<button data-tag="h3" data-value="### ">').concat(window.VditorI18n.heading3," &lt;").concat((0,compatibility.fG)("⌥⌘3"),'></button>\n<button data-tag="h4" data-value="#### ">').concat(window.VditorI18n.heading4," &lt;").concat((0,compatibility.fG)("⌥⌘4"),'></button>\n<button data-tag="h5" data-value="##### ">').concat(window.VditorI18n.heading5," &lt;").concat((0,compatibility.fG)("⌥⌘5"),'></button>\n<button data-tag="h6" data-value="###### ">').concat(window.VditorI18n.heading6," &lt;").concat((0,compatibility.fG)("⌥⌘6"),"></button>"),_this.element.appendChild(panelElement),_this._bindEvent(vditor,panelElement),_this}return Headings_extends(Headings2,_super),Headings2.prototype._bindEvent=function(vditor,panelElement){var actionBtn=this.element.children[0];actionBtn.addEventListener((0,compatibility.y3)(),(function(event){event.preventDefault(),clearTimeout(vditor.wysiwyg.afterRenderTimeoutId),clearTimeout(vditor.ir.processTimeoutId),clearTimeout(vditor.sv.processTimeoutId),actionBtn.classList.contains(constants.Y.CLASS_MENU_DISABLED)||(actionBtn.blur(),actionBtn.classList.contains("vditor-menu--current")?("wysiwyg"===vditor.currentMode?(removeHeading(vditor),afterRenderEvent(vditor)):"ir"===vditor.currentMode&&process_processHeading(vditor,""),actionBtn.classList.remove("vditor-menu--current")):(hidePanel(vditor,["subToolbar"]),panelElement.style.display="block"))}));for(var i=0;i<6;i++)panelElement.children.item(i).addEventListener((0,compatibility.y3)(),(function(event){event.preventDefault(),"wysiwyg"===vditor.currentMode?(setHeading(vditor,event.target.getAttribute("data-tag")),afterRenderEvent(vditor),actionBtn.classList.add("vditor-menu--current")):"ir"===vditor.currentMode?(process_processHeading(vditor,event.target.getAttribute("data-value")),actionBtn.classList.add("vditor-menu--current")):processHeading(vditor,event.target.getAttribute("data-value")),panelElement.style.display="none"}))},Headings2}(MenuItem),Help_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Help=function(_super){function Help2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return _this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){event.preventDefault(),vditor.tip.show('<div style="margin-bottom:14px;font-size: 14px;line-height: 22px;min-width:300px;max-width: 360px;display: flex;">\n<div style="margin-top: 14px;flex: 1">\n    <div>Markdown 使用指南</div>\n    <ul style="list-style: none">\n        <li><a href="https://ld246.com/article/1583308420519" target="_blank">语法速查手册</a></li>\n        <li><a href="https://ld246.com/article/1583129520165" target="_blank">基础语法</a></li>\n        <li><a href="https://ld246.com/article/1583305480675" target="_blank">扩展语法</a></li>\n        <li><a href="https://ld246.com/article/1582778815353" target="_blank">键盘快捷键</a></li>\n    </ul>\n</div>\n<div style="margin-top: 14px;flex: 1">\n    <div>Vditor 支持</div>\n    <ul style="list-style: none">\n        <li><a href="https://github.com/Vanessa219/vditor/issues" target="_blank">Issues</a></li>\n        <li><a href="https://ld246.com/tag/vditor" target="_blank">官方讨论区</a></li>\n        <li><a href="https://ld246.com/article/1549638745630" target="_blank">开发手册</a></li>\n        <li><a href="https://ld246.com/guide/markdown" target="_blank">演示地址</a></li>\n    </ul>\n</div></div>',0)})),_this}return Help_extends(Help2,_super),Help2}(MenuItem),Indent_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Indent=function(_super){function Indent2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return _this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){if(event.preventDefault(),!_this.element.firstElementChild.classList.contains(constants.Y.CLASS_MENU_DISABLED)&&"sv"!==vditor.currentMode){var range=(0,selection.RN)(vditor),liElement=(0,hasClosest._Y)(range.startContainer,"LI");liElement&&listIndent(vditor,liElement,range)}})),_this}return Indent_extends(Indent2,_super),Indent2}(MenuItem),Info_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Info=function(_super){function Info2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return _this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){event.preventDefault(),vditor.tip.show('<div style="max-width: 520px; font-size: 14px;line-height: 22px;margin-bottom: 14px;">\n<p style="text-align: center;margin: 14px 0">\n    <em>下一代的 Markdown 编辑器，为未来而构建</em>\n</p>\n<div style="display: flex;margin-bottom: 14px;flex-wrap: wrap;align-items: center">\n    <img src="https://unpkg.com/vditor/dist/images/logo.png" style="margin: 0 auto;height: 68px"/>\n    <div>&nbsp;&nbsp;</div>\n    <div style="flex: 1;min-width: 250px">\n        Vditor 是一款浏览器端的 Markdown 编辑器，支持所见即所得、即时渲染（类似 Typora）和分屏预览模式。\n        它使用 TypeScript 实现，支持原生 JavaScript 以及 Vue、React、Angular 和 Svelte 等框架。\n    </div>\n</div>\n<div style="display: flex;flex-wrap: wrap;">\n    <ul style="list-style: none;flex: 1;min-width:148px">\n        <li>\n        项目地址：<a href="https://b3log.org/vditor" target="_blank">b3log.org/vditor</a>\n        </li>\n        <li>\n        开源协议：MIT\n        </li>\n    </ul>\n    <ul style="list-style: none;margin-right: 18px">\n        <li>\n        组件版本：Vditor v'.concat(constants.g," / Lute v").concat(Lute.Version,'\n        </li>\n        <li>\n        赞助捐赠：<a href="https://ld246.com/sponsor" target="_blank">https://ld246.com/sponsor</a>\n        </li>\n    </ul>\n</div>\n</div>'),0)})),_this}return Info_extends(Info2,_super),Info2}(MenuItem),InsertAfter_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),InsertAfter=function(_super){function InsertAfter2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return _this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){event.preventDefault(),_this.element.firstElementChild.classList.contains(constants.Y.CLASS_MENU_DISABLED)||"sv"===vditor.currentMode||insertEmptyBlock(vditor,"afterend")})),_this}return InsertAfter_extends(InsertAfter2,_super),InsertAfter2}(MenuItem),InsertBefore_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),InsertBefore=function(_super){function InsertBefore2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return _this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){event.preventDefault(),_this.element.firstElementChild.classList.contains(constants.Y.CLASS_MENU_DISABLED)||"sv"===vditor.currentMode||insertEmptyBlock(vditor,"beforebegin")})),_this}return InsertBefore_extends(InsertBefore2,_super),InsertBefore2}(MenuItem),Outdent_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Outdent=function(_super){function Outdent2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return _this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){if(event.preventDefault(),!_this.element.firstElementChild.classList.contains(constants.Y.CLASS_MENU_DISABLED)&&"sv"!==vditor.currentMode){var range=(0,selection.RN)(vditor),liElement=(0,hasClosest._Y)(range.startContainer,"LI");liElement&&listOutdent(vditor,liElement,range,liElement.parentElement)}})),_this}return Outdent_extends(Outdent2,_super),Outdent2}(MenuItem),Outline_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Outline_Outline=function(_super){function Outline2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return vditor.options.outline&&_this.element.firstElementChild.classList.add("vditor-menu--current"),_this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){event.preventDefault(),vditor.toolbar.elements.outline.firstElementChild.classList.contains(constants.Y.CLASS_MENU_DISABLED)||(vditor.options.outline.enable=!_this.element.firstElementChild.classList.contains("vditor-menu--current"),vditor.outline.toggle(vditor,vditor.options.outline.enable))})),_this}return Outline_extends(Outline2,_super),Outline2}(MenuItem),Preview_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Preview_Preview=function(_super){function Preview2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return _this._bindEvent(vditor),_this}return Preview_extends(Preview2,_super),Preview2.prototype._bindEvent=function(vditor){var _this=this;this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){event.preventDefault();var btnElement=_this.element.firstElementChild;if(!btnElement.classList.contains(constants.Y.CLASS_MENU_DISABLED)){var toolbars=constants.Y.EDIT_TOOLBARS.concat(["both","edit-mode","devtools"]);btnElement.classList.contains("vditor-menu--current")?(btnElement.classList.remove("vditor-menu--current"),"sv"===vditor.currentMode?(vditor.sv.element.style.display="block","both"===vditor.options.preview.mode?vditor.preview.element.style.display="block":vditor.preview.element.style.display="none"):(vditor[vditor.currentMode].element.parentElement.style.display="block",vditor.preview.element.style.display="none"),enableToolbar(vditor.toolbar.elements,toolbars),vditor.outline.render(vditor)):(disableToolbar(vditor.toolbar.elements,toolbars),vditor.preview.element.style.display="block","sv"===vditor.currentMode?vditor.sv.element.style.display="none":vditor[vditor.currentMode].element.parentElement.style.display="none",vditor.preview.render(vditor),btnElement.classList.add("vditor-menu--current"),hidePanel(vditor,["subToolbar","hint","popover"]),setTimeout((function(){vditor.outline.render(vditor)}),vditor.options.preview.delay+10)),setPadding(vditor)}}))},Preview2}(MenuItem),RecordMedia=function(){function RecordMedia2(e){var context;if(this.SAMPLE_RATE=5e3,this.isRecording=!1,this.readyFlag=!1,this.leftChannel=[],this.rightChannel=[],this.recordingLength=0,"undefined"!=typeof AudioContext)context=new AudioContext;else{if(!webkitAudioContext)return;context=new webkitAudioContext}this.DEFAULT_SAMPLE_RATE=context.sampleRate;var volume=context.createGain();context.createMediaStreamSource(e).connect(volume),this.recorder=context.createScriptProcessor(2048,2,1),this.recorder.onaudioprocess=null,volume.connect(this.recorder),this.recorder.connect(context.destination),this.readyFlag=!0}return RecordMedia2.prototype.cloneChannelData=function(leftChannelData,rightChannelData){this.leftChannel.push(new Float32Array(leftChannelData)),this.rightChannel.push(new Float32Array(rightChannelData)),this.recordingLength+=2048},RecordMedia2.prototype.startRecordingNewWavFile=function(){this.readyFlag&&(this.isRecording=!0,this.leftChannel.length=this.rightChannel.length=0,this.recordingLength=0)},RecordMedia2.prototype.stopRecording=function(){this.isRecording=!1},RecordMedia2.prototype.buildWavFileBlob=function(){for(var leftBuffer=this.mergeBuffers(this.leftChannel),rightBuffer=this.mergeBuffers(this.rightChannel),interleaved=new Float32Array(leftBuffer.length),i=0;i<leftBuffer.length;++i)interleaved[i]=.5*(leftBuffer[i]+rightBuffer[i]);this.DEFAULT_SAMPLE_RATE>this.SAMPLE_RATE&&(interleaved=this.downSampleBuffer(interleaved,this.SAMPLE_RATE));var totalByteCount=44+2*interleaved.length,buffer=new ArrayBuffer(totalByteCount),view=new DataView(buffer);this.writeUTFBytes(view,0,"RIFF"),view.setUint32(4,totalByteCount,!0),this.writeUTFBytes(view,8,"WAVE"),this.writeUTFBytes(view,12,"fmt "),view.setUint32(16,16,!0),view.setUint16(20,1,!0),view.setUint16(22,1,!0),view.setUint32(24,this.SAMPLE_RATE,!0),view.setUint32(28,2*this.SAMPLE_RATE,!0),view.setUint16(32,2,!0),view.setUint16(34,16,!0);var subChunk2ByteCount=2*interleaved.length;this.writeUTFBytes(view,36,"data"),view.setUint32(40,subChunk2ByteCount,!0);for(var lng=interleaved.length,index=44,j=0;j<lng;j++)view.setInt16(index,32767*interleaved[j],!0),index+=2;return new Blob([view],{type:"audio/wav"})},RecordMedia2.prototype.downSampleBuffer=function(buffer,rate){if(rate===this.DEFAULT_SAMPLE_RATE)return buffer;if(rate>this.DEFAULT_SAMPLE_RATE)return buffer;for(var sampleRateRatio=this.DEFAULT_SAMPLE_RATE/rate,newLength=Math.round(buffer.length/sampleRateRatio),result=new Float32Array(newLength),offsetResult=0,offsetBuffer=0;offsetResult<result.length;){for(var nextOffsetBuffer=Math.round((offsetResult+1)*sampleRateRatio),accum=0,count=0,i=offsetBuffer;i<nextOffsetBuffer&&i<buffer.length;i++)accum+=buffer[i],count++;result[offsetResult]=accum/count,offsetResult++,offsetBuffer=nextOffsetBuffer}return result},RecordMedia2.prototype.mergeBuffers=function(desiredChannelBuffer){for(var result=new Float32Array(this.recordingLength),offset=0,lng=desiredChannelBuffer.length,i=0;i<lng;++i){var buffer=desiredChannelBuffer[i];result.set(buffer,offset),offset+=buffer.length}return result},RecordMedia2.prototype.writeUTFBytes=function(view,offset,value){for(var lng=value.length,i=0;i<lng;i++)view.setUint8(offset+i,value.charCodeAt(i))},RecordMedia2}(),Record_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Record=function(_super){function Record2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return _this._bindEvent(vditor),_this}return Record_extends(Record2,_super),Record2.prototype._bindEvent=function(vditor){var mediaRecorder,_this=this;this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){if(event.preventDefault(),!_this.element.firstElementChild.classList.contains(constants.Y.CLASS_MENU_DISABLED)){var editorElement=vditor[vditor.currentMode].element;if(mediaRecorder)if(mediaRecorder.isRecording){mediaRecorder.stopRecording(),vditor.tip.hide();var file=new File([mediaRecorder.buildWavFileBlob()],"record".concat((new Date).getTime(),".wav"),{type:"video/webm"});uploadFiles(vditor,[file]),_this.element.children[0].classList.remove("vditor-menu--current")}else vditor.tip.show(window.VditorI18n.recording),editorElement.setAttribute("contenteditable","false"),mediaRecorder.startRecordingNewWavFile(),_this.element.children[0].classList.add("vditor-menu--current");else navigator.mediaDevices.getUserMedia({audio:!0}).then((function(mediaStream){(mediaRecorder=new RecordMedia(mediaStream)).recorder.onaudioprocess=function(e){if(mediaRecorder.isRecording){var left=e.inputBuffer.getChannelData(0),right=e.inputBuffer.getChannelData(1);mediaRecorder.cloneChannelData(left,right)}},mediaRecorder.startRecordingNewWavFile(),vditor.tip.show(window.VditorI18n.recording),editorElement.setAttribute("contenteditable","false"),_this.element.children[0].classList.add("vditor-menu--current")})).catch((function(){vditor.tip.show(window.VditorI18n["record-tip"])}))}}))},Record2}(MenuItem),Redo_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Redo=function(_super){function Redo2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return disableToolbar({redo:_this.element},["redo"]),_this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){event.preventDefault(),_this.element.firstElementChild.classList.contains(constants.Y.CLASS_MENU_DISABLED)||vditor.undo.redo(vditor)})),_this}return Redo_extends(Redo2,_super),Redo2}(MenuItem),Undo_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Undo=function(_super){function Undo2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this;return disableToolbar({undo:_this.element},["undo"]),_this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){event.preventDefault(),_this.element.firstElementChild.classList.contains(constants.Y.CLASS_MENU_DISABLED)||vditor.undo.undo(vditor)})),_this}return Undo_extends(Undo2,_super),Undo2}(MenuItem),Upload_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),Upload_Upload=function(_super){function Upload2(vditor,menuItem){var _this=_super.call(this,vditor,menuItem)||this,inputHTML='<input type="file"';return vditor.options.upload.multiple&&(inputHTML+=' multiple="multiple"'),vditor.options.upload.accept&&(inputHTML+=' accept="'.concat(vditor.options.upload.accept,'"')),_this.element.children[0].innerHTML="".concat(menuItem.icon||'<svg><use xlink:href="#vditor-icon-upload"></use></svg>').concat(inputHTML,">"),_this._bindEvent(vditor),_this}return Upload_extends(Upload2,_super),Upload2.prototype._bindEvent=function(vditor){var _this=this;this.element.children[0].addEventListener((0,compatibility.y3)(),(function(event){if(_this.element.firstElementChild.classList.contains(constants.Y.CLASS_MENU_DISABLED))return event.stopPropagation(),void event.preventDefault()})),this.element.querySelector("input").addEventListener("change",(function(event){if(_this.element.firstElementChild.classList.contains(constants.Y.CLASS_MENU_DISABLED))return event.stopPropagation(),void event.preventDefault();0!==event.target.files.length&&uploadFiles(vditor,event.target.files,event.target)}))},Upload2}(MenuItem),Toolbar=function(){function Toolbar2(vditor){var _this=this,options=vditor.options;this.elements={},this.element=document.createElement("div"),this.element.className="vditor-toolbar",options.toolbar.forEach((function(menuItem,i){var itemElement=_this.genItem(vditor,menuItem,i);if(_this.element.appendChild(itemElement),menuItem.toolbar){var panelElement_1=document.createElement("div");panelElement_1.className="vditor-hint vditor-panel--arrow",panelElement_1.addEventListener((0,compatibility.y3)(),(function(event){panelElement_1.style.display="none"})),menuItem.toolbar.forEach((function(subMenuItem,subI){subMenuItem.level=2,panelElement_1.appendChild(_this.genItem(vditor,subMenuItem,i+subI))})),itemElement.appendChild(panelElement_1),toggleSubMenu(vditor,panelElement_1,itemElement.children[0])}})),vditor.options.toolbarConfig.hide&&this.element.classList.add("vditor-toolbar--hide"),vditor.options.toolbarConfig.pin&&this.element.classList.add("vditor-toolbar--pin"),vditor.options.counter.enable&&(vditor.counter=new Counter(vditor),this.element.appendChild(vditor.counter.element))}return Toolbar2.prototype.updateConfig=function(vditor,options){vditor.options.toolbarConfig=Object.assign({hide:!1,pin:!1},options),vditor.options.toolbarConfig.hide?this.element.classList.add("vditor-toolbar--hide"):this.element.classList.remove("vditor-toolbar--hide"),vditor.options.toolbarConfig.pin?this.element.classList.add("vditor-toolbar--pin"):this.element.classList.remove("vditor-toolbar--pin")},Toolbar2.prototype.genItem=function(vditor,menuItem,index){var menuItemObj;switch(menuItem.name){case"bold":case"italic":case"more":case"strike":case"line":case"quote":case"list":case"ordered-list":case"check":case"code":case"inline-code":case"link":case"table":menuItemObj=new MenuItem(vditor,menuItem);break;case"emoji":menuItemObj=new Emoji(vditor,menuItem);break;case"headings":menuItemObj=new Headings(vditor,menuItem);break;case"|":menuItemObj=new Divider;break;case"br":menuItemObj=new Br;break;case"undo":menuItemObj=new Undo(vditor,menuItem);break;case"redo":menuItemObj=new Redo(vditor,menuItem);break;case"help":menuItemObj=new Help(vditor,menuItem);break;case"both":menuItemObj=new Both(vditor,menuItem);break;case"preview":menuItemObj=new Preview_Preview(vditor,menuItem);break;case"fullscreen":menuItemObj=new Fullscreen(vditor,menuItem);break;case"upload":menuItemObj=new Upload_Upload(vditor,menuItem);break;case"record":menuItemObj=new Record(vditor,menuItem);break;case"info":menuItemObj=new Info(vditor,menuItem);break;case"edit-mode":menuItemObj=new EditMode(vditor,menuItem);break;case"devtools":menuItemObj=new Devtools(vditor,menuItem);break;case"outdent":menuItemObj=new Outdent(vditor,menuItem);break;case"indent":menuItemObj=new Indent(vditor,menuItem);break;case"outline":menuItemObj=new Outline_Outline(vditor,menuItem);break;case"insert-after":menuItemObj=new InsertAfter(vditor,menuItem);break;case"insert-before":menuItemObj=new InsertBefore(vditor,menuItem);break;case"code-theme":menuItemObj=new CodeTheme(vditor,menuItem);break;case"content-theme":menuItemObj=new ContentTheme(vditor,menuItem);break;case"export":menuItemObj=new Export(vditor,menuItem);break;default:menuItemObj=new Custom(vditor,menuItem)}if(menuItemObj){var key=menuItem.name;return"br"!==key&&"|"!==key||(key+=index),this.elements[key]=menuItemObj.element,menuItemObj.element}},Toolbar2}(),diff_match_patch=__webpack_require__(192),undo_Undo=function(){function Undo2(){this.stackSize=50,this.resetStack(),this.dmp=new diff_match_patch}return Undo2.prototype.clearStack=function(vditor){this.resetStack(),this.resetIcon(vditor)},Undo2.prototype.resetIcon=function(vditor){vditor.toolbar&&(this[vditor.currentMode].undoStack.length>1?enableToolbar(vditor.toolbar.elements,["undo"]):disableToolbar(vditor.toolbar.elements,["undo"]),0!==this[vditor.currentMode].redoStack.length?enableToolbar(vditor.toolbar.elements,["redo"]):disableToolbar(vditor.toolbar.elements,["redo"]))},Undo2.prototype.undo=function(vditor){if("false"!==vditor[vditor.currentMode].element.getAttribute("contenteditable")&&!(this[vditor.currentMode].undoStack.length<2)){var state=this[vditor.currentMode].undoStack.pop();state&&(this[vditor.currentMode].redoStack.push(state),this.renderDiff(state,vditor),this[vditor.currentMode].hasUndo=!0,hidePanel(vditor,["hint"]))}},Undo2.prototype.redo=function(vditor){if("false"!==vditor[vditor.currentMode].element.getAttribute("contenteditable")){var state=this[vditor.currentMode].redoStack.pop();state&&(this[vditor.currentMode].undoStack.push(state),this.renderDiff(state,vditor,!0))}},Undo2.prototype.recordFirstPosition=function(vditor,event){if(0!==getSelection().rangeCount&&!(1!==this[vditor.currentMode].undoStack.length||0===this[vditor.currentMode].undoStack[0].length||this[vditor.currentMode].redoStack.length>0||(0,compatibility.gm)()&&"Backspace"===event.key||(0,compatibility.nr)())){var text=this.addCaret(vditor);text.replace("<wbr>","").replace(" vditor-ir__node--expand","")===this[vditor.currentMode].undoStack[0][0].diffs[0][1].replace("<wbr>","")&&(this[vditor.currentMode].undoStack[0][0].diffs[0][1]=text,this[vditor.currentMode].lastText=text)}},Undo2.prototype.addToUndoStack=function(vditor){var text=this.addCaret(vditor,!0),diff=this.dmp.diff_main(text,this[vditor.currentMode].lastText,!0),patchList=this.dmp.patch_make(text,this[vditor.currentMode].lastText,diff);0===patchList.length&&this[vditor.currentMode].undoStack.length>0||(this[vditor.currentMode].lastText=text,this[vditor.currentMode].undoStack.push(patchList),this[vditor.currentMode].undoStack.length>this.stackSize&&this[vditor.currentMode].undoStack.shift(),this[vditor.currentMode].hasUndo&&(this[vditor.currentMode].redoStack=[],this[vditor.currentMode].hasUndo=!1,disableToolbar(vditor.toolbar.elements,["redo"])),this[vditor.currentMode].undoStack.length>1&&enableToolbar(vditor.toolbar.elements,["undo"]))},Undo2.prototype.renderDiff=function(state,vditor,isRedo){var text;if(void 0===isRedo&&(isRedo=!1),isRedo){var redoPatchList=this.dmp.patch_deepCopy(state).reverse();redoPatchList.forEach((function(patch){patch.diffs.forEach((function(diff){diff[0]=-diff[0]}))})),text=this.dmp.patch_apply(redoPatchList,this[vditor.currentMode].lastText)[0]}else text=this.dmp.patch_apply(state,this[vditor.currentMode].lastText)[0];if(this[vditor.currentMode].lastText=text,vditor[vditor.currentMode].element.innerHTML=text,"sv"!==vditor.currentMode&&(vditor[vditor.currentMode].element.querySelectorAll(".vditor-".concat(vditor.currentMode,"__preview")).forEach((function(blockElement){blockElement.parentElement.querySelector(".language-echarts")&&(blockElement.outerHTML=vditor.lute.SpinVditorDOM(blockElement.parentElement.outerHTML))})),vditor[vditor.currentMode].element.querySelectorAll(".vditor-".concat(vditor.currentMode,"__preview[data-render='2']")).forEach((function(blockElement){processCodeRender(blockElement,vditor)}))),vditor[vditor.currentMode].element.querySelector("wbr"))(0,selection.ir)(vditor[vditor.currentMode].element,vditor[vditor.currentMode].element.ownerDocument.createRange()),scrollCenter(vditor);else{var range=getSelection().getRangeAt(0);range.setEndBefore(vditor[vditor.currentMode].element),range.collapse(!1)}renderToc(vditor),execAfterRender(vditor,{enableAddUndoStack:!1,enableHint:!1,enableInput:!0}),highlightToolbar(vditor),vditor[vditor.currentMode].element.querySelectorAll(".vditor-".concat(vditor.currentMode,"__preview[data-render='2']")).forEach((function(item){processCodeRender(item,vditor)})),this[vditor.currentMode].undoStack.length>1?enableToolbar(vditor.toolbar.elements,["undo"]):disableToolbar(vditor.toolbar.elements,["undo"]),0!==this[vditor.currentMode].redoStack.length?enableToolbar(vditor.toolbar.elements,["redo"]):disableToolbar(vditor.toolbar.elements,["redo"])},Undo2.prototype.resetStack=function(){this.ir={hasUndo:!1,lastText:"",redoStack:[],undoStack:[]},this.sv={hasUndo:!1,lastText:"",redoStack:[],undoStack:[]},this.wysiwyg={hasUndo:!1,lastText:"",redoStack:[],undoStack:[]}},Undo2.prototype.addCaret=function(vditor,setFocus){var cloneRange;if(void 0===setFocus&&(setFocus=!1),0!==getSelection().rangeCount&&!vditor[vditor.currentMode].element.querySelector("wbr")){var range=getSelection().getRangeAt(0);if(vditor[vditor.currentMode].element.contains(range.startContainer)){cloneRange=range.cloneRange();var wbrElement=document.createElement("span");wbrElement.className="vditor-wbr",range.insertNode(wbrElement)}}vditor.ir.element.cloneNode(!0).querySelectorAll(".vditor-".concat(vditor.currentMode,"__preview[data-render='1']")).forEach((function(item){item.firstElementChild&&(item.firstElementChild.classList.contains("language-echarts")||item.firstElementChild.classList.contains("language-plantuml")||item.firstElementChild.classList.contains("language-mindmap")?(item.firstElementChild.removeAttribute("_echarts_instance_"),item.firstElementChild.removeAttribute("data-processed"),item.firstElementChild.innerHTML=item.previousElementSibling.firstElementChild.innerHTML,item.setAttribute("data-render","2")):item.firstElementChild.classList.contains("language-math")&&(item.setAttribute("data-render","2"),item.firstElementChild.textContent=item.firstElementChild.getAttribute("data-math"),item.firstElementChild.removeAttribute("data-math")))}));var text=vditor[vditor.currentMode].element.innerHTML;return vditor[vditor.currentMode].element.querySelectorAll(".vditor-wbr").forEach((function(item){item.remove()})),setFocus&&cloneRange&&(0,selection.jl)(cloneRange),text.replace('<span class="vditor-wbr"></span>',"<wbr>")},Undo2}(),merge=__webpack_require__(905),Options=function(){function Options2(options){this.defaultOptions={rtl:!1,after:void 0,cache:{enable:!0},cdn:constants.Y.CDN,classes:{preview:""},comment:{enable:!1},counter:{enable:!1,type:"markdown"},customRenders:[],debugger:!1,fullscreen:{index:90},height:"auto",hint:{delay:200,emoji:{"+1":"👍","-1":"👎",confused:"😕",eyes:"👀️",heart:"❤️",rocket:"🚀️",smile:"😄",tada:"🎉️"},emojiPath:"".concat(constants.Y.CDN,"/dist/images/emoji"),extend:[],parse:!0},icon:"ant",lang:"zh_CN",mode:"ir",outline:{enable:!1,position:"left"},placeholder:"",preview:{actions:["desktop","tablet","mobile","mp-wechat","zhihu"],delay:1e3,hljs:constants.Y.HLJS_OPTIONS,markdown:constants.Y.MARKDOWN_OPTIONS,math:constants.Y.MATH_OPTIONS,maxWidth:800,mode:"both",theme:constants.Y.THEME_OPTIONS,render:{media:{enable:!0}}},link:{isOpen:!0},image:{isPreview:!0},resize:{enable:!1,position:"bottom"},theme:"classic",toolbar:["emoji","headings","bold","italic","strike","link","|","list","ordered-list","check","outdent","indent","|","quote","line","code","inline-code","insert-before","insert-after","|","upload","record","table","|","undo","redo","|","fullscreen","edit-mode",{name:"more",toolbar:["both","code-theme","content-theme","export","outline","preview","devtools","info","help"]}],toolbarConfig:{hide:!1,pin:!1},typewriterMode:!1,undoDelay:800,upload:{extraData:{},fieldName:"file[]",filename:function(name){return name.replace(/\W/g,"")},linkToImgUrl:"",max:10485760,multiple:!0,url:"",withCredentials:!1},value:"",width:"auto"},this.options=options}return Options2.prototype.merge=function(){var _a,_b,_c,_d,_e,_f,_g,_h,_j;this.options&&(this.options.toolbar?this.options.toolbar=this.mergeToolbar(this.options.toolbar):this.options.toolbar=this.mergeToolbar(this.defaultOptions.toolbar),(null===(_b=null===(_a=this.options.preview)||void 0===_a?void 0:_a.theme)||void 0===_b?void 0:_b.list)&&(this.defaultOptions.preview.theme.list=this.options.preview.theme.list),(null===(_e=null===(_d=null===(_c=this.options.preview)||void 0===_c?void 0:_c.render)||void 0===_d?void 0:_d.media)||void 0===_e?void 0:_e.enable)&&(this.defaultOptions.preview.render.media.enable=this.options.preview.render.media.enable),(null===(_f=this.options.hint)||void 0===_f?void 0:_f.emoji)&&(this.defaultOptions.hint.emoji=this.options.hint.emoji),this.options.comment&&(this.defaultOptions.comment=this.options.comment),this.options.cdn&&((null===(_h=null===(_g=this.options.preview)||void 0===_g?void 0:_g.theme)||void 0===_h?void 0:_h.path)||(this.defaultOptions.preview.theme.path="".concat(this.options.cdn,"/dist/css/content-theme")),(null===(_j=this.options.hint)||void 0===_j?void 0:_j.emojiPath)||(this.defaultOptions.hint.emojiPath="".concat(this.options.cdn,"/dist/images/emoji"))));var mergedOptions=(0,merge.h)(this.defaultOptions,this.options);if(mergedOptions.cache.enable&&!mergedOptions.cache.id)throw new Error("need options.cache.id, see https://ld246.com/article/1549638745630#options");return mergedOptions},Options2.prototype.mergeToolbar=function(toolbar){var _this=this,toolbarItem=[{icon:'<svg><use xlink:href="#vditor-icon-export"></use></svg>',name:"export",tipPosition:"ne"},{hotkey:"⌘E",icon:'<svg><use xlink:href="#vditor-icon-emoji"></use></svg>',name:"emoji",tipPosition:"ne"},{hotkey:"⌘H",icon:'<svg><use xlink:href="#vditor-icon-headings"></use></svg>',name:"headings",tipPosition:"ne"},{hotkey:"⌘B",icon:'<svg><use xlink:href="#vditor-icon-bold"></use></svg>',name:"bold",prefix:"**",suffix:"**",tipPosition:"ne"},{hotkey:"⌘I",icon:'<svg><use xlink:href="#vditor-icon-italic"></use></svg>',name:"italic",prefix:"*",suffix:"*",tipPosition:"ne"},{hotkey:"⌘D",icon:'<svg><use xlink:href="#vditor-icon-strike"></use></svg>',name:"strike",prefix:"~~",suffix:"~~",tipPosition:"ne"},{hotkey:"⌘K",icon:'<svg><use xlink:href="#vditor-icon-link"></use></svg>',name:"link",prefix:"[",suffix:"](https://)",tipPosition:"n"},{name:"|"},{hotkey:"⌘L",icon:'<svg><use xlink:href="#vditor-icon-list"></use></svg>',name:"list",prefix:"* ",tipPosition:"n"},{hotkey:"⌘O",icon:'<svg><use xlink:href="#vditor-icon-ordered-list"></use></svg>',name:"ordered-list",prefix:"1. ",tipPosition:"n"},{hotkey:"⌘J",icon:'<svg><use xlink:href="#vditor-icon-check"></use></svg>',name:"check",prefix:"* [ ] ",tipPosition:"n"},{hotkey:"⇧⌘I",icon:'<svg><use xlink:href="#vditor-icon-outdent"></use></svg>',name:"outdent",tipPosition:"n"},{hotkey:"⇧⌘O",icon:'<svg><use xlink:href="#vditor-icon-indent"></use></svg>',name:"indent",tipPosition:"n"},{name:"|"},{hotkey:"⌘;",icon:'<svg><use xlink:href="#vditor-icon-quote"></use></svg>',name:"quote",prefix:"> ",tipPosition:"n"},{hotkey:"⇧⌘H",icon:'<svg><use xlink:href="#vditor-icon-line"></use></svg>',name:"line",prefix:"---",tipPosition:"n"},{hotkey:"⌘U",icon:'<svg><use xlink:href="#vditor-icon-code"></use></svg>',name:"code",prefix:"```",suffix:"\n```",tipPosition:"n"},{hotkey:"⌘G",icon:'<svg><use xlink:href="#vditor-icon-inline-code"></use></svg>',name:"inline-code",prefix:"`",suffix:"`",tipPosition:"n"},{hotkey:"⇧⌘B",icon:'<svg><use xlink:href="#vditor-icon-before"></use></svg>',name:"insert-before",tipPosition:"n"},{hotkey:"⇧⌘E",icon:'<svg><use xlink:href="#vditor-icon-after"></use></svg>',name:"insert-after",tipPosition:"n"},{name:"|"},{icon:'<svg><use xlink:href="#vditor-icon-upload"></use></svg>',name:"upload",tipPosition:"n"},{icon:'<svg><use xlink:href="#vditor-icon-record"></use></svg>',name:"record",tipPosition:"n"},{hotkey:"⌘M",icon:'<svg><use xlink:href="#vditor-icon-table"></use></svg>',name:"table",prefix:"| col1",suffix:" | col2 | col3 |\n| --- | --- | --- |\n|  |  |  |\n|  |  |  |",tipPosition:"n"},{name:"|"},{hotkey:"⌘Z",icon:'<svg><use xlink:href="#vditor-icon-undo"></use></svg>',name:"undo",tipPosition:"nw"},{hotkey:"⌘Y",icon:'<svg><use xlink:href="#vditor-icon-redo"></use></svg>',name:"redo",tipPosition:"nw"},{name:"|"},{icon:'<svg><use xlink:href="#vditor-icon-more"></use></svg>',name:"more",tipPosition:"e"},{hotkey:"⌘'",icon:'<svg><use xlink:href="#vditor-icon-fullscreen"></use></svg>',name:"fullscreen",tipPosition:"nw"},{icon:'<svg><use xlink:href="#vditor-icon-edit"></use></svg>',name:"edit-mode",tipPosition:"nw"},{hotkey:"⌘P",icon:'<svg><use xlink:href="#vditor-icon-both"></use></svg>',name:"both",tipPosition:"nw"},{icon:'<svg><use xlink:href="#vditor-icon-preview"></use></svg>',name:"preview",tipPosition:"nw"},{icon:'<svg><use xlink:href="#vditor-icon-align-center"></use></svg>',name:"outline",tipPosition:"nw"},{icon:'<svg><use xlink:href="#vditor-icon-theme"></use></svg>',name:"content-theme",tipPosition:"nw"},{icon:'<svg><use xlink:href="#vditor-icon-code-theme"></use></svg>',name:"code-theme",tipPosition:"nw"},{icon:'<svg><use xlink:href="#vditor-icon-bug"></use></svg>',name:"devtools",tipPosition:"nw"},{icon:'<svg><use xlink:href="#vditor-icon-info"></use></svg>',name:"info",tipPosition:"nw"},{icon:'<svg><use xlink:href="#vditor-icon-help"></use></svg>',name:"help",tipPosition:"nw"},{name:"br"}],toolbarResult=[];return toolbar.forEach((function(menuItem){var currentMenuItem=menuItem;toolbarItem.forEach((function(defaultMenuItem){"string"==typeof menuItem&&defaultMenuItem.name===menuItem&&(currentMenuItem=defaultMenuItem),"object"==typeof menuItem&&defaultMenuItem.name===menuItem.name&&(currentMenuItem=Object.assign({},defaultMenuItem,menuItem))})),menuItem.toolbar&&(currentMenuItem.toolbar=_this.mergeToolbar(menuItem.toolbar)),toolbarResult.push(currentMenuItem)})),toolbarResult},Options2}(),WYSIWYG=function(){function WYSIWYG2(vditor){var _this=this;this.composingLock=!1,this.commentIds=[];var divElement=document.createElement("div");divElement.className="vditor-wysiwyg",divElement.innerHTML='<pre class="vditor-reset" placeholder="'.concat(vditor.options.placeholder,'"\n contenteditable="true" spellcheck="false"></pre>\n<div class="vditor-panel vditor-panel--none"></div>\n<div class="vditor-panel vditor-panel--none">\n    <button type="button" aria-label="').concat(window.VditorI18n.comment,'" class="vditor-icon vditor-tooltipped vditor-tooltipped__n">\n        <svg><use xlink:href="#vditor-icon-comment"></use></svg>\n    </button>\n</div>'),this.element=divElement.firstElementChild,this.popover=divElement.firstElementChild.nextElementSibling,this.selectPopover=divElement.lastElementChild,this.bindEvent(vditor),focusEvent(vditor,this.element),dblclickEvent(vditor,this.element),blurEvent(vditor,this.element),hotkeyEvent(vditor,this.element),selectEvent(vditor,this.element),dropEvent(vditor,this.element),copyEvent(vditor,this.element,this.copy),cutEvent(vditor,this.element,this.copy),vditor.options.comment.enable&&(this.selectPopover.querySelector("button").onclick=function(){var blockStartElement,blockEndElement,id=Lute.NewNodeID(),range=getSelection().getRangeAt(0),rangeClone=range.cloneRange(),contents=range.extractContents(),removeStart=!1,removeEnd=!1;contents.childNodes.forEach((function(item,index){var wrap=!1;if(3===item.nodeType?wrap=!0:item.classList.contains("vditor-comment")?item.classList.contains("vditor-comment")&&item.setAttribute("data-cmtids",item.getAttribute("data-cmtids")+" "+id):wrap=!0,wrap)if(3!==item.nodeType&&"0"===item.getAttribute("data-block")&&0===index&&rangeClone.startOffset>0)item.innerHTML='<span class="vditor-comment" data-cmtids="'.concat(id,'">').concat(item.innerHTML,"</span>"),blockStartElement=item;else if(3!==item.nodeType&&"0"===item.getAttribute("data-block")&&index===contents.childNodes.length-1&&rangeClone.endOffset<rangeClone.endContainer.textContent.length)item.innerHTML='<span class="vditor-comment" data-cmtids="'.concat(id,'">').concat(item.innerHTML,"</span>"),blockEndElement=item;else if(3!==item.nodeType&&"0"===item.getAttribute("data-block"))0===index?removeStart=!0:index===contents.childNodes.length-1&&(removeEnd=!0),item.innerHTML='<span class="vditor-comment" data-cmtids="'.concat(id,'">').concat(item.innerHTML,"</span>");else{var commentElement=document.createElement("span");commentElement.classList.add("vditor-comment"),commentElement.setAttribute("data-cmtids",id),item.parentNode.insertBefore(commentElement,item),commentElement.appendChild(item)}}));var startElement=(0,hasClosest.pt)(rangeClone.startContainer);startElement&&(blockStartElement?(startElement.insertAdjacentHTML("beforeend",blockStartElement.innerHTML),blockStartElement.remove()):""===startElement.textContent.trim().replace(constants.Y.ZWSP,"")&&removeStart&&startElement.remove());var endElement=(0,hasClosest.pt)(rangeClone.endContainer);endElement&&(blockEndElement?(endElement.insertAdjacentHTML("afterbegin",blockEndElement.innerHTML),blockEndElement.remove()):""===endElement.textContent.trim().replace(constants.Y.ZWSP,"")&&removeEnd&&endElement.remove()),range.insertNode(contents),vditor.options.comment.add(id,range.toString(),_this.getComments(vditor,!0)),afterRenderEvent(vditor,{enableAddUndoStack:!0,enableHint:!1,enableInput:!1}),_this.hideComment()})}return WYSIWYG2.prototype.getComments=function(vditor,getData){var _this=this;if(void 0===getData&&(getData=!1),"wysiwyg"!==vditor.currentMode||!vditor.options.comment.enable)return[];this.commentIds=[],this.element.querySelectorAll(".vditor-comment").forEach((function(item){_this.commentIds=_this.commentIds.concat(item.getAttribute("data-cmtids").split(" "))})),this.commentIds=Array.from(new Set(this.commentIds));var comments_1=[];return getData?(this.commentIds.forEach((function(id){comments_1.push({id:id,top:_this.element.querySelector('.vditor-comment[data-cmtids="'.concat(id,'"]')).offsetTop})})),comments_1):void 0},WYSIWYG2.prototype.triggerRemoveComment=function(vditor){var a,b,s;if("wysiwyg"===vditor.currentMode&&vditor.options.comment.enable&&vditor.wysiwyg.commentIds.length>0){var oldIds=JSON.parse(JSON.stringify(this.commentIds));this.getComments(vditor);var removedIds=(a=oldIds,b=this.commentIds,s=new Set(b),a.filter((function(x){return!s.has(x)})));removedIds.length>0&&vditor.options.comment.remove(removedIds)}},WYSIWYG2.prototype.showComment=function(){var position=(0,selection.Ey)(this.element);this.selectPopover.setAttribute("style","left:".concat(position.left,"px;display:block;top:").concat(Math.max(-8,position.top-21),"px"))},WYSIWYG2.prototype.hideComment=function(){this.selectPopover.setAttribute("style","display:none")},WYSIWYG2.prototype.unbindListener=function(){window.removeEventListener("scroll",this.scrollListener)},WYSIWYG2.prototype.copy=function(event,vditor){var range=getSelection().getRangeAt(0);if(""!==range.toString()){event.stopPropagation(),event.preventDefault();var codeElement=(0,hasClosest._Y)(range.startContainer,"CODE"),codeEndElement=(0,hasClosest._Y)(range.endContainer,"CODE");if(codeElement&&codeEndElement&&codeEndElement.isSameNode(codeElement)){var codeText="";return codeText="PRE"===codeElement.parentElement.tagName?range.toString():"`"+range.toString()+"`",event.clipboardData.setData("text/plain",codeText),void event.clipboardData.setData("text/html","")}var aElement=(0,hasClosest._Y)(range.startContainer,"A"),aEndElement=(0,hasClosest._Y)(range.endContainer,"A");if(aElement&&aEndElement&&aEndElement.isSameNode(aElement)){var aTitle=aElement.getAttribute("title")||"";return aTitle&&(aTitle=' "'.concat(aTitle,'"')),event.clipboardData.setData("text/plain","[".concat(range.toString(),"](").concat(aElement.getAttribute("href")).concat(aTitle,")")),void event.clipboardData.setData("text/html","")}var tempElement=document.createElement("div");tempElement.appendChild(range.cloneContents()),event.clipboardData.setData("text/plain",vditor.lute.VditorDOM2Md(tempElement.innerHTML).trim()),event.clipboardData.setData("text/html","")}},WYSIWYG2.prototype.bindEvent=function(vditor){var _this=this;this.unbindListener(),window.addEventListener("scroll",this.scrollListener=function(){if(hidePanel(vditor,["hint"]),"block"===_this.popover.style.display&&"block"===_this.selectPopover.style.display){var top=parseInt(_this.popover.getAttribute("data-top"),10);if("auto"===vditor.options.height){if(vditor.options.toolbarConfig.pin){var popoverTop1=Math.max(top,window.scrollY-vditor.element.offsetTop-8)+"px";"block"===_this.popover.style.display&&(_this.popover.style.top=popoverTop1),"block"===_this.selectPopover.style.display&&(_this.selectPopover.style.top=popoverTop1)}}else if(vditor.options.toolbarConfig.pin&&0===vditor.toolbar.element.getBoundingClientRect().top){var popoverTop=Math.max(window.scrollY-vditor.element.offsetTop-8,Math.min(top-vditor.wysiwyg.element.scrollTop,_this.element.clientHeight-21))+"px";"block"===_this.popover.style.display&&(_this.popover.style.top=popoverTop),"block"===_this.selectPopover.style.display&&(_this.selectPopover.style.top=popoverTop)}}}),this.element.addEventListener("scroll",(function(){if(hidePanel(vditor,["hint"]),vditor.options.comment&&vditor.options.comment.enable&&vditor.options.comment.scroll&&vditor.options.comment.scroll(vditor.wysiwyg.element.scrollTop),"block"===_this.popover.style.display){var top=parseInt(_this.popover.getAttribute("data-top"),10)-vditor.wysiwyg.element.scrollTop,max=-8;vditor.options.toolbarConfig.pin&&0===vditor.toolbar.element.getBoundingClientRect().top&&(max=window.scrollY-vditor.element.offsetTop+max);var topPx=Math.max(max,Math.min(top,_this.element.clientHeight-21))+"px";_this.popover.style.top=topPx,_this.selectPopover.style.top=topPx}})),this.element.addEventListener("paste",(function(event){paste(vditor,event,{pasteCode:function(code){var range=(0,selection.RN)(vditor),node=document.createElement("template");node.innerHTML=code,range.insertNode(node.content.cloneNode(!0));var blockElement=(0,hasClosest.Th)(range.startContainer,"data-block","0");blockElement?blockElement.outerHTML=vditor.lute.SpinVditorDOM(blockElement.outerHTML):vditor.wysiwyg.element.innerHTML=vditor.lute.SpinVditorDOM(vditor.wysiwyg.element.innerHTML),(0,selection.ir)(vditor.wysiwyg.element,range)}})})),this.element.addEventListener("compositionstart",(function(){_this.composingLock=!0})),this.element.addEventListener("compositionend",(function(event){var headingElement=(0,hasClosestByHeadings.c)(getSelection().getRangeAt(0).startContainer);headingElement&&""===headingElement.textContent?renderToc(vditor):((0,compatibility.gm)()||input_input(vditor,getSelection().getRangeAt(0).cloneRange(),event),_this.composingLock=!1)})),this.element.addEventListener("input",(function(event){if("deleteByDrag"!==event.inputType&&"insertFromDrop"!==event.inputType){if(_this.preventInput)return _this.preventInput=!1,void afterRenderEvent(vditor);if(_this.composingLock||"‘"===event.data||"“"===event.data||"《"===event.data)afterRenderEvent(vditor);else{var range=getSelection().getRangeAt(0),blockElement=(0,hasClosest.pt)(range.startContainer);if(blockElement||(modifyPre(vditor,range),blockElement=(0,hasClosest.pt)(range.startContainer)),blockElement){for(var startOffset=(0,selection.ED)(blockElement,vditor.wysiwyg.element,range).start,startSpace=!0,i=startOffset-1;i>blockElement.textContent.substr(0,startOffset).lastIndexOf("\n");i--)if(" "!==blockElement.textContent.charAt(i)&&"\t"!==blockElement.textContent.charAt(i)){startSpace=!1;break}0===startOffset&&(startSpace=!1);var endSpace=!0;for(i=startOffset-1;i<blockElement.textContent.length;i++)if(" "!==blockElement.textContent.charAt(i)&&"\n"!==blockElement.textContent.charAt(i)){endSpace=!1;break}endSpace&&/^#{1,6} $/.test(blockElement.textContent)&&(endSpace=!1);var headingElement=(0,hasClosestByHeadings.c)(getSelection().getRangeAt(0).startContainer);headingElement&&""===headingElement.textContent&&(renderToc(vditor),headingElement.remove()),startSpace&&"code-block"!==blockElement.getAttribute("data-type")||endSpace||isHeadingMD(blockElement.innerHTML)||isHrMD(blockElement.innerHTML)&&blockElement.previousElementSibling?"function"==typeof vditor.options.input&&vditor.options.input(getMarkdown(vditor)):("insertParagraph"===event.inputType&&"<p><br></p><p><br></p>"===_this.element.innerHTML&&blockElement.previousElementSibling.remove(),input_input(vditor,range,event))}}}})),this.element.addEventListener("click",(function(event){if("INPUT"===event.target.tagName){var checkElement=event.target;return checkElement.checked?checkElement.setAttribute("checked","checked"):checkElement.removeAttribute("checked"),_this.preventInput=!0,getSelection().rangeCount>0&&(0,selection.jl)(getSelection().getRangeAt(0)),void afterRenderEvent(vditor)}if("IMG"!==event.target.tagName||event.target.parentElement.classList.contains("vditor-wysiwyg__preview")){var a=(0,hasClosest._Y)(event.target,"A");if(a)return vditor.options.link.click?vditor.options.link.click(a):vditor.options.link.isOpen&&window.open(a.getAttribute("href")),void event.preventDefault();var range=(0,selection.RN)(vditor);if(event.target.isEqualNode(_this.element)&&_this.element.lastElementChild&&range.collapsed){var lastRect=_this.element.lastElementChild.getBoundingClientRect();event.y>lastRect.top+lastRect.height&&("P"===_this.element.lastElementChild.tagName&&""===_this.element.lastElementChild.textContent.trim().replace(constants.Y.ZWSP,"")?(range.selectNodeContents(_this.element.lastElementChild),range.collapse(!1)):(_this.element.insertAdjacentHTML("beforeend",'<p data-block="0">'.concat(constants.Y.ZWSP,"<wbr></p>")),(0,selection.ir)(_this.element,range)))}highlightToolbarWYSIWYG(vditor);var previewElement=(0,hasClosest.KJ)(event.target,"vditor-wysiwyg__preview");previewElement||(previewElement=(0,hasClosest.KJ)((0,selection.RN)(vditor).startContainer,"vditor-wysiwyg__preview")),previewElement&&showCode(previewElement,vditor),clickToc(event,vditor)}else"link-ref"===event.target.getAttribute("data-type")?genLinkRefPopover(vditor,event.target):function(event,vditor){var imgElement=event.target;vditor.wysiwyg.popover.innerHTML="";var updateImg=function(){imgElement.setAttribute("src",inputElement.value),imgElement.setAttribute("alt",alt.value),imgElement.setAttribute("title",title.value),"function"==typeof vditor.options.input&&vditor.options.input(getMarkdown(vditor))},inputWrap=document.createElement("span");inputWrap.setAttribute("aria-label",window.VditorI18n.imageURL),inputWrap.className="vditor-tooltipped vditor-tooltipped__n";var inputElement=document.createElement("input");inputWrap.appendChild(inputElement),inputElement.className="vditor-input",inputElement.setAttribute("placeholder",window.VditorI18n.imageURL),inputElement.value=imgElement.getAttribute("src")||"",inputElement.oninput=function(){updateImg()},inputElement.onkeydown=function(elementEvent){removeBlockElement(vditor,elementEvent)};var altWrap=document.createElement("span");altWrap.setAttribute("aria-label",window.VditorI18n.alternateText),altWrap.className="vditor-tooltipped vditor-tooltipped__n";var alt=document.createElement("input");altWrap.appendChild(alt),alt.className="vditor-input",alt.setAttribute("placeholder",window.VditorI18n.alternateText),alt.style.width="52px",alt.value=imgElement.getAttribute("alt")||"",alt.oninput=function(){updateImg()},alt.onkeydown=function(elementEvent){removeBlockElement(vditor,elementEvent)};var titleWrap=document.createElement("span");titleWrap.setAttribute("aria-label",window.VditorI18n.title),titleWrap.className="vditor-tooltipped vditor-tooltipped__n";var title=document.createElement("input");titleWrap.appendChild(title),title.className="vditor-input",title.setAttribute("placeholder",window.VditorI18n.title),title.value=imgElement.getAttribute("title")||"",title.oninput=function(){updateImg()},title.onkeydown=function(elementEvent){removeBlockElement(vditor,elementEvent)},genClose(imgElement,vditor),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",inputWrap),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",altWrap),vditor.wysiwyg.popover.insertAdjacentElement("beforeend",titleWrap),setPopoverPosition(vditor,imgElement)}(event,vditor)})),this.element.addEventListener("keyup",(function(event){if(!event.isComposing&&!(0,compatibility._0)(event)){"Enter"===event.key&&scrollCenter(vditor),"Backspace"!==event.key&&"Delete"!==event.key||""===vditor.wysiwyg.element.innerHTML||1!==vditor.wysiwyg.element.childNodes.length||!vditor.wysiwyg.element.firstElementChild||"P"!==vditor.wysiwyg.element.firstElementChild.tagName||0!==vditor.wysiwyg.element.firstElementChild.childElementCount||""!==vditor.wysiwyg.element.textContent&&"\n"!==vditor.wysiwyg.element.textContent||(vditor.wysiwyg.element.innerHTML="");var range=(0,selection.RN)(vditor);if("Backspace"===event.key&&(0,compatibility.gm)()&&"\n"===range.startContainer.textContent&&1===range.startOffset&&(range.startContainer.textContent=""),modifyPre(vditor,range),highlightToolbarWYSIWYG(vditor),"ArrowDown"===event.key||"ArrowRight"===event.key||"Backspace"===event.key||"ArrowLeft"===event.key||"ArrowUp"===event.key){"ArrowLeft"!==event.key&&"ArrowRight"!==event.key||vditor.hint.render(vditor);var previewElement=(0,hasClosest.KJ)(range.startContainer,"vditor-wysiwyg__preview");if(!previewElement&&3!==range.startContainer.nodeType&&range.startOffset>0&&(blockRenderElement=range.startContainer).classList.contains("vditor-wysiwyg__block")&&(previewElement=blockRenderElement.lastElementChild),previewElement)if("none"!==previewElement.previousElementSibling.style.display){var codeElement=previewElement.previousElementSibling;if("PRE"===codeElement.tagName&&(codeElement=codeElement.firstElementChild),"ArrowDown"===event.key||"ArrowRight"===event.key){var blockRenderElement,nextNode=function(blockCodeElement){for(var nextNode=blockCodeElement;nextNode&&!nextNode.nextSibling;)nextNode=nextNode.parentElement;return nextNode.nextSibling}(blockRenderElement=previewElement.parentElement);if(nextNode&&3!==nextNode.nodeType){var nextRenderElement=nextNode.querySelector(".vditor-wysiwyg__preview");if(nextRenderElement)return void showCode(nextRenderElement,vditor)}if(3===nextNode.nodeType){for(;0===nextNode.textContent.length&&nextNode.nextSibling;)nextNode=nextNode.nextSibling;range.setStart(nextNode,1)}else range.setStart(nextNode.firstChild,0)}else range.selectNodeContents(codeElement),range.collapse(!1)}else"ArrowDown"===event.key||"ArrowRight"===event.key?showCode(previewElement,vditor):showCode(previewElement,vditor,!1)}}}))},WYSIWYG2}(),src_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])})(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();const src=function(_super){function Vditor3(id,options){var _this=_super.call(this)||this;if(_this.version=constants.g,"string"==typeof id){if(options?options.cache?options.cache.id||(options.cache.id="vditor".concat(id)):options.cache={id:"vditor".concat(id)}:options={cache:{id:"vditor".concat(id)}},!document.getElementById(id))return _this.showErrorTip("Failed to get element by id: ".concat(id)),_this;id=document.getElementById(id)}var mergedOptions=new Options(options).merge();if(mergedOptions.i18n)window.VditorI18n=mergedOptions.i18n,_this.init(id,mergedOptions);else{if(!["en_US","fr_FR","pt_BR","ja_JP","ko_KR","ru_RU","sv_SE","zh_CN","zh_TW"].includes(mergedOptions.lang))throw new Error("options.lang error, see https://ld246.com/article/1549638745630#options");var i18nScriptID_1="vditorI18nScript"+mergedOptions.lang;document.querySelectorAll('head script[id^="'.concat("vditorI18nScript",'"]')).forEach((function(el){el.id!==i18nScriptID_1&&document.head.removeChild(el)})),(0,addScript.Z)("".concat(mergedOptions.cdn,"/dist/js/i18n/").concat(mergedOptions.lang,".js"),i18nScriptID_1).then((function(){_this.init(id,mergedOptions)})).catch((function(error){_this.showErrorTip("GET ".concat(mergedOptions.cdn,"/dist/js/i18n/").concat(mergedOptions.lang,".js net::ERR_ABORTED 404 (Not Found)"))}))}return _this}return src_extends(Vditor3,_super),Vditor3.prototype.showErrorTip=function(error){var tip=new Tip;document.body.appendChild(tip.element),tip.show(error,0)},Vditor3.prototype.updateToolbarConfig=function(options){this.vditor.toolbar.updateConfig(this.vditor,options)},Vditor3.prototype.setTheme=function(theme,contentTheme,codeTheme,contentThemePath){this.vditor.options.theme=theme,setTheme(this.vditor),contentTheme&&(this.vditor.options.preview.theme.current=contentTheme,(0,setContentTheme.H)(contentTheme,contentThemePath||this.vditor.options.preview.theme.path)),codeTheme&&(this.vditor.options.preview.hljs.style=codeTheme,(0,setCodeTheme.h)(codeTheme,this.vditor.options.cdn))},Vditor3.prototype.getValue=function(){return getMarkdown(this.vditor)},Vditor3.prototype.getCurrentMode=function(){return this.vditor.currentMode},Vditor3.prototype.focus=function(){"sv"===this.vditor.currentMode?this.vditor.sv.element.focus():"wysiwyg"===this.vditor.currentMode?this.vditor.wysiwyg.element.focus():"ir"===this.vditor.currentMode&&this.vditor.ir.element.focus()},Vditor3.prototype.blur=function(){"sv"===this.vditor.currentMode?this.vditor.sv.element.blur():"wysiwyg"===this.vditor.currentMode?this.vditor.wysiwyg.element.blur():"ir"===this.vditor.currentMode&&this.vditor.ir.element.blur()},Vditor3.prototype.disabled=function(){hidePanel(this.vditor,["subToolbar","hint","popover"]),disableToolbar(this.vditor.toolbar.elements,constants.Y.EDIT_TOOLBARS.concat(["undo","redo","fullscreen","edit-mode"])),this.vditor[this.vditor.currentMode].element.setAttribute("contenteditable","false")},Vditor3.prototype.enable=function(){enableToolbar(this.vditor.toolbar.elements,constants.Y.EDIT_TOOLBARS.concat(["undo","redo","fullscreen","edit-mode"])),this.vditor.undo.resetIcon(this.vditor),this.vditor[this.vditor.currentMode].element.setAttribute("contenteditable","true")},Vditor3.prototype.getSelection=function(){return"wysiwyg"===this.vditor.currentMode?getSelectText(this.vditor.wysiwyg.element):"sv"===this.vditor.currentMode?getSelectText(this.vditor.sv.element):"ir"===this.vditor.currentMode?getSelectText(this.vditor.ir.element):void 0},Vditor3.prototype.renderPreview=function(value){this.vditor.preview.render(this.vditor,value)},Vditor3.prototype.getCursorPosition=function(){return(0,selection.Ey)(this.vditor[this.vditor.currentMode].element)},Vditor3.prototype.isUploading=function(){return this.vditor.upload.isUploading},Vditor3.prototype.clearCache=function(){this.vditor.options.cache.enable&&(0,compatibility.D)()&&localStorage.removeItem(this.vditor.options.cache.id)},Vditor3.prototype.disabledCache=function(){this.vditor.options.cache.enable=!1},Vditor3.prototype.enableCache=function(){if(!this.vditor.options.cache.id)throw new Error("need options.cache.id, see https://ld246.com/article/1549638745630#options");this.vditor.options.cache.enable=!0},Vditor3.prototype.html2md=function(value){return this.vditor.lute.HTML2Md(value)},Vditor3.prototype.exportJSON=function(value){return this.vditor.lute.RenderJSON(value)},Vditor3.prototype.getHTML=function(){return getHTML(this.vditor)},Vditor3.prototype.tip=function(text,time){this.vditor.tip.show(text,time)},Vditor3.prototype.setPreviewMode=function(mode){setPreviewMode(mode,this.vditor)},Vditor3.prototype.deleteValue=function(){window.getSelection().isCollapsed||document.execCommand("delete",!1)},Vditor3.prototype.updateValue=function(value){document.execCommand("insertHTML",!1,value)},Vditor3.prototype.insertValue=function(value,render){void 0===render&&(render=!0);var range=(0,selection.RN)(this.vditor);range.collapse(!0);var tmpElement=document.createElement("template");tmpElement.innerHTML=value,range.insertNode(tmpElement.content.cloneNode(!0)),range.collapse(!1),"sv"===this.vditor.currentMode?(this.vditor.sv.preventInput=!0,render&&inputEvent(this.vditor)):"wysiwyg"===this.vditor.currentMode?render&&input_input(this.vditor,getSelection().getRangeAt(0)):"ir"===this.vditor.currentMode&&(this.vditor.ir.preventInput=!0,render&&input(this.vditor,getSelection().getRangeAt(0),!0))},Vditor3.prototype.insertMD=function(md){"ir"===this.vditor.currentMode?(0,selection.Z2)(this.vditor.lute.Md2VditorIRDOM(md),this.vditor):"wysiwyg"===this.vditor.currentMode?(0,selection.Z2)(this.vditor.lute.Md2VditorDOM(md),this.vditor):processPaste(this.vditor,md),this.vditor.outline.render(this.vditor),execAfterRender(this.vditor)},Vditor3.prototype.setValue=function(markdown,clearStack){var _this=this;void 0===clearStack&&(clearStack=!1),"sv"===this.vditor.currentMode?(this.vditor.sv.element.innerHTML="<div data-block='0'>".concat(this.vditor.lute.SpinVditorSVDOM(markdown),"</div>"),processAfterRender(this.vditor,{enableAddUndoStack:!0,enableHint:!1,enableInput:!1})):"wysiwyg"===this.vditor.currentMode?renderDomByMd(this.vditor,markdown,{enableAddUndoStack:!0,enableHint:!1,enableInput:!1}):(this.vditor.ir.element.innerHTML=this.vditor.lute.Md2VditorIRDOM(markdown),this.vditor.ir.element.querySelectorAll(".vditor-ir__preview[data-render='2']").forEach((function(item){processCodeRender(item,_this.vditor)})),process_processAfterRender(this.vditor,{enableAddUndoStack:!0,enableHint:!1,enableInput:!1})),this.vditor.outline.render(this.vditor),markdown||(hidePanel(this.vditor,["emoji","headings","submenu","hint"]),this.vditor.wysiwyg.popover&&(this.vditor.wysiwyg.popover.style.display="none"),this.clearCache()),clearStack&&this.clearStack()},Vditor3.prototype.clearStack=function(){this.vditor.undo.clearStack(this.vditor),this.vditor.undo.addToUndoStack(this.vditor)},Vditor3.prototype.destroy=function(){this.vditor.element.innerHTML=this.vditor.originalInnerHTML,this.vditor.element.classList.remove("vditor"),this.vditor.element.removeAttribute("style");var iconScript=document.getElementById("vditorIconScript");iconScript&&iconScript.remove(),this.clearCache(),UIUnbindListener(),this.vditor.wysiwyg.unbindListener()},Vditor3.prototype.getCommentIds=function(){return"wysiwyg"!==this.vditor.currentMode?[]:this.vditor.wysiwyg.getComments(this.vditor,!0)},Vditor3.prototype.hlCommentIds=function(ids){if("wysiwyg"===this.vditor.currentMode){var hlItem=function(item){item.classList.remove("vditor-comment--hover"),ids.forEach((function(id){item.getAttribute("data-cmtids").indexOf(id)>-1&&item.classList.add("vditor-comment--hover")}))};this.vditor.wysiwyg.element.querySelectorAll(".vditor-comment").forEach((function(item){hlItem(item)})),"none"!==this.vditor.preview.element.style.display&&this.vditor.preview.element.querySelectorAll(".vditor-comment").forEach((function(item){hlItem(item)}))}},Vditor3.prototype.unHlCommentIds=function(ids){if("wysiwyg"===this.vditor.currentMode){var unHlItem=function(item){ids.forEach((function(id){item.getAttribute("data-cmtids").indexOf(id)>-1&&item.classList.remove("vditor-comment--hover")}))};this.vditor.wysiwyg.element.querySelectorAll(".vditor-comment").forEach((function(item){unHlItem(item)})),"none"!==this.vditor.preview.element.style.display&&this.vditor.preview.element.querySelectorAll(".vditor-comment").forEach((function(item){unHlItem(item)}))}},Vditor3.prototype.removeCommentIds=function(removeIds){var _this=this;if("wysiwyg"===this.vditor.currentMode){var removeItem=function(item,removeId){var ids=item.getAttribute("data-cmtids").split(" ");ids.find((function(id,index){if(id===removeId)return ids.splice(index,1),!0})),0===ids.length?(item.outerHTML=item.innerHTML,(0,selection.RN)(_this.vditor).collapse(!0)):item.setAttribute("data-cmtids",ids.join(" "))};removeIds.forEach((function(removeId){_this.vditor.wysiwyg.element.querySelectorAll(".vditor-comment").forEach((function(item){removeItem(item,removeId)})),"none"!==_this.vditor.preview.element.style.display&&_this.vditor.preview.element.querySelectorAll(".vditor-comment").forEach((function(item){removeItem(item,removeId)}))})),afterRenderEvent(this.vditor,{enableAddUndoStack:!0,enableHint:!1,enableInput:!1})}},Vditor3.prototype.init=function(id,mergedOptions){var _this=this;this.vditor={currentMode:mergedOptions.mode,element:id,hint:new Hint(mergedOptions.hint.extend),lute:void 0,options:mergedOptions,originalInnerHTML:id.innerHTML,outline:new Outline(window.VditorI18n.outline),tip:new Tip},this.vditor.sv=new Editor(this.vditor),this.vditor.undo=new undo_Undo,this.vditor.wysiwyg=new WYSIWYG(this.vditor),this.vditor.ir=new IR(this.vditor),this.vditor.toolbar=new Toolbar(this.vditor),mergedOptions.resize.enable&&(this.vditor.resize=new Resize(this.vditor)),this.vditor.toolbar.elements.devtools&&(this.vditor.devtools=new DevTools),(mergedOptions.upload.url||mergedOptions.upload.handler)&&(this.vditor.upload=new Upload),(0,addScript.Z)(mergedOptions._lutePath||"".concat(mergedOptions.cdn,"/dist/js/lute/lute.min.js"),"vditorLuteScript").then((function(){_this.vditor.lute=(0,setLute.X)({autoSpace:_this.vditor.options.preview.markdown.autoSpace,gfmAutoLink:_this.vditor.options.preview.markdown.gfmAutoLink,codeBlockPreview:_this.vditor.options.preview.markdown.codeBlockPreview,emojiSite:_this.vditor.options.hint.emojiPath,emojis:_this.vditor.options.hint.emoji,fixTermTypo:_this.vditor.options.preview.markdown.fixTermTypo,footnotes:_this.vditor.options.preview.markdown.footnotes,headingAnchor:!1,inlineMathDigit:_this.vditor.options.preview.math.inlineDigit,linkBase:_this.vditor.options.preview.markdown.linkBase,linkPrefix:_this.vditor.options.preview.markdown.linkPrefix,listStyle:_this.vditor.options.preview.markdown.listStyle,mark:_this.vditor.options.preview.markdown.mark,mathBlockPreview:_this.vditor.options.preview.markdown.mathBlockPreview,paragraphBeginningSpace:_this.vditor.options.preview.markdown.paragraphBeginningSpace,sanitize:_this.vditor.options.preview.markdown.sanitize,toc:_this.vditor.options.preview.markdown.toc}),_this.vditor.preview=new Preview(_this.vditor),function(vditor){vditor.element.innerHTML="",vditor.element.classList.add("vditor"),vditor.options.rtl&&vditor.element.setAttribute("dir","rtl"),setTheme(vditor),(0,setContentTheme.H)(vditor.options.preview.theme.current,vditor.options.preview.theme.path),"number"==typeof vditor.options.height?vditor.element.style.height=vditor.options.height+"px":vditor.element.style.height=vditor.options.height,"number"==typeof vditor.options.minHeight&&(vditor.element.style.minHeight=vditor.options.minHeight+"px"),"number"==typeof vditor.options.width?vditor.element.style.width=vditor.options.width+"px":vditor.element.style.width=vditor.options.width,vditor.element.appendChild(vditor.toolbar.element);var contentElement=document.createElement("div");if(contentElement.className="vditor-content","left"===vditor.options.outline.position&&contentElement.appendChild(vditor.outline.element),contentElement.appendChild(vditor.wysiwyg.element.parentElement),contentElement.appendChild(vditor.sv.element),contentElement.appendChild(vditor.ir.element.parentElement),contentElement.appendChild(vditor.preview.element),vditor.toolbar.elements.devtools&&contentElement.appendChild(vditor.devtools.element),"right"===vditor.options.outline.position&&(vditor.outline.element.classList.add("vditor-outline--right"),contentElement.appendChild(vditor.outline.element)),vditor.upload&&contentElement.appendChild(vditor.upload.element),vditor.options.resize.enable&&contentElement.appendChild(vditor.resize.element),contentElement.appendChild(vditor.hint.element),contentElement.appendChild(vditor.tip.element),vditor.element.appendChild(contentElement),contentElement.addEventListener("click",(function(){hidePanel(vditor,["subToolbar"])})),vditor.toolbar.elements.export&&vditor.element.insertAdjacentHTML("beforeend",'<iframe id="vditorExportIframe" style="width: 100%;height: 0;border: 0"></iframe>'),setEditMode(vditor,vditor.options.mode,afterRender(vditor)),document.execCommand("DefaultParagraphSeparator",!1,"p"),navigator.userAgent.indexOf("iPhone")>-1&&void 0!==window.visualViewport){var pendingUpdate_1=!1,viewportHandler=function(event){pendingUpdate_1||(pendingUpdate_1=!0,requestAnimationFrame((function(){pendingUpdate_1=!1;var layoutViewport=vditor.toolbar.element;layoutViewport.style.transform="none",layoutViewport.getBoundingClientRect().top<0&&(layoutViewport.style.transform="translate(0, ".concat(-layoutViewport.getBoundingClientRect().top,"px)"))})))};window.visualViewport.addEventListener("scroll",viewportHandler),window.visualViewport.addEventListener("resize",viewportHandler)}}(_this.vditor),mergedOptions.after&&mergedOptions.after(),mergedOptions.icon&&(0,addScript.U)("".concat(mergedOptions.cdn,"/dist/js/icons/").concat(mergedOptions.icon,".js"),"vditorIconScript")}))},Vditor3}(method.default)})(),__webpack_exports__=__webpack_exports__.default})())()),_sfc_main$2=defineComponent({inheritAttrs:!1,props:{height:{type:Number,default:360},value:{type:String,default:""}},emits:["change","get","update:value"],setup(props,{attrs:attrs,emit:emit}){const wrapRef=ref(null),vditorRef=ref(null),initedRef=ref(!1),modalFn=useModalContext(),{getLocale:getLocale}=useLocale(),{getDarkMode:getDarkMode}=useRootSetting(),valueRef=ref(props.value||"");watch([()=>getDarkMode.value,()=>initedRef.value],(([val,inited])=>{var _a;inited&&(null==(_a=instance.getVditor())||_a.setTheme(getTheme(val),getTheme(val,"content"),getTheme(val,"code")))}),{immediate:!0,flush:"post"}),watch((()=>props.value),(v=>{var _a;v!==valueRef.value&&(null==(_a=instance.getVditor())||_a.setValue(v)),valueRef.value=v}));const getCurrentLang=computed((()=>{let lang;switch(unref(getLocale)){case"en":lang="en_US";break;case"ja":lang="ja_JP";break;case"ko":lang="ko_KR";break;default:lang="zh_CN"}return lang}));const instance={getVditor:()=>vditorRef.value};function destroy(){var _a;const vditorInstance=unref(vditorRef);if(vditorInstance){try{null==(_a=null==vditorInstance?void 0:vditorInstance.destroy)||_a.call(vditorInstance)}catch(error){}vditorRef.value=null,initedRef.value=!1}}return onMountedOrActivated((function(){const wrapEl=unref(wrapRef);if(!wrapEl)return;const bindValue=__spreadValues(__spreadValues({},attrs),props),insEditor=new Vditor(wrapEl,__spreadProps(__spreadValues({theme:getTheme(getDarkMode.value),lang:unref(getCurrentLang),mode:"sv",fullscreen:{index:520},preview:{theme:{current:getTheme(getDarkMode.value,"content")},hljs:{style:getTheme(getDarkMode.value,"code")},actions:[]},input:v=>{valueRef.value=v,emit("update:value",v),emit("change",v)},after:()=>{nextTick((()=>{var _a;null==(_a=null==modalFn?void 0:modalFn.redoModalHeight)||_a.call(modalFn),insEditor.setValue(valueRef.value),vditorRef.value=insEditor,initedRef.value=!0,emit("get",instance)}))},blur:()=>{}},bindValue),{cache:{enable:!1}}))})),onBeforeUnmount(destroy),onDeactivated(destroy),__spreadValues({wrapRef:wrapRef},instance)}}),_hoisted_1$1={ref:"wrapRef"};withInstall(_export_sfc(_sfc_main$2,[["render",function(_ctx,_cache,$props,$setup,$data,$options){return openBlock(),createElementBlock("div",_hoisted_1$1,null,512)}]]));const MarkdownViewer=withInstall(_sfc_main$3);const PluginConfigForm=_export_sfc(defineComponent({name:"PluginConfigForm",components:{BasicForm:BasicForm},props:{plugin:{type:Object,required:!0},softGrouping:{type:Boolean,default:!1},activeGroupKey:{type:String,default:"default"},softGroupList:{type:Array,default:()=>[]}},emits:["register","update:activeGroupKey","update:softGroupList"],setup(props,{emit:emit}){const{createMessage:$message,createErrorModal:createErrorModal}=useMessage(),loading=ref(!1);let initGroupKey="";const softGroupMap=new Map,schemas=function(){var _a;if(!props.softGrouping)return props.plugin.schemas;softGroupMap.clear();const schemas2=lodash.cloneDeep(props.plugin.schemas),genIfShowFn=groupKey=>()=>props.activeGroupKey===groupKey,active={name:"default",show:genIfShowFn("default")};softGroupMap.set(active.name,{name:active.name,title:"默认",count:0});for(const schema of schemas2){if("SOFT_GROUP_BEGIN"===schema.component){schema.ifShow=!1,active.name=schema.label,active.show=genIfShowFn(active.name);continue}if("function"==typeof schema.show){const oldShow=schema.show;schema.show=(...args)=>active.show()&&oldShow(...args)}else schema.show=active.show;const group=softGroupMap.get(active.name)||{name:active.name,count:0};group.count++,softGroupMap.set(active.name,group)}let groupKeys=Array.from(softGroupMap.keys());for(const key of groupKeys)(null==(_a=softGroupMap.get(key))?void 0:_a.count)||softGroupMap.delete(key);if(groupKeys=Array.from(softGroupMap.keys()),1==groupKeys.length)return props.plugin.schemas;let activeGroup=softGroupMap.get(props.activeGroupKey);(null==activeGroup?void 0:activeGroup.count)||(initGroupKey=groupKeys[0],emit("update:activeGroupKey",initGroupKey));const softGroupList=[];return Array.from(softGroupMap.entries()).forEach((([key,value])=>softGroupList.push({name:key,title:value.title||key}))),emit("update:softGroupList",softGroupList),schemas2}(),[registerForm,formActions]=useForm({labelWidth:120,schemas:schemas,labelAlign:"right",showActionButtonGroup:!1,baseColProps:{span:24}});provide("formActions",formActions),provide("pluginInfo",props.plugin);const{setFieldsValue:setFieldsValue,validate:validate}=formActions;const url=computed((()=>`/plugin/s/${props.plugin.name}/config`));function getPluginConfigData(){return __async(this,null,(function*(){try{loading.value=!0;let result=yield defHttp.get({url:url.value},{errorMessageMode:"modal"});yield setFieldsValue(result)}finally{loading.value=!1}}))}function savePluginConfigData(){return __async(this,null,(function*(){let values=yield validate(),{ok:ok,message:message}=yield defHttp.put({url:url.value,params:values},{trimValues:!1,isTransformResponse:!1});ok?($message.success(message||"保存成功！"),yield getPluginConfigData()):createErrorModal({title:"错误",content:message||"保存失败！"})}))}return provide("doFormSubmit",savePluginConfigData),{registerForm:(...args)=>{registerForm(...args),getPluginConfigData()},loading:loading,savePluginConfigData:savePluginConfigData}}}),[["render",function(_ctx,_cache,$props,$setup,$data,$options){const _component_BasicForm=resolveComponent("BasicForm"),_component_a_spin=resolveComponent("a-spin");return openBlock(),createBlock(_component_a_spin,{spinning:_ctx.loading},{default:withCtx((()=>[createVNode(_component_BasicForm,{onRegister:_ctx.registerForm},null,8,["onRegister"])])),_:1},8,["spinning"])}]]),_hoisted_1={key:0};const GPluginModal=_export_sfc(defineComponent({name:"GPluginModal",components:{PluginConfigForm:PluginConfigForm,Scrollbar:Scrollbar,BasicModal:BasicModal,Description:Description,MarkdownViewer:MarkdownViewer},emits:["register","success"],setup(props){const configFormRef=ref(),attrs=useAttrs(),{prefixCls:prefixCls}=useDesign("g-plugin-modal"),{createMessage:$message,createConfirm:createConfirm}=useMessage(),go=useGo(),loading=ref(!1),loadingTip=ref(""),initOk=ref(!1),activeKey=ref("desc"),plugin=ref(),readme=ref(""),[registerModal,{closeModal:closeModal,setModalProps:setModalProps,getVisible:getVisible}]=useModalInner((function(data){return __async(this,null,(function*(){readme.value="",activeKey.value="desc",plugin.value=data.plugin}))})),[registerDesc,{}]=useDescription({column:1,schema:[{label:"插件标题",field:"title"},{label:"插件名称",field:"name"},{label:"插件作者",field:"author",render:(_,record)=>parseAuthorLink(record)},{label:"插件链接",field:"link",render:val=>createVNode("a",{href:val,target:"_blank"},[val])},{label:"插件说明",field:"description"},{label:"状态",field:"installed",render:(_,record)=>getStatusTags(record,0)}]}),getProps=computed((()=>{let modalProps={width:800,title:"插件详情",wrapClassName:prefixCls,confirmLoading:unref(loading),showOkBtn:!1,cancelText:"关闭"};return __spreadProps(__spreadValues(__spreadValues(__spreadValues({},unref(attrs)),modalProps),props),{onOk:close,onCancel:close,onRegister:registerModal})}));watch(activeKey,(val=>{var _a;"readme"===val?readme.value&&function(){__async(this,null,(function*(){setLoading(!0);let timer=setTimeout((()=>{loadingTip.value="github仓库可能会因为网络问题而缓慢，请耐心等待"}),1500);try{plugin.value.link?(readme.value=yield pluginApi.getReadme(plugin.value.link),mdTimer=setTimeout((()=>{loadingTip.value="Markdown编辑器首次使用可能会因为网络原因加载比较慢，请耐心等待"}),1500)):readme.value=""}finally{loadingTip.value="",clearTimeout(timer),setLoading(!1)}}))}():"config"===val&&(null==(_a=plugin.value)?void 0:_a.showInMenu)&&(go(`/plugin/@/${plugin.value.name}`),close())}));const showConfigForm=ref(!1);function close(){closeModal()}function setLoading(flag){loading.value=flag,setModalProps({confirmLoading:flag})}watch(getVisible,(val=>__async(this,null,(function*(){val?(yield sleep(300),showConfigForm.value=!0):(yield sleep(300),showConfigForm.value=!1)}))));let mdTimer=null;const autoRestart=ref(!0),autoNpmInstall=ref(!0);return{configFormRef:configFormRef,registerDesc:registerDesc,getProps:getProps,initOk:initOk,loading:loading,loadingTip:loadingTip,plugin:plugin,readme:readme,activeKey:activeKey,showConfigForm:showConfigForm,close:close,saveConfig:function(){return __async(this,null,(function*(){try{setLoading(!0),yield configFormRef.value.savePluginConfigData()}finally{setLoading(!1)}}))},installNow:function(){return __async(this,null,(function*(){createConfirm({title:"安装插件",iconType:"warning",content:()=>createVNode("div",null,[createVNode("p",null,[createTextVNode("确定要安装该插件吗？")]),createVNode(Checkbox,{checked:autoRestart.value,onChange:e=>{autoRestart.value=e.target.checked,autoRestart.value&&!autoNpmInstall.value&&(autoNpmInstall.value=!0)}},{default:()=>[createTextVNode("自动重启")]}),createVNode(Checkbox,{checked:autoNpmInstall.value,onChange:e=>{!e.target.checked&&autoRestart.value?$message.warn("请先去掉自动重启（自动重启必须自动安装依赖）"):autoNpmInstall.value=e.target.checked}},{default:()=>[createTextVNode("自动安装依赖")]})]),onOk(){return __async(this,null,(function*(){try{setLoading(!0);let data=yield pluginApi.installPlugin(plugin.value.link,{autoRestart:autoRestart.value,autoNpmInstall:autoNpmInstall.value});"success"===data.status?($message.success(data.message),autoRestart.value&&(yield sleep(3e3),window.location.reload())):$message.error(data.message)}finally{setLoading(!1)}}))}})}))},uninstall:function(){return __async(this,null,(function*(){createConfirm({title:"卸载插件",iconType:"warning",content:createVNode("div",null,[createVNode("p",null,[createTextVNode("确定要卸载该插件吗？"),createVNode("br",null,null),createTextVNode("将会删除插件目录包括可能产生的数据以及配置，且无法恢复！")]),createVNode("p",null,[createTextVNode("请谨慎操作，卸载后会立即重启！")])]),onOk(){return __async(this,null,(function*(){try{setLoading(!0);let data=yield pluginApi.uninstallPlugin(plugin.value.name);"success"===data.status?($message.success(data.message),yield sleep(3e3),window.location.reload()):$message.error(data.message)}finally{setLoading(!1)}}))}})}))},onInitOk:function(){clearTimeout(mdTimer),loadingTip.value="",initOk.value=!0}}}}),[["render",function(_ctx,_cache,$props,$setup,$data,$options){const _component_a_empty=resolveComponent("a-empty"),_component_Description=resolveComponent("Description"),_component_a_tab_pane=resolveComponent("a-tab-pane"),_component_PluginConfigForm=resolveComponent("PluginConfigForm"),_component_MarkdownViewer=resolveComponent("MarkdownViewer"),_component_a_tabs=resolveComponent("a-tabs"),_component_a_spin=resolveComponent("a-spin"),_component_a_button=resolveComponent("a-button"),_component_a_col=resolveComponent("a-col"),_component_a_row=resolveComponent("a-row"),_component_BasicModal=resolveComponent("BasicModal");return openBlock(),createBlock(_component_BasicModal,normalizeProps(guardReactiveProps(_ctx.getProps)),{footer:withCtx((()=>[createVNode(_component_a_row,{type:"flex",justify:"space-between"},{default:withCtx((()=>[createVNode(_component_a_col,null,{default:withCtx((()=>{var _a;return[["desc"].includes(_ctx.activeKey)?(openBlock(),createElementBlock(Fragment,{key:0},[(null==(_a=_ctx.plugin)?void 0:_a.installed)?(openBlock(),createBlock(_component_a_button,{key:1,type:"primary",danger:"",disabled:["miao-plugin"].includes(_ctx.plugin.name),onClick:_ctx.uninstall},{default:withCtx((()=>[createTextVNode(" 卸载 ")])),_:1},8,["disabled","onClick"])):(openBlock(),createBlock(_component_a_button,{key:0,type:"primary",onClick:_ctx.installNow},{default:withCtx((()=>[createTextVNode(" 立即安装")])),_:1},8,["onClick"]))],64)):createCommentVNode("",!0)]})),_:1}),createVNode(_component_a_col,null,{default:withCtx((()=>[["desc","readme"].includes(_ctx.activeKey)?(openBlock(),createBlock(_component_a_button,{key:0,onClick:_ctx.close},{default:withCtx((()=>[createTextVNode("关闭")])),_:1},8,["onClick"])):createCommentVNode("",!0),["config"].includes(_ctx.activeKey)?(openBlock(),createBlock(_component_a_button,{key:1,type:"primary",preIcon:"ant-design:save",onClick:_ctx.saveConfig},{default:withCtx((()=>[createTextVNode("保存")])),_:1},8,["onClick"])):createCommentVNode("",!0)])),_:1})])),_:1})])),default:withCtx((()=>[createVNode(_component_a_spin,{spinning:_ctx.loading||"readme"===_ctx.activeKey&&!_ctx.initOk,tip:_ctx.loadingTip},{default:withCtx((()=>[_ctx.plugin?(openBlock(),createBlock(_component_a_tabs,{key:1,"active-key":_ctx.activeKey,"onUpdate:activeKey":_cache[0]||(_cache[0]=$event=>_ctx.activeKey=$event)},{default:withCtx((()=>{var _a;return[createVNode(_component_a_tab_pane,{tab:"详情",key:"desc"},{default:withCtx((()=>[createVNode(_component_Description,{onRegister:_ctx.registerDesc,data:_ctx.plugin},null,8,["onRegister","data"])])),_:1}),(null==(_a=_ctx.plugin)?void 0:_a.hasConfig)?(openBlock(),createBlock(_component_a_tab_pane,{tab:"配置",key:"config"},{default:withCtx((()=>{var _a2;return[!(null==(_a2=_ctx.plugin)?void 0:_a2.showInMenu)&&_ctx.showConfigForm?(openBlock(),createBlock(_component_PluginConfigForm,{key:0,ref:"configFormRef",plugin:_ctx.plugin},null,8,["plugin"])):createCommentVNode("",!0)]})),_:1})):createCommentVNode("",!0),createVNode(_component_a_tab_pane,{tab:"README",key:"readme"},{default:withCtx((()=>[_ctx.loading?(openBlock(),createElementBlock("div",_hoisted_1)):_ctx.readme?(openBlock(),createBlock(_component_MarkdownViewer,{key:2,value:_ctx.readme,onInitOk:_ctx.onInitOk},null,8,["value","onInitOk"])):(openBlock(),createBlock(_component_a_empty,{key:1,description:"README读取失败"}))])),_:1})]})),_:1},8,["active-key"])):(openBlock(),createBlock(_component_a_empty,{key:0,description:"插件加载失败"}))])),_:1},8,["spinning","tip"])])),_:1},16)}]]);export{GPluginModal as G,PluginConfigForm as P};
